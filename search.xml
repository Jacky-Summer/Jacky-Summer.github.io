<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>TypeScript è¿›é˜¶ç»éªŒæ€»ç»“</title>
    <url>/2021/04/21/TypeScript-%E8%BF%9B%E9%98%B6%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¿«ä¸€ä¸ªæœˆæ²¡å†™æ–‡ç« äº†ï¼Œè¿™ä¸ªæœˆä¸»è¦æƒ³æ•´ç†å’Œå¤ç›˜ï¼Œç›®å‰æ‰“ç®—æ˜¯ä¸‹ä¸ªæœˆä¸­æ—¬å†å¼€å§‹æ±‚èŒï¼Œåœ°ç‚¹æ˜¯<strong>æ·±åœ³</strong>ï¼Œå¦‚æœæœ‰å†…æ¨çš„å°ä¼™ä¼´åˆ°æ—¶å¯ä»¥è”ç³»æˆ‘ï¼Œè°¢è°¢ ğŸ˜ã€‚ <a href="https://github.com/Jacky-Summer" target="_blank" rel="noopener">æˆ‘çš„ Github</a></p><p>ä½¿ç”¨ TypeScript ä¹Ÿå¿«ä¸€å¹´äº†ï¼Œæœ¬æ–‡ä¸»è¦åˆ†äº«ä¸€äº›å·¥ä½œå¸¸ç”¨çš„çŸ¥è¯†ç‚¹æŠ€å·§å’Œæ³¨æ„ç‚¹ã€‚</p><p>æœ¬æ–‡é€‚åˆäº†è§£ TypeScript æˆ–æœ‰å®é™…ä½¿ç”¨è¿‡ä¸€æ®µæ—¶é—´çš„å°ä¼™ä¼´ã€‚</p><p>å¦‚æœå¯¹ TypeScript åŸºç¡€çŸ¥è¯†ä¸ç†Ÿæ‚‰çš„å¯ä»¥çœ‹ä¸‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/6886059772451012616" target="_blank" rel="noopener">TypeScript å…¥é—¨çŸ¥è¯†ç‚¹æ€»ç»“</a></p><h2 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h2><h3 id="ç±»å‹åˆ«å"><a href="#ç±»å‹åˆ«å" class="headerlink" title="ç±»å‹åˆ«å"></a>ç±»å‹åˆ«å</h3><p>ç”¨æ¥ç»™ä¸€ä¸ªç±»å‹èµ·ä¸ªæ–°åå­—</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Props = TextProps</span><br></pre></td></tr></table></figure><h3 id="keyof"><a href="#keyof" class="headerlink" title="keyof"></a>keyof</h3><p>ç”¨äºè·å–æŸç§ç±»å‹çš„æ‰€æœ‰é”®ï¼Œå…¶è¿”å›ç±»å‹æ˜¯è”åˆç±»å‹ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PersonKey = keyof Person <span class="comment">// "name" | "age"</span></span><br></pre></td></tr></table></figure><h3 id="è”åˆç±»å‹"><a href="#è”åˆç±»å‹" class="headerlink" title="è”åˆç±»å‹"></a>è”åˆç±»å‹</h3><p>å’Œé€»è¾‘ â€œ||â€ ä¸€æ ·éƒ½æ˜¯è¡¨ç¤ºå…¶ç±»å‹ä¸ºå¤šä¸ªç±»å‹ä¸­çš„ä»»æ„ä¸€ä¸ª</p><p>æ¯”å¦‚å½“ä½ åœ¨å†™<a href="https://github.com/Jacky-Summer/monki-ui/blob/679c4033269714e18cfe095faf4a2b135f4d5fe2/components/button/button.tsx#L21" target="_blank" rel="noopener">Button ç»„ä»¶</a>çš„æ—¶å€™ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ButtonSize = <span class="string">'lg'</span> | <span class="string">'md'</span> | <span class="string">'sm'</span></span><br></pre></td></tr></table></figure><h3 id="äº¤å‰ç±»å‹"><a href="#äº¤å‰ç±»å‹" class="headerlink" title="äº¤å‰ç±»å‹"></a>äº¤å‰ç±»å‹</h3><p>å°†å¤šä¸ªç±»å‹åˆå¹¶æˆä¸€ä¸ªç±»å‹</p><p>æ¯”å¦‚å½“ä½ ç»™ä¸€ä¸ªæ–°çš„ React ç»„ä»¶å®šä¹‰ Props ç±»å‹ï¼Œéœ€è¦ç”¨åˆ°å…¶å®ƒè‹¥å¹²å±æ€§é›†åˆ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Props = TypographyProps &amp; ColorProps &amp; SpaceProps</span><br></pre></td></tr></table></figure><h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h3><p>ä¸»è¦ä½œç”¨æ˜¯æ·»åŠ æ³›å‹çº¦æŸ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> WithLength &#123;</span><br><span class="line">  length: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// extends æ¥ç»§æ‰¿</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">WithLength</span>&gt;(<span class="params">val: T</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(val.length)</span><br><span class="line">&#125;</span><br><span class="line">logger(<span class="string">'hello'</span>)</span><br><span class="line">logger([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="comment">// logger(true) // error æ²¡æœ‰lengthå±æ€§</span></span><br></pre></td></tr></table></figure><h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><p>typeof æ˜¯è·å–ä¸€ä¸ªå¯¹è±¡/å®ä¾‹çš„ç±»å‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person1: Person = &#123; name: <span class="string">'monkey'</span>, age: <span class="number">18</span> &#125;</span><br><span class="line"><span class="keyword">const</span> person2: <span class="keyword">typeof</span> person1 = &#123; name: <span class="string">'jacky'</span>, age: <span class="number">24</span> &#125; <span class="comment">// é€šè¿‡ç¼–è¯‘</span></span><br></pre></td></tr></table></figure><h2 id="æ³›å‹å·¥å…·ç±»å‹"><a href="#æ³›å‹å·¥å…·ç±»å‹" class="headerlink" title="æ³›å‹å·¥å…·ç±»å‹"></a>æ³›å‹å·¥å…·ç±»å‹</h2><h3 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h3><p>å°†æŸä¸ªç±»å‹é‡Œçš„å±æ€§å…¨éƒ¨å˜ä¸ºå¯é€‰é¡¹ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šå…¨éƒ¨å˜å¯é€‰</span></span><br><span class="line"><span class="keyword">type</span> Partial&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Animal &#123;</span><br><span class="line">  canFly: <span class="built_in">boolean</span></span><br><span class="line">  canSwim: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å˜å¯é€‰ï¼Œå¯ä»¥åªèµ‹å€¼éƒ¨åˆ†å±æ€§</span></span><br><span class="line"><span class="keyword">let</span> animal: Partial&lt;Animal&gt; = &#123;</span><br><span class="line">  canFly: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ReadOnly"><a href="#ReadOnly" class="headerlink" title="ReadOnly"></a>ReadOnly</h3><p>å®ƒæ¥æ”¶ä¸€ä¸ªæ³›å‹ Tï¼Œç”¨æ¥æŠŠå®ƒçš„æ‰€æœ‰å±æ€§æ ‡è®°ä¸ºåªè¯»ç±»å‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šå…¨éƒ¨å˜åªè¯»</span></span><br><span class="line"><span class="keyword">type</span> Readonly&lt;T&gt; = &#123;</span><br><span class="line">  readonly [P <span class="keyword">in</span> keyof T]: T[P]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person: Readonly&lt;Person&gt; = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  age: <span class="number">24</span>,</span><br><span class="line">&#125;</span><br><span class="line">person.name = <span class="string">'jack'</span> <span class="comment">// Cannot assign to 'name' because it is a read-only property.</span></span><br></pre></td></tr></table></figure><h3 id="Required"><a href="#Required" class="headerlink" title="Required"></a>Required</h3><p>å°†æŸä¸ªç±»å‹é‡Œçš„å±æ€§å…¨éƒ¨å˜ä¸ºå¿…é€‰é¡¹ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šå…¨éƒ¨å˜å¿…é€‰</span></span><br><span class="line"><span class="keyword">type</span> Required&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]-?: T[P]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  name?: <span class="built_in">string</span></span><br><span class="line">  age?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Property 'age' is missing in type '&#123; name: string; &#125;' but required in type 'Required&lt;Person&gt;'.</span></span><br><span class="line"><span class="keyword">let</span> person: Required&lt;Person&gt; = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  <span class="comment">// æ²¡å†™ age å±æ€§ä¼šæç¤ºé”™è¯¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šK ä¸­æ‰€æœ‰å±æ€§å€¼è½¬åŒ–ä¸º T ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> Record&lt;K <span class="keyword">extends</span> keyof <span class="built_in">any</span>, T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Record ç”Ÿæˆçš„ç±»å‹å…·æœ‰ç±»å‹ K ä¸­å­˜åœ¨çš„å±æ€§ï¼Œå€¼ä¸ºç±»å‹ T</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> DatabaseInfo &#123;</span><br><span class="line">  id: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DataSource = <span class="string">'user'</span> | <span class="string">'detail'</span> | <span class="string">'list'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> x: Record&lt;DataSource, DatabaseInfo&gt; = &#123;</span><br><span class="line">  user: &#123; id: <span class="string">'1'</span> &#125;,</span><br><span class="line">  detail: &#123; id: <span class="string">'2'</span> &#125;,</span><br><span class="line">  list: &#123; id: <span class="string">'3'</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Pick"><a href="#Pick" class="headerlink" title="Pick"></a>Pick</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šé€šè¿‡ä»Typeä¸­é€‰æ‹©å±æ€§Keysçš„é›†åˆæ¥æ„é€ ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> Pick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨äºæå–æ¥å£çš„æŸå‡ ä¸ªå±æ€§</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Animal &#123;</span><br><span class="line">  canFly: <span class="built_in">boolean</span></span><br><span class="line">  canSwim: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person: Pick&lt;Animal, <span class="string">'canSwim'</span>&gt; = &#123;</span><br><span class="line">  canSwim: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Exclude"><a href="#Exclude" class="headerlink" title="Exclude"></a>Exclude</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šå¦‚æœ T ä¸­çš„ç±»å‹åœ¨ U ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™ä¸è¿”å›</span></span><br><span class="line"><span class="keyword">type</span> Exclude&lt;T, U&gt; = T <span class="keyword">extends</span> U ? never : T</span><br></pre></td></tr></table></figure><p>å°†æŸä¸ªç±»å‹ä¸­å±äºå¦ä¸€ä¸ªçš„ç±»å‹ç§»é™¤æ‰</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Programmer &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">  isWork: <span class="built_in">boolean</span></span><br><span class="line">  isStudy: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Student &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">  isStudy: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ExcludeKeys = Exclude&lt;keyof Programmer, keyof Student&gt;</span><br><span class="line"><span class="comment">// type ExcludeKeys = "isWork"</span></span><br></pre></td></tr></table></figure><h3 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a>Omit</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šå»é™¤ç±»å‹ T ä¸­åŒ…å« K çš„é”®å€¼å¯¹ã€‚</span></span><br><span class="line"><span class="keyword">type</span> Omit&lt;T, K <span class="keyword">extends</span> keyof <span class="built_in">any</span>&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;</span><br></pre></td></tr></table></figure><p>ä½œç”¨äº Pick ç›¸åï¼Œè¿˜æ˜¯ç›´æ¥çœ‹ä»£ç å®¹æ˜“ç†è§£</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Animal &#123;</span><br><span class="line">  canFly: <span class="built_in">boolean</span></span><br><span class="line">  canSwim: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person1: Pick&lt;Animal, <span class="string">'canSwim'</span>&gt; = &#123;</span><br><span class="line">  canSwim: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person2: Omit&lt;Animal, <span class="string">'canFly'</span>&gt; = &#123;</span><br><span class="line">  canSwim: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ReturnType"><a href="#ReturnType" class="headerlink" title="ReturnType"></a>ReturnType</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°ï¼šè·å– T ç±»å‹(å‡½æ•°)å¯¹åº”çš„è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> ReturnType&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; infer R ? R : <span class="built_in">any</span></span><br></pre></td></tr></table></figure><p>è·å–å‡½æ•°è¿”å›å€¼ç±»å‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">x: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">string</span> | <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'hello'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> FooType = ReturnType&lt;<span class="keyword">typeof</span> bar&gt; <span class="comment">// string | number</span></span><br></pre></td></tr></table></figure><h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><h3 id="å¯é€‰é“¾è¿ç®—ç¬¦"><a href="#å¯é€‰é“¾è¿ç®—ç¬¦" class="headerlink" title="å¯é€‰é“¾è¿ç®—ç¬¦"></a>å¯é€‰é“¾è¿ç®—ç¬¦</h3><p>å¯é€‰é“¾æ“ä½œç¬¦(<code>?.</code>)å…è®¸è¯»å–ä½äºè¿æ¥å¯¹è±¡é“¾æ·±å¤„çš„å±æ€§çš„å€¼ï¼Œè€Œä¸å¿…æ˜ç¡®éªŒè¯é“¾ä¸­çš„æ¯ä¸ªå¼•ç”¨æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœé‡åˆ° null æˆ– undefined å°±å¯ä»¥ç«‹å³åœæ­¢æŸäº›è¡¨è¾¾å¼çš„è¿è¡Œ</p><p>è¿™ä¸ªåœ¨é¡¹ç›®ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œä¹Ÿå¾ˆå¥½ç”¨ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æ•°æ®éƒ½æ˜¯ä» api è¿”å›çš„ï¼Œå‡è®¾æœ‰è¿™ä¹ˆä¸€ç»„æ•°æ®</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚ api åæ‰è¿”å›çš„æ•°æ®</span></span><br><span class="line">&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    name: <span class="string">'jacky'</span>,</span><br><span class="line">    age: <span class="number">24</span>,</span><br><span class="line">    address: &#123;</span><br><span class="line">      city: <span class="string">'shenzhen'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ç«¯æ¥æ”¶åæ‹¿æ¥å–å€¼ï¼Œ<code>apiRequestResult.data.address.city</code>ï¼Œæ­£å¸¸æƒ…å†µå–å¾—åˆ°å€¼ï¼Œå¦‚æœåå° GG æ²¡æœ‰è¿”å› address è¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TypeError: Cannot read property &#39;city&#39; of undefined</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™éœ€è¦å‰ç«¯å¤„ç†äº†ï¼Œæ¯”å¦‚æœ€ç›´æ¥çš„å°±æ˜¯</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">apiRequestResult &amp;&amp; apiRequestResult.data &amp;&amp; data.address &amp;&amp; data.address.city</span><br></pre></td></tr></table></figure><p>æˆ–è€… lodash åº“æ–¹æ³•ä¹Ÿèƒ½è§£å†³</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="keyword">const</span> city = _.get(apiRequestResult, <span class="string">'apiRequestResult.data.address.city'</span>, <span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure><p>é¡¹ç›®ä¸­å¦‚æœéƒ½æ˜¯è¿™ä¹ˆå¤„ç†ï¼Œæœªå…å¤ªè¿‡äºç¹çï¼Œç‰¹åˆ«å¯¹è±¡å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ TS çš„å¯é€‰é“¾æ“ä½œç¬¦ï¼Œ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">apiRequestResult?.data?.address?.city</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ä»£ç ä¼šè‡ªåŠ¨æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸º null æˆ– undefinedï¼Œå¦‚æœæ˜¯çš„è¯å°±ç«‹å³è¿”å› undefinedï¼Œè¿™æ ·å°±å¯ä»¥ç«‹å³åœæ­¢æŸäº›è¡¨è¾¾å¼çš„è¿è¡Œï¼Œä»è€Œä¸ä¼šæŠ¥é”™ã€‚</p><p>å½“ä½ åœ¨ React ä¸­ä½¿ç”¨ ref å°è£…åˆ¤æ–­å…ƒç´ æ˜¯å¦åŒ…å« XX å…ƒç´ æ—¶ï¼Œä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªæ“ä½œç¬¦</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isClickAway = !childRef.current?.contains?.(e.target)</span><br></pre></td></tr></table></figure><h3 id="ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦"><a href="#ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦" class="headerlink" title="ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦"></a>ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦</h3><p>ç©ºå€¼åˆå¹¶æ“ä½œç¬¦ï¼ˆ<code>??</code>ï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘æ“ä½œç¬¦ï¼Œå½“å·¦ä¾§çš„æ“ä½œæ•°ä¸º null æˆ–è€… undefined æ—¶ï¼Œè¿”å›å…¶å³ä¾§æ“ä½œæ•°ï¼Œå¦åˆ™è¿”å›å·¦ä¾§æ“ä½œæ•°ã€‚</p><p>ä¸ <code>||</code>æ“ä½œç¬¦ç±»ä¼¼ï¼Œä½†æ˜¯ <code>||</code> æ˜¯ä¸€ä¸ªå¸ƒå°”é€»è¾‘è¿ç®—ç¬¦ï¼Œå·¦ä¾§çš„æ“ä½œæ•°ä¼šè¢«å¼ºåˆ¶è½¬æ¢æˆå¸ƒå°”å€¼ç”¨äºæ±‚å€¼ã€‚å¦‚<code>0, &#39;&#39;, NaN, null, undefined</code>éƒ½ä¸ä¼šè¢«è¿”å›ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> foo1 = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> foo2 = <span class="number">12</span></span><br><span class="line"><span class="keyword">const</span> foo3 = <span class="string">'hello'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res1 = foo1 ?? <span class="string">'value'</span> <span class="comment">// 'value'</span></span><br><span class="line"><span class="keyword">const</span> res2 = foo2 ?? <span class="string">'value'</span> <span class="comment">// 12</span></span><br><span class="line"><span class="keyword">const</span> res3 = foo3 ?? <span class="string">'value'</span> <span class="comment">// 'hello'</span></span><br></pre></td></tr></table></figure><p>å®é™…å¼€å‘ä¹Ÿå¯ä»¥æ··ç”¨<code>?.</code>å’Œ<code>??</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const title &#x3D; document.getElementById(&quot;title&quot;)?.textContent ?? &quot;&quot;;</span><br></pre></td></tr></table></figure><h3 id="éç©ºæ–­è¨€è¿ç®—ç¬¦"><a href="#éç©ºæ–­è¨€è¿ç®—ç¬¦" class="headerlink" title="éç©ºæ–­è¨€è¿ç®—ç¬¦"></a>éç©ºæ–­è¨€è¿ç®—ç¬¦</h3><p>åœ¨ä¸Šä¸‹æ–‡ä¸­å½“ç±»å‹æ£€æŸ¥å™¨æ— æ³•æ–­å®šç±»å‹æ—¶ï¼Œè¿™ä¸ªè¿ç®—ç¬¦(<code>!</code>)å¯ä»¥ç”¨åœ¨å˜é‡åæˆ–è€…å‡½æ•°åä¹‹åï¼Œç”¨äºæ–­è¨€æ“ä½œå¯¹è±¡æ˜¯é null å’Œé undefined ç±»å‹ã€‚ä¸è¿‡ä¸€èˆ¬æ˜¯ä¸æ¨èä½¿ç”¨çš„</p><p>è¿™ä¸ªé€‚ç”¨äºæˆ‘ä»¬å·²ç»å¾ˆç¡®å®šçŸ¥é“ä¸ä¼šè¿”å›ç©ºå€¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">name: <span class="built_in">string</span> | <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> myName: <span class="built_in">string</span> = <span class="string">'jacky'</span></span><br><span class="line">  <span class="comment">// Type 'string | undefined' is not assignable to type 'string'.</span></span><br><span class="line">  <span class="comment">// Type 'undefined' is not assignable to type 'string'</span></span><br><span class="line">  myName = name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è§£å†³è¿™ä¸ªæŠ¥é”™ï¼Œå¯ä»¥åŠ å…¥åˆ¤æ–­</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">name: <span class="built_in">string</span> | <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> myName: <span class="built_in">string</span> = <span class="string">'jacky'</span></span><br><span class="line">  <span class="keyword">if</span> (name) &#123;</span><br><span class="line">    myName = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¿™æ ·å†™ä»£ç å°±æ˜¾å¾—å†—é•¿ä¸€ç‚¹ï¼Œè¿™æ—¶ä½ éå¸¸ç¡®å®šä¸ç©ºï¼Œé‚£å°±ç”¨éç©ºæ–­è¨€è¿ç®—ç¬¦</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">name: <span class="built_in">string</span> | <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> myName: <span class="built_in">string</span> = <span class="string">'jacky'</span></span><br><span class="line">  myName = name!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è€Œå¯ä»¥å‡å°‘å†—ä½™çš„ä»£ç åˆ¤æ–­</p><h2 id="é¡¹ç›®ä¸­çš„ç»†èŠ‚åº”ç”¨"><a href="#é¡¹ç›®ä¸­çš„ç»†èŠ‚åº”ç”¨" class="headerlink" title="é¡¹ç›®ä¸­çš„ç»†èŠ‚åº”ç”¨"></a>é¡¹ç›®ä¸­çš„ç»†èŠ‚åº”ç”¨</h2><h3 id="å°½é‡é¿å…-any"><a href="#å°½é‡é¿å…-any" class="headerlink" title="å°½é‡é¿å… any"></a>å°½é‡é¿å… any</h3><p>é¿å… anyï¼Œä½†æ£€æŸ¥è¿‡ä¸äº†æ€ä¹ˆæï¼Ÿå¯ä»¥ç”¨ unknownï¼ˆä¸å¯é¢„å…ˆå®šä¹‰çš„ç±»å‹ï¼‰ä»£æ›¿</p><p>ç»™ä¸ªä¸æ˜¯å¾ˆå¥½çš„ä¾‹å­ï¼Œå› ä¸ºä¸‹é¢ä¾‹å­æ˜¯æœ¬èº«ä¸å¯¹è¿˜å¼ºè¡Œä¿®æ­£é”™è¯¯ã€‚å¤§æ¦‚æƒ…å†µæ˜¯æœ‰äº›æœªçŸ¥æ•°æ®çš„æƒ…å†µï¼Œéœ€è¦å¼ºå®šä¹‰ç±»å‹æ‰èƒ½è¿‡ï¼Œå¯ä»¥ç”¨<code>(xx as unknown) as SomeType</code>çš„å½¢å¼ï¼Œå½“ç„¶è¿™é‡Œåªæ˜¯ä¾‹å­ï¼Œé¡¹ç›®ä¸­ç±»å‹æ£€æŸ¥é€¼ä¸å¾—å·²çš„æƒ…å†µä¸‹å¯èƒ½ä¼šä½¿ç”¨</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> metaData = &#123;</span><br><span class="line">  description: <span class="string">'xxxx'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> MetaType &#123;</span><br><span class="line">  desc: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleMeta</span>(<span class="params">data: MetaType</span>): <span class="title">void</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸¤ç§å†™æ³•éƒ½ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// handleMeta(metaData)</span></span><br><span class="line"><span class="comment">// handleMeta(metaData as MetaType)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œå¯ä»¥é€šè¿‡ç±»å‹æ£€æŸ¥ä¸æŠ¥é”™ï¼Œæ›¿ä»£ any çš„åŠŸèƒ½åŒæ—¶ä¿ç•™é™æ€æ£€æŸ¥çš„èƒ½åŠ›ï¼Œ</span></span><br><span class="line">handleMeta((metaData <span class="keyword">as</span> unknown) <span class="keyword">as</span> MetaType)</span><br></pre></td></tr></table></figure><h3 id="å¯ç´¢å¼•çš„ç±»å‹"><a href="#å¯ç´¢å¼•çš„ç±»å‹" class="headerlink" title="å¯ç´¢å¼•çš„ç±»å‹"></a>å¯ç´¢å¼•çš„ç±»å‹</h3><p>ä¸€èˆ¬ç”¨æ¥çº¦æŸå¯¹è±¡å’Œæ•°ç»„</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> StringObject &#123;</span><br><span class="line">  <span class="comment">// key çš„ç±»å‹ä¸º string, ä»£è¡¨å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// é™åˆ¶ value çš„ç±»å‹ä¸º string</span></span><br><span class="line">  [key: <span class="built_in">string</span>]: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj: StringObject = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  age: <span class="number">24</span>, <span class="comment">// æ­¤è¡ŒæŠ¥é”™ï¼šType 'number' is not assignable to type 'string'.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> StringArr &#123;</span><br><span class="line">  <span class="comment">// key çš„ç±»å‹ä¸º number, ä»£è¡¨æ•°ç»„</span></span><br><span class="line">  <span class="comment">// é™åˆ¶ value çš„ç±»å‹ä¸º string</span></span><br><span class="line">  [key: <span class="built_in">number</span>]: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr: StringArr = [<span class="string">'name'</span>, <span class="string">'jacky'</span>]</span><br></pre></td></tr></table></figure><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>é€šè¿‡ <code>/** */</code> å½¢å¼çš„æ³¨é‡Šè®© TS ç±»å‹åšæ ‡è®°æç¤ºï¼Œç¼–è¾‘å™¨ä¼šæœ‰æ›´å¥½çš„æç¤º</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** Animal common props */</span></span><br><span class="line"><span class="keyword">interface</span> Animal &#123;</span><br><span class="line">  <span class="comment">/** like animal special skill */</span></span><br><span class="line">  feature: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cat: Animal = &#123;</span><br><span class="line">  feature: <span class="string">'running'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53755f93b68d4cc8926499cecdb1410f~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd63e1517a614326a6e55efacf304270~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h3 id="ts-ignore"><a href="#ts-ignore" class="headerlink" title="ts-ignore"></a>ts-ignore</h3><p>è¿˜æ˜¯é‚£æ ·ï¼Œå°½å¯èƒ½ç”¨ unknown æ¥ä»£æ›¿ä½¿ç”¨ any</p><p>å¦‚æœä½ ä»¬é¡¹ç›®ç¦ç”¨ anyï¼Œé‚£ä¹ˆ ts-ignore æ˜¯ä¸€ä¸ªæ¯” any æ›´æœ‰æ½œåœ¨å½±å“ä»£ç è´¨é‡çš„å› ç´ äº†ã€‚</p><p>ç¦ç”¨äº†ä½†æœ‰äº›åœ°æ–¹ç¡®å®éœ€è¦ä½¿ç”¨å¿½ç•¥çš„è¯ï¼Œæœ€å¥½æ³¨é‡Šè¡¥å¤šå¥ç†ç”±ã€‚</p><p>æ¯”å¦‚æœ‰äº›å‡½æ•°å•å…ƒæµ‹è¯•æ–‡ä»¶ï¼Œæµ‹è¯•ç”¨ä¾‹æ•…æ„ä¼ å…¥ä¸æ­£ç¡®çš„æ•°æ®ç±»å‹ç­‰ï¼Œæœ‰æ—¶æ˜¯é€¼ä¸å¾—å·²çš„æŠ¥é”™ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @ts-ignore intentionally for test</span></span><br></pre></td></tr></table></figure><br><ul><li><a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a><br>è§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>TypeScriptç³»åˆ—</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡¹ç›®ä¼˜åŒ–å®è·µï¼šWebpack åŠ¨æ€å¯¼å…¥ react-toastify</title>
    <url>/2021/03/27/%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%9AWebpack-%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5-react-toastify/</url>
    <content><![CDATA[<p>å¦‚æœä½ çš„é¡¹ç›®æ­£åœ¨ä½¿ç”¨ <code>react-toastify</code>ï¼Œå¯ä»¥çœ‹çœ‹æœ¬æ–‡ã€‚æˆ‘æ˜¯æœ€è¿‘é€šè¿‡<code>webpack-bundle-analyzer</code>å‘ç°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå…¶å®æˆ‘ä»¬åªæœ‰æŸä¸ªé¡µé¢ä¼šå¯èƒ½ç”¨åˆ°å¼¹æ¡†ï¼Œæ¯”å¦‚ä½ ç‚¹äº†æ”¶è—ä¹‹åä¼šæœ‰å¼¹æ¡†å‡ºæ¥ã€‚ä½†æ˜¯é€šè¿‡æ‰“åŒ…ç»“æœå’Œè¿è¡Œå¾—å‡ºï¼Œæ¯ä¸ªé¡µé¢æ— è®ºæœ‰æ²¡æœ‰ä½¿ç”¨ï¼Œä¸€å¼€å§‹éƒ½å¼•å…¥äº† <code>react-toastify</code>ã€‚</p><a id="more"></a><h2 id="react-toastify-çš„ä½¿ç”¨"><a href="#react-toastify-çš„ä½¿ç”¨" class="headerlink" title="react-toastify çš„ä½¿ç”¨"></a>react-toastify çš„ä½¿ç”¨</h2><p>å¦‚æœä½ æ‰“å¼€å®ƒ <a href="https://github.com/fkhadra/react-toastify#readme" target="_blank" rel="noopener">Github</a>ï¼Œå®ƒæ˜¯è¿™ä¹ˆä½¿ç”¨çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ToastContainer, toast &#125; <span class="keyword">from</span> <span class="string">'react-toastify'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'react-toastify/dist/ReactToastify.css'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> notify = <span class="function"><span class="params">()</span> =&gt;</span> toast(<span class="string">'Wow so easy!'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;notify&#125;&gt;Notify!&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;ToastContainer /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœæ•´ä¸ªé¡¹ç›®å¤šä¸ªåœ°æ–¹ç”¨æˆ–è€…éœ€è¦æ§åˆ¶å¥½æ•°æ®æµçš„è¯ï¼Œä¸€ä¸ªåšæ³•å¾€å¾€æ˜¯æŠŠå®ƒæ‹‰åˆ° Redux ç®¡ç†ï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®å°±å˜æˆ</p><p><code>app.tsx</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é‡Œé¢å°è£…äº†é€»è¾‘å’Œè¿”å›äº† &lt;ToastContainer /&gt;</span></span><br><span class="line"><span class="keyword">import</span> Toast <span class="keyword">from</span> <span class="string">"src/containers/Toast"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; noToast &#125; = <span class="keyword">this</span>.props</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    &#123;!noToast &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Toast</span> /&gt;</span></span>&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>é¡¹ç›®ä½¿ç”¨çš„æ˜¯ <strong>Next.js</strong></p><p>æˆ‘ä»¬çš„æ¯ä¸ª<code>pages/</code>é¡µé¢éƒ½å¼•å…¥äº†è¿™ä¸ª<code>app.tsx</code>å…¬å…±æ–‡ä»¶ï¼Œä¸Šé¢ä»£ç ä¸­ï¼ŒToast æ˜¯ç»è¿‡ Redux ç­‰å°è£…å¥½çš„ Toast ç»„ä»¶ï¼Œç”±ä¸Šé¢ä»£ç ç²—ç•¥çœ‹å‡ºï¼Œå¦‚æœåœ¨æ¯ä¸ªé¡µé¢çš„<code>app.tsx</code>ç»„ä»¶ä¼ å…¥<code>noToast</code>å±æ€§ï¼Œé‚£ä¹ˆ<code>&lt;Toast /&gt;</code>å°±ä¸ä¼šè¢«åŠ è½½ï¼Œè°ƒç”¨ <code>toast</code>æ–¹æ³•ä¹Ÿä¸ä¼šæœ‰å¼¹æ¡†å‡ºç°ã€‚</p><p>è¿™æ®µä»£ç å·²ç»æ˜¯å‡ å¹´å‰çš„äº†ï¼Œæ¨æµ‹æ˜¯è¿™ä¸ªæ„å›¾ï¼Œé»˜è®¤å¯¼å…¥ï¼Œå‡è®¾ç¡®è®¤ä½ é¡µé¢çœŸçš„ä¸éœ€è¦å¼¹æ¡†ï¼Œå°±ä¼ <code>noToast</code>å±æ€§ï¼Œç„¶è€Œæˆ‘æœç´¢äº†æ•´ä¸ªé¡¹ç›®ï¼Œç”¨åˆ°<code>noToast</code>çš„åœ°æ–¹åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥è¿™ä¸ªå±æ€§å¹¶ä¸è¢«åæ¥æ¥æ‰‹çš„äººæ‰€çŸ¥ï¼Œä¹Ÿå°±ä¸ä¼šæ‰‹åŠ¨ä¼ å…¥<code>noToast</code>ï¼Œå¯¼è‡´æ¯ä¸ªé¡µé¢éƒ½å¼•å…¥äº†<code>react-toasify</code></p><blockquote><p>ä½¿ç”¨ toast æ–¹æ³•å¿…é¡»é¡µé¢è¦æŒ‚è½½äº† <code>&lt;ToastContainer /&gt;</code>ï¼Œæ‰å¯ä»¥å¼¹å‡ºå¼¹æ¡†</p></blockquote><h2 id="ç°æœ‰çš„é—®é¢˜"><a href="#ç°æœ‰çš„é—®é¢˜" class="headerlink" title="ç°æœ‰çš„é—®é¢˜"></a>ç°æœ‰çš„é—®é¢˜</h2><ol><li>æˆ‘ä»¬åªæœ‰åœ¨é¡µé¢è¯¦æƒ…é¡µç‚¹å‡»æ”¶è—ï¼Œæ‰ä¼šæœ‰å¼¹æ¡†ï¼ˆä½¿ç”¨<code>react-toastify</code>ï¼‰ï¼Œå…¶ä»–é¡µé¢éƒ½æ²¡æœ‰ã€‚ä½†æ¯ä¸ªé¡µé¢éƒ½åŠ è½½äº†è¯¥ chunk åŒ…</li><li>é¡¹ç›®ä¸­ä½¿ç”¨ toast æ–¹æ³•æ˜¯é€šè¿‡ Redux è§¦å‘ï¼Œé€šè¿‡<code>useUpdateEffect</code>ç›‘å¬äº†å…¨å±€</li></ol><p><code>src/containers/Toast.tsx</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">useUpdateEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// toastPropä»reduxè·å–è€Œæ¥çš„</span></span><br><span class="line">  <span class="keyword">if</span> (toastProp.message || toastProp.errors) notify(toastProp) <span class="comment">// notifyé‡Œé¢åˆ¤æ–­å’Œè°ƒç”¨toast</span></span><br><span class="line">&#125;, [notify, toastProp])</span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><ol><li>å½“ç„¶æ˜¯ä¸è¦æ¯ä¸ªé¡µé¢éƒ½å¼•å…¥ï¼Œè€Œæ˜¯ç”¨åˆ°çš„é¡µé¢å†å¼•å…¥</li><li>æœ€å¥½ç”¨åˆ°çš„é¡µé¢ï¼Œæ²¡ç‚¹å‡»æ—¶ä¹Ÿä¸åŠ è½½ï¼Œæ¯”å¦‚åªæœ‰ç‚¹å‡»æ”¶è—ï¼Œæ‰è®©<code>react-toasify</code>åŠ è½½ã€‚</li></ol><p>è¿™å°±è®©äººæƒ³åˆ°åŠ¨æ€å¯¼å…¥äº†ï¼Œåšæ³•å³æ˜¯ä¸å†éœ€è¦åœ¨<code>app.tsx</code>åˆ¤æ–­å¼•å…¥<code>react-toastify</code>ï¼Œå¦‚æ–°å°è£…äº†ä¸€ä¸ªç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ToastContent, ToastOptions &#125; <span class="keyword">from</span> <span class="string">'react-toastify'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€å¯¼å…¥	 ./Toastifyæ˜¯å°è£…å¥½çš„ Toastify</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> toastify = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./Toastify'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> toast = <span class="function">(<span class="params">message: ToastContent, toastOptions?: ToastOptions</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> toastify().then(<span class="function"><span class="params">toast</span> =&gt;</span> &#123;</span><br><span class="line">    toast.showToast(message, toastOptions)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åšåˆ°çš„æ•ˆæœå³æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="keyword">import</span> &#123; toast &#125; <span class="keyword">from</span> <span class="string">'./toastify'</span></span><br><span class="line">toast(<span class="string">'Hello World'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./toastify'</span>).then(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>.toast(<span class="string">'Hello World'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç°åœ¨çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶ <code>./Toastify.tsx</code>ï¼ˆçœç•¥å¾ˆå¤šä»£ç â€¦ï¼‰</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> setupToastContainer = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!hasToastContainer) &#123;</span><br><span class="line">    hasToastContainer = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// éœ€è¦å»ç»™æ ¹htmlæ·»åŠ ä¸€ä¸ªdivï¼Œidä¸º root-toastify</span></span><br><span class="line">    ReactDOM.render(</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &lt;ToastGlobalStyle /&gt;</span><br><span class="line">        &lt;ToastWrapper /&gt;</span><br><span class="line">      &lt;<span class="regexp">/&gt;,</span></span><br><span class="line"><span class="regexp">      document.getElementById('root-toastify')</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export const showToast = (message, toastOptions = &#123;&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  setupToastContainer()</span></span><br><span class="line"><span class="regexp">  toast(message, toastOptions)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥æ‘†è„±äº† Redux ä¾èµ–ï¼Œè€Œä¸”åªæœ‰ä½ ç‚¹å‡»çš„ä¸€ç¬é—´æ‰ä¼šåŠ è½½<code>react-toastify</code>çš„ chunk åŒ…ï¼Œåˆå§‹åŠ è½½å¹¶ä¸ä¼šï¼Œæ•…æœ€åä¼˜åŒ–ç»“æœæ˜¯æ¯ä¸ªé¡µé¢éƒ½æ‰“åŒ…å‹ç¼©ä½“ç§¯éƒ½å‡å°‘ 15-20K+ã€‚</p><p>è¿™æ¬¡å°±æœ‰ç‚¹å·æ‡’å†™æ–‡äº†ï¼Œå› ä¸ºè¿™åªæ˜¯é¡¹ç›®ä¼˜åŒ–çš„å…¶ä¸­ä¸€ä¸ªå°ç‚¹ï¼Œä»¥å‰ä¹Ÿæ²¡æœ‰è®°å½•ä¼˜åŒ–ç‚¹ï¼Œè¿™æ¬¡åšäº†å°±é©¬ä¸Šå›é¡¾ä¸€ä¸‹ï¼Œä¸Šé¢ä»£ç å¯èƒ½çœ‹çš„æœ‰ç‚¹æ‡µï¼Œæ²¡æœ‰æ”¾å‡ºå®Œæ•´ä»£ç å’Œåšä¸ª Demoã€‚</p><p>ä¸è¿‡æ²¡å…³ç³»ï¼Œå› ä¸ºæˆ‘åœ¨ Github æ‰¾åˆ°äº†å®Œæ•´çš„ PR ä¾‹å­ä¾›å¤§å®¶å‚è€ƒ <a href="https://github.com/getfider/fider/pull/645/files" target="_blank" rel="noopener">enhancement: move react-toastify to its own bundle</a>ï¼ŒåŒæ ·æ˜¯åŠ¨æ€å¯¼å…¥<code>react-toastify</code>ï¼Œåšæ³•ä¸€æ ·ã€‚</p><br><ul><li>psï¼š<ul><li><a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a></li></ul></li></ul>]]></content>
      <categories>
        <category>æ€§èƒ½ä¼˜åŒ–</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>åŠ¨æ€å¯¼å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Webpack SourceMap å›é¡¾</title>
    <url>/2021/03/21/Webpack-SourceMap-%E5%9B%9E%E9%A1%BE/</url>
    <content><![CDATA[<p>æœ¬æ–‡åŒæ­¥å‘å¸ƒåœ¨æˆ‘çš„ <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">Github ä¸ªäººåšå®¢</a></p><p>å‰å‡ å¤©åœ¨ä¼˜åŒ–é¡¹ç›®æ—¶ï¼Œå‘ç°<code>next.config.js</code>çš„é…ç½®é‡Œï¼Œdevelopment æ¨¡å¼ä¸‹çš„ sourcemap ä¸º<code>cheap-module-sourcemap</code>ï¼Œä»”ç»†æƒ³äº†æƒ³ï¼Œè®°å¿†ä¸­å¥½åƒæœ‰ä¸ªæ›´æ¨èå¸¸ç”¨çš„å¼€å‘æ¨¡å¼ sourcemap é…ç½®ï¼š<code>cheap-module-eval-source-map</code>ã€‚</p><p>çœ‹äº†ä¸€ä¸‹æ˜¯ä¸‰å¹´å‰æ·»åŠ çš„ä»£ç ï¼Œäºæ˜¯åˆå›é¡¾ç ”ç©¶äº†ä¸‹ webpack çš„ sourcemap é…ç½®ï¼Œå¼€ä¸ª PRã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-Sourcemap"><a href="#ä»€ä¹ˆæ˜¯-Sourcemap" class="headerlink" title="ä»€ä¹ˆæ˜¯ Sourcemap"></a>ä»€ä¹ˆæ˜¯ Sourcemap</h2><p>æˆ‘ä»¬çš„é¡¹ç›®åœ¨æ‰“åŒ…åï¼Œå°†å¼€å‘ç¯å¢ƒä¸­æºä»£ç ç»è¿‡å‹ç¼©ï¼Œå»ç©ºæ ¼ï¼Œbabel ç¼–è¯‘ç­‰å·¥ç¨‹åŒ–è½¬æ¢ï¼Œæœ€ç»ˆçš„é¡¹ç›®ä»£ç å’Œæºä»£ç ä¹‹é—´å·®å¼‚æ€§å¾ˆå¤§ï¼Œä¼šé€ æˆæ— æ³• debug çš„é—®é¢˜ï¼Œåœ¨çº¿ä¸Šç¯å¢ƒå®šä½åˆ°çš„ä»£ç æ˜¯å‹ç¼©å¤„ç†åçš„ä»£ç ã€‚</p><p>è€Œ Sourcemap å°±æ˜¯æ˜¯ä¸ºäº†è§£å†³å¼€å‘ä»£ç ä¸å®é™…è¿è¡Œä»£ç ä¸ä¸€è‡´æ—¶å¸®åŠ©æˆ‘ä»¬ debug åˆ°åŸå§‹å¼€å‘ä»£ç çš„æŠ€æœ¯ï¼Œè§£å†³ä¸Šè¿°<strong>ä»£ç å®šä½</strong>çš„é—®é¢˜ï¼Œæ˜¯<strong>æºä»£ç å’Œç›®æ ‡ä»£ç å‡ºé”™ä½ç½®çš„æ˜ å°„</strong>ã€‚</p><h2 id="Sourcemap-å…³é”®è¯"><a href="#Sourcemap-å…³é”®è¯" class="headerlink" title="Sourcemap å…³é”®è¯"></a>Sourcemap å…³é”®è¯</h2><p>Sourcemap çš„å…³é”®è¯ç»„åˆçœ¼èŠ±ç¼­ä¹±ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ä¸€ä¸ªä¸€ä¸ªå»è®°æ¯ç§ sourcemap ç”¨é€”ï¼Œæˆ‘ä»¬åªéœ€çŸ¥é“å‡ ä¸ªå…³é”®è¯çš„æ„æ€ï¼Œä¾¿å¯æ¨æµ‹å®ƒä»¬ç»„åˆçš„ sourcemap ç±»å‹ã€‚</p><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><p><strong>æ¯ä¸€ä¸ªæ¨¡å—éƒ½æ‰§è¡Œ eval() è¿‡ç¨‹ï¼Œæ‰§è¡Œåä¸ä¼šç”Ÿæˆ<code>.map</code>æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨æ¯ä¸€ä¸ªæ¨¡å—åè¿½åŠ <code>//@ sourceURL</code>æ¥å…³è”ä»£ç å¤„ç†å‰åçš„å¯¹åº”å…³ç³»</strong>ã€‚ä½¿ç”¨ eval åŒ…è£¹æ¨¡å—ä»£ç ï¼Œå¯ä»¥æé«˜ <strong>rebuild</strong> çš„é€Ÿåº¦ã€‚æ•…ä¸€èˆ¬ sourcemap å¸¦æœ‰<code>eval</code>çš„é€‰é¡¹ï¼Œ<code>rebuild</code> é€Ÿåº¦éƒ½å¿«ä¸€äº›ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">webpackJsonp([1],[</span><br><span class="line">function(module,exports,__webpack_require__)&#123;</span><br><span class="line">eval(</span><br><span class="line">      ...</span><br><span class="line">&#x2F;&#x2F;# sourceURL&#x3D;webpack:&#x2F;&#x2F;&#x2F;.&#x2F;src&#x2F;js&#x2F;index.js?&#39;</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">function(module,exports,__webpack_require__)&#123;</span><br><span class="line">eval(</span><br><span class="line">      ...</span><br><span class="line">&#x2F;&#x2F;# sourceURL&#x3D;webpack:&#x2F;&#x2F;&#x2F;.&#x2F;src&#x2F;static&#x2F;css&#x2F;app.less?.&#x2F;~&#x2F;.npminstall&#x2F;css-loader&#x2F;0.23.1&#x2F;css-loader!.&#x2F;~&#x2F;.npminstall&#x2F;postcss-loader&#x2F;1.1.1&#x2F;postcss-loader!.&#x2F;~&#x2F;.npminstall&#x2F;less-loader&#x2F;2.2.3&#x2F;less-loader&#39;</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">function(module,exports,__webpack_require__)&#123;</span><br><span class="line"> eval(</span><br><span class="line">      ...</span><br><span class="line"> &#x2F;&#x2F;# sourceURL&#x3D;webpack:&#x2F;&#x2F;&#x2F;.&#x2F;src&#x2F;tmpl&#x2F;appTemplate.tpl?&quot;</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">...])</span><br></pre></td></tr></table></figure><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42794b4bbbc3449599a92327f6c6d45a~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>ä¸ºä»€ä¹ˆ eval æ¨¡å¼ rebuild çš„é€Ÿåº¦ä¼šå¿«?</p><blockquote><p>å› ä¸ºå¸¦ eval çš„æ„å»ºæ¨¡å¼èƒ½å¤Ÿ cache Sourcemapï¼ŒçŒœæµ‹å¯èƒ½æ˜¯å¸¦ eval çš„æ¨¡å¼èƒ½æŠŠæ¯ä¸ªæ¨¡å—çš„ç”Ÿæˆä»£ç å•ç‹¬æ‰“åœ¨ä¸€è¡Œé‡Œï¼Œå¹¶ä¸”éƒ½ä»¥ DataURL çš„å½¢å¼æ·»åŠ  sourcemapï¼Œè¿™æ ·å®ƒåœ¨ rebuild æ—¶ä¼šå¯¹æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿæ”¹åŠ¨ï¼Œå°±ç›´æ¥ä½¿ç”¨ä¹‹å‰çš„ sourcemapï¼Œæ•…åªéœ€è¦ä¸ºæ”¹åŠ¨çš„æ¨¡å—é‡æ–°ç”Ÿæˆ sourcemapï¼›è€Œé eval çš„æ„å»ºæ¨¡å¼ä¸‹ç”Ÿæˆä»£ç ä¸ç®¡æœ‰ä»»ä½•æ¨¡å—ä½œå‡ºä¿®æ”¹ï¼Œéƒ½ä¼šå½±å“åˆ°æœ€å bundle æ–‡ä»¶æ•´ä½“çš„è¡Œåˆ—æ ¼å¼ï¼Œæ‰€ä»¥å®ƒæ¯æ¬¡éƒ½è¦é‡æ–°ç”Ÿæˆæ•´ä½“çš„ sourcemapï¼Œrebuild çš„é€Ÿåº¦ä¼šå¾ˆæ…¢ã€‚</p></blockquote><h3 id="source-map"><a href="#source-map" class="headerlink" title="source-map"></a>source-map</h3><p>ä¼šä¸ºæ¯ä¸€ä¸ªæ‰“åŒ…åçš„æ¨¡å—ç”Ÿæˆç‹¬ç«‹çš„<code>.map</code>æ–‡ä»¶ï¼Œä¼šåœ¨ bundle æ–‡ä»¶æœ«å°¾è¿½åŠ  <code>sourceURI=æŒ‡å®š.mapæ–‡ä»¶è·¯å¾„</code>ï¼Œä¼šåœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­çœ‹åˆ°<code>webpack://</code>çš„æ–‡ä»¶å¤¹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">webpackJsonp([1],[</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">  ...</span><br><span class="line">])&#x2F;&#x2F;# sourceMappingURL&#x3D;index.js.map</span><br></pre></td></tr></table></figure><p>æ‰“åŒ…åçš„æ¨¡å—åœ¨æ¨¡å—åé¢ä¼šå¯¹åº”å¼•ç”¨ä¸€ä¸ª<code>.map</code>æ–‡ä»¶ï¼ŒåŒæ—¶åœ¨æ‰“åŒ…å¥½çš„ç›®å½•ä¸‹ä¼šé’ˆå¯¹æ¯ä¸€ä¸ªæ¨¡å—ç”Ÿæˆç›¸åº”çš„<code>.map</code> æ–‡ä»¶ï¼Œåœ¨ä¸Šä¾‹ä¸­ä¼šç”Ÿæˆä¸€ä¸ª index.js.map æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå…¸å‹çš„ sourcemap æ–‡ä»¶ï¼Œå½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;version&quot;:3,</span><br><span class="line">&quot;sources&quot;:[</span><br><span class="line">    &quot;webpack:&#x2F;&#x2F;&#x2F;js&#x2F;index.js&quot;,&quot;webpack:&#x2F;&#x2F;&#x2F;.&#x2F;src&#x2F;js&#x2F;index.js&quot;,</span><br><span class="line">    &quot;webpack:&#x2F;&#x2F;&#x2F;.&#x2F;~&#x2F;.npminstall&#x2F;css-loader&#x2F;0.23.1&#x2F;css-loader&#x2F;lib&#x2F;css-base.js&quot;,</span><br><span class="line">    ...</span><br><span class="line">],</span><br><span class="line">&quot;names&quot;:[&quot;webpackJsonp&quot;,&quot;module&quot;,&quot;exports&quot;...],</span><br><span class="line">&quot;mappings&quot;:&quot;AAAAA,cAAc,IAER,SAASC...&quot;,</span><br><span class="line">&quot;file&quot;:&quot;js&#x2F;index.js&quot;,</span><br><span class="line">&quot;sourcesContent&quot;:[...],</span><br><span class="line">&quot;sourceRoot&quot;:&quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="cheap"><a href="#cheap" class="headerlink" title="cheap"></a>cheap</h3><p>ä¸åŒ…å«åˆ—ä¿¡æ¯ä¹Ÿä¸åŒ…å« loader çš„ sourcemapï¼Œä¼šä¸ºæ¯ä¸€ä¸ªæ¨¡å—ç”Ÿæˆ<code>.map</code>æ–‡ä»¶ï¼Œä¸<code>source-map</code>çš„åŒºåˆ«åœ¨äº cheap ç”Ÿæˆçš„<code>.map</code>æ–‡ä»¶ä¼šå¿½ç•¥åŸå§‹ä»£ç ä¸­çš„åˆ—ä¿¡æ¯ã€‚</p><p>ç”±äºç”Ÿæˆçš„ sourcemap ä¸ä¼šæœ‰åˆ—ä¿¡æ¯è€Œåªæœ‰è¡Œä¿¡æ¯ï¼Œç¼–è¯‘è®¡ç®—é‡å°‘ï¼Œæ‰€ä»¥é€Ÿåº¦è¾ƒå¿«ã€‚</p><h3 id="module"><a href="#module" class="headerlink" title="module"></a>module</h3><p>åŒ…å« <strong>loader</strong> æ¨¡å—ä¹‹é—´çš„ sourcemapï¼ˆæ¯”å¦‚ jsx è¯­æ³•ä»£ç ç» loader ç¼–è¯‘ä¸ºåŸç”Ÿ js ä»£ç ï¼‰,è¿™æ ·å¯ä»¥çœ‹åˆ° loader å¤„ç†å‰çš„åŸå§‹ä»£ç </p><h3 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h3><p>æ­£å¸¸çš„ sourcemap çš„ç”Ÿæˆæ˜¯åœ¨ dist ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>.map</code> æ–‡ä»¶ï¼Œ inline çš„å«ä¹‰å°±æ˜¯ä¸äº§ç”Ÿç‹¬ç«‹çš„ <code>.map</code> æ–‡ä»¶ï¼ŒæŠŠ sourcemap çš„å†…å®¹ä»¥ <strong>DataURI</strong> çš„æ–¹å¼è¿½åŠ åˆ° bundle ä»¶æœ«å°¾ï¼Œå³å°†<code>.map</code> ä½œä¸º DataURI åµŒå…¥ã€‚ï¼ˆä¸€èˆ¬ä½¿ç”¨è¯¥ç±»å‹å¦‚é€ æˆä½“ç§¯è¿‡å¤§ï¼Œè¯¥ç±»å‹æ¯”è¾ƒå°‘ç”¨ï¼‰</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">webpackJsonp([1],[</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">function(e,t,i)&#123;...&#125;,</span><br><span class="line">  ...</span><br><span class="line">])</span><br><span class="line">&#x2F;&#x2F;# sourceMappingURL&#x3D;data:application&#x2F;json;charset&#x3D;utf-8;base64,eyJ2ZXJzaW9...</span><br></pre></td></tr></table></figure><blockquote><p>DataURL æœ€æ—©æ˜¯å‡ºç°åœ¨ HTML æ–‡ä»¶ img æ ‡ç­¾ä¸­çš„å…³äºå›¾ç‰‡çš„å¼•ç”¨ï¼Œå¦‚ base64 å›¾ç‰‡</p></blockquote><p>DataURL ä½¿ç”¨äºå¦‚ä¸‹çš„åœºæ™¯</p><ul><li>è®¿é—®å¤–éƒ¨èµ„æºå—é™</li><li>å›¾ç‰‡ä½“ç§¯å°ï¼Œå ç”¨ä¸€ä¸ª HTTP ä¼šè¯èµ„æºæµªè´¹</li></ul><h3 id="hidden"><a href="#hidden" class="headerlink" title="hidden"></a>hidden</h3><p>bundle é‡Œä¸åŒ…å« sourcemap çš„å¼•ç”¨åœ°å€ï¼Œè¿™æ ·æµè§ˆå™¨å¼€å‘è€…å·¥å…·é‡Œçœ‹ä¸åˆ°åŸå§‹ä»£ç </p><h2 id="Sourcemap-ç±»å‹"><a href="#Sourcemap-ç±»å‹" class="headerlink" title="Sourcemap ç±»å‹"></a>Sourcemap ç±»å‹</h2><p>ä¸Šè¿°çš„å…³é”®è¯æ··ä¸€èµ·æ­é…ï¼Œåˆå¢åŠ äº†å¥½å‡ ç§ sourcemap ç±»å‹</p><ul><li><p><strong>eval-source-map</strong>ï¼šæ¯ä¸€ä¸ªæ¨¡å—åœ¨æ‰§è¡Œ eval()è¿‡ç¨‹ä¹‹åï¼Œå¹¶ä¸”ä¼šä¸ºæ¯ä¸€ä¸ªæ¨¡å—ç”Ÿæˆ <code>.map</code> æ–‡ä»¶ï¼Œç”Ÿæˆçš„ sourcemap æ–‡ä»¶é€šè¿‡ DataURL çš„æ–¹å¼æ·»åŠ ï¼ˆæŠŠ eval çš„ sourceURL æ¢æˆäº†å®Œæ•´ sourcemap ä¿¡æ¯çš„ DataURLï¼‰</p></li><li><p><strong>cheap-eval-source-map</strong>ï¼šè·Ÿ eval-source-map ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯å¢åŠ äº†â€cheapâ€ï¼Œâ€cheapâ€æ˜¯æŒ‡å¿½ç•¥äº†è¡Œä¿¡æ¯ã€‚è¿™ä¸ªå±æ€§åŒæ—¶ä¹Ÿä¸ä¼šç”Ÿæˆä¸åŒ loader æ¨¡å—ä¹‹é—´çš„ sourcemapã€‚</p></li><li><p><strong>cheap-module-eval-source-map</strong>ï¼šä¸ cheap-eval-source-map ç›¸åŒï¼Œä½†æ˜¯åŒ…å«äº†ä¸åŒ loader æ¨¡å—ä¹‹é—´çš„ sourcemap</p></li><li><p><strong>cheap-source-map</strong>ï¼š ä¸åŒ…å«åˆ—ä¿¡æ¯ï¼Œä¸åŒ…å« loader çš„ sourcemap</p></li><li><p><strong>inline-source-map</strong>ï¼š ä¸ºæ¯ä¸€ä¸ªæ–‡ä»¶æ·»åŠ  sourcemap çš„ DataURLï¼Œæ³¨æ„è¿™é‡Œçš„æ–‡ä»¶æ˜¯æ‰“åŒ…å‰çš„æ¯ä¸€ä¸ªæ–‡ä»¶è€Œä¸æ˜¯æœ€åæ‰“åŒ…å‡ºæ¥çš„ï¼ŒåŒæ—¶è¿™ä¸ª DataURL æ˜¯åŒ…å«ä¸€ä¸ªæ–‡ä»¶å®Œæ•´ sourcemap ä¿¡æ¯çš„ base64 æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²</p></li></ul><p>-<strong>hidden-source-map</strong>ï¼šä¸åœ¨ bundle æ–‡ä»¶ç»“å°¾å¤„è¿½åŠ  sourceURL æŒ‡å®šå…¶ sourcemap æ–‡ä»¶çš„ä½ç½®ï¼Œä½†æ˜¯ä»ç„¶ä¼šç”Ÿæˆ sourcemap æ–‡ä»¶ã€‚è¿™æ ·ï¼Œæµè§ˆå™¨å¼€å‘è€…å·¥å…·å°±æ— æ³•åº”ç”¨ sourcemap, ç›®çš„æ˜¯é¿å…æŠŠ sourcemap æ–‡ä»¶å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œé€ æˆæºç æ³„éœ²ã€‚</p><p>ä¸ä»…è¿˜æœ‰è¿™å‡ ç§ï¼Œè¿˜å¯ä»¥ç»§ç»­ç»„åˆï¼Œè¿™é‡Œå°±åˆ—ä¸¾è¿™ä¹ˆå¤šäº†</p><h2 id="å¦‚ä½•é€‰æ‹©-Sourcemap"><a href="#å¦‚ä½•é€‰æ‹©-Sourcemap" class="headerlink" title="å¦‚ä½•é€‰æ‹© Sourcemap"></a>å¦‚ä½•é€‰æ‹© Sourcemap</h2><ul><li>é¦–å…ˆåœ¨æºä»£ç çš„åˆ—ä¿¡æ¯æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºåªè¦æœ‰è¡Œä¿¡æ¯å°±èƒ½å®Œæ•´çš„å»ºç«‹æ‰“åŒ…å‰åä»£ç ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¤Ÿæˆ‘ä»¬å®šä½äº†ã€‚</li><li>å…¶æ¬¡ï¼Œä¸ç®¡åœ¨ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯å¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬éƒ½éœ€è¦å®šä½ debug åˆ°æœ€æœ€åŸå§‹çš„èµ„æºï¼Œæ¯”å¦‚å®šä½é”™è¯¯åˆ° jsx çš„åŸå§‹ä»£ç å¤„ï¼Œè€Œä¸æ˜¯ç¼–è¯‘æˆ js çš„ä»£ç å¤„ï¼Œå› æ­¤ï¼Œä¸èƒ½å¿½ç•¥ module å±æ€§ã€‚</li><li><code>eval-source-map</code> ä½¿ç”¨ DataURL æœ¬èº«åŒ…å«å®Œæ•´ sourcemap ä¿¡æ¯ï¼Œå¹¶ä¸éœ€è¦åƒ sourceURL é‚£æ ·ï¼Œæµè§ˆå™¨éœ€è¦å‘é€ä¸€ä¸ªå®Œæ•´è¯·æ±‚å»è·å– sourcemap æ–‡ä»¶ï¼Œè¿™ä¼šç•¥å¾®æé«˜ç‚¹æ•ˆç‡</li></ul><p>å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼š<strong>cheap-module-eval-source-map</strong>ï¼ˆè¯¥é…ç½®å€¼èƒ½ä¿ç•™ loader å¤„ç†å‰çš„åŸå§‹ä»£ç ä¿¡æ¯ï¼Œè€Œæ‰“åŒ…é€Ÿåº¦ä¹Ÿè¾ƒå¿«ï¼Œæ˜¯ä¸€ä¸ªè¾ƒä½³çš„é€‰æ‹©ã€‚ï¼‰</p><p>ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ sourcemap ä¼šæœ‰æ³„éœ²æºä»£ç çš„é£é™©ï¼Œä½†å¦‚æœè¦ä¿ç•™å®šä½çº¿ä¸Šçš„é”™è¯¯ï¼Œåº”è¯¥ç¦æ­¢æµè§ˆå™¨å¼€å‘è€…å·¥å…·çœ‹åˆ°æºä»£ç ï¼Œè€Œæ˜¯ç”¨ä¸€äº›é”™è¯¯æ”¶é›†ç³»ç»Ÿï¼Œå°† sourcemap æ–‡ä»¶ä¼ åˆ°ç³»ç»Ÿä¸Šï¼Œé€šè¿‡ç³»ç»Ÿ source map åˆ†æå‡ºåŸå§‹ä»£ç çš„é”™è¯¯å †æ ˆï¼Œå¦‚ä½¿ç”¨<code>hidden-source-map</code>ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿæœ‰ä½¿ç”¨<code>nosources-source-map</code>, <code>source-map</code>çš„ï¼Œä¾æ®ä½ ä»¬éœ€æ±‚åœºæ™¯é€‰æ‹©ã€‚æ€»ä¹‹ï¼Œæœ€ç»ˆç»“æœæ˜¯ä¸èƒ½è¢«äººé€šè¿‡å¼€å‘è€…å·¥å…·çœ‹åˆ°æºä»£ç çš„ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a674f3f10dc0482da017738a79772d50~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æˆ‘ä»¬é¡¹ç›®ç›®å‰è¿˜æ˜¯ Webpack4.xï¼Œå¦‚æœä½ ä»¬é¡¹ç›®å·²ç»ç”¨ Webpack5ï¼Œsourcemap åç§°æœ‰äº›ä¸<br>åŒï¼Œå…·ä½“è¯·æŸ¥é˜… Webpack5 æ–‡æ¡£ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/forthealllight/blog/issues/6" target="_blank" rel="noopener">Webpack ä¸­çš„ sourcemap ä»¥åŠå¦‚ä½•åœ¨ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¸­åˆç†çš„è®¾ç½® sourcemap çš„ç±»å‹</a></p><br><p>psï¼š</p><ul><li><a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a></li></ul>]]></content>
      <categories>
        <category>å‰ç«¯å·¥ç¨‹åŒ–</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>SourceMap</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¦ä½ å…¥é—¨ä½“éªŒ Vue3</title>
    <url>/2021/03/09/%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8%E4%BD%93%E9%AA%8C-Vue3/</url>
    <content><![CDATA[<p>æœ¬æ–‡åŒæ­¥å‘å¸ƒåœ¨æˆ‘çš„<a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">Github ä¸ªäººåšå®¢</a></p><p>ä¸€ç›´éƒ½æ˜¯ React è¿›è¡Œå¼€å‘ï¼Œè™½ç„¶ Vue æ˜¯æ¥è§¦æœ€æ—©çš„ï¼Œä½†ç°åœ¨å®é™…å·¥ä½œä¹Ÿä¸æ€ä¹ˆæœ‰æœºä¼šç”¨ï¼ŒVue3 éƒ½å‡ºäº†ã€‚å…¶ä¸­æ–°å†™æ³•æœ‰ç‚¹åƒ React Hookï¼Œäºæ˜¯ï¼Œè¿™æ®µæ—¶é—´è¿…é€Ÿå¯¹ Vue3 è¿›è¡Œäº†åŸºæœ¬çŸ¥è¯†å…¥é—¨ï¼Œä½“éªŒä¸‹ Vue3ã€‚</p><a id="more"></a><h2 id="Vue2-x-æœ‰å“ªäº›ç—›ç‚¹"><a href="#Vue2-x-æœ‰å“ªäº›ç—›ç‚¹" class="headerlink" title="Vue2.x æœ‰å“ªäº›ç—›ç‚¹"></a>Vue2.x æœ‰å“ªäº›ç—›ç‚¹</h2><p>é¦–å…ˆ Vue3 å‡ºç°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥ç†ç† Vue2.x æœ‰ä»€ä¹ˆç—›ç‚¹ï¼Œéœ€è¦ Vue3 è¡¥ä¸Šçš„ã€‚</p><ul><li>Vue2.x å¯¹æ•°ç»„å¯¹è±¡çš„æ·±å±‚ç›‘å¬æ— æ³•å®ç°ã€‚å› ä¸ºç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯å°† data é‡Œçš„æ•°æ®é€šè¿‡ defineProperty è¿›è¡Œå“åº”å¼æˆ–è€…åŒå‘ç»‘å®šä¸Šï¼Œä¹‹å‰æ²¡æœ‰ååŠ çš„å±æ€§æ˜¯ä¸ä¼šè¢«ç»‘å®šä¸Šï¼Œä¹Ÿå°±ä¸ä¼šè§¦å‘æ›´æ–°æ¸²æŸ“ã€‚</li><li>ä»£ç çš„å¯è¯»æ€§éšç€ç»„ä»¶å˜å¤§è€Œå˜å·®</li><li>æ¯ä¸€ç§ä»£ç å¤ç”¨çš„æ–¹å¼ï¼Œéƒ½å­˜åœ¨ç¼ºç‚¹</li><li>vue2.x å¯¹ typescript æ”¯æŒä¸å¤ªå‹å¥½ï¼Œéœ€è¦ä½¿ç”¨ä¸€å †è£…é¥°å™¨è¯­æ³•</li></ul><h2 id="Options-API-åˆ°-Composition-API-çš„è½¬å˜"><a href="#Options-API-åˆ°-Composition-API-çš„è½¬å˜" class="headerlink" title="Options API åˆ° Composition API çš„è½¬å˜"></a>Options API åˆ° Composition API çš„è½¬å˜</h2><p>Options API å³æ˜¯é€šè¿‡å®šä¹‰ methodsï¼Œcomputedï¼Œwatchï¼Œdata ç­‰å±æ€§ä¸æ–¹æ³•ï¼Œå…±åŒå¤„ç†é¡µé¢é€»è¾‘ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9c1026434744a1bae136ac31e1bcac4~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>å¯ä»¥çœ‹åˆ° Options ä»£ç ç¼–å†™æ–¹å¼ï¼Œå¦‚æœæ˜¯ç»„ä»¶çŠ¶æ€ï¼Œåˆ™å†™åœ¨ data å±æ€§ä¸Šï¼Œå¦‚æœæ˜¯æ–¹æ³•ï¼Œåˆ™å†™åœ¨ methods å±æ€§ä¸Š</p><p>å½“ç»„ä»¶å˜å¾—å¤æ‚æ—¶ï¼Œä¼šå¯¼è‡´å¯¹åº”å±æ€§çš„åˆ—è¡¨ä¹Ÿä¼šå¢é•¿ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç»„ä»¶éš¾ä»¥é˜…è¯»å’Œç†è§£ã€‚</p><p>ä¸‹é¢è¡¨ç¤ºç»„ä»¶æ˜¯ä¸€ä¸ªå¤§å‹ç»„ä»¶ï¼ˆä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒé€»è¾‘ï¼‰ï¼Œä¼šçœ‹åˆ°åŒä¸ªåŠŸèƒ½é€»è¾‘çš„ä»£ç è¢«åˆ†æ•£åˆ°å„å¤„ï¼Œè¿™ç§ç¢ç‰‡åŒ–ä½¿å¾—ç†è§£å’Œç»´æŠ¤å¤æ‚ç»„ä»¶å˜å¾—å›°éš¾ï¼Œéœ€è¦ä¸æ–­â€è·³â€åˆ°ç›¸å…³ä»£ç å¤„ã€‚<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de12120d2468456fb75465ecae3b9ee0~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>è€Œ Composition API æ˜¯æ ¹æ®é€»è¾‘åŠŸèƒ½æ¥ç»„ç»‡çš„ï¼Œä¸€ä¸ªåŠŸèƒ½æ‰€å®šä¹‰çš„æ‰€æœ‰ API ä¼šæ”¾åœ¨ä¸€èµ·ï¼ˆæ›´åŠ çš„é«˜å†…èšï¼Œä½è€¦åˆï¼‰</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f21b64d574254722b9a13d3b491aeedb~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>ç”¨ Composition API æ¥è¡¨ç¤ºä¸€ä¸ªå¤§å‹ç»„ä»¶ä¸ä¸Šé¢ Options API çš„å¯¹æ¯”ï¼Œå¯ä»¥ç›´è§‚åœ°æ„Ÿå—åˆ° Composition API åœ¨é€»è¾‘ç»„ç»‡æ–¹é¢çš„ä¼˜åŠ¿ï¼Œä»¥åä¿®æ”¹ä¸€ä¸ªå±æ€§åŠŸèƒ½çš„æ—¶å€™ï¼Œåªéœ€è¦è·³åˆ°æ§åˆ¶è¯¥å±æ€§çš„æ–¹æ³•ä¸­å³å¯ï¼Œåœ¨é€»è¾‘ç»„ç»‡å’Œé€»è¾‘å¤ç”¨æ–¹é¢æ›´å¥½ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4cd55d676c034223a99adc64936d39ef~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>Options API æ˜¯é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼ŒComposition API æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ã€‚</p><p>Vue3 å°† Vue2.x é‡Œé¢çš„ Options APIï¼Œç»†ç²’åº¦æ‹†åˆ†æˆç»†å°çš„å‡½æ•°ï¼Œç„¶åç»Ÿä¸€æ”¾åˆ° setup è¿™ä¸€ä¸ªå…¥å£å‡½æ•°ä¸­è°ƒç”¨ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„ï¼š</p><ul><li>ä¿ç•™äº† Vue2.x ä¸­å„ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œåšåˆ°å…¼å®¹</li><li>åŒæ—¶ä»¥å°çš„å‡½æ•°å½¢å¼è¢«è°ƒç”¨ï¼Œæ›´åŠ çµæ´»ï¼Œæ›´å¥½ç»´æŠ¤ï¼Œæ›´å¥½ tree-shaking</li></ul><h2 id="vue3-æœ‰å“ªäº›ä¼˜åŒ–"><a href="#vue3-æœ‰å“ªäº›ä¼˜åŒ–" class="headerlink" title="vue3 æœ‰å“ªäº›ä¼˜åŒ–"></a>vue3 æœ‰å“ªäº›ä¼˜åŒ–</h2><ul><li>æ‰“åŒ…å¤§å°å‡å°‘ 41%ï¼Œåˆæ¬¡æ¸²æŸ“å¿« 55%ï¼Œæ›´æ–°å¿« 133%ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘ 54%ï¼ˆå®˜æ–¹æ•°æ®ï¼‰</li><li>é‡‡ç”¨ Typescript å¼€å‘ï¼Œæ›´å¥½æ”¯æŒ Typescript</li><li>ä½¿ç”¨ Proxy ä»£æ›¿ vue2.x ä¸­çš„ definePropertyï¼Œèƒ½å¤Ÿæ·±å±‚ç›‘å¬æ•°ç»„å¯¹è±¡çš„å˜åŒ–ã€‚</li><li>Options API åˆ° Composition APIï¼Œä½¿å¤æ‚ç»„ä»¶é€»è¾‘å¤ç”¨å˜å¾—æ›´å®¹æ˜“å’Œç»´æŠ¤ã€‚</li></ul><h2 id="Composition-API"><a href="#Composition-API" class="headerlink" title="Composition API"></a>Composition API</h2><p>å­—é¢æ„æ€å°±æ˜¯ç»„åˆå¼ APIï¼Œä¹Ÿå°±æ˜¯å°†åŸæ¥çš„å¾ˆå¤šåº•å±‚çš„æ–¹æ³•æ‹†åˆ†å¼€ï¼Œæš´éœ²å‡ºæ¥è®©å¤§å®¶å»ä½¿ç”¨ã€‚</p><h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><p><code>setup</code> æ˜¯ Composition API çš„æ ¸å¿ƒï¼Œå®ƒåœ¨<code>props</code>ã€<code>data</code>ã€<code>computed</code>ã€<code>methods</code>ã€<code>ç”Ÿå‘½å‘¨æœŸå‡½æ•°</code>ä¹‹å‰è¿è¡Œçš„ã€‚</p><p>å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸Šçš„å±æ€§å°†åˆå¹¶åˆ°ç»„ä»¶æ¨¡æ¿çš„æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿˜å¯ä»¥è¿”å›ä¸€ä¸ª render å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;setup&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="comment">// Composition API é€»è¾‘ç»„ç»‡çš„å…¥å£</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>å®ƒå°† Vue2.x ä¸­çš„ <code>beforeCreate</code> å’Œ <code>created</code> ä»£æ›¿äº†ï¼Œä»¥ä¸€ä¸ª <code>setup</code> å‡½æ•°çš„å½¢å¼çµæ´»ç»„ç»‡ä»£ç ï¼›è¿˜å¯ä»¥ return æ•°æ®æˆ–è€… templateï¼Œç›¸å½“äºæŠŠ data å’Œ render ä¹Ÿä¸€å¹¶ä»£æ›¿äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123; foo &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> foo = <span class="number">2</span> <span class="comment">// æ™®é€šå˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      foo, <span class="comment">// å¿…é¡» return å‡ºå»æ‰èƒ½åœ¨æ¨¡æ¿ä½¿ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>é¡ºå¸¦ä¸€æï¼Œé€šå¸¸ä¸ºäº†åœ¨ TypeScript ä¸‹èƒ½è®©ç»„ä»¶æœ‰æ­£ç¡®çš„å‚æ•°ç±»å‹æ¨æ–­ã€IDE æœ‰æ›´å¥½çš„æç¤ºæ•ˆæœï¼Œä¼šåœ¨<code>export default</code>å¤„å†åŒ…ä¸€å±‚å‡½æ•°<code>defineComponent</code>ï¼ˆè¯¥å‡½æ•°åªè¿”å›ä¼ é€’ç»™å®ƒçš„å¯¹è±¡ï¼‰</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="comment">// Composition API é€»è¾‘ç»„ç»‡çš„å…¥å£</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><strong><code>setup</code>å‡½æ•°ä½¿ç”¨éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</strong></p><ul><li>ç”±äºåœ¨æ‰§è¡Œ<code>setup</code>å‡½æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œ<code>created</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨<code>setup</code> å‡½æ•°ä¸­ï¼Œæ— æ³•ä½¿ç”¨ <code>data</code>å’Œ <code>methods</code> çš„å˜é‡å’Œæ–¹æ³•</li><li><code>setup</code>å‡½æ•°åªèƒ½æ˜¯åŒæ­¥çš„ä¸èƒ½æ˜¯å¼‚æ­¥çš„</li></ul><p>ç”±äº <code>setup</code> æ˜¯ä¸€ä¸ªå…¥å£å‡½æ•°ï¼Œæœ¬è´¨æ˜¯é¢å‘å‡½æ•°ç¼–ç¨‹ï¼Œè€Œ <code>this</code> æ˜¯é¢å‘å¯¹è±¡çš„ä¸€ç§ä½“ç°ï¼Œè¿™é‡Œå…¶å®ç›¸å½“äºå–æ¶ˆ<code>this</code>äº†ï¼Œåœ¨ Vue3<code>setup</code> å‡½æ•°é‡Œçš„<code>this</code>ä¸º <code>undefined</code>ã€‚</p><p>è€Œå–æ¶ˆäº†<code>this</code>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code>setup</code>å¢åŠ äº† 2 ä¸ªå‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">propsï¼šç»„ä»¶å‚æ•°</span><br><span class="line">contextï¼šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚attrsã€slotsã€emitï¼‰</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: <span class="built_in">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  setup(props, context) &#123;</span><br><span class="line">    <span class="keyword">const</span> foo = <span class="number">2</span></span><br><span class="line">    <span class="built_in">console</span>.log(props.title, context)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      foo,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p>æ¥å—ä¸€ä¸ªå†…éƒ¨å€¼å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼ä¸”å¯å˜çš„ ref å¯¹è±¡ï¼ˆå“åº”å¼å¯¹è±¡ï¼‰ï¼Œ<code>ref()</code>åˆ›å»ºçš„æ•°æ®ä¼šè§¦å‘æ¨¡ç‰ˆæ›´æ–°ã€‚ref å¯¹è±¡å…·æœ‰æŒ‡å‘å†…éƒ¨å€¼çš„å•ä¸ª property <code>.value</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123; count &#125;&#125;</span><br><span class="line">    &lt;button @click=<span class="string">"handleClick"</span>&gt;åŠ <span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; defineComponent, ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default defineComponent(&#123;</span></span><br><span class="line"><span class="regexp">  setup() &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ è¢« ref æ–¹æ³•åŒ…è£¹åçš„å…ƒç´ å°±å˜æˆäº†ä¸€ä¸ªä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="regexp">    const count = ref(0)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const handleClick = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      count.value++ /</span><span class="regexp">/ åœ¨setupé‡Œé¢ä½¿ç”¨refä»£ç†å¯¹è±¡éœ€è¦ `.value`ï¼Œæ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ç”±äºvueå¸®æˆ‘ä»¬åšäº†è‡ªåŠ¨è§£ææ‰€ä»¥ä¸ç”¨ `.value`</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      count,</span></span><br><span class="line"><span class="regexp">      handleClick,</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><h3 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h3><p>reactive ä¹Ÿæ˜¯å®ç°å“åº”å¼çš„ä¸€ç§æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæ™®é€šå¯¹è±¡ç„¶åè¿”å›è¯¥æ™®é€šå¯¹è±¡çš„å“åº”å¼ä»£ç†ï¼Œç›¸å½“äº Vue2.x ä¸­çš„ <code>Vue.observable()</code></p><p>ä¸€èˆ¬çº¦å®š reactive çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ<code>ref</code>çš„å‚æ•°é€šå¸¸æ˜¯åŸå§‹æ•°æ®ç±»å‹ï¼Œè™½ç„¶åè¿‡æ¥ä¹Ÿå¯ä»¥ã€‚</p><p><code>ref</code>çš„æœ¬è´¨è¿˜æ˜¯ reactive ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®<code>ref()</code>å‡½æ•°çš„å…¥å‚å°†å…¶è½¬æ¢æˆ<code>ref(x)</code>å³<code>reactive({ value:x })</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123; obj1.count1 &#125;&#125;</span><br><span class="line">    &#123;&#123; count2 &#125;&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive, toRefs &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> obj1 = reactive(&#123;</span><br><span class="line">      count1: <span class="number">10</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> obj2 = reactive(&#123;</span><br><span class="line">      count2: <span class="number">20</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      obj1,</span><br><span class="line">      ...toRefs(obj2),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥ return obj1ï¼Œåœ¨æ¨¡æ¿ä½¿ç”¨æ—¶éœ€è¦<code>obj.count1</code>ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥<code>...obj1</code>å‘¢ï¼Œé‚£æ˜¯å› ä¸º obj1 æ˜¯<code>proxy</code>ä»£ç†å¯¹è±¡ï¼Œæ•´ä¸ªå¯¹è±¡éƒ½æ˜¯å“åº”å¼ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨å‰©ä½™è¿ç®—ç¬¦ã€‚</p><p>å¦‚æœè§‰å¾—éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨<code>...toRefs(obj2)</code>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ¨¡æ¿ç›´æ¥ä½¿ç”¨å®šä¹‰çš„æ•°æ®äº†ã€‚</p><blockquote><p><code>toRefs</code> å‡½æ•°æ˜¯å°†<code>reactive</code>åˆ›å»ºçš„å“åº”å¼å¯¹è±¡ï¼Œè½¬åŒ–æˆä¸ºæ™®é€šçš„å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½æ˜¯<code>ref</code>ç±»å‹çš„å“åº”å¼æ•°æ®</p></blockquote><h3 id="toRef"><a href="#toRef" class="headerlink" title="toRef"></a>toRef</h3><p>å¯ä»¥ç”¨æ¥ä¸ºæºå“åº”å¼å¯¹è±¡ä¸Šçš„æŸä¸ª property æ–°åˆ›å»ºä¸€ä¸ª refã€‚ç„¶åï¼Œref å¯ä»¥è¢«ä¼ é€’ï¼Œå®ƒä¼šä¿æŒå¯¹å…¶æº property çš„å“åº”å¼è¿æ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">      foo: <span class="number">1</span>,</span><br><span class="line">      bar: <span class="number">2</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> fooRef = toRef(state, <span class="string">'foo'</span>)</span><br><span class="line"></span><br><span class="line">    fooRef.value++</span><br><span class="line">    <span class="built_in">console</span>.log(state.foo) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    state.foo++</span><br><span class="line">    <span class="built_in">console</span>.log(fooRef.value) <span class="comment">// 3</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>toRef()</code>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºå¯¹è±¡ï¼Œç¬¬äºŒä¸ªä¸ºå¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§ã€‚å®ƒæ˜¯å¯¹åŸæ•°æ®çš„ä¸€ä¸ªå¼•ç”¨ï¼Œå½“å€¼æ”¹å˜æ—¶ä¼šå½±å“åˆ°åŸå§‹å€¼ï¼›åˆ›å»ºçš„å“åº”å¼æ•°æ®å¹¶ä¸ä¼šè§¦å‘ vue æ¨¡ç‰ˆæ›´æ–°ã€‚</p><h3 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a>toRefs</h3><p>å°†å“åº”å¼å¯¹è±¡è½¬æ¢ä¸ºæ™®é€šå¯¹è±¡ï¼Œå…¶ä¸­ç»“æœå¯¹è±¡çš„æ¯ä¸ª property éƒ½æ˜¯æŒ‡å‘åŸå§‹å¯¹è±¡ç›¸åº” property çš„ refã€‚</p><p><code>toRefs()</code>æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶éå†å¯¹è±¡èº«ä¸Šçš„æ‰€æœ‰å±æ€§ï¼Œç„¶åé€ä¸ªè°ƒç”¨<code>toRef()</code>æ‰§è¡Œã€‚ä»¥æ­¤ï¼Œå°†å“åº”å¼å¯¹è±¡è½¬åŒ–ä¸ºæ™®é€šå¯¹è±¡ï¼Œä¾¿äºåœ¨æ¨¡ç‰ˆä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å±æ€§ã€‚</p><p>é€šå¸¸ç”¨æ¥å°†ä¸€ç»„çš„å“åº”å¼å¯¹è±¡æ‹†æˆå•ä¸ªçš„å“åº”å¼å¯¹è±¡ï¼Œå¦‚å°†ä¸€ä¸ª reactive ä»£ç†å¯¹è±¡æ‰“å¹³ï¼Œè½¬æ¢ä¸º ref ä»£ç†å¯¹è±¡ï¼Œä½¿å¾—å¯¹è±¡çš„å±æ€§å¯ä»¥ç›´æ¥åœ¨ template ä¸Šä½¿ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123; foo &#125;&#125;</span><br><span class="line">    &#123;&#123; bar &#125;&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive, toRefs &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå“åº”å¼å¯¹è±¡state</span></span><br><span class="line">    <span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">      foo: <span class="number">1</span>,</span><br><span class="line">      bar: <span class="number">2</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> stateAsRefs = toRefs(state) <span class="comment">// å°†å“åº”å¼çš„å¯¹è±¡å˜ä¸ºæ™®é€šå¯¹è±¡ç»“æ„, ä¸”èƒ½ä½¿ç”¨ES6çš„æ‰©å±•è¿ç®—ç¬¦ï¼Œä¹Ÿä»å…·æœ‰å“åº”æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ref å’ŒåŸå§‹ property å·²ç»â€œé“¾æ¥â€èµ·æ¥äº†</span></span><br><span class="line">    state.foo++</span><br><span class="line">    <span class="built_in">console</span>.log(stateAsRefs.foo.value) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    stateAsRefs.foo.value++</span><br><span class="line">    <span class="built_in">console</span>.log(state.foo) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...stateAsRefs,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h3><p>æ¥å—ä¸€ä¸ª getter å‡½æ•°ï¼Œå¹¶ä¸ºä» getter è¿”å›çš„å€¼è¿”å›ä¸€ä¸ªä¸å˜çš„å“åº”å¼ ref å¯¹è±¡ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setup() &#123;</span><br><span class="line">  <span class="keyword">const</span> count = ref(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">const</span> plusOne = computed(<span class="function"><span class="params">()</span> =&gt;</span> count.value + <span class="number">1</span>) <span class="comment">// ç»“æœæ˜¯ä¸€ä¸ª ref ä»£ç†å¯¹è±¡ï¼Œå–å€¼éœ€è¦ .value</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(plusOne.value) <span class="comment">// 2</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>ä¸ Vue2.x ä¸­çš„ä½œç”¨ç±»ä¼¼ï¼Œè·å–ä¸€ä¸ªè®¡ç®—ç»“æœã€‚å½“ computed å‚æ•°ä½¿ç”¨ object å¯¹è±¡ä¹¦å†™æ—¶ï¼Œä¸ä»…æ”¯æŒå–å€¼ getï¼ˆé»˜è®¤ï¼‰ï¼Œè¿˜æ”¯æŒèµ‹å€¼ setã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setup() &#123;</span><br><span class="line">  <span class="keyword">const</span> count = ref(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">const</span> plusOne = computed(&#123;</span><br><span class="line">    <span class="keyword">get</span>: () =&gt; count.value + 1,</span><br><span class="line">    <span class="keyword">set</span>: (val) =&gt; &#123;</span><br><span class="line">      count.value = val - <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  plusOne.value = <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(count.value) <span class="comment">// 0</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p>watch API ä¸é€‰é¡¹å¼ API <code>this.$watch</code> (ä»¥åŠç›¸åº”çš„ watch é€‰é¡¹) å®Œå…¨ç­‰æ•ˆã€‚watch éœ€è¦ä¾¦å¬ç‰¹å®šçš„æ•°æ®æºï¼Œå¹¶åœ¨å•ç‹¬çš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œå‰¯ä½œç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¹Ÿæ˜¯æƒ°æ€§çš„â€”â€”å³å›è°ƒä»…åœ¨ä¾¦å¬æºå‘ç”Ÿæ›´æ”¹æ—¶è¢«è°ƒç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123; count &#125;&#125;</span><br><span class="line">    &lt;button @click=<span class="string">"changeCount"</span>&gt;countåŠ <span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; defineComponent, watch, ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default defineComponent(&#123;</span></span><br><span class="line"><span class="regexp">  setup() &#123;</span></span><br><span class="line"><span class="regexp">    const count = ref(0)</span></span><br><span class="line"><span class="regexp">    const changeCount = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      count.value++</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    watch(count, (newCount, prevCount) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      console.log('newCount:', newCount, ' oldCount:', prevCount)</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      count,</span></span><br><span class="line"><span class="regexp">      changeCount,</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„åŒæ—¶ä¾¦å¬å¤šä¸ªæºã€‚</p><h3 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h3><p>åœ¨å“åº”å¼åœ°è·Ÿè¸ªå…¶ä¾èµ–é¡¹æ—¶ç«‹å³æ‰§è¡Œä¼ å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨æ›´æ”¹ä¾èµ–é¡¹æ—¶é‡æ–°è¿è¡Œå®ƒã€‚</p><p>å½“ç»„ä»¶çš„ setup()æˆ–è€…ç”Ÿå‘½å‘¨æœŸé’©å­è¢«è°ƒç”¨æ—¶ï¼ŒwatchEffect ä¼šè¢«é“¾æ¥åˆ°è¯¥ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123; count &#125;&#125;</span><br><span class="line">    &lt;button @click=<span class="string">"changeCount"</span>&gt;countåŠ <span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; defineComponent, ref, watchEffect &#125; from 'vue'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default defineComponent(&#123;</span></span><br><span class="line"><span class="regexp">  setup() &#123;</span></span><br><span class="line"><span class="regexp">    const count = ref(0)</span></span><br><span class="line"><span class="regexp">    const changeCount = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      count.value++</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    watchEffect(() =&gt; console.log(count.value))</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ -&gt; logs 0</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      count.value++</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ -&gt; logs 1</span></span><br><span class="line"><span class="regexp">    &#125;, 100)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      count,</span></span><br><span class="line"><span class="regexp">      changeCount,</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p><strong>watch ä¸ watchEffect æ¯”è¾ƒï¼Œwatch å…è®¸æˆ‘ä»¬</strong></p><ul><li>æƒ°æ€§åœ°æ‰§è¡Œå‰¯ä½œç”¨ï¼›</li><li>æ›´å…·ä½“åœ°è¯´æ˜åº”è§¦å‘ä¾¦å¬å™¨é‡æ–°è¿è¡Œçš„çŠ¶æ€ï¼›</li><li>è®¿é—®è¢«ä¾¦å¬çŠ¶æ€çš„å…ˆå‰å€¼å’Œå½“å‰å€¼ã€‚</li></ul><h3 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h3><p>æ¥å—ä¸€ä¸ªå¯¹è±¡ (å“åº”å¼æˆ–çº¯å¯¹è±¡) æˆ– ref å¹¶è¿”å›åŸå§‹å¯¹è±¡çš„åªè¯»ä»£ç†ã€‚åªè¯»ä»£ç†æ˜¯æ·±å±‚çš„ï¼šä»»ä½•è¢«è®¿é—®çš„åµŒå¥— property ä¹Ÿæ˜¯åªè¯»çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setup() &#123;</span><br><span class="line">  <span class="keyword">const</span> original = reactive(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›çš„ readonly å¯¹è±¡ï¼Œä¸€æ—¦ä¿®æ”¹å°±ä¼šåœ¨ console æœ‰ warning è­¦å‘Šã€‚ç¨‹åºè¿˜æ˜¯ä¼šç…§å¸¸è¿è¡Œï¼Œä¸ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> copy = readonly(original)</span><br><span class="line"></span><br><span class="line">  watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åªè¦æœ‰æ•°æ®å˜åŒ–ï¼Œè¿™ä¸ªå‡½æ•°éƒ½ä¼šæ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">console</span>.log(copy.count)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿™é‡Œä¼šè§¦å‘ watchEffect</span></span><br><span class="line">  original.count++</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿™é‡Œä¸ä¼šè§¦å‘ä¸Šæ–¹çš„ watchEffectï¼Œå› ä¸ºæ˜¯ readonlyã€‚</span></span><br><span class="line">  copy.count++ <span class="comment">// warning!</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="Fragments-Template"><a href="#Fragments-Template" class="headerlink" title="Fragments Template"></a>Fragments Template</h3><p>Vue3.x ä¸­ï¼Œå¯ä»¥ä¸ç”¨å”¯ä¸€æ ¹èŠ‚ç‚¹ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure><h3 id="Teleport-ç»„ä»¶"><a href="#Teleport-ç»„ä»¶" class="headerlink" title="Teleport ç»„ä»¶"></a>Teleport ç»„ä»¶</h3><p>Teleport åœ¨å›½å†…ç¿»è¯‘æˆäº†ç¬é—´ç§»åŠ¨ç»„ä»¶æˆ–è€…ç‹¬ç«‹ç»„ä»¶ï¼Œå®ƒå¯ä»¥æŠŠä½ å†™çš„ç»„ä»¶æŒ‚è½½åˆ°ä»»ä½•ä½ æƒ³æŒ‚è½½çš„ DOM ä¸Šã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"user-card"</span>&gt;</span><br><span class="line">    &lt;b&gt; &#123;&#123; name &#125;&#125; &lt;<span class="regexp">/b&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button @click="isModalOpen = true"&gt;åˆ é™¤ç”¨æˆ·&lt;/</span>button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- æ³¨æ„è¿™ä¸€å—ä»£ç  --&gt;</span><br><span class="line">    &lt;Teleport to=<span class="string">"#modal"</span>&gt;</span><br><span class="line">      &lt;div v-show=<span class="string">"isModalOpen"</span>&gt;</span><br><span class="line">        &lt;p&gt;ç¡®å®šåˆ é™¤?&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button @click="removeUser"&gt;ç¡®å®š&lt;/</span>button&gt;</span><br><span class="line">        &lt;button @click=<span class="string">"isModalOpen = false"</span>&gt;å–æ¶ˆ&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/Teleport&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; defineComponent, reactive, ref, toRefs &#125; from 'vue'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default defineComponent(&#123;</span></span><br><span class="line"><span class="regexp">  setup() &#123;</span></span><br><span class="line"><span class="regexp">    const isModalOpen = ref(false)</span></span><br><span class="line"><span class="regexp">    const user = reactive(&#123;</span></span><br><span class="line"><span class="regexp">      name: 'jacky',</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const removeUser = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      console.log('removeUser')</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      isModalOpen,</span></span><br><span class="line"><span class="regexp">      removeUser,</span></span><br><span class="line"><span class="regexp">      ...toRefs(user),</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b44366dd9a654ef9b540d89132d43936~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>è¿è¡Œè¿™æ®µä»£ç ä¹‹å‰ï¼Œéœ€è¦å»<code>./public/index.html</code>åŠ ä¸Šä¸ª id ä¸º<code>modal</code>å…ƒç´ ä¾›æŒ‚è½½ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åˆ°ç»„ä»¶é‡Œé¢æ·»åŠ ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"modal"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Teleport æä¾›äº†ä¸€ç§å¹²å‡€çš„æ–¹æ³•ï¼Œå…è®¸æˆ‘ä»¬æ§åˆ¶åœ¨ DOM ä¸­å“ªä¸ªçˆ¶èŠ‚ç‚¹ä¸‹æ¸²æŸ“äº† HTMLï¼Œè€Œä¸å¿…æ±‚åŠ©äºå…¨å±€çŠ¶æ€æˆ–å°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ªç»„ä»¶ã€‚</p><h3 id="Suspense-ç»„ä»¶"><a href="#Suspense-ç»„ä»¶" class="headerlink" title="Suspense ç»„ä»¶"></a>Suspense ç»„ä»¶</h3><p>Suspense æä¾›ä¸¤ä¸ª template çš„ä½ç½®ï¼Œä¸€ä¸ªæ˜¯æ²¡æœ‰è¯·æ±‚æœªå®Œæˆæˆ–å¤±è´¥æ˜¾ç¤ºçš„å†…å®¹ï¼Œä¸€ä¸ªæ˜¯å…¨éƒ¨è¯·æ±‚å®Œæ¯•çš„å†…å®¹ã€‚è¿™æ ·è¿›è¡Œå¼‚æ­¥å†…å®¹çš„æ¸²æŸ“å°±ä¼šéå¸¸ç®€å•ã€‚</p><p>ä¸‹é¢ Demo æˆ‘å°±æ¨¡æ‹Ÿä¸€ä¸‹ç”¨æ³•ï¼Œä¸å†™çœŸå®è¯·æ±‚äº†ã€‚</p><p>æ–°å»º<code>AsyncShow.vue</code>ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; result &#125;&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">import &#123; defineComponent &#125; from 'vue'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default defineComponent(&#123;</span></span><br><span class="line"><span class="regexp">  name: 'AsyncShow',</span></span><br><span class="line"><span class="regexp">  setup() &#123;</span></span><br><span class="line"><span class="regexp">    return new Promise((resolve) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        return resolve(&#123;</span></span><br><span class="line"><span class="regexp">          result: 'è¿™æ˜¯è¯·æ±‚ç»“æœ',</span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">      &#125;, 3000)</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>æ–°å»º<code>Suspense.vue</code>ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Suspense&gt;</span><br><span class="line">      &lt;template #default&gt;</span><br><span class="line">        &lt;!-- è¯·æ±‚æˆåŠŸå±•ç¤º --&gt;</span><br><span class="line">        &lt;<span class="keyword">async</span>-show /&gt;</span><br><span class="line">      &lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">      &lt;template #fallback&gt;</span></span><br><span class="line"><span class="regexp">        &lt;!-- è¯·æ±‚ä¸­å’Œå¤±è´¥å±•ç¤º --&gt;</span></span><br><span class="line"><span class="regexp">        &lt;h2&gt;Promise Loading...ï¼ˆè¯·æ±‚ä¸­ï¼‰&lt;/</span>h2&gt;</span><br><span class="line">      &lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Suspense&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> AsyncShow <span class="keyword">from</span> <span class="string">'./AsyncShow.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    AsyncShow,</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Vue3-x-ç”Ÿå‘½å‘¨æœŸå˜åŒ–"><a href="#Vue3-x-ç”Ÿå‘½å‘¨æœŸå˜åŒ–" class="headerlink" title="Vue3.x ç”Ÿå‘½å‘¨æœŸå˜åŒ–"></a>Vue3.x ç”Ÿå‘½å‘¨æœŸå˜åŒ–</h2><h3 id="è¢«æ›¿æ¢"><a href="#è¢«æ›¿æ¢" class="headerlink" title="è¢«æ›¿æ¢"></a>è¢«æ›¿æ¢</h3><ul><li>beforeCreate -&gt; setup()</li><li>created -&gt; setup()</li></ul><h3 id="é‡å‘½å"><a href="#é‡å‘½å" class="headerlink" title="é‡å‘½å"></a>é‡å‘½å</h3><p>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å‰é¢éƒ½ç»Ÿä¸€åŠ äº†<code>on</code>ï¼›<code>destroy</code>è¢«æ”¹åæˆ<code>Unmount</code>æ›´è´´åˆ‡ä¹Ÿå¯¹åº”<code>Mount</code></p><ul><li>beforeMount -&gt; onBeforeMount</li><li>mounted -&gt; onMounted</li><li>beforeUpdate -&gt; onBeforeUpdate</li><li>updated -&gt; onUpdated</li><li>beforeDestroy -&gt; onBeforeUnmount</li><li>destroyed -&gt; onUnmounted</li><li>errorCaptured -&gt; onErrorCaptured</li></ul><h3 id="æ–°å¢"><a href="#æ–°å¢" class="headerlink" title="æ–°å¢"></a>æ–°å¢</h3><p>æ–°å¢çš„ä»¥ä¸‹ 2 ä¸ªæ–¹ä¾¿è°ƒè¯• debug çš„å›è°ƒé’©å­ï¼š</p><ul><li>onRenderTrackedï¼šçŠ¶æ€è·Ÿè¸ªï¼Œå®ƒä¼šè·Ÿè¸ªé¡µé¢ä¸Šæ‰€æœ‰å“åº”å¼å˜é‡å’Œæ–¹æ³•çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç”¨ return è¿”å›å»çš„å€¼ï¼Œä»–éƒ½ä¼šè·Ÿè¸ªã€‚åªè¦é¡µé¢æœ‰ update çš„æƒ…å†µï¼Œä»–å°±ä¼šè·Ÿè¸ªï¼Œç„¶åç”Ÿæˆä¸€ä¸ª event å¯¹è±¡ï¼Œæˆ‘ä»¬é€šè¿‡ event å¯¹è±¡æ¥æŸ¥æ‰¾ç¨‹åºçš„é—®é¢˜æ‰€åœ¨ã€‚</li><li>onRenderTriggeredï¼šçŠ¶æ€è§¦å‘ï¼Œå®ƒä¸ä¼šè·Ÿè¸ªæ¯ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯ç»™ä½ å˜åŒ–å€¼çš„ä¿¡æ¯ï¼Œå¹¶ä¸”æ–°å€¼å’Œæ—§å€¼éƒ½ä¼šç»™ä½ æ˜ç¡®çš„å±•ç¤ºå‡ºæ¥ã€‚</li></ul><h3 id="æ–°æ—§ç”Ÿå‘½å‘¨æœŸè°å…ˆè¿è¡Œï¼Ÿ"><a href="#æ–°æ—§ç”Ÿå‘½å‘¨æœŸè°å…ˆè¿è¡Œï¼Ÿ" class="headerlink" title="æ–°æ—§ç”Ÿå‘½å‘¨æœŸè°å…ˆè¿è¡Œï¼Ÿ"></a>æ–°æ—§ç”Ÿå‘½å‘¨æœŸè°å…ˆè¿è¡Œï¼Ÿ</h3><ul><li>åœ¨ Vue2.x ä¸­é€šè¿‡è¡¥ä¸å½¢å¼å¼•å…¥ Composition APIï¼Œè¿›è¡Œ Vue2.x å’Œ Vue3.x çš„å›è°ƒå‡½æ•°æ··ç”¨æ—¶ï¼šVue2.x çš„å›è°ƒå‡½æ•°ä¼šç›¸å¯¹å…ˆæ‰§è¡Œï¼Œæ¯”å¦‚ï¼šmounted ä¼˜å…ˆäº onMountedã€‚</li><li>åœ¨ Vue3.x ä¸­ï¼Œä¸ºäº†å…¼å®¹ Vue2.x çš„è¯­æ³•ï¼Œæ‰€æœ‰æ—§çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¾—åˆ°ä¿ç•™ï¼ˆé™¤äº† beforeDestroy å’Œ destroyedï¼‰ã€‚å½“ç”Ÿå‘½å‘¨æœŸæ··åˆä½¿ç”¨æ—¶ï¼šVue3.x çš„ç”Ÿå‘½å‘¨æœŸç›¸å¯¹ä¼˜å…ˆäº Vue2.x çš„æ‰§è¡Œï¼Œæ¯”å¦‚ï¼šonMounted æ¯” mounted å…ˆæ‰§è¡Œã€‚</li></ul><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æš‚æ—¶å°±å†™è¿™ä¹ˆå¤šäº†ï¼Œå¹¶ä¸å®Œå…¨ï¼Œä½†ä¹Ÿèƒ½å¤§æ¦‚å¯¹ Vue3 æœ‰ä¸ªåˆæ­¥äº†è§£äº†ã€‚</p><p>æœ¬æ–‡æ¡ˆä¾‹ä»£ç ï¼š<a href="https://github.com/Jacky-Summer/vue-tutorial" target="_blank" rel="noopener">vue3-tutorial</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://juejin.cn/post/6844904096265142279" target="_blank" rel="noopener">vue2.x/React/vue3.x ç®€å•æ¨ªè¯„ï¼ˆ4ï¼‰</a></li><li><a href="https://juejin.cn/post/6899702587977646088" target="_blank" rel="noopener">vue3 composition api</a></li><li><a href="https://www.cnblogs.com/houxianzhou/p/14368919.html" target="_blank" rel="noopener">Vue3.0 æ‰€é‡‡ç”¨çš„ Composition Api ä¸ Vue2.x ä½¿ç”¨çš„ Options Api æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</a></li></ul>]]></content>
      <categories>
        <category>Vue ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Vue3</tag>
        <tag>Composition API</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…æ requestIdleCallback</title>
    <url>/2021/02/25/%E6%B5%85%E6%9E%90-requestIdleCallback/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨ç ”ç©¶ React Fiber ç›¸å…³çš„çŸ¥è¯†ï¼Œä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://juejin.cn/post/6926432527980691470" target="_blank" rel="noopener">æµ…è°ˆå¯¹ React Fiber çš„ç†è§£</a> ç®€å•æåˆ°äº† requestIdleCallbackï¼Œ React æºç ä¸­ polyfill äº†è¿™ä¸ªæ–¹æ³•ï¼Œäº†è§£å®ƒå¯¹ Fiber ä¹Ÿèƒ½æœ‰è¿›ä¸€æ­¥ç†è§£ã€‚æœ¬ç¯‡ä¼šæ·±å…¥ä»‹ç»ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p><a id="more"></a><h2 id="requestIdleCallback-æ˜¯ä»€ä¹ˆ"><a href="#requestIdleCallback-æ˜¯ä»€ä¹ˆ" class="headerlink" title="requestIdleCallback æ˜¯ä»€ä¹ˆ"></a>requestIdleCallback æ˜¯ä»€ä¹ˆ</h2><p>requestIdleCallback æ˜¯ window å±æ€§ä¸Šçš„æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨æµè§ˆå™¨ä¸€å¸§çš„å‰©ä½™ç©ºé—²æ—¶é—´å†…æ‰§è¡Œä¼˜å…ˆåº¦ç›¸å¯¹è¾ƒä½çš„ä»»åŠ¡ã€‚</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦-requestIdleCallback"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-requestIdleCallback" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ requestIdleCallback"></a>ä¸ºä»€ä¹ˆéœ€è¦ requestIdleCallback</h2><p>åœ¨ç½‘é¡µè¿è¡Œä¸­ï¼Œæœ‰å¾ˆå¤šè€—æ—¶ä½†åˆä¸æ˜¯é‚£ä¹ˆé‡è¦çš„ä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡å’Œé‡è¦çš„ä»»åŠ¡å¦‚å¯¹ç”¨æˆ·çš„è¾“å…¥ä½œå‡ºåŠæ—¶å“åº”çš„ä¹‹ç±»çš„ä»»åŠ¡ï¼Œå®ƒä»¬å…±äº«äº‹ä»¶é˜Ÿåˆ—ã€‚å¦‚æœä¸¤è€…å‘ç”Ÿå†²çªï¼Œç”¨æˆ·ä½“éªŒä¼šå¾ˆç³Ÿç³•ã€‚</p><p>requestIdleCallback å°±è§£å†³äº†è¿™ä¸ªç—›ç‚¹ï¼ŒrequestIdleCallback ä¼šåœ¨æ¯ä¸€å¸§ç»“æŸæ—¶å¹¶ä¸”æœ‰ç©ºé—²æ—¶é—´æ‰§è¡Œå›è°ƒã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ea116d4702c45edaf176599952cb0af~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>å‡è®¾éœ€è¦å¤§é‡æ¶‰åŠåˆ° DOM çš„æ“ä½œçš„è®¡ç®—ï¼Œåœ¨è¿ç®—æ—¶ï¼Œæµè§ˆå™¨å¯èƒ½å°±ä¼šå‡ºç°æ˜æ˜¾çš„å¡é¡¿è¡Œä¸ºï¼Œç”šè‡³ä¸èƒ½è¿›è¡Œä»»ä½•æ“ä½œï¼Œå› ä¸ºæ˜¯ JS å•çº¿ç¨‹ï¼Œå°±ç®—ç”¨åœ¨è¾“å…¥å¤„ç†ï¼Œç»™å®šå¸§æ¸²æŸ“å’Œåˆæˆä¹‹åï¼Œç”¨æˆ·çš„ä¸»çº¿ç¨‹å°±ä¼šå˜å¾—ç©ºé—²ï¼Œç›´åˆ°ä¸‹ä¸€å¸§çš„å¼€å§‹ã€‚</p><p>è€Œè¿™äº›ç©ºé—²æ—¶é—´å¯ä»¥æ‹¿æ¥å¤„ç†ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ŒReact16 çš„è°ƒåº¦ç­–ç•¥å¼‚æ­¥å¯ä¸­æ–­ï¼Œå…¶ä¸­å…³é”®å°±é çš„è¿™ä¸ªï¼ˆpolyfillï¼‰æ–¹æ³•åŠŸèƒ½ï¼›React æŠŠä»»åŠ¡ç»†åˆ†ï¼ˆæ—¶é—´åˆ‡ç‰‡ï¼‰ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²çš„æ—¶é—´å»æ‰§è¡Œï¼Œä»è€Œå°½å¯èƒ½åœ°æé«˜æ¸²æŸ“æ€§èƒ½ã€‚</p><p>æ—¶é—´åˆ‡ç‰‡çš„æœ¬è´¨æ˜¯æ¨¡æ‹Ÿå®ç° requestIdleCallback</p><p>è®²åˆ°è¿™é‡Œï¼Œä» React15 åˆ° React16 Fiberï¼Œå¯¹æ•´ä½“æ€§èƒ½æ¥è¯´æ˜¯å¤§ä¼˜åŒ–äº†ï¼›ä½†è¦çŸ¥é“çš„æ˜¯ï¼ŒReact16 ç›¸å¯¹ 15 åšå‡ºçš„ä¼˜åŒ–ï¼Œå¹¶ä¸æ˜¯å¤§å¤§å‡å°‘äº†ä»»åŠ¡é‡ï¼Œä½ å†™çš„ä»£ç çš„ä»»åŠ¡æ€»é‡å¹¶æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯æŠŠç©ºé—²æ—¶é—´åˆ©ç”¨èµ·æ¥äº†ï¼Œä¸åœçš„å¹²æ´»ï¼Œå°±èƒ½æ›´å¿«çš„æŠŠæ´»å¹²å®Œï¼›è¿™åªæ˜¯å…¶ä¸­ä¸€ä¸ªè§’åº¦ï¼ŒReact è¿˜åšäº†åŒºåˆ†ä¼˜å…ˆçº§æ‰§è¡Œç­‰ç­‰ã€‚</p><h2 id="å±å¹•åˆ·æ–°ç‡å’Œ-FPS-çš„å…³ç³»"><a href="#å±å¹•åˆ·æ–°ç‡å’Œ-FPS-çš„å…³ç³»" class="headerlink" title="å±å¹•åˆ·æ–°ç‡å’Œ FPS çš„å…³ç³»"></a>å±å¹•åˆ·æ–°ç‡å’Œ FPS çš„å…³ç³»</h2><p>å½“å‰å¤§å¤šæ•°çš„å±å¹•åˆ·æ–°ç‡éƒ½æ˜¯ 60HZï¼Œä¸€ç§’ 60 å¸§ï¼ˆFPS ä¸º 60ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’å±å¹•åˆ·æ–° 60 æ¬¡ï¼Œæ­¤æ—¶ä¸€å¸§çš„æ—¶é—´ä¸º 16.7msï¼ˆ1000ms/60ï¼‰ä½äº 60HZ äººçœ¼å°±ä¼šæ„ŸçŸ¥å¡é¡¿æ‰å¸§ç­‰æƒ…å†µã€‚</p><blockquote><p>æµè§ˆå™¨çš„ä¸€å¸§è¯´çš„å°±æ˜¯ä¸€æ¬¡å®Œæ•´çš„é‡ç»˜ã€‚</p></blockquote><p>å‰ç«¯æµè§ˆå™¨æ‰€è¯´çš„æ¸²æŸ“é¢‘ç‡ FPS(Frames Per Second)æ˜¯æ¯ç§’ä¼ è¾“å¸§æ•°ï¼Œå³æ˜¯æ¯ç§’åˆ·æ–°çš„æ¬¡æ•°ï¼Œç†è®ºä¸Š FPS è¶Šé«˜äººçœ¼è§‰å¾—ç•Œé¢è¶Šæµç•…ã€‚</p><h2 id="window-requestIdleCallback-ç”¨æ³•"><a href="#window-requestIdleCallback-ç”¨æ³•" class="headerlink" title="window.requestIdleCallback() ç”¨æ³•"></a>window.requestIdleCallback() ç”¨æ³•</h2><p>window.requestIdleCallback()æ–¹æ³•å°†åœ¨æµè§ˆå™¨çš„ç©ºé—²æ—¶æ®µå†…è°ƒç”¨çš„å‡½æ•°æ’é˜Ÿã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚å‡½æ•°ä¸€èˆ¬ä¼šæŒ‰å…ˆè¿›å…ˆè°ƒç”¨çš„é¡ºåºæ‰§è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœå›è°ƒå‡½æ•°æŒ‡å®šäº†æ‰§è¡Œè¶…æ—¶æ—¶é—´ timeoutï¼Œåˆ™æœ‰å¯èƒ½ä¸ºäº†åœ¨è¶…æ—¶å‰æ‰§è¡Œå‡½æ•°è€Œæ‰“ä¹±æ‰§è¡Œé¡ºåºã€‚</p><p>ä½ å¯ä»¥åœ¨ç©ºé—²å›è°ƒå‡½æ•°ä¸­è°ƒç”¨ requestIdleCallback()ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡é€šè¿‡äº‹ä»¶å¾ªç¯ä¹‹å‰è°ƒåº¦å¦ä¸€ä¸ªå›è°ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> handle = <span class="built_in">window</span>.requestIdleCallback(callback[, options])</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸€ä¸ª ID æ ‡è¯†ç¬¦ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">callbackï¼š</span><br><span class="line">ä¸€ä¸ªåœ¨äº‹ä»¶å¾ªç¯ç©ºé—²æ—¶å³å°†è¢«è°ƒç”¨çš„å‡½æ•°çš„å¼•ç”¨ã€‚å‡½æ•°ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªåä¸º deadline çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è·å–å½“å‰ç©ºé—²æ—¶é—´ä»¥åŠå›è°ƒæ˜¯å¦åœ¨è¶…æ—¶æ—¶é—´å‰å·²ç»æ‰§è¡Œçš„çŠ¶æ€ï¼›è¯¥å¯¹è±¡ä¸Šæœ‰ä¸¤ä¸ªå±æ€§ï¼š</span><br><span class="line">  - timeRemainingï¼štimeRemainingå±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼è¡¨ç¤ºè¿”å›å½“å‰ç©ºé—²æ—¶é—´çš„å‰©ä½™æ—¶é—´</span><br><span class="line">  - didTimeoutï¼šdidTimeoutå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœdidTimeoutæ˜¯trueï¼Œé‚£ä¹ˆè¡¨ç¤ºæœ¬æ¬¡callbackçš„æ‰§è¡Œæ˜¯å› ä¸ºè¶…æ—¶çš„åŸå› </span><br><span class="line"></span><br><span class="line">options å¯é€‰</span><br><span class="line">åŒ…æ‹¬å¯é€‰çš„é…ç½®å‚æ•°ã€‚å…·æœ‰å¦‚ä¸‹å±æ€§ï¼š</span><br><span class="line">timeoutï¼šå¦‚æœæŒ‡å®šäº†timeoutå¹¶å…·æœ‰ä¸€ä¸ªæ­£å€¼ï¼Œå¹¶ä¸”å°šæœªé€šè¿‡è¶…æ—¶æ¯«ç§’æ•°è°ƒç”¨å›è°ƒï¼Œé‚£ä¹ˆå›è°ƒä¼šåœ¨ä¸‹ä¸€æ¬¡ç©ºé—²æ—¶æœŸè¢«å¼ºåˆ¶æ‰§è¡Œï¼Œå°½ç®¡è¿™æ ·å¾ˆå¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆè´Ÿé¢å½±å“ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myNonEssentialWork</span>(<span class="params">deadline</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ((deadline.timeRemaining() &gt; <span class="number">0</span> || deadline.didTimeout) &amp;&amp; tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    doWorkIfNeeded()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    requestIdleCallback(myNonEssentialWork)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestIdleCallback(myNonEssentialWork, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">requestIdleCallback(myWork)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">let</span> tasks = [</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">t1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œä»»åŠ¡1'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">t2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œä»»åŠ¡2'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">t3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œä»»åŠ¡3'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// deadlineæ˜¯requestIdleCallbackè¿”å›çš„ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myWork</span>(<span class="params">deadline</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`å½“å‰å¸§å‰©ä½™æ—¶é—´: <span class="subst">$&#123;deadline.timeRemaining()&#125;</span>`</span>)</span><br><span class="line">  <span class="comment">// æŸ¥çœ‹å½“å‰å¸§çš„å‰©ä½™æ—¶é—´æ˜¯å¦å¤§äº0 &amp;&amp; æ˜¯å¦è¿˜æœ‰å‰©ä½™ä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">if</span> (deadline.timeRemaining() &gt; <span class="number">0</span> &amp;&amp; tasks.length) &#123;</span><br><span class="line">    <span class="comment">// åœ¨è¿™é‡Œåšä¸€äº›äº‹æƒ…</span></span><br><span class="line">    <span class="keyword">const</span> task = tasks.shift()</span><br><span class="line">    task()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœè¿˜æœ‰ä»»åŠ¡æ²¡æœ‰è¢«æ‰§è¡Œï¼Œé‚£å°±æ”¾åˆ°ä¸‹ä¸€å¸§è°ƒåº¦ä¸­å»ç»§ç»­æ‰§è¡Œï¼Œç±»ä¼¼é€’å½’</span></span><br><span class="line">  <span class="keyword">if</span> (tasks.length) &#123;</span><br><span class="line">    requestIdleCallback(myWork)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼ˆæ¯æ¬¡è¿è¡Œï¼Œä¸åŒæœºå™¨è¿è¡Œéƒ½ä¸ä¸€æ ·ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å½“å‰å¸§å‰©ä½™æ—¶é—´: 15.120000000000001</span><br><span class="line">æ‰§è¡Œä»»åŠ¡1</span><br><span class="line">å½“å‰å¸§å‰©ä½™æ—¶é—´: 15.445000000000002</span><br><span class="line">æ‰§è¡Œä»»åŠ¡2</span><br><span class="line">å½“å‰å¸§å‰©ä½™æ—¶é—´: 15.21</span><br><span class="line">æ‰§è¡Œä»»åŠ¡3</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å› ä¸º timeout å›è°ƒæ‰å¾—ä»¥æ‰§è¡Œçš„è¯ï¼Œå…¶å®ç”¨æˆ·å°±æœ‰å¯èƒ½ä¼šæ„Ÿè§‰åˆ°å¡é¡¿äº†ï¼Œå› ä¸ºä¸€å¸§çš„æ‰§è¡Œæ—¶é—´å¿…ç„¶å·²ç»è¶…è¿‡ 16ms äº†</p><h2 id="requestIdleCallback-æ–¹æ³•çš„ç¼ºé™·"><a href="#requestIdleCallback-æ–¹æ³•çš„ç¼ºé™·" class="headerlink" title="requestIdleCallback æ–¹æ³•çš„ç¼ºé™·"></a>requestIdleCallback æ–¹æ³•çš„ç¼ºé™·</h2><p>è¿™ä¸ªæ–¹æ³•ç†è®ºä¸Šå¯è¡Œï¼Œä½†ä¸ºä»€ä¹ˆ React å›¢é˜Ÿåˆ polyfill è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿ</p><ol><li><p>æµè§ˆå™¨å…¼å®¹ä¸å¥½çš„é—®é¢˜</p></li><li><p>requestIdleCallback çš„ FPS åªæœ‰ 20ï¼Œä¹Ÿå°±æ˜¯ 50ms åˆ·æ–°ä¸€æ¬¡ï¼Œè¿œè¿œä½äºé¡µé¢æµç•…åº¦çš„è¦æ±‚ï¼Œæ‰€ä»¥ React å›¢é˜Ÿéœ€è¦è‡ªå·±å®ç°ã€‚</p></li></ol><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc589c5d1b0f4c30997ed0fda92f68fe~tplv-k3u1fbpfcp-watermark.image" alt=""></p><blockquote><p>æ³¨æ„ï¼štimeRemaining æœ€å¤§ä¸º 50msï¼Œæ˜¯æœ‰æ ¹æ®ç ”ç©¶å¾—å‡ºçš„ï¼Œå³æ˜¯è¯´äººå¯¹ç”¨æˆ·è¾“å…¥çš„ 100 æ¯«ç§’ä»¥å†…çš„å“åº”é€šå¸¸è¢«è®¤ä¸ºæ˜¯ç¬æ—¶çš„ï¼Œä¸ä¼šè¢«äººå¯Ÿè§‰åˆ°ã€‚å°†ç©ºé—²æ—¶é—´é™åˆ¶åœ¨ 50ms å†…æ„å‘³ç€å³ä½¿åœ¨é—²ç½®ä»»åŠ¡å¼€å§‹åç«‹å³å‘ç”Ÿç”¨æˆ·æ“ä½œï¼Œç”¨æˆ·ä»£ç†ä»ç„¶æœ‰å‰©ä½™çš„ 50ms å¯ä»¥åœ¨å…¶ä¸­å“åº”ç”¨æˆ·è¾“å…¥è€Œä¸ä¼šäº§ç”Ÿç”¨æˆ·å¯å¯Ÿè§‰çš„æ»åã€‚</p></blockquote><h2 id="requestIdleCallback-å’Œ-requestAnimationFrame-åŒºåˆ«"><a href="#requestIdleCallback-å’Œ-requestAnimationFrame-åŒºåˆ«" class="headerlink" title="requestIdleCallback å’Œ requestAnimationFrame åŒºåˆ«"></a>requestIdleCallback å’Œ requestAnimationFrame åŒºåˆ«</h2><ul><li>requestAnimationFrame çš„å›è°ƒä¼šåœ¨æ¯ä¸€å¸§ç¡®å®šæ‰§è¡Œï¼Œå±äºé«˜ä¼˜å…ˆçº§ä»»åŠ¡</li><li>requestIdleCallback çš„å›è°ƒåˆ™ä¸ä¸€å®šï¼Œæœ‰ç©ºé—²æ—¶é—´æ‰æ‰§è¡Œï¼Œå±äºä½ä¼˜å…ˆçº§ä»»åŠ¡ã€‚</li></ul><blockquote><p>window.requestAnimationFrame() å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œ</p></blockquote><p>requestAnimationFrame æ¯”èµ· setTimeoutã€setInterval çš„ä¼˜åŠ¿ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p><ul><li><p>requestAnimationFrame ä¼šæŠŠæ¯ä¸€å¸§ä¸­çš„æ‰€æœ‰ DOM æ“ä½œé›†ä¸­èµ·æ¥ï¼Œåœ¨ä¸€æ¬¡é‡ç»˜æˆ–å›æµä¸­å°±å®Œæˆï¼Œå¹¶ä¸”é‡ç»˜æˆ–å›æµçš„æ—¶é—´é—´éš”ç´§ç´§è·Ÿéšæµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªé¢‘ç‡ä¸ºæ¯ç§’ 60 å¸§ã€‚</p></li><li><p>åœ¨éšè—æˆ–ä¸å¯è§çš„å…ƒç´ ä¸­ï¼ŒrequestAnimationFrame å°†ä¸ä¼šè¿›è¡Œé‡ç»˜æˆ–å›æµï¼Œè¿™å½“ç„¶å°±æ„å‘³ç€æ›´å°‘çš„çš„ cpuï¼Œgpu å’Œå†…å­˜ä½¿ç”¨é‡ã€‚</p></li></ul><h2 id="æ¨¡æ‹Ÿå®ç°-requestIdleCallback"><a href="#æ¨¡æ‹Ÿå®ç°-requestIdleCallback" class="headerlink" title="æ¨¡æ‹Ÿå®ç° requestIdleCallback"></a>æ¨¡æ‹Ÿå®ç° requestIdleCallback</h2><h3 id="setTimeout-æ¨¡æ‹Ÿ"><a href="#setTimeout-æ¨¡æ‹Ÿ" class="headerlink" title="setTimeout æ¨¡æ‹Ÿ"></a>setTimeout æ¨¡æ‹Ÿ</h3><p>å½“ç„¶ä¸€èˆ¬ä¸ä¼šç”¨ setTimeout çš„ï¼Œå› ä¸ºè¯¯å·®å¾ˆå¤§</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.requestIdleCallback = <span class="function"><span class="keyword">function</span> (<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> startTime = <span class="built_in">Date</span>.now()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    handler(&#123;</span><br><span class="line">      didTimeout: <span class="literal">false</span>,</span><br><span class="line">      timeRemaining: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.max(<span class="number">0</span>, <span class="number">50.0</span> - (<span class="built_in">Date</span>.now() - startTime))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React å›¢é˜Ÿåˆ™æ˜¯ç”¨ requestAnimationFrame å’Œ postMessage æ¨¡æ‹Ÿå®ç°çš„ï¼Œæœ¬ç¯‡å°±ä¸è®²äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£çœ‹çœ‹ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://juejin.cn/post/6844904196345430023" target="_blank" rel="noopener">ç†Ÿæ‚‰ requestidlecallback åˆ°äº†è§£ react ric polyfill å®ç°</a></li><li><a href="https://juejin.cn/post/6861590253434585096" target="_blank" rel="noopener">react ä¸­ requestIdleCallback çš„å®ç°åŸç†</a></li></ul><br><p>æˆ‘è¿‘æœŸä¼šç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼š</p><ul><li><a href="https://github.com/Jacky-Summer/monki-ui" target="_blank" rel="noopener">åŸºäº React + TypeScript + Dumi + Jest + Enzyme å¼€å‘ UI ç»„ä»¶åº“</a></li><li><a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter" target="_blank" rel="noopener">Next.js ä¼ä¸šçº§é¡¹ç›®è„šæ‰‹æ¶æ¨¡æ¿</a></li><li><a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a><br>è§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>requestIdleCallback</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆå¯¹ React Fiber çš„ç†è§£</title>
    <url>/2021/02/07/%E6%B5%85%E8%B0%88%E5%AF%B9-React-Fiber-%E7%9A%84%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä½œä¸ºè‡ªå·±æ·±å…¥å­¦ä¹  React Fiber (<code>Reactv16.8.6</code>)çš„ç†è§£ï¼Œæœ¬ç¯‡ä»…ä»‹ç»å¤§è‡´æµç¨‹ï¼ŒFiber è¯¦ç»†æºç æœ¬æ–‡ä¸ä½œç»†èŠ‚æè¿°ã€‚</p><p>æœ¬æ–‡åŒæ­¥å‘å¸ƒåœ¨æˆ‘çš„ <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">Github ä¸ªäººåšå®¢</a></p><a id="more"></a><h2 id="Fiber-å‡ºç°çš„èƒŒæ™¯"><a href="#Fiber-å‡ºç°çš„èƒŒæ™¯" class="headerlink" title="Fiber å‡ºç°çš„èƒŒæ™¯"></a>Fiber å‡ºç°çš„èƒŒæ™¯</h2><p>é¦–å…ˆè¦çŸ¥é“çš„æ˜¯ï¼ŒJavaScript å¼•æ“å’Œé¡µé¢æ¸²æŸ“å¼•æ“ä¸¤ä¸ªçº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åªèƒ½æŒ‚èµ·ç­‰å¾…ã€‚</p><p>åœ¨è¿™æ ·çš„æœºåˆ¶ä¸‹ï¼Œå¦‚æœ JavaScript çº¿ç¨‹é•¿æ—¶é—´åœ°å ç”¨äº†ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆæ¸²æŸ“å±‚é¢çš„æ›´æ–°å°±ä¸å¾—ä¸é•¿æ—¶é—´åœ°ç­‰å¾…ï¼Œç•Œé¢é•¿æ—¶é—´ä¸æ›´æ–°ï¼Œä¼šå¯¼è‡´é¡µé¢å“åº”åº¦å˜å·®ï¼Œç”¨æˆ·å¯èƒ½ä¼šæ„Ÿè§‰åˆ°å¡é¡¿ã€‚</p><p>è€Œè¿™æ­£æ˜¯ React 15 çš„ Stack Reconciler æ‰€é¢ä¸´çš„é—®é¢˜ï¼Œå³æ˜¯ JavaScript å¯¹ä¸»çº¿ç¨‹çš„è¶…æ—¶å ç”¨é—®é¢˜ã€‚Stack Reconciler æ˜¯ä¸€ä¸ªåŒæ­¥çš„é€’å½’è¿‡ç¨‹ï¼Œä½¿ç”¨çš„æ˜¯ JavaScript å¼•æ“è‡ªèº«çš„å‡½æ•°è°ƒç”¨æ ˆï¼Œå®ƒä¼šä¸€ç›´æ‰§è¡Œåˆ°æ ˆç©ºä¸ºæ­¢ï¼Œæ‰€ä»¥å½“ React åœ¨æ¸²æŸ“ç»„ä»¶æ—¶ï¼Œä»å¼€å§‹åˆ°æ¸²æŸ“å®Œæˆæ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸€æ°”å‘µæˆçš„ã€‚å¦‚æœæ¸²æŸ“çš„ç»„ä»¶æ¯”è¾ƒåºå¤§ï¼Œjs æ‰§è¡Œä¼šå æ®ä¸»çº¿ç¨‹è¾ƒé•¿æ—¶é—´ï¼Œä¼šå¯¼è‡´é¡µé¢å“åº”åº¦å˜å·®ã€‚</p><p>è€Œä¸”æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯æŒ‰ç…§å…ˆåé¡ºåºï¼Œæ²¡æœ‰åŒºåˆ†ä¼˜å…ˆçº§ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„ä»»åŠ¡æ— æ³•è¢«ä¼˜å…ˆæ‰§è¡Œã€‚</p><h2 id="Fiber-æ˜¯ä»€ä¹ˆ"><a href="#Fiber-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Fiber æ˜¯ä»€ä¹ˆ"></a>Fiber æ˜¯ä»€ä¹ˆ</h2><p>Fiber çš„ä¸­æ–‡ç¿»è¯‘å«çº¤ç¨‹ï¼Œä¸è¿›ç¨‹ã€çº¿ç¨‹åŒä¸ºç¨‹åºæ‰§è¡Œè¿‡ç¨‹ï¼ŒFiber å°±æ˜¯æ¯”çº¿ç¨‹è¿˜è¦çº¤ç»†çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚çº¤ç¨‹æ„åœ¨å¯¹æ¸²æŸ“è¿‡ç¨‹å®ç°è¿›è¡Œæ›´åŠ ç²¾ç»†çš„æ§åˆ¶ã€‚</p><p>ä»æ¶æ„è§’åº¦æ¥çœ‹ï¼ŒFiber æ˜¯å¯¹ React æ ¸å¿ƒç®—æ³•ï¼ˆå³è°ƒå’Œè¿‡ç¨‹ï¼‰çš„é‡å†™ã€‚</p><p>ä»ç¼–ç è§’åº¦æ¥çœ‹ï¼ŒFiber æ˜¯ React å†…éƒ¨æ‰€å®šä¹‰çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ Fiber æ ‘ç»“æ„çš„èŠ‚ç‚¹å•ä½ï¼Œä¹Ÿå°±æ˜¯ React 16 æ–°æ¶æ„ä¸‹çš„â€è™šæ‹Ÿ DOMâ€ã€‚</p><p>ä¸€ä¸ª fiber å°±æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼ŒFiber çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">type Fiber = &#123;</span><br><span class="line">  <span class="comment">// ç”¨äºæ ‡è®°fiberçš„WorkTagç±»å‹ï¼Œä¸»è¦è¡¨ç¤ºå½“å‰fiberä»£è¡¨çš„ç»„ä»¶ç±»å‹å¦‚FunctionComponentã€ClassComponentç­‰</span></span><br><span class="line">  tag: WorkTag,</span><br><span class="line">  <span class="comment">// ReactElementé‡Œé¢çš„key</span></span><br><span class="line">  key: <span class="literal">null</span> | string,</span><br><span class="line">  <span class="comment">// ReactElement.typeï¼Œè°ƒç”¨`createElement`çš„ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">  elementType: any,</span><br><span class="line">  <span class="comment">// The resolved function/class/ associated with this fiber.</span></span><br><span class="line">  <span class="comment">// è¡¨ç¤ºå½“å‰ä»£è¡¨çš„èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line">  type: any,</span><br><span class="line">  <span class="comment">// è¡¨ç¤ºå½“å‰FiberNodeå¯¹åº”çš„elementç»„ä»¶å®ä¾‹</span></span><br><span class="line">  stateNode: any,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŒ‡å‘ä»–åœ¨FiberèŠ‚ç‚¹æ ‘ä¸­çš„`parent`ï¼Œç”¨æ¥åœ¨å¤„ç†å®Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åå‘ä¸Šè¿”å›</span></span><br><span class="line">  <span class="keyword">return</span>: Fiber | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// æŒ‡å‘è‡ªå·±çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">  child: Fiber | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// æŒ‡å‘è‡ªå·±çš„å…„å¼Ÿç»“æ„ï¼Œå…„å¼ŸèŠ‚ç‚¹çš„returnæŒ‡å‘åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  sibling: Fiber | <span class="literal">null</span>,</span><br><span class="line">  index: number,</span><br><span class="line"></span><br><span class="line">  ref: <span class="literal">null</span> | <span class="function">(<span class="params">((handle: mixed</span>) =&gt;</span> <span class="keyword">void</span>) &amp; &#123; <span class="attr">_stringRef</span>: ?string &#125;) | RefObject,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“å‰å¤„ç†è¿‡ç¨‹ä¸­çš„ç»„ä»¶propså¯¹è±¡</span></span><br><span class="line">  pendingProps: any,</span><br><span class="line">  <span class="comment">// ä¸Šä¸€æ¬¡æ¸²æŸ“å®Œæˆä¹‹åçš„props</span></span><br><span class="line">  memoizedProps: any,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯¥Fiberå¯¹åº”çš„ç»„ä»¶äº§ç”Ÿçš„Updateä¼šå­˜æ”¾åœ¨è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢</span></span><br><span class="line">  updateQueue: UpdateQueue&lt;any&gt; | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸Šä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™çš„state</span></span><br><span class="line">  memoizedState: any,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜æ”¾è¿™ä¸ªFiberä¾èµ–çš„context</span></span><br><span class="line">  firstContextDependency: ContextDependency&lt;mixed&gt; | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  mode: TypeOfMode,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Effect</span></span><br><span class="line">  <span class="comment">// ç”¨æ¥è®°å½•Side Effect</span></span><br><span class="line">  effectTag: SideEffectTag,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å•é“¾è¡¨ç”¨æ¥å¿«é€ŸæŸ¥æ‰¾ä¸‹ä¸€ä¸ªside effect</span></span><br><span class="line">  nextEffect: Fiber | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å­æ ‘ä¸­ç¬¬ä¸€ä¸ªside effect</span></span><br><span class="line">  firstEffect: Fiber | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// å­æ ‘ä¸­æœ€åä¸€ä¸ªside effect</span></span><br><span class="line">  lastEffect: Fiber | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»£è¡¨ä»»åŠ¡åœ¨æœªæ¥çš„å“ªä¸ªæ—¶é—´ç‚¹åº”è¯¥è¢«å®Œæˆï¼Œä¹‹åç‰ˆæœ¬æ”¹åä¸º lanes</span></span><br><span class="line">  expirationTime: ExpirationTime,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¿«é€Ÿç¡®å®šå­æ ‘ä¸­æ˜¯å¦æœ‰ä¸åœ¨ç­‰å¾…çš„å˜åŒ–</span></span><br><span class="line">  childExpirationTime: ExpirationTime,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// fiberçš„ç‰ˆæœ¬æ± ï¼Œå³è®°å½•fiberæ›´æ–°è¿‡ç¨‹ï¼Œä¾¿äºæ¢å¤</span></span><br><span class="line">  alternate: Fiber | <span class="literal">null</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ 2020 å¹´ 5 æœˆï¼Œä»¥ expirationTime å±æ€§ä¸ºä»£è¡¨çš„ä¼˜å…ˆçº§æ¨¡å‹è¢« lanes å–ä»£ã€‚</p></blockquote><h2 id="Fiber-å¦‚ä½•è§£å†³é—®é¢˜çš„"><a href="#Fiber-å¦‚ä½•è§£å†³é—®é¢˜çš„" class="headerlink" title="Fiber å¦‚ä½•è§£å†³é—®é¢˜çš„"></a>Fiber å¦‚ä½•è§£å†³é—®é¢˜çš„</h2><p>Fiber æŠŠä¸€ä¸ªæ¸²æŸ“ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªæ¸²æŸ“ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆï¼ŒæŠŠæ¯ä¸€ä¸ªåˆ†å‰²å¾—å¾ˆç»†çš„ä»»åŠ¡è§†ä½œä¸€ä¸ªâ€æ‰§è¡Œå•å…ƒâ€ï¼ŒReact å°±ä¼šæ£€æŸ¥ç°åœ¨è¿˜å‰©å¤šå°‘æ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´å°±å°†æ§åˆ¶æƒè®©å‡ºå»ï¼Œæ•…ä»»åŠ¡ä¼šè¢«åˆ†æ•£åˆ°å¤šä¸ªå¸§é‡Œé¢ï¼Œä¸­é—´å¯ä»¥è¿”å›è‡³ä¸»è¿›ç¨‹æ§åˆ¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œæœ€ç»ˆå®ç°æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚</p><p>å³æ˜¯å®ç°äº†â€å¢é‡æ¸²æŸ“â€ï¼Œå®ç°äº†å¯ä¸­æ–­ä¸æ¢å¤ï¼Œæ¢å¤åä¹Ÿå¯ä»¥å¤ç”¨ä¹‹å‰çš„ä¸­é—´çŠ¶æ€ï¼Œå¹¶ç»™ä¸åŒçš„ä»»åŠ¡èµ‹äºˆä¸åŒçš„ä¼˜å…ˆçº§ï¼Œå…¶ä¸­æ¯ä¸ªä»»åŠ¡æ›´æ–°å•å…ƒä¸º React Element å¯¹åº”çš„ Fiber èŠ‚ç‚¹ã€‚</p><h2 id="Fiber-å®ç°åŸç†"><a href="#Fiber-å®ç°åŸç†" class="headerlink" title="Fiber å®ç°åŸç†"></a>Fiber å®ç°åŸç†</h2><p>å®ç°çš„æ–¹å¼æ˜¯<code>requestIdleCallback</code>è¿™ä¸€ APIï¼Œä½† React å›¢é˜Ÿ polyfill äº†è¿™ä¸ª APIï¼Œä½¿å…¶å¯¹æ¯”åŸç”Ÿçš„æµè§ˆå™¨å…¼å®¹æ€§æ›´å¥½ä¸”æ‹“å±•äº†ç‰¹æ€§ã€‚</p><blockquote><p><code>window.requestIdleCallback()</code>æ–¹æ³•å°†åœ¨æµè§ˆå™¨çš„ç©ºé—²æ—¶æ®µå†…è°ƒç”¨çš„å‡½æ•°æ’é˜Ÿã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚å‡½æ•°ä¸€èˆ¬ä¼šæŒ‰å…ˆè¿›å…ˆè°ƒç”¨çš„é¡ºåºæ‰§è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœå›è°ƒå‡½æ•°æŒ‡å®šäº†æ‰§è¡Œè¶…æ—¶æ—¶é—´ timeoutï¼Œåˆ™æœ‰å¯èƒ½ä¸ºäº†åœ¨è¶…æ—¶å‰æ‰§è¡Œå‡½æ•°è€Œæ‰“ä¹±æ‰§è¡Œé¡ºåºã€‚</p></blockquote><p><code>requestIdleCallback</code>å›è°ƒçš„æ‰§è¡Œçš„å‰ææ¡ä»¶æ˜¯å½“å‰æµè§ˆå™¨å¤„äºç©ºé—²çŠ¶æ€ã€‚</p><p>å³<code>requestIdleCallback</code>çš„ä½œç”¨æ˜¯åœ¨æµè§ˆå™¨ä¸€å¸§çš„å‰©ä½™ç©ºé—²æ—¶é—´å†…æ‰§è¡Œä¼˜å…ˆåº¦ç›¸å¯¹è¾ƒä½çš„ä»»åŠ¡ã€‚é¦–å…ˆ React ä¸­ä»»åŠ¡åˆ‡å‰²ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œåˆ†æ‰¹å®Œæˆã€‚åœ¨å®Œæˆä¸€éƒ¨åˆ†ä»»åŠ¡ä¹‹åï¼Œå°†æ§åˆ¶æƒäº¤å›ç»™æµè§ˆå™¨ï¼Œè®©æµè§ˆå™¨æœ‰æ—¶é—´å†è¿›è¡Œé¡µé¢çš„æ¸²æŸ“ã€‚ç­‰æµè§ˆå™¨å¿™å®Œä¹‹åæœ‰å‰©ä½™æ—¶é—´ï¼Œå†ç»§ç»­ä¹‹å‰ React æœªå®Œæˆçš„ä»»åŠ¡ï¼Œæ˜¯ä¸€ç§åˆä½œå¼è°ƒåº¦ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œç”±æµè§ˆå™¨ç»™æˆ‘ä»¬åˆ†é…æ‰§è¡Œæ—¶é—´ç‰‡ï¼Œæˆ‘ä»¬è¦æŒ‰ç…§çº¦å®šåœ¨è¿™ä¸ªæ—¶é—´å†…æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶å°†æ§åˆ¶æƒè¿˜ç»™æµè§ˆå™¨ã€‚</p><p>React 16 çš„<code>Reconciler</code>åŸºäº Fiber èŠ‚ç‚¹å®ç°ï¼Œè¢«ç§°ä¸º Fiber Reconcilerã€‚</p><p>ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„æ¥è¯´ï¼Œæ¯ä¸ª Fiber èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ª React elementï¼Œä¿å­˜äº†è¯¥ç»„ä»¶çš„ç±»å‹ï¼ˆå‡½æ•°ç»„ä»¶/ç±»ç»„ä»¶/åŸç”Ÿç»„ä»¶ç­‰ç­‰ï¼‰ã€å¯¹åº”çš„ DOM èŠ‚ç‚¹ç­‰ä¿¡æ¯ã€‚</p><p>ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒæ¥è¯´ï¼Œæ¯ä¸ª Fiber èŠ‚ç‚¹ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ä¸­è¯¥ç»„ä»¶æ”¹å˜çš„çŠ¶æ€ã€è¦æ‰§è¡Œçš„å·¥ä½œã€‚</p><p>æ¯ä¸ª Fiber èŠ‚ç‚¹æœ‰ä¸ªå¯¹åº”çš„ React elementï¼Œå¤šä¸ª Fiber èŠ‚ç‚¹æ˜¯å¦‚ä½•è¿æ¥å½¢æˆæ ‘å‘¢ï¼Ÿé å¦‚ä¸‹ä¸‰ä¸ªå±æ€§ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å‘çˆ¶çº§FiberèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">this</span>.return = <span class="literal">null</span></span><br><span class="line"><span class="comment">// æŒ‡å‘å­FiberèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">this</span>.child = <span class="literal">null</span></span><br><span class="line"><span class="comment">// æŒ‡å‘å³è¾¹ç¬¬ä¸€ä¸ªå…„å¼ŸFiberèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">this</span>.sibling = <span class="literal">null</span></span><br></pre></td></tr></table></figure><h2 id="Fiber-æ¶æ„æ ¸å¿ƒ"><a href="#Fiber-æ¶æ„æ ¸å¿ƒ" class="headerlink" title="Fiber æ¶æ„æ ¸å¿ƒ"></a>Fiber æ¶æ„æ ¸å¿ƒ</h2><p>Fiber æ¶æ„å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼š</p><ul><li>Scheduler è°ƒåº¦å™¨ â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥ Reconciler</li><li>Reconciler åè°ƒå™¨ â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶</li><li>Renderer æ¸²æŸ“å™¨ â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ul><p>ç›¸æ¯” React15ï¼ŒReact16 å¤šäº†<strong>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</strong>ï¼Œè°ƒåº¦å™¨çš„ä½œç”¨æ˜¯è°ƒåº¦æ›´æ–°çš„ä¼˜å…ˆçº§ã€‚</p><p>åœ¨æ–°çš„æ¶æ„æ¨¡å¼ä¸‹ï¼Œå·¥ä½œæµå¦‚ä¸‹ï¼š</p><ul><li>æ¯ä¸ªæ›´æ–°ä»»åŠ¡éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªä¼˜å…ˆçº§ã€‚</li><li>å½“æ›´æ–°ä»»åŠ¡æŠµè¾¾è°ƒåº¦å™¨æ—¶ï¼Œé«˜ä¼˜å…ˆçº§çš„æ›´æ–°ä»»åŠ¡ï¼ˆè®°ä¸º Aï¼‰ä¼šæ›´å¿«åœ°è¢«è°ƒåº¦è¿› Reconciler å±‚ï¼›</li><li>æ­¤æ—¶è‹¥æœ‰æ–°çš„æ›´æ–°ä»»åŠ¡ï¼ˆè®°ä¸º Bï¼‰æŠµè¾¾è°ƒåº¦å™¨ï¼Œè°ƒåº¦å™¨ä¼šæ£€æŸ¥å®ƒçš„ä¼˜å…ˆçº§ï¼Œè‹¥å‘ç° B çš„ä¼˜å…ˆçº§é«˜äºå½“å‰ä»»åŠ¡ Aï¼Œé‚£ä¹ˆå½“å‰å¤„äº Reconciler å±‚çš„ A ä»»åŠ¡å°±ä¼šè¢«ä¸­æ–­ï¼Œè°ƒåº¦å™¨ä¼šå°† B ä»»åŠ¡æ¨å…¥ Reconciler å±‚ã€‚</li><li>å½“ B ä»»åŠ¡å®Œæˆæ¸²æŸ“åï¼Œæ–°ä¸€è½®çš„è°ƒåº¦å¼€å§‹ï¼Œä¹‹å‰è¢«ä¸­æ–­çš„ A ä»»åŠ¡å°†ä¼šè¢«é‡æ–°æ¨å…¥ Reconciler å±‚ï¼Œç»§ç»­å®ƒçš„æ¸²æŸ“ä¹‹æ—…ï¼Œå³â€œå¯æ¢å¤â€ã€‚</li></ul><p><strong>Fiber æ¶æ„çš„æ ¸å¿ƒå³æ˜¯â€å¯ä¸­æ–­â€ã€â€å¯æ¢å¤â€ã€â€ä¼˜å…ˆçº§â€</strong></p><h3 id="Scheduler-è°ƒåº¦å™¨"><a href="#Scheduler-è°ƒåº¦å™¨" class="headerlink" title="Scheduler è°ƒåº¦å™¨"></a>Scheduler è°ƒåº¦å™¨</h3><p>è¿™ä¸ªéœ€è¦ä¸Šé¢æåˆ°çš„<code>requestIdleCallback</code>ï¼ŒReact å›¢é˜Ÿå®ç°äº†åŠŸèƒ½æ›´å®Œå¤‡çš„ <code>requestIdleCallback</code> polyfillï¼Œè¿™å°±æ˜¯ Schedulerã€‚é™¤äº†åœ¨ç©ºé—²æ—¶è§¦å‘å›è°ƒçš„åŠŸèƒ½å¤–ï¼ŒScheduler è¿˜æä¾›äº†å¤šç§è°ƒåº¦ä¼˜å…ˆçº§ä¾›ä»»åŠ¡è®¾ç½®ã€‚</p><h3 id="Reconciler-åè°ƒå™¨"><a href="#Reconciler-åè°ƒå™¨" class="headerlink" title="Reconciler åè°ƒå™¨"></a>Reconciler åè°ƒå™¨</h3><p>åœ¨ React 15 ä¸­æ˜¯é€’å½’å¤„ç†è™šæ‹Ÿ DOM çš„ï¼ŒReact 16 åˆ™æ˜¯å˜æˆäº†å¯ä»¥ä¸­æ–­çš„å¾ªç¯è¿‡ç¨‹ï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šè°ƒç”¨<code>shouldYield</code>åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoopConcurrent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Perform work until Scheduler asks us to yield</span></span><br><span class="line">  <span class="keyword">while</span> (workInProgress !== <span class="literal">null</span> &amp;&amp; !shouldYield()) &#123;</span><br><span class="line">    <span class="comment">// workInProgressè¡¨ç¤ºå½“å‰å·¥ä½œè¿›åº¦çš„æ ‘ã€‚</span></span><br><span class="line">    workInProgress = performUnitOfWork(workInProgress)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React 16 æ˜¯å¦‚ä½•è§£å†³ä¸­æ–­æ›´æ–°æ—¶ DOM æ¸²æŸ“ä¸å®Œå…¨çš„é—®é¢˜å‘¢ï¼Ÿ</p><p>åœ¨ React 16 ä¸­ï¼Œ<code>Reconciler</code>ä¸<code>Renderer</code>ä¸å†æ˜¯äº¤æ›¿å·¥ä½œã€‚å½“<code>Scheduler</code>å°†ä»»åŠ¡äº¤ç»™<code>Reconciler</code>åï¼Œ<code>Reconciler</code>ä¼šä¸ºå˜åŒ–çš„è™šæ‹Ÿ DOM æ‰“ä¸Šçš„æ ‡è®°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Placement = <span class="comment">/*             */</span> <span class="number">0b0000000000010</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Update = <span class="comment">/*                */</span> <span class="number">0b0000000000100</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PlacementAndUpdate = <span class="comment">/*    */</span> <span class="number">0b0000000000110</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Deletion = <span class="comment">/*              */</span> <span class="number">0b0000000001000</span></span><br></pre></td></tr></table></figure><ul><li><code>Placement</code>è¡¨ç¤ºæ’å…¥æ“ä½œ</li><li><code>PlacementAndUpdate</code>è¡¨ç¤ºæ›¿æ¢æ“ä½œ</li><li><code>Update</code>è¡¨ç¤ºæ›´æ–°æ“ä½œ</li><li><code>Deletion</code>è¡¨ç¤ºåˆ é™¤æ“ä½œ</li></ul><p>æ•´ä¸ª<code>Scheduler</code>ä¸<code>Reconciler</code>çš„å·¥ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œæ‰€ä»¥å³ä½¿åå¤ä¸­æ–­ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹è§æ›´æ–°ä¸å®Œå…¨çš„ DOMã€‚åªæœ‰å½“æ‰€æœ‰ç»„ä»¶éƒ½å®Œæˆ<code>Reconciler</code>çš„å·¥ä½œï¼Œæ‰ä¼šç»Ÿä¸€äº¤ç»™<code>Renderer</code>ã€‚</p><h3 id="Renderer-æ¸²æŸ“å™¨"><a href="#Renderer-æ¸²æŸ“å™¨" class="headerlink" title="Renderer æ¸²æŸ“å™¨"></a>Renderer æ¸²æŸ“å™¨</h3><p><code>Renderer</code>æ ¹æ®<code>Reconciler</code>ä¸ºè™šæ‹Ÿ DOM æ‰“çš„æ ‡è®°ï¼ŒåŒæ­¥æ‰§è¡Œå¯¹åº”çš„ DOM æ“ä½œã€‚</p><h2 id="Fiber-æ¶æ„å¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“"><a href="#Fiber-æ¶æ„å¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“" class="headerlink" title="Fiber æ¶æ„å¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“"></a>Fiber æ¶æ„å¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“</h2><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8eb7f64f3f94a9f8038949001284385~tplv-k3u1fbpfcp-watermark.image" alt=""></p><ol><li>render é˜¶æ®µï¼šçº¯å‡€ä¸”æ²¡æœ‰å‰¯ä½œç”¨ï¼Œå¯èƒ½ä¼šè¢« React æš‚åœã€ç»ˆæ­¢æˆ–é‡æ–°å¯åŠ¨ã€‚</li><li>pre-commit é˜¶æ®µï¼šå¯ä»¥è¯»å– DOMã€‚</li><li>commit é˜¶æ®µï¼šå¯ä»¥ä½¿ç”¨ DOMï¼Œè¿è¡Œå‰¯ä½œç”¨ï¼Œå®‰æ’æ›´æ–°ã€‚</li></ol><p>å…¶ä¸­ pre-commit å’Œ commit ä»å¤§é˜¶æ®µä¸Šæ¥çœ‹éƒ½å±äº commit é˜¶æ®µã€‚</p><p>åœ¨ render é˜¶æ®µï¼ŒReact ä¸»è¦æ˜¯åœ¨å†…å­˜ä¸­åšè®¡ç®—ï¼Œæ˜ç¡® DOM æ ‘çš„æ›´æ–°ç‚¹ï¼›è€Œ commit é˜¶æ®µï¼Œåˆ™è´Ÿè´£æŠŠ render é˜¶æ®µç”Ÿæˆçš„æ›´æ–°çœŸæ­£åœ°æ‰§è¡Œæ‰ã€‚</p><p>æ–°è€ä¸¤ç§æ¶æ„å¯¹ React ç”Ÿå‘½å‘¨æœŸçš„å½±å“ä¸»è¦åœ¨ render è¿™ä¸ªé˜¶æ®µï¼Œè¿™ä¸ªå½±å“æ˜¯é€šè¿‡å¢åŠ  Scheduler å±‚å’Œæ”¹å†™ Reconciler å±‚æ¥å®ç°çš„ã€‚</p><p>åœ¨ render é˜¶æ®µï¼Œä¸€ä¸ªåºå¤§çš„æ›´æ–°ä»»åŠ¡è¢«åˆ†è§£ä¸ºäº†ä¸€ä¸ªä¸ªçš„å·¥ä½œå•å…ƒï¼Œè¿™äº›å·¥ä½œå•å…ƒæœ‰ç€ä¸åŒçš„ä¼˜å…ˆçº§ï¼ŒReact å¯ä»¥æ ¹æ®ä¼˜å…ˆçº§çš„é«˜ä½å»å®ç°å·¥ä½œå•å…ƒçš„æ‰“æ–­å’Œæ¢å¤ã€‚</p><p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« å…³äºä¸ºä»€ä¹ˆ React ä¸€äº›æ—§ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ‰“ç®—åºŸå¼ƒçš„åŸå› ï¼š<a href="https://juejin.cn/post/6900703477480685582" target="_blank" rel="noopener">è°ˆè°ˆå¯¹ React æ–°æ—§ç”Ÿå‘½å‘¨æœŸçš„ç†è§£</a></p><p>è€Œè¿™æ¬¡ä» Firber æœºåˆ¶ render é˜¶æ®µçš„è§’åº¦çœ‹è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸçš„å…±åŒç‰¹ç‚¹æ˜¯éƒ½å¤„äº render é˜¶æ®µï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">componentWillMount</span><br><span class="line">componentWillUpdate</span><br><span class="line">componentWillReceiveProps</span><br></pre></td></tr></table></figure><p>ç”±äº render é˜¶æ®µæ˜¯å…è®¸æš‚åœã€ç»ˆæ­¢å’Œé‡å¯çš„ï¼Œè¿™å°±å¯¼è‡´ render é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸéƒ½æœ‰å¯èƒ½è¢«é‡å¤æ‰§è¡Œï¼Œæ•…ä¹Ÿæ˜¯åºŸå¼ƒä»–ä»¬çš„åŸå› ä¹‹ä¸€ã€‚</p><h2 id="Fiber-æ›´æ–°è¿‡ç¨‹"><a href="#Fiber-æ›´æ–°è¿‡ç¨‹" class="headerlink" title="Fiber æ›´æ–°è¿‡ç¨‹"></a>Fiber æ›´æ–°è¿‡ç¨‹</h2><p>è™šæ‹Ÿ DOM æ›´æ–°è¿‡ç¨‹åˆ†ä¸º 2 ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>render/reconciliation åè°ƒé˜¶æ®µ(å¯ä¸­æ–­/å¼‚æ­¥)</strong>ï¼šé€šè¿‡ Diff ç®—æ³•æ‰¾å‡ºæ‰€æœ‰èŠ‚ç‚¹å˜æ›´ï¼Œä¾‹å¦‚èŠ‚ç‚¹æ–°å¢ã€åˆ é™¤ã€å±æ€§å˜æ›´ç­‰ç­‰, è·å¾—éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¯¹åº”æ—©æœŸç‰ˆæœ¬çš„ Diff è¿‡ç¨‹ã€‚</li><li><strong>commit æäº¤é˜¶æ®µ(ä¸å¯ä¸­æ–­/åŒæ­¥)</strong>ï¼šå°†éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ä¸€æ¬¡è¿‡æ‰¹é‡æ›´æ–°ï¼Œå¯¹åº”æ—©æœŸç‰ˆæœ¬çš„ patch è¿‡ç¨‹ã€‚</li></ul><h3 id="åè°ƒé˜¶æ®µ"><a href="#åè°ƒé˜¶æ®µ" class="headerlink" title="åè°ƒé˜¶æ®µ"></a>åè°ƒé˜¶æ®µ</h3><p>åœ¨åè°ƒé˜¶æ®µä¼šè¿›è¡Œ Diff è®¡ç®—ï¼Œä¼šç”Ÿæˆä¸€æ£µ Fiber æ ‘ã€‚</p><p>è¯¥é˜¶æ®µå¼€å§‹äº<code>performSyncWorkOnRoot</code>æˆ–<code>performConcurrentWorkOnRoot</code>æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å–å†³äºæœ¬æ¬¡æ›´æ–°æ˜¯åŒæ­¥æ›´æ–°è¿˜æ˜¯å¼‚æ­¥æ›´æ–°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// performSyncWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoopSync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (workInProgress !== <span class="literal">null</span>) &#123;</span><br><span class="line">    performUnitOfWork(workInProgress)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// performConcurrentWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoopConcurrent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (workInProgress !== <span class="literal">null</span> &amp;&amp; !shouldYield()) &#123;</span><br><span class="line">    performUnitOfWork(workInProgress)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒä»¬å”¯ä¸€çš„åŒºåˆ«æ˜¯æ˜¯å¦è°ƒç”¨<code>shouldYield</code>ã€‚å¦‚æœå½“å‰æµè§ˆå™¨å¸§æ²¡æœ‰å‰©ä½™æ—¶é—´ï¼Œ<code>shouldYield</code>ä¼šä¸­æ­¢å¾ªç¯ï¼Œç›´åˆ°æµè§ˆå™¨æœ‰ç©ºé—²æ—¶é—´åå†ç»§ç»­éå†ã€‚</p><p><code>workInProgress</code>ä»£è¡¨å½“å‰å·²åˆ›å»ºçš„ workInProgress fiberã€‚</p><p><code>performUnitOfWork</code>æ–¹æ³•å°†è§¦å‘å¯¹ <code>beginWork</code> çš„è°ƒç”¨ï¼Œè¿›è€Œå®ç°å¯¹æ–° Fiber èŠ‚ç‚¹çš„åˆ›å»ºã€‚è‹¥ <code>beginWork</code> æ‰€åˆ›å»ºçš„ Fiber èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™ <code>performUniOfWork</code> ä¼šç”¨è¿™ä¸ªæ–°çš„ Fiber èŠ‚ç‚¹æ¥æ›´æ–° <code>workInProgress</code> çš„å€¼ï¼Œä¸ºä¸‹ä¸€æ¬¡å¾ªç¯åšå‡†å¤‡ã€‚</p><p>é€šè¿‡å¾ªç¯è°ƒç”¨ <code>performUnitOfWork</code> æ¥è§¦å‘ <code>beginWork</code>ï¼Œæ–°çš„ Fiber èŠ‚ç‚¹å°±ä¼šè¢«ä¸æ–­åœ°åˆ›å»ºã€‚å½“ <code>workInProgress</code> ç»ˆäºä¸ºç©ºæ—¶ï¼Œè¯´æ˜æ²¡æœ‰æ–°çš„èŠ‚ç‚¹å¯ä»¥åˆ›å»ºäº†ï¼Œä¹Ÿå°±æ„å‘³ç€å·²ç»å®Œæˆå¯¹æ•´æ£µ Fiber æ ‘çš„æ„å»ºã€‚</p><p>æˆ‘ä»¬çŸ¥é“ Fiber Reconciler æ˜¯ä» Stack Reconciler é‡æ„è€Œæ¥ï¼Œé€šè¿‡éå†çš„æ–¹å¼å®ç°å¯ä¸­æ–­çš„é€’å½’ï¼Œæ‰€ä»¥<code>performUnitOfWork</code>çš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šâ€é€’â€å’Œâ€å½’â€ã€‚</p><p><strong>â€œé€’é˜¶æ®µâ€</strong></p><p>é¦–å…ˆä» rootFiber å¼€å§‹å‘ä¸‹æ·±åº¦ä¼˜å…ˆéå†ã€‚ä¸ºéå†åˆ°çš„æ¯ä¸ª Fiber èŠ‚ç‚¹è°ƒç”¨<code>beginWork</code>æ–¹æ³•ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">beginWork</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  current: Fiber | null, <span class="regexp">//</span> å½“å‰ç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹åœ¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶çš„FiberèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="function"><span class="params">  workInProgress: Fiber, <span class="regexp">//</span> å½“å‰ç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="function"><span class="params">  renderExpirationTime: ExpirationTime <span class="regexp">//</span> ä¼˜å…ˆçº§ç›¸å…³</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Fiber</span> | <span class="title">null</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...çœç•¥å‡½æ•°ä½“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„ Fiber èŠ‚ç‚¹åˆ›å»ºå­ Fiber èŠ‚ç‚¹ï¼Œå¹¶å°†è¿™ä¸¤ä¸ª Fiber èŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚</p><p>å½“éå†åˆ°å¶å­èŠ‚ç‚¹ï¼ˆå³æ²¡æœ‰å­ç»„ä»¶çš„ç»„ä»¶ï¼‰æ—¶å°±ä¼šè¿›å…¥â€å½’â€é˜¶æ®µã€‚</p><p><strong>â€œå½’é˜¶æ®µâ€</strong></p><p>åœ¨â€å½’â€é˜¶æ®µä¼šè°ƒç”¨<code>completeWork</code>å¤„ç† Fiber èŠ‚ç‚¹ã€‚</p><blockquote><p>completeWork å°†æ ¹æ® workInProgress èŠ‚ç‚¹çš„ tag å±æ€§çš„ä¸åŒï¼Œè¿›å…¥ä¸åŒçš„ DOM èŠ‚ç‚¹çš„åˆ›å»ºã€å¤„ç†é€»è¾‘ã€‚</p></blockquote><p>completeWork å†…éƒ¨æœ‰ 3 ä¸ªå…³é”®åŠ¨ä½œï¼š</p><ul><li>åˆ›å»º DOM èŠ‚ç‚¹ï¼ˆCreateInstanceï¼‰</li><li>å°† DOM èŠ‚ç‚¹æ’å…¥åˆ° DOM æ ‘ä¸­ï¼ˆAppendAllChildrenï¼‰</li><li>ä¸º DOM èŠ‚ç‚¹è®¾ç½®å±æ€§ï¼ˆFinalizeInitialChildrenï¼‰</li></ul><p>å½“æŸä¸ª Fiber èŠ‚ç‚¹æ‰§è¡Œå®Œ<code>completeWork</code>ï¼Œå¦‚æœå…¶å­˜åœ¨å…„å¼Ÿ Fiber èŠ‚ç‚¹ï¼ˆå³<code>fiber.sibling !== null</code>ï¼‰ï¼Œä¼šè¿›å…¥å…¶å…„å¼Ÿ Fiber çš„â€é€’â€é˜¶æ®µã€‚</p><p>å¦‚æœä¸å­˜åœ¨å…„å¼Ÿ Fiberï¼Œä¼šè¿›å…¥çˆ¶çº§ Fiber çš„â€å½’â€é˜¶æ®µã€‚</p><p>â€œé€’â€å’Œâ€å½’â€é˜¶æ®µä¼šäº¤é”™æ‰§è¡Œç›´åˆ°â€å½’â€åˆ° rootFiberã€‚è‡³æ­¤ï¼Œåè°ƒé˜¶æ®µçš„å·¥ä½œå°±ç»“æŸäº†ã€‚</p><h3 id="commit-æäº¤é˜¶æ®µ"><a href="#commit-æäº¤é˜¶æ®µ" class="headerlink" title="commit æäº¤é˜¶æ®µ"></a>commit æäº¤é˜¶æ®µ</h3><p>commit é˜¶æ®µçš„ä¸»è¦å·¥ä½œï¼ˆå³ Renderer çš„å·¥ä½œæµç¨‹ï¼‰åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p><ul><li>before mutation é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µ DOM èŠ‚ç‚¹è¿˜æ²¡æœ‰è¢«æ¸²æŸ“åˆ°ç•Œé¢ä¸Šå»ï¼Œè¿‡ç¨‹ä¸­ä¼šè§¦å‘ <code>getSnapshotBeforeUpdate</code>ï¼Œä¹Ÿä¼šå¤„ç† <code>useEffect</code> é’©å­ç›¸å…³çš„è°ƒåº¦é€»è¾‘ã€‚</li><li>mutation é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µè´Ÿè´£ DOM èŠ‚ç‚¹çš„æ¸²æŸ“ã€‚åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œä¼šéå† effectListï¼Œæ ¹æ® flagsï¼ˆeffectTagï¼‰çš„ä¸åŒï¼Œæ‰§è¡Œä¸åŒçš„ DOM æ“ä½œã€‚</li><li>layout é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå¤„ç† DOM æ¸²æŸ“å®Œæ¯•ä¹‹åçš„æ”¶å°¾é€»è¾‘ã€‚æ¯”å¦‚è°ƒç”¨ <code>componentDidMount/componentDidUpdate</code>ï¼Œè°ƒç”¨ <code>useLayoutEffect</code> é’©å­å‡½æ•°çš„å›è°ƒç­‰ã€‚é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šæŠŠ fiberRoot çš„ current æŒ‡é’ˆæŒ‡å‘ workInProgress Fiber æ ‘ã€‚</li></ul><p>å‚è€ƒï¼š</p><ul><li>ä¿®è¨€-æ·±å…¥æµ…å‡ºæå®š React</li><li>React æŠ€æœ¯æ­ç§˜</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>Fiber</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ React çš„ setState æœºåˆ¶</title>
    <url>/2021/01/23/%E6%B7%B1%E5%85%A5-React-%E7%9A%84-setState-%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>æœ¬ç¯‡å†™çš„ setStateï¼ˆæ¶‰åŠæºç éƒ¨åˆ†ï¼‰æ˜¯é’ˆå¯¹ React15 ç‰ˆæœ¬ï¼Œå³æ˜¯æ²¡æœ‰ Fiber ä»‹å…¥çš„ï¼›ä¸ºäº†æ–¹ä¾¿çœ‹å’Œå†™ï¼Œæ‰€ä»¥é€‰æ‹©æ—§ç‰ˆæœ¬ï¼ŒFiber å†™èµ·æ¥æœ‰ç‚¹éš¾ï¼Œå…ˆç•™ç€å°†ä¼šå†™ã€‚setState åœ¨ React 15 çš„åŸç†èƒ½ç†è§£ï¼Œ16 ç‰ˆæœ¬çš„ä¹Ÿæ˜¯å¤§åŒå°å¼‚ã€‚</p><p>è™½ç„¶å·²ç»ç”¨ React Hooks å¾ˆä¹…äº†ï¼ŒReact15 çš„<code>this.setState()</code>å½¢å¼éƒ½å¾ˆå°‘ç”¨äº†ï¼Œä½†ä¾ç„¶æ˜¯ç«™åœ¨å›é¡¾ä¸æ€»ç»“çš„è§’åº¦ï¼Œçœ‹å¾… React çš„å˜è¿å’Œå‘å±•ï¼Œæ‰€ä»¥æœ€è¿‘å¼€å§‹é‡æ–°å›é¡¾ä»¥å‰ä¸€çŸ¥åŠè§£çš„ä¸€äº›åŸç†é—®é¢˜ï¼Œæ…¢æ…¢æ²‰æ·€æŠ€æœ¯ã€‚</p><a id="more"></a><h2 id="setState-ç»å…¸é—®é¢˜"><a href="#setState-ç»å…¸é—®é¢˜" class="headerlink" title="setState ç»å…¸é—®é¢˜"></a>setState ç»å…¸é—®é¢˜</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setState(updater, [callback])</span><br></pre></td></tr></table></figure><p>React é€šè¿‡ <code>this.setState()</code> æ¥æ›´æ–° stateï¼Œå½“ä½¿ç”¨ <code>this.setState()</code>çš„æ—¶å€™ ï¼ŒReact ä¼šè°ƒç”¨ render æ–¹æ³•æ¥é‡æ–°æ¸²æŸ“ UIã€‚</p><p>setState çš„å‡ ç§ç”¨æ³•å°±ä¸ç”¨æˆ‘è¯´äº†ï¼Œæ¥çœ‹çœ‹ç½‘ä¸Šè®¨è®º setState æ¯”è¾ƒå¤šçš„é—®é¢˜ï¼š</p><h3 id="æ‰¹é‡æ›´æ–°"><a href="#æ‰¹é‡æ›´æ–°" class="headerlink" title="æ‰¹é‡æ›´æ–°"></a>æ‰¹é‡æ›´æ–°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">1</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;åŠ <span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;&#123;this.state.count&#125;&lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App</span></span><br></pre></td></tr></table></figure><p>ç‚¹å‡»æŒ‰é’®è§¦å‘äº‹ä»¶ï¼Œæ‰“å°çš„éƒ½æ˜¯ 1ï¼Œé¡µé¢æ˜¾ç¤º count çš„å€¼ä¸º 2ã€‚</p><p>è¿™å°±æ˜¯å¸¸å¸¸è¯´çš„ setState æ‰¹é‡æ›´æ–°ï¼Œå¯¹åŒä¸€ä¸ªå€¼è¿›è¡Œå¤šæ¬¡ setState ï¼Œ setState çš„æ‰¹é‡æ›´æ–°ç­–ç•¥ä¼šå¯¹å…¶è¿›è¡Œè¦†ç›–ï¼Œå–æœ€åä¸€æ¬¡çš„æ‰§è¡Œç»“æœã€‚æ‰€ä»¥æ¯æ¬¡ setState ä¹‹åç«‹å³æ‰“å°å€¼éƒ½æ˜¯åˆå§‹å€¼ 1ï¼Œè€Œæœ€åé¡µé¢æ˜¾ç¤ºçš„å€¼åˆ™ä¸ºæœ€åä¸€æ¬¡çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå°±æ˜¯ 2ã€‚</p><h3 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">1</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 3</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;åŠ <span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;&#123;this.state.count&#125;&lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App</span></span><br></pre></td></tr></table></figure><p>ç‚¹å‡»æŒ‰é’®è§¦å‘äº‹ä»¶ï¼Œå‘ç° setTimeout é‡Œé¢çš„ count å€¼æ‰“å°å€¼ä¸º 3ï¼Œé¡µé¢æ˜¾ç¤º count çš„å€¼ä¸º 3ã€‚setTimeout é‡Œé¢ setState ä¹‹åèƒ½é©¬ä¸Šèƒ½åˆ°æœ€æ–°å€¼ã€‚</p><p>åœ¨ setTimeout é‡Œé¢ï¼ŒsetState æ˜¯åŒæ­¥çš„ï¼›ç»è¿‡å‰é¢ä¸¤æ¬¡çš„ setState æ‰¹é‡æ›´æ–°ï¼Œcount å€¼å·²ç»æ›´æ–°ä¸º 2ã€‚åœ¨ setTimeout é‡Œé¢çš„é¦–å…ˆæ‹¿åˆ°æ–°çš„ count å€¼ 2ï¼Œå†ä¸€æ¬¡ setStateï¼Œç„¶åèƒ½å®æ—¶æ‹¿åˆ° count çš„å€¼ä¸º 3ã€‚</p><h3 id="DOM-åŸç”Ÿäº‹ä»¶"><a href="#DOM-åŸç”Ÿäº‹ä»¶" class="headerlink" title="DOM åŸç”Ÿäº‹ä»¶"></a>DOM åŸç”Ÿäº‹ä»¶</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">1</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>).addEventListener(<span class="string">'click'</span>, <span class="keyword">this</span>.handleClick)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 4</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &lt;button id=<span class="string">'btn'</span>&gt;è§¦å‘åŸç”Ÿäº‹ä»¶&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;&#123;this.state.count&#125;&lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App</span></span><br></pre></td></tr></table></figure><p>ç‚¹å‡»æŒ‰é’®ï¼Œä¼šå‘ç°æ¯æ¬¡ setState æ‰“å°å‡ºæ¥çš„å€¼éƒ½æ˜¯å®æ—¶æ‹¿åˆ°çš„ï¼Œä¸ä¼šè¿›è¡Œæ‰¹é‡æ›´æ–°ã€‚</p><p>åœ¨ DOM åŸç”Ÿäº‹ä»¶é‡Œé¢ï¼ŒsetState ä¹Ÿæ˜¯åŒæ­¥çš„ã€‚</p><h2 id="setState-åŒæ­¥å¼‚æ­¥é—®é¢˜"><a href="#setState-åŒæ­¥å¼‚æ­¥é—®é¢˜" class="headerlink" title="setState åŒæ­¥å¼‚æ­¥é—®é¢˜"></a>setState åŒæ­¥å¼‚æ­¥é—®é¢˜</h2><p>è¿™é‡Œè®¨è®ºçš„åŒæ­¥å’Œå¼‚æ­¥å¹¶ä¸æ˜¯æŒ‡ setState æ˜¯å¦å¼‚æ­¥æ‰§è¡Œï¼Œä½¿ç”¨äº†ä»€ä¹ˆå¼‚æ­¥ä»£ç ï¼Œè€Œæ˜¯æŒ‡è°ƒç”¨ setState ä¹‹å this.state èƒ½å¦ç«‹å³æ›´æ–°ã€‚</p><p>React ä¸­çš„äº‹ä»¶éƒ½æ˜¯åˆæˆäº‹ä»¶ï¼Œéƒ½æ˜¯ç”± React å†…éƒ¨å°è£…å¥½çš„ã€‚React æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€å¼‚æ­¥â€äº†ã€‚</p><p>ç”±ä¸Šé¢ä¹Ÿå¯ä»¥å¾—çŸ¥ setState åœ¨åŸç”Ÿäº‹ä»¶å’Œ setTimeout ä¸­éƒ½æ˜¯åŒæ­¥çš„ã€‚</p><h2 id="setState-æºç å±‚é¢"><a href="#setState-æºç å±‚é¢" class="headerlink" title="setState æºç å±‚é¢"></a>setState æºç å±‚é¢</h2><p>æºç é€‰æ‹©çš„ React ç‰ˆæœ¬ä¸º<code>15.6.2</code></p><h3 id="setState-å‡½æ•°"><a href="#setState-å‡½æ•°" class="headerlink" title="setState å‡½æ•°"></a>setState å‡½æ•°</h3><p>æºç é‡Œé¢ï¼ŒsetState å‡½æ•°çš„ä»£ç </p><p>React ç»„ä»¶ç»§æ‰¿è‡ª<code>React.Component</code>ï¼Œè€Œ setState æ˜¯<code>React.Component</code>çš„æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ReactComponent.prototype.setState = <span class="function"><span class="keyword">function</span> (<span class="params">partialState, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.updater.enqueueSetState(<span class="keyword">this</span>, partialState)</span><br><span class="line">  <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">    <span class="keyword">this</span>.updater.enqueueCallback(<span class="keyword">this</span>, callback, <span class="string">'setState'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒç›´æ¥è°ƒç”¨äº† <code>this.updater.enqueueSetState</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="enqueueSetState"><a href="#enqueueSetState" class="headerlink" title="enqueueSetState"></a>enqueueSetState</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">enqueueSetState: <span class="function"><span class="keyword">function</span>(<span class="params">publicInstance, partialState</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ‹¿åˆ°å¯¹åº”çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="keyword">var</span> internalInstance = getInternalInstanceReadyForUpdate(</span><br><span class="line">    publicInstance,</span><br><span class="line">    <span class="string">'setState'</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// queue å¯¹åº”ä¸€ä¸ªç»„ä»¶å®ä¾‹çš„ state æ•°ç»„</span></span><br><span class="line">  <span class="keyword">var</span> queue = internalInstance._pendingStateQueue || (internalInstance._pendingStateQueue = []);</span><br><span class="line">  queue.push(partialState); <span class="comment">// å°† partialState æ”¾å…¥å¾…æ›´æ–° state é˜Ÿåˆ—</span></span><br><span class="line">  <span class="comment">// å¤„ç†å½“å‰çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  enqueueUpdate(internalInstance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_pendingStateQueue</code>è¡¨ç¤ºå¾…æ›´æ–°é˜Ÿåˆ—</p><p><code>enqueueSetState</code> åšäº†ä¸¤ä»¶äº‹ï¼š</p><ul><li>å°†æ–°çš„ state æ”¾è¿›ç»„ä»¶çš„çŠ¶æ€é˜Ÿåˆ—é‡Œï¼›</li><li>ç”¨ enqueueUpdate æ¥å¤„ç†å°†è¦æ›´æ–°çš„å®ä¾‹å¯¹è±¡ã€‚</li></ul><p>æ¥ä¸‹æ¥çœ‹çœ‹ <code>enqueueUpdate</code> åšäº†ä»€ä¹ˆï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enqueueUpdate</span>(<span class="params">component</span>) </span>&#123;</span><br><span class="line">  ensureInjected()</span><br><span class="line">  <span class="comment">// isBatchingUpdates æ ‡è¯†ç€å½“å‰æ˜¯å¦å¤„äºæ‰¹é‡æ›´æ–°è¿‡ç¨‹</span></span><br><span class="line">  <span class="keyword">if</span> (!batchingStrategy.isBatchingUpdates) &#123;</span><br><span class="line">    <span class="comment">// è‹¥å½“å‰æ²¡æœ‰å¤„äºæ‰¹é‡åˆ›å»º/æ›´æ–°ç»„ä»¶çš„é˜¶æ®µï¼Œåˆ™ç«‹å³æ›´æ–°ç»„ä»¶</span></span><br><span class="line">    batchingStrategy.batchedUpdates(enqueueUpdate, component)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// éœ€è¦æ‰¹é‡æ›´æ–°ï¼Œåˆ™å…ˆæŠŠç»„ä»¶å¡å…¥ dirtyComponents é˜Ÿåˆ—</span></span><br><span class="line">  dirtyComponents.push(component)</span><br><span class="line">  <span class="keyword">if</span> (component._updateBatchNumber == <span class="literal">null</span>) &#123;</span><br><span class="line">    component._updateBatchNumber = updateBatchNumber + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>batchingStrategy</code> è¡¨ç¤ºæ‰¹é‡æ›´æ–°ç­–ç•¥ï¼Œ<code>isBatchingUpdates</code>è¡¨ç¤ºå½“å‰æ˜¯å¦å¤„äºæ‰¹é‡æ›´æ–°è¿‡ç¨‹ï¼Œé»˜è®¤æ˜¯ falseã€‚</p><p><code>enqueueUpdate</code>åšçš„äº‹æƒ…ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35dce2754bb844808bf65fcc12cd1b24~tplv-k3u1fbpfcp-watermark.image" alt=""></p><ul><li><p>åˆ¤æ–­ç»„ä»¶æ˜¯å¦å¤„äºæ‰¹é‡æ›´æ–°æ¨¡å¼ï¼Œå¦‚æœæ˜¯ï¼Œå³<code>isBatchingUpdates</code>ä¸º true æ—¶ï¼Œä¸è¿›è¡Œ state çš„æ›´æ–°æ“ä½œï¼Œè€Œæ˜¯å°†éœ€è¦æ›´æ–°çš„ç»„ä»¶æ·»åŠ åˆ°<code>dirtyComponents</code>æ•°ç»„ä¸­ï¼›</p></li><li><p>å¦‚æœä¸æ˜¯å¤„äºæ‰¹é‡æ›´æ–°æ¨¡å¼ï¼Œåˆ™å¯¹æ‰€æœ‰é˜Ÿåˆ—ä¸­çš„æ›´æ–°æ‰§è¡Œ<code>batchedUpdates</code>æ–¹æ³•</p></li></ul><p>å½“ä¸­ <code>batchingStrategy</code>è¯¥å¯¹è±¡çš„<code>isBatchingUpdates</code>å±æ€§ç›´æ¥å†³å®šäº†æ˜¯é©¬ä¸Šè¦èµ°æ›´æ–°æµç¨‹ï¼Œè¿˜æ˜¯åº”è¯¥è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼›æ‰€ä»¥å¤§æ¦‚å¯ä»¥å¾—çŸ¥<code>batchingStrategy</code>ç”¨äºç®¡æ§æ‰¹é‡æ›´æ–°çš„å¯¹è±¡ã€‚</p><p>æ¥çœ‹çœ‹å®ƒçš„æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  batchingStrategyæºç </span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">var</span> ReactDefaultBatchingStrategy = &#123;</span><br><span class="line">  isBatchingUpdates: <span class="literal">false</span>, <span class="comment">// åˆå§‹å€¼ä¸º false è¡¨ç¤ºå½“å‰å¹¶æœªè¿›è¡Œä»»ä½•æ‰¹é‡æ›´æ–°æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘èµ·æ›´æ–°åŠ¨ä½œçš„æ–¹æ³•</span></span><br><span class="line">  batchedUpdates: <span class="function"><span class="keyword">function</span> (<span class="params">callback, a, b, c, d, e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> alreadyBatchingUpdates = ReactDefaultBatchingStrategy.isBatchingUpdates</span><br><span class="line"></span><br><span class="line">    ReactDefaultBatchingStrategy.isBatchingUpdates = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (alreadyBatchingUpdates) &#123;</span><br><span class="line">      <span class="keyword">return</span> callback(a, b, c, d, e)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¯åŠ¨äº‹åŠ¡ï¼Œå°† callback æ”¾è¿›äº‹åŠ¡é‡Œæ‰§è¡Œ</span></span><br><span class="line">      <span class="keyword">return</span> transaction.perform(callback, <span class="literal">null</span>, a, b, c, d, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¯å½“ React è°ƒç”¨ batchedUpdate å»æ‰§è¡Œæ›´æ–°åŠ¨ä½œæ—¶ï¼Œä¼šå…ˆæŠŠ<code>isBatchingUpdates</code>ç½®ä¸º trueï¼Œè¡¨æ˜æ­£å¤„äºæ‰¹é‡æ›´æ–°è¿‡ç¨‹ä¸­ã€‚</strong></p><p>çœ‹å®Œæ‰¹é‡æ›´æ–°æ•´ä½“çš„ç®¡ç†æœºåˆ¶ï¼Œå‘ç°è¿˜æœ‰ä¸€ä¸ªæ“ä½œæ˜¯<code>transaction.perform</code>ï¼Œè¿™å°±å¼•å‡º React ä¸­çš„ Transactionï¼ˆäº‹åŠ¡ï¼‰æœºåˆ¶ã€‚</p><h3 id="Transactionï¼ˆäº‹åŠ¡ï¼‰æœºåˆ¶"><a href="#Transactionï¼ˆäº‹åŠ¡ï¼‰æœºåˆ¶" class="headerlink" title="Transactionï¼ˆäº‹åŠ¡ï¼‰æœºåˆ¶"></a>Transactionï¼ˆäº‹åŠ¡ï¼‰æœºåˆ¶</h3><p>Transaction æ˜¯åˆ›å»ºä¸€ä¸ªé»‘ç›’ï¼Œè¯¥é»‘ç›’èƒ½å¤Ÿå°è£…ä»»ä½•çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œé‚£äº›éœ€è¦åœ¨å‡½æ•°è¿è¡Œå‰ã€åè¿è¡Œçš„æ–¹æ³•å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å°è£…ï¼ˆå³ä½¿å‡½æ•°è¿è¡Œä¸­æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œè¿™äº›å›ºå®šçš„æ–¹æ³•ä»å¯è¿è¡Œï¼‰ã€‚</p><p>åœ¨ React ä¸­æºç æœ‰å…³äº Transaction çš„æ³¨é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">* <span class="xml"><span class="tag">&lt;<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="xml">*                       wrappers (injected at creation time)</span></span><br><span class="line"><span class="xml">*                                      +        +</span></span><br><span class="line"><span class="xml">*                                      |        |</span></span><br><span class="line"><span class="xml">*                    +-----------------|--------|--------------+</span></span><br><span class="line"><span class="xml">*                    |                 v        |              |</span></span><br><span class="line"><span class="xml">*                    |      +---------------+   |              |</span></span><br><span class="line"><span class="xml">*                    |   +--|    wrapper1   |---|----+         |</span></span><br><span class="line"><span class="xml">*                    |   |  +---------------+   v    |         |</span></span><br><span class="line"><span class="xml">*                    |   |          +-------------+  |         |</span></span><br><span class="line"><span class="xml">*                    |   |     +----|   wrapper2  |--------+   |</span></span><br><span class="line"><span class="xml">*                    |   |     |    +-------------+  |     |   |</span></span><br><span class="line"><span class="xml">*                    |   |     |                     |     |   |</span></span><br><span class="line"><span class="xml">*                    |   v     v                     v     v   | wrapper</span></span><br><span class="line"><span class="xml">*                    | +---+ +---+   +---------+   +---+ +---+ | invariants</span></span><br><span class="line"><span class="xml">* perform(anyMethod) | |   | |   |   |         |   |   | |   | | maintained</span></span><br><span class="line"><span class="xml">* +-----------------&gt;|-|---|-|---|--&gt;|anyMethod|---|---|-|---|-|--------&gt;</span></span><br><span class="line"><span class="xml">*                    | |   | |   |   |         |   |   | |   | |</span></span><br><span class="line"><span class="xml">*                    | |   | |   |   |         |   |   | |   | |</span></span><br><span class="line"><span class="xml">*                    | |   | |   |   |         |   |   | |   | |</span></span><br><span class="line"><span class="xml">*                    | +---+ +---+   +---------+   +---+ +---+ |</span></span><br><span class="line"><span class="xml">*                    |  initialize                    close    |</span></span><br><span class="line"><span class="xml">*                    +-----------------------------------------+</span></span><br><span class="line"><span class="xml">* <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>æ ¹æ®ä»¥ä¸Šæ³¨é‡Šï¼Œå¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ª Transaction å°±æ˜¯å°†éœ€è¦æ‰§è¡Œçš„ method ä½¿ç”¨ wrapperï¼ˆä¸€ç»„ initialize åŠ close æ–¹æ³•ç§°ä¸ºä¸€ä¸ª wrapperï¼‰ å°è£…èµ·æ¥ï¼Œå†é€šè¿‡ Transaction æä¾›çš„ perform æ–¹æ³•æ‰§è¡Œã€‚</p><p>åœ¨ perform ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œæ‰€æœ‰ wrapper ä¸­çš„ initialize æ–¹æ³•ï¼›perform å®Œæˆä¹‹åï¼ˆå³ method æ‰§è¡Œåï¼‰å†æ‰§è¡Œæ‰€æœ‰çš„ close æ–¹æ³•ï¼Œè€Œä¸” Transaction æ”¯æŒå¤šä¸ª wrapper å åŠ ã€‚è¿™å°±æ˜¯ React ä¸­çš„äº‹åŠ¡æœºåˆ¶ã€‚</p><h3 id="batchingStrategy-æ‰¹é‡æ›´æ–°ç­–ç•¥"><a href="#batchingStrategy-æ‰¹é‡æ›´æ–°ç­–ç•¥" class="headerlink" title="batchingStrategy æ‰¹é‡æ›´æ–°ç­–ç•¥"></a>batchingStrategy æ‰¹é‡æ›´æ–°ç­–ç•¥</h3><p>å†çœ‹å›<code>batchingStrategy</code>æ‰¹é‡æ›´æ–°ç­–ç•¥ï¼ŒReactDefaultBatchingStrategy å…¶å®å°±æ˜¯ä¸€ä¸ªæ‰¹é‡æ›´æ–°ç­–ç•¥äº‹åŠ¡ï¼Œå®ƒçš„ wrapper æœ‰ä¸¤ä¸ªï¼š<code>FLUSH_BATCHED_UPDATES</code> å’Œ <code>RESET_BATCHED_UPDATES</code>ã€‚</p><p><code>isBatchingUpdates</code>åœ¨ close æ–¹æ³•è¢«å¤ä½ä¸º falseï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> RESET_BATCHED_UPDATES = &#123;</span><br><span class="line">  initialize: emptyFunction,</span><br><span class="line">  close: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    ReactDefaultBatchingStrategy.isBatchingUpdates = <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  flushBatchedUpdates å°†æ‰€æœ‰çš„ä¸´æ—¶ state åˆå¹¶å¹¶è®¡ç®—å‡ºæœ€æ–°çš„ props åŠ state</span></span><br><span class="line"><span class="keyword">var</span> FLUSH_BATCHED_UPDATES = &#123;</span><br><span class="line">  initialize: emptyFunction,</span><br><span class="line">  close: ReactUpdates.flushBatchedUpdates.bind(ReactUpdates),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> TRANSACTION_WRAPPERS = [FLUSH_BATCHED_UPDATES, RESET_BATCHED_UPDATES]</span><br></pre></td></tr></table></figure><p><strong>React é’©å­å‡½æ•°</strong></p><p>éƒ½è¯´ React é’©å­å‡½æ•°ä¹Ÿæ˜¯å¼‚æ­¥æ›´æ–°ï¼Œåˆ™å¿…é¡»ä¸€å¼€å§‹ isBatchingUpdates ä¸º tureï¼Œä½†é»˜è®¤ isBatchingUpdates ä¸º falseï¼Œå®ƒæ˜¯åœ¨å“ªé‡Œè¢«è®¾ç½®ä¸º true çš„å‘¢ï¼Ÿæ¥çœ‹ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ReactMount.js</span></span><br><span class="line">_renderNewRootComponent: <span class="function"><span class="keyword">function</span>(<span class="params"> nextElement, container, shouldReuseMarkup, context </span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">var</span> componentInstance = instantiateReactComponent(nextElement);</span><br><span class="line">  <span class="comment">// è°ƒç”¨ batchedUpdates æ–¹æ³•</span></span><br><span class="line">  ReactUpdates.batchedUpdates(</span><br><span class="line">    batchedMountComponentIntoNode,</span><br><span class="line">    componentInstance,</span><br><span class="line">    container,</span><br><span class="line">    shouldReuseMarkup,</span><br><span class="line">    context</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯åœ¨é¦–æ¬¡æ¸²æŸ“ç»„ä»¶æ—¶ä¼šæ‰§è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå†…éƒ¨è°ƒç”¨äº†ä¸€æ¬¡ <code>batchedUpdates</code> æ–¹æ³•ï¼ˆå°† isBatchingUpdates è®¾ä¸º trueï¼‰ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§é¡ºåºè°ƒç”¨å„ä¸ªç”Ÿå‘½å‘¨æœŸ(é’©å­)å‡½æ•°ã€‚å¦‚æœåœ¨å‡½æ•°é‡Œé¢è°ƒç”¨ setStateï¼Œåˆ™çœ‹ä¸‹åˆ—ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!batchingStrategy.isBatchingUpdates) &#123;</span><br><span class="line">  <span class="comment">// ç«‹å³æ›´æ–°ç»„ä»¶</span></span><br><span class="line">  batchingStrategy.batchedUpdates(enqueueUpdate, component)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰¹é‡æ›´æ–°ï¼Œåˆ™å…ˆæŠŠç»„ä»¶å¡å…¥ dirtyComponents é˜Ÿåˆ—</span></span><br><span class="line">dirtyComponents.push(component)</span><br></pre></td></tr></table></figure><p>åˆ™æ‰€æœ‰çš„æ›´æ–°éƒ½èƒ½å¤Ÿè¿›å…¥ dirtyComponents é‡Œå»ï¼Œå³ setState èµ°çš„å¼‚æ­¥æ›´æ–°</p><p><strong>React åˆæˆäº‹ä»¶</strong></p><p>å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šç»‘å®šäº†äº‹ä»¶ä¹‹åï¼Œäº‹ä»¶ä¸­ä¹Ÿæœ‰å¯èƒ½ä¼šè§¦å‘ setStateã€‚ä¸ºäº†ç¡®ä¿æ¯ä¸€æ¬¡ setState éƒ½æœ‰æ•ˆï¼ŒReact åŒæ ·ä¼šåœ¨æ­¤å¤„æ‰‹åŠ¨å¼€å¯æ‰¹é‡æ›´æ–°ã€‚çœ‹ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ReactEventListener.js</span></span><br><span class="line"></span><br><span class="line">dispatchEvent: <span class="function"><span class="keyword">function</span> (<span class="params">topLevelType, nativeEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†äº‹ä»¶ï¼šbatchedUpdatesä¼šå°† isBatchingUpdatesè®¾ä¸ºtrue</span></span><br><span class="line">    ReactUpdates.batchedUpdates(handleTopLevelImpl, bookKeeping);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    TopLevelCallbackBookKeeping.release(bookKeeping);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isBatchingUpdates</code> è¿™ä¸ªå˜é‡ï¼Œåœ¨ React çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä»¥åŠåˆæˆäº‹ä»¶æ‰§è¡Œå‰ï¼Œå·²ç»è¢« React æ”¹ä¸º trueï¼Œè¿™æ—¶æˆ‘ä»¬æ‰€åšçš„ setState æ“ä½œè‡ªç„¶ä¸ä¼šç«‹å³ç”Ÿæ•ˆã€‚å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œäº‹åŠ¡çš„ close æ–¹æ³•ä¼šå†æŠŠ isBatchingUpdates æ”¹ä¸º falseã€‚</p><p>å°±åƒæœ€ä¸Šé¢çš„ä¾‹å­ï¼Œæ•´ä¸ªè¿‡ç¨‹æ¨¡æ‹Ÿå¤§æ¦‚æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// isBatchingUpdates = true</span></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line">  <span class="comment">// isBatchingUpdates = false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœæœ‰ setTimeout ä»‹å…¥å</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// isBatchingUpdates = true</span></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// setTimeoutå¼‚æ­¥æ‰§è¡Œï¼Œæ­¤æ—¶ isBatchingUpdates å·²ç»è¢«é‡ç½®ä¸º false</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      count: <span class="keyword">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.count) <span class="comment">// 3</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// isBatchingUpdates = false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isBatchingUpdates</code>æ˜¯åœ¨åŒæ­¥ä»£ç ä¸­å˜åŒ–çš„ï¼Œè€Œ setTimeout çš„é€»è¾‘æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚å½“ this.setState è°ƒç”¨çœŸæ­£å‘ç”Ÿçš„æ—¶å€™ï¼ŒisBatchingUpdates æ—©å·²ç»è¢«é‡ç½®ä¸º falseï¼Œè¿™å°±ä½¿å¾— setTimeout é‡Œé¢çš„ setState å…·å¤‡äº†ç«‹åˆ»å‘èµ·åŒæ­¥æ›´æ–°çš„èƒ½åŠ›ã€‚</p><h3 id="batchedUpdates-æ–¹æ³•"><a href="#batchedUpdates-æ–¹æ³•" class="headerlink" title="batchedUpdates æ–¹æ³•"></a>batchedUpdates æ–¹æ³•</h3><p>çœ‹åˆ°è¿™é‡Œå¤§æ¦‚å°±å¯ä»¥äº†è§£ setState çš„åŒæ­¥å¼‚æ­¥æœºåˆ¶äº†ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿›ä¸€æ­¥ä½“ä¼šï¼Œå¯ä»¥æŠŠ React çš„<code>batchedUpdates</code>æ‹¿æ¥è¯•è¯•ï¼Œåœ¨è¯¥ç‰ˆæœ¬ä¸­æ­¤æ–¹æ³•åç§°è¢«ç½®ä¸º<code>unstable_batchedUpdates</code>å³ä¸ç¨³å®šçš„æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &#39;react&#39;</span><br><span class="line">import &#123; unstable_batchedUpdates as batchedUpdates &#125; from &#39;react-dom&#39;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  state &#x3D; &#123;</span><br><span class="line">    count: 1,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      count: this.state.count + 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(this.state.count) &#x2F;&#x2F; 1</span><br><span class="line"></span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      count: this.state.count + 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(this.state.count) &#x2F;&#x2F; 1</span><br><span class="line"></span><br><span class="line">    setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">      batchedUpdates(() &#x3D;&gt; &#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">          count: this.state.count + 1,</span><br><span class="line">        &#125;)</span><br><span class="line">        console.log(this.state.count) &#x2F;&#x2F; 2</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &lt;button onClick&#x3D;&#123;this.handleClick&#125;&gt;åŠ 1&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.state.count&#125;&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App</span><br></pre></td></tr></table></figure><p>å¦‚æœè°ƒç”¨<code>batchedUpdates</code>æ–¹æ³•ï¼Œåˆ™ <code>isBatchingUpdates</code>å˜é‡ä¼šè¢«è®¾ç½®ä¸º trueï¼Œç”±ä¸Šè¿°å¾—ä¸º true èµ°çš„æ˜¯æ‰¹é‡æ›´æ–°ç­–ç•¥ï¼Œåˆ™ setTimeout é‡Œé¢çš„æ–¹æ³•ä¹Ÿå˜æˆå¼‚æ­¥æ›´æ–°äº†ï¼Œæ‰€ä»¥æœ€ç»ˆæ‰“å°å€¼ä¸º 2ï¼Œä¸æœ¬æ–‡ç¬¬ä¸€é“é¢˜ç»“æœä¸€æ ·ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>setState åŒæ­¥å¼‚æ­¥çš„è¡¨ç°ä¼šå› è°ƒç”¨åœºæ™¯çš„ä¸åŒè€Œä¸åŒï¼šåœ¨ React é’©å­å‡½æ•°åŠåˆæˆäº‹ä»¶ä¸­ï¼Œå®ƒè¡¨ç°ä¸ºå¼‚æ­¥ï¼›è€Œåœ¨ setTimeout/setInterval å‡½æ•°ï¼ŒDOM åŸç”Ÿäº‹ä»¶ä¸­ï¼Œå®ƒéƒ½è¡¨ç°ä¸ºåŒæ­¥ã€‚è¿™æ˜¯ç”± React äº‹åŠ¡æœºåˆ¶å’Œæ‰¹é‡æ›´æ–°æœºåˆ¶çš„å·¥ä½œæ–¹å¼æ¥å†³å®šçš„ã€‚</p><p>åœ¨ React16 ä¸­ï¼Œç”±äºå¼•å…¥äº† Fiber æœºåˆ¶ï¼Œæºç å¤šå°‘æœ‰ç‚¹ä¸åŒï¼Œä½†å¤§åŒå°å¼‚ï¼Œä¹‹åæˆ‘ä¹Ÿä¼šå†™ React16 åŸç†çš„æ–‡ç« ï¼Œæ•¬è¯·å…³æ³¨ï¼</p><br><p>æˆ‘è¿‘æœŸä¼šç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼š</p><ul><li><a href="https://github.com/Jacky-Summer/monki-ui" target="_blank" rel="noopener">åŸºäº React + TypeScript + Dumi + Jest + Enzyme å¼€å‘ UI ç»„ä»¶åº“</a></li><li><a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter" target="_blank" rel="noopener">Next.js ä¼ä¸šçº§é¡¹ç›®è„šæ‰‹æ¶æ¨¡æ¿</a></li><li><a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a><br>è§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>setState</tag>
        <tag>äº‹åŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6 ç³»åˆ—ä¹‹ Proxy</title>
    <url>/2021/01/03/ES6-%E7%B3%BB%E5%88%97%E4%B9%8B-Proxy/</url>
    <content><![CDATA[<p>å‰å‡ å¤©æ¨¡æ‹Ÿå®ç°äº† MobX çš„ä¸¤ä¸ªå‡½æ•° â€”â€” <a href="https://github.com/Jacky-Summer/personal-blog/blob/master/React%E7%B3%BB%E5%88%97/%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0MobX%E7%9A%84observable%E5%92%8Cautorun%E6%96%B9%E6%B3%95.md" target="_blank" rel="noopener">æ‰‹å†™å®ç° MobX çš„ observable å’Œ autorun æ–¹æ³•</a>ï¼Œå…¶ä¸­ç”¨åˆ°äº† Proxyï¼Œæ‰€ä»¥æ‰“ç®—å†å¯¹ Proxy æ·±å…¥äº†è§£ä¸€ä¸‹ï¼Œåšä¸ªç¬”è®°ã€‚</p><a id="more"></a><h2 id="Proxy-æ˜¯ä»€ä¹ˆ"><a href="#Proxy-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Proxy æ˜¯ä»€ä¹ˆ"></a>Proxy æ˜¯ä»€ä¹ˆ</h2><p><strong>Proxy</strong> å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚</p><blockquote><p>const p = new Proxy(target, handler)</p></blockquote><ul><li>target: ä½¿ç”¨ Proxy åŒ…è£…çš„ç›®æ ‡å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ JavaScript å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ï¼Œå‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ï¼‰ã€‚</li><li>handler: ä¸€ä¸ªé€šå¸¸ä»¥å‡½æ•°ä½œä¸ºå±æ€§çš„å¯¹è±¡ï¼Œç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºã€‚</li></ul><p>åœ¨æ”¯æŒ Proxy çš„æµè§ˆå™¨ç¯å¢ƒä¸­ï¼ŒProxy æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚<code>Proxy(target, handler)</code>æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œ<code>target</code>æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦-Proxy"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Proxy" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Proxy"></a>ä¸ºä»€ä¹ˆéœ€è¦ Proxy</h2><p>å­¦ä¹ ä¸€æ ·ä¸œè¥¿ä¹‹å‰æˆ‘ä»¬å…ˆè¦æƒ³æƒ³ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œä¸€èˆ¬å‡ ç§æƒ…å†µã€‚</p><ol><li>è¢«ä»£ç†çš„å¯¹è±¡ä¸æƒ³ç›´æ¥è¢«è®¿é—®</li><li>æ§åˆ¶å’Œä¿®æ”¹è¢«ä»£ç†å¯¹è±¡çš„è¡Œä¸ºï¼ˆè°ƒç”¨å±æ€§ã€å±æ€§èµ‹å€¼ã€æ–¹æ³•è°ƒç”¨ç­‰ç­‰ï¼‰ï¼Œä½¿ä¹‹å¯ä»¥è¿›è¡Œè®¿é—®æ§åˆ¶å’Œå¢åŠ åŠŸèƒ½ã€‚</li></ol><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>API æ¦‚è§ˆå¦‚ä¸‹ï¼š</p><ul><li><strong>get(target, propKey, receiver)</strong>ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚ proxy.foo å’Œ proxy[â€˜fooâ€™] ã€‚</li><li><strong>set(target, propKey, value, receiver)</strong>ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚ proxy.foo = v æˆ– proxy[â€˜fooâ€™] = v ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><strong>has(target, propKey)</strong>ï¼šæ‹¦æˆª propKey in proxy çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><strong>deleteProperty(target, propKey)</strong>ï¼šæ‹¦æˆª delete proxy[propKey]çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><strong>ownKeys(target)</strong>ï¼šæ‹¦æˆª Object.getOwnPropertyNames(proxy) ã€ Object.getOwnPropertySymbols(proxy) ã€ Object.keys(proxy) ã€ forâ€¦in å¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€Œ Object.keys() çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚</li><li><strong>getOwnPropertyDescriptor(target, propKey)</strong>ï¼šæ‹¦æˆª Object.getOwnPropertyDescriptor(proxy, propKey) ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚</li><li><strong>defineProperty(target, propKey, propDesc)</strong>ï¼šæ‹¦æˆª Object.defineProperty(proxy, propKey, propDescï¼‰ ã€</li><li><strong>Object.defineProperties(proxy, propDescs)</strong>ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><strong>preventExtensions(target)</strong>ï¼šæ‹¦æˆª Object.preventExtensions(proxy) ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><strong>getPrototypeOf(target)</strong>ï¼šæ‹¦æˆª Object.getPrototypeOf(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ ã€‚</li><li><strong>isExtensible(target)</strong>ï¼šæ‹¦æˆª Object.isExtensible(proxy) ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><strong>setPrototypeOf(target, proto)</strong>ï¼šæ‹¦æˆª Object.setPrototypeOf(proxy, proto) ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ç§é¢å¤–æ“ä½œå¯ä»¥æ‹¦æˆªã€‚</li><li><strong>apply(target, object, args)</strong>ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ proxy(â€¦args)ã€proxy.call(object, â€¦args)ã€proxy.apply(â€¦)`ã€‚</li><li><strong>construct(target, args)</strong>ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ new proxy(â€¦args) ã€‚</li></ul><p>æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯<code>get</code>å’Œ<code>set</code></p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> target = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  sex: <span class="string">'man'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, key) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'è·å–åå­—/æ€§åˆ«'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line"><span class="built_in">console</span>.log(proxy.name)</span><br></pre></td></tr></table></figure><p>è¿è¡Œï¼Œæ‰“å°å°è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è·å–åå­—&#x2F;æ€§åˆ«</span><br><span class="line">jacky</span><br></pre></td></tr></table></figure><p>åœ¨è·å–<code>name</code>å±æ€§æ˜¯å…ˆè¿›å…¥<code>get</code>æ–¹æ³•ï¼Œåœ¨<code>get</code>æ–¹æ³•é‡Œé¢æ‰“å°äº†<code>è·å–åå­—/æ€§åˆ«</code>ï¼Œç„¶åé€šè¿‡<code>Reflect.get(target, key)</code>çš„è¿”å›å€¼æ‹¿åˆ°å±æ€§å€¼ï¼Œç›¸å½“äº<code>target[key]</code></p><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> target = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  sex: <span class="string">'man'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, key) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'è·å–åå­—/æ€§åˆ«'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>(target, key, value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, key, <span class="string">`å¼ºè¡Œè®¾ç½®ä¸º <span class="subst">$&#123;value&#125;</span>`</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line">proxy.name = <span class="string">'monkey'</span></span><br><span class="line"><span class="built_in">console</span>.log(proxy.name)</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è·å–åå­—&#x2F;æ€§åˆ«</span><br><span class="line">å¼ºè¡Œè®¾ç½® monkey</span><br></pre></td></tr></table></figure><p>è®¾ç½®<code>proxy.name = &#39;monkey&#39;</code>ï¼Œè¿™æ˜¯ä¿®æ”¹å±æ€§çš„å€¼ï¼Œåˆ™ä¼šè§¦å‘åˆ°<code>set</code>æ–¹æ³•ï¼Œ ç„¶åæˆ‘ä»¬å¼ºè¡Œæ›´æ”¹è®¾ç½®çš„å€¼å†è¿”å›ï¼Œè¾¾åˆ°æ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®çš„ç›®çš„ã€‚</p><hr><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Reflectå¯¹è±¡ä¸Proxyå¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° APIã€‚</span><br><span class="line">Reflect.get(target, name, receiver) ï¼šæŸ¥æ‰¾å¹¶è¿”å›targetå¯¹è±¡çš„nameå±æ€§ï¼Œå¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™è¿”å›undefinedã€‚</span><br><span class="line">Reflect.set(target, name, value, receiver) ï¼šè®¾ç½®targetå¯¹è±¡çš„nameå±æ€§ç­‰äºvalueã€‚</span><br></pre></td></tr></table></figure><h2 id="this-æŒ‡å‘"><a href="#this-æŒ‡å‘" class="headerlink" title="this æŒ‡å‘"></a>this æŒ‡å‘</h2><p>proxy ä¼šæ”¹å˜ target ä¸­çš„ this æŒ‡å‘ï¼Œä¸€æ—¦ Proxy ä»£ç†äº† targetï¼Œtarget å†…éƒ¨çš„ this åˆ™æŒ‡å‘äº† Proxy ä»£ç†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> target = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2021-01-03'</span>)</span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, prop) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prop === <span class="string">'getDate'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> target.getDate(target)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, prop)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(proxy.getDate())</span><br></pre></td></tr></table></figure><p>è¿è¡Œä»£ç ï¼Œä¼šå‘ç°æŠ¥é”™ï¼Œæç¤º<code>TypeError: proxy.getDate is not a function</code>ï¼Œå³ this ä¸æ˜¯ Date å¯¹è±¡çš„å®ä¾‹ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç»‘å®šåŸå§‹å¯¹è±¡å³å¯è§£å†³ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> target = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2021-01-03'</span>)</span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, prop) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prop === <span class="string">'getDate'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> target.getDate.bind(target) <span class="comment">// ç»‘å®š</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, prop)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(proxy.getDate()) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>è­¦å‘Šæˆ–é˜»æ­¢ç‰¹å®šæ“ä½œ</li><li>get æ–¹æ³•å–ä¸åˆ°å¯¹åº”å€¼å¯ä»¥è¿”å›æˆ‘ä»¬æƒ³æŒ‡å®šçš„å…¶å®ƒå€¼</li><li>æ•°æ®æ ¡éªŒã€‚åˆ¤æ–­æ•°æ®æ˜¯å¦æ»¡è¶³æ¡ä»¶</li></ul><p>ç­‰ç­‰â€¦</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://es6.ruanyifeng.com/#docs/proxy" target="_blank" rel="noopener">https://es6.ruanyifeng.com/#docs/proxy</a></li></ul><br><ul><li>psï¼š<ul><li><a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a></li></ul></li></ul><p>è§‰å¾—ä¸é”™çš„è¯èµä¸ª starï¼Œç»™æˆ‘æŒç»­åˆ›ä½œçš„åŠ¨åŠ›å§ï¼</p>]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™å®ç°MobXçš„observableå’Œautorunæ–¹æ³•</title>
    <url>/2021/01/01/%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0MobX%E7%9A%84observable%E5%92%8Cautorun%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>å­¦äº† MobXï¼Œäº†è§£äº†ç®€å•åŸç†ï¼Œæ•…ç®€å•ç²—ç•¥çš„æ–¹å¼å®ç°ä¸‹</p><a id="more"></a><p>Demo</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable, autorun &#125; <span class="keyword">from</span> <span class="string">'./mobx'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = observable(&#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// autorunæ–¹æ³•è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åæ¯æ¬¡å†…éƒ¨ç›¸å…³çš„observableä¸­çš„ä¾èµ–å‘ç”Ÿå˜åŠ¨æ—¶è¢«å†æ¬¡è°ƒç”¨</span></span><br><span class="line">autorun(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'autorun'</span>, obj.name, obj.age)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.name = <span class="string">'xxx'</span></span><br></pre></td></tr></table></figure><p>å®ç° observable æ–¹æ³•</p><p><code>./mobx/observable.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Reaction <span class="keyword">from</span> <span class="string">'./reaction'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·±å±‚Proxyä»£ç†è¿”å›</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepProxy</span>(<span class="params">val, handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> val !== <span class="string">'object'</span>) <span class="keyword">return</span> val</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> val) &#123;</span><br><span class="line">    <span class="comment">// ä»åå¾€å‰ä¾æ¬¡å®ç°ä»£ç†çš„åŠŸèƒ½ï¼Œç›¸å½“äºæ˜¯ååºéå†</span></span><br><span class="line">    val[key] = deepProxy(val[key], handler)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(val, handler())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObservable</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å£°æ˜ä¸€ä¸ªä¸“é—¨ç”¨æ¥ä»£ç†çš„å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> handler = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> reaction = <span class="keyword">new</span> Reaction()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="keyword">get</span>(target, key) &#123;</span><br><span class="line">        reaction.collect()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>(target, key, value) &#123;</span><br><span class="line">        <span class="comment">// å¯¹äºæ•°ç»„çš„å€¼è®¾ç½®å¤„ç†: å½“å¯¹æ•°ç»„è¿›è¡Œè§‚å¯Ÿç›‘å¬æ—¶ï¼Œç”±äºå¯¹æ•°ç»„çš„æ“ä½œä¼šæœ‰ä¸¤æ­¥æ‰§è¡Œ:</span></span><br><span class="line">        <span class="comment">// æ›´æ–°æ•°ç»„å…ƒç´ å€¼</span></span><br><span class="line">        <span class="comment">// æ›´æ”¹æ•°ç»„çš„lengthå±æ€§ï¼Œæ‰€ä»¥éœ€è¦å°†æ›´æ”¹lengthå±æ€§çš„æ“ä½œç»™æ‹¦æˆªï¼Œé¿å…ä¸€æ¬¡æ“ä½œæ•°ç»„ï¼Œå¤šæ¬¡è§¦å‘handler</span></span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">'length'</span>) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">let</span> r = <span class="built_in">Reflect</span>.set(target, key, value)</span><br><span class="line">        reaction.run()</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> deepProxy(val, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observable</span>(<span class="params">target, key, descriptor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> key === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="comment">// è£…é¥°å™¨å†™æ³•ï¼šå…ˆæŠŠè£…é¥°çš„å¯¹è±¡è¿›è¡Œæ·±åº¦ä»£ç†</span></span><br><span class="line">    <span class="keyword">let</span> v = descriptor.initializer()</span><br><span class="line">    v = createObservable(v)</span><br><span class="line">    <span class="keyword">let</span> reaction = <span class="keyword">new</span> Reaction()</span><br><span class="line">    <span class="comment">// è¿”å›æè¿°å™¨</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      enumerable: <span class="literal">true</span>,</span><br><span class="line">      configurable: <span class="literal">true</span>,</span><br><span class="line">      <span class="keyword">get</span>() &#123;</span><br><span class="line">        reaction.collect()</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>(value) &#123;</span><br><span class="line">        v = value</span><br><span class="line">        reaction.run()</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> createObservable(target) <span class="comment">// ä¸æ˜¯è£…é¥°å™¨å†™æ³•ï¼šå°†ç›®æ ‡å¯¹è±¡è¿›è¡Œä»£ç†æ“ä½œï¼Œåˆ›å»ºæˆå¯æ“ä½œå¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> observable</span><br></pre></td></tr></table></figure><p>autorun æ–¹æ³•</p><p><code>./mobx/autorun.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Reaction <span class="keyword">from</span> <span class="string">'./reaction'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">autorun</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  Reaction.start(handler) <span class="comment">// å…ˆä¿å­˜å‡½æ•°ï¼Œæœé›†ä¾èµ–ï¼Œè®¾ç½®Reactionä¸­çš„nowFn</span></span><br><span class="line">  handler() <span class="comment">// è°ƒç”¨è¯¥æ–¹æ³•ä¼šè§¦å‘ get å±æ€§</span></span><br><span class="line">  Reaction.end() <span class="comment">// æ¸…é™¤nowFn</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> autorun</span><br></pre></td></tr></table></figure><p>Reaction ç±»</p><p><code>./mobx/Reaction.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> nowFn = <span class="literal">null</span> <span class="comment">// è¡¨ç¤ºå½“å‰çš„ autorun ä¸­çš„ handler æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> counter = <span class="number">0</span> <span class="comment">// è®°å½•ä¸€ä¸ªè®¡æ•°å™¨å€¼ä½œä¸ºæ¯ä¸ª observable å±æ€§çš„ id å€¼è¿›è¡Œå’Œ nowFn è¿›è¡Œç»‘å®š</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reaction</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.id = ++counter <span class="comment">// æ¯æ¬¡å¯¹ observable å±æ€§è¿›è¡Œ Proxy çš„æ—¶å€™ï¼Œå¯¹ Proxy è¿›è¡Œæ ‡è®°</span></span><br><span class="line">    <span class="keyword">this</span>.store = &#123;&#125; <span class="comment">// å­˜å‚¨å½“å‰å¯è§‚å¯Ÿå¯¹è±¡çš„nowFn, &#123; id: [nowFn] &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿›è¡Œä¾èµ–æœé›†</span></span><br><span class="line">  collect() &#123;</span><br><span class="line">    <span class="comment">// å½“å‰æœ‰éœ€è¦ç»‘å®šçš„å‡½æ•°æ‰è¿›è¡Œç»‘å®š</span></span><br><span class="line">    <span class="keyword">if</span> (nowFn) &#123;</span><br><span class="line">      <span class="keyword">this</span>.store[<span class="keyword">this</span>.id] = <span class="keyword">this</span>.store[<span class="keyword">this</span>.id] || []</span><br><span class="line">      <span class="keyword">this</span>.store[<span class="keyword">this</span>.id].push(nowFn)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿è¡Œä¾èµ–å‡½æ•°</span></span><br><span class="line">  run() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.store[<span class="keyword">this</span>.id]) &#123;</span><br><span class="line">      <span class="keyword">this</span>.store[<span class="keyword">this</span>.id].forEach(<span class="function"><span class="params">w</span> =&gt;</span> &#123;</span><br><span class="line">        w()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”¨äºåœ¨è°ƒç”¨ autorun æ–¹æ³•æ—¶å€™å¯¹ nowFn è¿›è¡Œè®¾ç½®å’Œæ¶ˆé™¤</span></span><br><span class="line">  <span class="keyword">static</span> start(handler) &#123;</span><br><span class="line">    nowFn = handler</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨æ³¨å†Œç»‘å®šè¿™ä¸ªå°±è¦æ¸…ç©ºå½“å‰çš„ nowFnï¼Œç”¨äºä¹‹åè¿›è¡Œæœé›†ç»‘å®š</span></span><br><span class="line">  <span class="keyword">static</span> end() &#123;</span><br><span class="line">    nowFn = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Reaction</span><br></pre></td></tr></table></figure><p><code>./mobx/index.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> autorun <span class="keyword">from</span> <span class="string">'./autorun'</span></span><br><span class="line"><span class="keyword">import</span> observable <span class="keyword">from</span> <span class="string">'./observable'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; autorun, observable &#125;</span><br></pre></td></tr></table></figure><p>æºç åœ°å€ï¼š<a href="https://github.com/Jacky-Summer/mini-mobx/tree/master" target="_blank" rel="noopener">mini-mobx</a></p>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>MobX</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­å»º Next.js + TS + Antd + Redux + Storybook ä¼ä¸šçº§é¡¹ç›®è„šæ‰‹æ¶</title>
    <url>/2020/12/25/%E6%90%AD%E5%BB%BA-Next-js-TS-Antd-Redux-Storybook-%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%A1%B9%E7%9B%AE%E8%84%9A%E6%89%8B%E6%9E%B6/</url>
    <content><![CDATA[<p>â­ <a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter" target="_blank" rel="noopener">Nextjs-TS-Antd-Redux-Storybook-Jest-Starter</a></p><p>ä¹‹æ‰€ä»¥æœ‰è¯¥é¡¹ç›®å‘¢ï¼Œæ˜¯å› ä¸ºæ—¥å¸¸å¯èƒ½è‡ªå·±éœ€è¦ç»ƒæ‰‹å…¶ä»– Next.js é¡¹ç›®ï¼Œåˆä¸æƒ³æ¯æ¬¡éƒ½é‡æ–°é…ç½®ä¸€éï¼Œä½†åŸºäºå¼ºè¿«ç—‡æ­£å¸¸ä¼ä¸šçº§é¡¹ç›®è¯¥æœ‰çš„é…ç½®è§‰å¾—ä¸èƒ½å°‘äº†ï¼Œäºæ˜¯å°±æƒ³å¼€æä¸€ä¸ªé€šç”¨è„šæ‰‹æ¶æ¨¡æ¿ã€‚</p><a id="more"></a><p>è¯´èµ· Next.jsï¼Œ8 æœˆä»½å†™äº†ä¸€ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6863336367309455373" target="_blank" rel="noopener">æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ NextJsï¼ˆv9.5ï¼‰</a>ï¼Œä¸»è¦æ˜¯å› ä¸ºç½‘ä¸Šå¤§éƒ¨åˆ† Next.js æ˜¯æ—§ç‰ˆæœ¬ v7.x çš„æ•™ç¨‹ï¼Œäºæ˜¯å†™ä¸ªè¾ƒæ–°çš„ 9.5 ç‰ˆï¼Œæ²¡æƒ³åˆ° 10 æœˆå°±å‡ºäº† Next.js 10ï¼Œæªæ‰‹ä¸åŠï¼Œä¸è¿‡æ›´æ–°éƒ¨åˆ†ä¸»è¦æ˜¯å›¾ç‰‡ä¼˜åŒ–ç­‰ï¼Œå¯ä»¥ç…§æ ·çœ‹ã€‚</p><p>è¯¥é¡¹ç›®ä¹Ÿæ˜¯æƒ³æŠŠæ—¥å¸¸å·¥ä½œä¸­æˆ‘è§‰å¾—å®è·µæ¯”è¾ƒå¥½çš„ç‚¹åŠ è¿›æ¥ï¼Œä¹Ÿæ‰“ç®—æ ¹æ®è¯¥é¡¹ç›®æŒç»­è·Ÿè¿›è‰¯å¥½è§„èŒƒå’Œæœ€æ–°åº“ç‰ˆæœ¬ã€‚å½“ç„¶ï¼Œåˆ°å…·ä½“ä¸šåŠ¡åœºæ™¯çš„è¯è„šæ‰‹æ¶è‚¯å®šå¤šå°‘éœ€è¦æ”¹ï¼Œä½†ç›®æ ‡å¸Œæœ›èƒ½é™ä½ä¿®æ”¹çš„æˆæœ¬ï¼Œèµ·ç åŸºæœ¬é…ç½®å¾—æå¥½ã€‚</p><p>è¯¥è„šæ‰‹æ¶ä¸»è¦åº“å’Œç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Next.js 10.x</span><br><span class="line">React 17.x</span><br><span class="line">TypeScript 4.x</span><br><span class="line">Ant Design 4.x</span><br><span class="line">Styled-components 5.x</span><br><span class="line">Storybook 6.x</span><br></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/facf99da9e1645db8b9b33e5cebff0af~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="åˆå§‹åŒ–-Next-js-æ¨¡æ¿"><a href="#åˆå§‹åŒ–-Next-js-æ¨¡æ¿" class="headerlink" title="åˆå§‹åŒ– Next.js æ¨¡æ¿"></a>åˆå§‹åŒ– Next.js æ¨¡æ¿</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npx create-next-app nextjs-ts-redux-antd-starter</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ -TypeScript-æ”¯æŒ"><a href="#æ·»åŠ -TypeScript-æ”¯æŒ" class="headerlink" title="æ·»åŠ  TypeScript æ”¯æŒ"></a>æ·»åŠ  TypeScript æ”¯æŒ</h2><p>æ ¹ç›®å½•ä¸‹æ–°å»º<code>tsconfig.json</code>æ–‡ä»¶ï¼Œæ­¤æ—¶è¿è¡Œ<code>yarn dev</code>ï¼Œä¼šçœ‹åˆ°å®ƒæç¤ºæˆ‘ä»¬å®‰è£…ç±»å‹åº“</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add --dev typescript @types&#x2F;react @types&#x2F;node</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿æŠŠ<code>@types/react-dom</code>ä¹Ÿè£…ä¸Š</p><p>å®‰è£…ä¹‹åï¼Œå†è¿è¡Œ<code>yarn dev</code>, ä¼šåœ¨æ ¹ç›®å½•è‡ªåŠ¨ç”Ÿæˆ<code>next-env.d.ts</code>æ–‡ä»¶ï¼Œä¸”<code>tsconfig.json</code>æœ‰äº†é»˜è®¤é…ç½®ï¼Œè¿™é‡Œæˆ‘å†å¯¹é…ç½®ç¨åŠ æ”¹åŠ¨ã€‚</p><p>å…·ä½“å¯ä»¥å‚è€ƒ TS å®˜ç½‘çœ‹<a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html" target="_blank" rel="noopener">é…ç½®é¡¹</a>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;baseUrl&quot;: &quot;.&quot;,</span><br><span class="line">    &quot;paths&quot;: &#123;</span><br><span class="line">      &quot;src&#x2F;*&quot;: [</span><br><span class="line">        &quot;src&#x2F;*&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;target&quot;: &quot;es5&quot;,</span><br><span class="line">    &quot;module&quot;: &quot;esnext&quot;,</span><br><span class="line">    &quot;strict&quot;: true,</span><br><span class="line">    &quot;allowJs&quot;: true, &#x2F;&#x2F; å…è®¸ç¼–è¯‘jsæ–‡ä»¶</span><br><span class="line">    &quot;jsx&quot;: &quot;preserve&quot;, &#x2F;&#x2F; åœ¨ .tsxæ–‡ä»¶é‡Œæ”¯æŒJSX</span><br><span class="line">    &quot;noEmit&quot;: true, &#x2F;&#x2F; ä¸è¾“å‡ºæ–‡ä»¶</span><br><span class="line">    &quot;lib&quot;: [</span><br><span class="line">      &quot;dom&quot;,</span><br><span class="line">      &quot;dom.iterable&quot;,</span><br><span class="line">      &quot;esnext&quot;</span><br><span class="line">    ], &#x2F;&#x2F; TSéœ€è¦å¼•ç”¨çš„åº“ï¼Œå³å£°æ˜æ–‡ä»¶</span><br><span class="line">    &quot;esModuleInterop&quot;: true, &#x2F;&#x2F; å…è®¸export&#x3D;å¯¼å‡ºï¼Œç”±import fromå¯¼å…¥</span><br><span class="line">    &quot;moduleResolution&quot;: &quot;node&quot;, &#x2F;&#x2F; æ¨¡å—è§£æç­–ç•¥ï¼Œtsé»˜è®¤ç”¨nodeçš„è§£æç­–ç•¥ï¼Œå³ç›¸å¯¹çš„æ–¹å¼å¯¼å…¥</span><br><span class="line">    &quot;allowSyntheticDefaultImports&quot;: true, &#x2F;&#x2F; å…è®¸ä»æ²¡æœ‰è®¾ç½®é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä¸­é»˜è®¤å¯¼å…¥</span><br><span class="line">    &quot;isolatedModules&quot;: true, &#x2F;&#x2F; å°†æ¯ä¸ªæ–‡ä»¶ä½œä¸ºå•ç‹¬çš„æ¨¡å—</span><br><span class="line">    &quot;resolveJsonModule&quot;: true, &#x2F;&#x2F; å…è®¸æŠŠjsonæ–‡ä»¶å½“åšæ¨¡å—è¿›è¡Œè§£æ</span><br><span class="line">    &quot;skipLibCheck&quot;: true, &#x2F;&#x2F; è·³è¿‡æ‰€æœ‰å£°æ˜æ–‡ä»¶çš„ç±»å‹æ£€æŸ¥</span><br><span class="line">    &quot;forceConsistentCasingInFileNames&quot;: true &#x2F;&#x2F; ä¸å…è®¸å¯¹åŒä¸€æ–‡ä»¶ä½¿ç”¨ä¸ä¸€è‡´å¤§å°å†™çš„å¼•ç”¨</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;include&quot;: [</span><br><span class="line">    &quot;next-env.d.ts&quot;,</span><br><span class="line">    &quot;**&#x2F;*.ts&quot;,</span><br><span class="line">    &quot;**&#x2F;*.tsx&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;exclude&quot;: [</span><br><span class="line">    &quot;node_modules&quot;,</span><br><span class="line">    &quot;.next&quot;,</span><br><span class="line">    &quot;dist&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ¸…é™¤å¹²å‡€ç›®å½•ï¼ŒæŠŠ<code>styles</code>, <code>pages</code>åªç•™ä¸‹ä¸€ä¸ª<code>index.js</code>å³å¯ï¼Œ å¹¶å°†<code>index.js</code>é‡å‘½åä¸º<code>index.tsx</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NextPage &#125; <span class="keyword">from</span> <span class="string">'next'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home: NextPage = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello nextjs-ts-redux-antd-starter<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure><h2 id="EditorConfig"><a href="#EditorConfig" class="headerlink" title="EditorConfig"></a>EditorConfig</h2><p>ä½œä¸ºé¡¹ç›®ä»£ç é£æ ¼çš„ç»Ÿä¸€è§„èŒƒï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹å·¥å…·æ¥å¼ºåˆ¶</p><p><code>.editorconfig</code> æ˜¯è·¨ç¼–è¾‘å™¨ç»´æŠ¤ä¸€è‡´ç¼–ç é£æ ¼çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ VSCode ä¸­éœ€è¦å®‰è£…ç›¸åº”æ’ä»¶ EditorConfig for VS Codeï¼Œå®‰è£…å®Œæ¯•ä¹‹åï¼Œ å¯ä»¥é€šè¿‡è¾“å…¥ <code>Generate .editorcofig</code> å³å¯å¿«é€Ÿç”Ÿæˆ <code>.editorconfig</code> æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ–°å»ºæ–‡ä»¶ã€‚</p><p>åœ¨<code>.editorcofig</code>æ–‡ä»¶ï¼Œå°±å¯ä»¥å¤§å®¶æ ¹æ®ä¸åŒæ¥è®¾ç½®æ–‡ä»¶äº†ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># http:&#x2F;&#x2F;editorconfig.org</span><br><span class="line">root &#x3D; true</span><br><span class="line"></span><br><span class="line">[*]</span><br><span class="line">indent_style &#x3D; space</span><br><span class="line">indent_size &#x3D; 2</span><br><span class="line">end_of_line &#x3D; lf</span><br><span class="line">charset &#x3D; utf-8</span><br><span class="line">trim_trailing_whitespace &#x3D; true</span><br><span class="line">insert_final_newline &#x3D; true</span><br><span class="line"></span><br><span class="line">[*.md]</span><br><span class="line">trim_trailing_whitespace &#x3D; false</span><br><span class="line"></span><br><span class="line">[Makefile]</span><br><span class="line">indent_style &#x3D; tab</span><br></pre></td></tr></table></figure><h2 id="Prettier"><a href="#Prettier" class="headerlink" title="Prettier"></a>Prettier</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add prettier -D</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿéœ€è¦å®‰è£… VSCode æ’ä»¶<code>Prettier - Code formatter</code></p><p>æ–°å»ºæ–‡ä»¶<code>.prettierrc</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;singleQuote&quot;: true,</span><br><span class="line">  &quot;tabWidth&quot;: 2,</span><br><span class="line">  &quot;endOfLine&quot;: &quot;lf&quot;,</span><br><span class="line">  &quot;trailingComma&quot;: &quot;all&quot;,</span><br><span class="line">  &quot;printWidth&quot;: 100,</span><br><span class="line">  &quot;arrowParens&quot;: &quot;avoid&quot;,</span><br><span class="line">  &quot;semi&quot;: false,</span><br><span class="line">  &quot;bracketSpacing&quot;: true,</span><br><span class="line">  &quot;overrides&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;files&quot;: &quot;.prettierrc&quot;,</span><br><span class="line">      &quot;options&quot;: &#123; &quot;parser&quot;: &quot;json&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ·»åŠ å¿½ç•¥æ–‡ä»¶<code>.prettierignore</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">**&#x2F;*.png</span><br><span class="line">**&#x2F;*.svg</span><br><span class="line">**&#x2F;*.ico</span><br><span class="line">package.json</span><br><span class="line">lib&#x2F;</span><br><span class="line">es&#x2F;</span><br><span class="line">dist&#x2F;</span><br><span class="line">.next&#x2F;</span><br><span class="line">coverage&#x2F;</span><br><span class="line">LICENSE</span><br><span class="line">yarn.lock</span><br><span class="line">yarn-error.log</span><br><span class="line">*.sh</span><br><span class="line">.gitignore</span><br><span class="line">.npmignore</span><br><span class="line">.prettierignore</span><br><span class="line">.DS_Store</span><br><span class="line">.editorconfig</span><br><span class="line">.eslintignore</span><br><span class="line">**&#x2F;*.yml</span><br></pre></td></tr></table></figure><h2 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add eslint -D</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œåè¿è¡Œ <code>npx eslint --init</code>ï¼Œè¿è¡Œåæœ‰é€‰é¡¹ï¼Œé€‰æ‹©å¦‚ä¸‹ï¼ˆè‡ªè¡Œæ ¹æ®éœ€è¦ï¼‰ï¼š</p><ul><li>To check syntax, find problems, and enforce code style</li><li>JavaScript modules (import/export)</li><li>React</li><li>TypeScript Yes</li><li>Browser Node</li><li>Use a popular style guide</li><li>Airbnb: <a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">https://github.com/airbnb/javascript</a></li><li>JavaScript</li><li>Would you like to install them now with npm (Yes)</li></ul><p>npm å®‰è£…åä¼šå‡ºç°<code>package-lock.json</code>ï¼Œå¦‚æœä½ é»˜è®¤æƒ³ç”¨<code>yarn.lock</code>ï¼Œä¸ºäº†é¿å…å†²çªå°±åˆ æ‰å®ƒã€‚</p><p>å®‰è£…è‡ªåŠ¨ç”Ÿæˆ<code>.eslintrc</code>æ–‡ä»¶ï¼Œè¿˜æ²¡å®Œï¼Œä¸ºäº†å†™å‡ºæ¥çš„ä»£ç æ›´å¥½æ›´ç¬¦åˆç¤¾åŒºè§„èŒƒï¼Œæˆ‘ä»¬å†åŠ ä¸€äº›ä¸é”™çš„ eslint æ’ä»¶</p><ul><li><code>eslint-plugin-unicorn</code>ï¼šæä¾›äº†å¾ªç¯ä¾èµ–æ£€æµ‹ï¼Œæ–‡ä»¶åå¤§å°å†™é£æ ¼çº¦æŸç­‰éå¸¸å®ç”¨çš„è§„åˆ™é›†åˆã€‚</li><li><code>eslint-config-prettier</code>ï¼šeslint å’Œ prettier æ··åˆä½¿ç”¨æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹è§„åˆ™ï¼Œä»¥é˜²æ­¢é‡å¤æˆ–å†²çªï¼›è¯¥æ’ä»¶å³ä¸ºè§£å†³æ­¤é—®é¢˜çš„å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå…³é—­æ‰€æœ‰å¯èƒ½å¼•èµ·å†²çªçš„è§„åˆ™ã€‚</li><li><code>eslint-plugin-import</code>ï¼šèƒ½å¤Ÿæ­£ç¡®è§£æ <code>.tsx, .ts, .js, .json</code> åç¼€åï¼ˆè¿˜éœ€æŒ‡å®šå…è®¸çš„åç¼€åï¼Œæ·»åŠ åˆ° setttings å­—æ®µï¼‰</li><li><code>eslint-import-resolver-alias</code>: eslint èƒ½è¯†åˆ« alias åˆ«åè‡ªå®šä¹‰è·¯å¾„</li><li><code>eslint-import-resolver-typescript</code>ï¼šè®© <code>eslint-plugin-import</code> èƒ½å¤Ÿæ­£ç¡®è§£æ <code>tsconfig.json</code> ä¸­çš„ <code>paths</code> æ˜ å°„ï¼Œéœ€è¦å®‰è£…å®ƒã€‚</li></ul><p>æˆ‘çš„é…ç½®å¦‚ä¸‹ï¼Œ<code>rules</code>å¿½ç•¥è§„åˆ™è‡ªå·±æ·»åŠ å› äººè€Œå¼‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    es2021: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="string">'airbnb'</span>,</span><br><span class="line">    <span class="string">'plugin:react/recommended'</span>,</span><br><span class="line">    <span class="string">'plugin:import/typescript'</span>,</span><br><span class="line">    <span class="string">'plugin:@typescript-eslint/recommended'</span>,</span><br><span class="line">    <span class="string">'prettier/react'</span>,</span><br><span class="line">  ],</span><br><span class="line">  settings: &#123;</span><br><span class="line">    <span class="string">'import/resolver'</span>: &#123;</span><br><span class="line">      node: &#123;</span><br><span class="line">        extensions: [<span class="string">'.tsx'</span>, <span class="string">'.ts'</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      alias: [[<span class="string">'src'</span>, <span class="string">'./src'</span>]],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  parser: <span class="string">'@typescript-eslint/parser'</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaFeatures: &#123;</span><br><span class="line">      jsx: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    ecmaVersion: <span class="number">12</span>,</span><br><span class="line">    sourceType: <span class="string">'module'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="string">'react'</span>, <span class="string">'@typescript-eslint'</span>, <span class="string">'react-hooks'</span>, <span class="string">'unicorn'</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    semi: <span class="number">0</span>,</span><br><span class="line">    indent: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'react/jsx-filename-extension'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'react/prop-types'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'react/jsx-props-no-spreading'</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'jsx-a11y/click-events-have-key-events'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'jsx-a11y/no-static-element-interactions'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'jsx-a11y/no-noninteractive-element-interactions'</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'no-use-before-define'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'no-unused-vars'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'implicit-arrow-linebreak'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'consistent-return'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'arrow-parens'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'object-curly-newline'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'operator-linebreak'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'import/no-extraneous-dependencies'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'import/extensions'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'import/no-unresolved'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'import/prefer-default-export'</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶<code>.eslintignore</code>ï¼Œå¿½ç•¥ä¸€äº›æ–‡ä»¶çš„æ£€æŸ¥</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;node_modules</span><br><span class="line">&#x2F;public</span><br><span class="line">&#x2F;dist</span><br><span class="line">&#x2F;.next</span><br><span class="line">&#x2F;coverage</span><br></pre></td></tr></table></figure><h2 id="StyleLint"><a href="#StyleLint" class="headerlink" title="StyleLint"></a>StyleLint</h2><h3 id="sass-less-css"><a href="#sass-less-css" class="headerlink" title="sass/less/css"></a>sass/less/css</h3><ul><li><code>eslint-config-prettier</code>: åˆ©ç”¨æ’ä»¶ç¦ç”¨ä¸ Prettier èµ·å†²çªçš„è§„åˆ™</li><li><code>stylelint-config-rational-order</code>: å¯¹å…³è”å±æ€§è¿›è¡Œåˆ†ç»„å’Œæ’åº</li><li><code>stylelint-declaration-block-no-ignored-properties</code>: çŸ›ç›¾æ ·å¼å¿½ç•¥</li><li><code>stylelint-order</code>ï¼šå¼ºåˆ¶ä½ æŒ‰ç…§æŸä¸ªé¡ºåºç¼–å†™ css</li></ul><p>.stylelintrc</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  extends: [</span><br><span class="line">    &#39;stylelint-config-standard&#39;,</span><br><span class="line">    &#39;stylelint-config-rational-order&#39;,</span><br><span class="line">    &#39;stylelint-config-prettier&#39;,</span><br><span class="line">  ],</span><br><span class="line">  plugins: [&#39;stylelint-order&#39;, &#39;stylelint-declaration-block-no-ignored-properties&#39;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="styled-components"><a href="#styled-components" class="headerlink" title="styled-components"></a>styled-components</h3><p>ä»¥ä¸Šæ˜¯ä½¿ç”¨ sass æˆ– less å¯ä»¥å®Œå…¨ç…§æ¬é…ç½®çš„ï¼Œè‡³äºè¯¥è„šæ‰‹æ¶æˆ‘å†³å®šé‡‡ç”¨çš„ CSS æ–¹æ¡ˆä¸º<code>styled-components</code>ï¼Œstylelint é…ç½® styled-components ç›®å‰æœ‰å…³åº“å°šæœªå®ç°è‡ªåŠ¨ä¿®å¤ï¼Œæ‰€ä»¥<code>--fix</code>ç›®å‰æ˜¯æ— æ•ˆçš„ï¼Œä¸”éœ€è¦å®‰è£…å¦å¤–çš„ stylelint è§„åˆ™æ’ä»¶</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add styled-components</span><br><span class="line">yarn add -D @types&#x2F;styled-components stylelint-processor-styled-components stylelint-config-styled-components</span><br></pre></td></tr></table></figure><p>.stylelintrc</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;processors&quot;: [</span><br><span class="line">    &quot;stylelint-processor-styled-components&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    &quot;stylelint-order&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;extends&quot;: [</span><br><span class="line">    &quot;stylelint-config-standard&quot;,</span><br><span class="line">    &quot;stylelint-config-styled-components&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ–°å»ºæ–‡ä»¶<code>babel.config.js</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [&quot;next&#x2F;babel&quot;],</span><br><span class="line">  &quot;plugins&quot;: [[&quot;styled-components&quot;, &#123; &quot;ssr&quot;: true &#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åˆ†<code>development</code>,<code>test</code>,<code>production</code>,å¯¹ styled-components è¿›è¡ŒåŒºåˆ†è®¾ç½®ï¼Œæ¯”å¦‚<a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter/blob/master/babel.config.js" target="_blank" rel="noopener">babel.config.js</a></p><p>æ–°å»ºæ–‡ä»¶<code>pages/_document.tsx</code>ï¼Œæ¥è‡ªå®šä¹‰ Document çš„æ–¹å¼æ¥æ”¹å†™ä»£ç ã€‚å®ƒåªæœ‰åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™æ‰ä¼šè¢«è°ƒç”¨ï¼Œä¸»è¦ç”¨æ¥ä¿®æ”¹æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ–‡æ¡£å†…å®¹ï¼Œä¸€èˆ¬ç”¨æ¥é…åˆç¬¬ä¸‰æ–¹ css-in-js æ–¹æ¡ˆä½¿ç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React from &#39;react&#39;</span><br><span class="line">import Document, &#123; DocumentContext &#125; from &#39;next&#x2F;document&#39;</span><br><span class="line">import &#123; ServerStyleSheet &#125; from &#39;styled-components&#39;</span><br><span class="line"></span><br><span class="line">class MyDocument extends Document &#123;</span><br><span class="line">  static async getInitialProps(ctx: DocumentContext) &#123;</span><br><span class="line">    const sheet &#x3D; new ServerStyleSheet()</span><br><span class="line">    const originalRenderPage &#x3D; ctx.renderPage</span><br><span class="line">    try &#123;</span><br><span class="line">      const initialProps &#x3D; await Document.getInitialProps(ctx)</span><br><span class="line"></span><br><span class="line">      ctx.renderPage &#x3D; () &#x3D;&gt;</span><br><span class="line">        originalRenderPage(&#123;</span><br><span class="line">          enhanceApp: App &#x3D;&gt; props &#x3D;&gt; sheet.collectStyles(&lt;App &#123;...props&#125; &#x2F;&gt;),</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      return &#123;</span><br><span class="line">        ...initialProps,</span><br><span class="line">        styles: (</span><br><span class="line">          &lt;&gt;</span><br><span class="line">            &#123;initialProps.styles&#125;</span><br><span class="line">            &#123;sheet.getStyleElement()&#125;</span><br><span class="line">          &lt;&#x2F;&gt;</span><br><span class="line">        ),</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">      sheet.seal()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default MyDocument</span><br></pre></td></tr></table></figure><h2 id="vscode"><a href="#vscode" class="headerlink" title=".vscode"></a>.vscode</h2><p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹<code>.vscode</code>ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶ settings.json,è¯¥æ–‡ä»¶çš„é…ç½®ä¼˜å…ˆäºä½ è‡ªå·± VSCode å…¨å±€çš„é…ç½®ï¼Œä¸ä¼šå› ä¸ºå›¢é˜Ÿä¸åŒæˆå‘˜çš„ VSCode å…¨å±€é…ç½®ä¸åŒè€Œå¯¼è‡´æ ¼å¼åŒ–ä¸åŒã€‚</p><p><code>settings.json</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;search.exclude&quot;: &#123;</span><br><span class="line">    &quot;**&#x2F;node_modules&quot;: true,</span><br><span class="line">    &quot;dist&quot;: true,</span><br><span class="line">    &quot;.next&quot;: true,</span><br><span class="line">    &quot;yarn.lock&quot;: true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;editor.formatOnSave&quot;: true,</span><br><span class="line">  &quot;editor.tabSize&quot;: 2,</span><br><span class="line">  &quot;eslint.validate&quot;: [&quot;javascript&quot;, &quot;javascriptreact&quot;, &quot;typescript&quot;, &quot;typescriptreact&quot;],</span><br><span class="line">  &quot;editor.codeActionsOnSave&quot;: &#123;</span><br><span class="line">    &quot;source.fixAll.eslint&quot;: true,</span><br><span class="line">    &quot;source.fixAll.stylelint&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="husky-ä¸-lint-staged"><a href="#husky-ä¸-lint-staged" class="headerlink" title="husky ä¸ lint-staged"></a>husky ä¸ lint-staged</h2><p>æ¯æ¬¡æäº¤ä»£ç éƒ½è¦å¯¹ä»£ç å…ˆè¿›è¡Œ lint å’Œæ ¼å¼åŒ–ï¼Œç¡®ä¿ä»£ç é£æ ¼ç»Ÿä¸€ã€‚äºæ˜¯æˆ‘ä»¬å®‰è£…<code>husky</code>æ¥è§£å†³è¿™ä¸ªäº‹æƒ…ï¼Œå¯æˆ‘ä»¬æƒ³æ¯æ¬¡ lint æ ¼å¼åŒ–çš„æ—¶å€™ï¼Œåªå¤„ç†æˆ‘ä»¬ä¿®æ”¹çš„ä»£ç ï¼ˆæš‚å­˜åŒºï¼‰ï¼Œå¯ä»¥é€‰æ‹©<code>lint-staged</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add -D husky lint-staged</span><br></pre></td></tr></table></figure><p>åœ¨<code>package.json</code>é…ç½® git commit é’©å­æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;husky&quot;: &#123;</span><br><span class="line">   &quot;hooks&quot;: &#123;</span><br><span class="line">     &quot;commit-msg&quot;: &quot;commitlint --config .commitlintrc.js -E HUSKY_GIT_PARAMS&quot;,</span><br><span class="line">     &quot;pre-commit&quot;: &quot;lint-staged &amp;&amp; yarn tsc&quot;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;lint-staged&quot;: &#123;</span><br><span class="line">   &quot;*.&#123;tsx,ts,js,jsx&#125;&quot;: [</span><br><span class="line">     &quot;stylelint&quot;,</span><br><span class="line">     &quot;prettier --write&quot;,</span><br><span class="line">     &quot;eslint --fix&quot;</span><br><span class="line">   ],</span><br><span class="line">   &quot;*.&#123;css,less,scss&#125;&quot;: [</span><br><span class="line">     &quot;stylelint&quot;,</span><br><span class="line">     &quot;prettier --write&quot;</span><br><span class="line">   ],</span><br><span class="line">   &quot;*.&#123;md,json,yaml,yml&#125;&quot;: [</span><br><span class="line">     &quot;prettier --write&quot;</span><br><span class="line">   ]</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><p><code>prettier --write</code>ä¸­çš„<code>--write</code>è¡¨ç¤ºå°†æ ¼å¼åŒ–åçš„ä»£ç å†™åˆ°æºæ–‡ä»¶ï¼Œä¸åŠ çš„è¯ä¼šè¾“å‡ºæ–‡ä»¶ã€‚</p><p>ä¸Šé¢<code>&quot;pre-commit&quot;: &quot;lint-staged &amp;&amp; yarn tsc&quot;</code>æˆ‘è¿˜åŠ äº†<code>yarn tsc</code>ï¼Œts æ£€æŸ¥ç±»å‹æœ‰é—®é¢˜ï¼Œé‚£å½“ç„¶ä¸ç»™ä½ æäº¤ï¼ŒåŠæ—©å‘ç°é”™è¯¯ã€‚</p><p>å¦å¤–éœ€ä¸éœ€è¦å¼ºåˆ¶<code>--fix</code>çœ‹ä¸ªäººï¼Œå› ä¸ºæœ‰äººä¼šé¡¾è™‘å¼ºåˆ¶çš„è¯ç›¸å½“äºé»‘ç›’ï¼Œä½ ä¸çŸ¥é“å®ƒå¯¹ä½ ä»£ç åšäº†ä»€ä¹ˆã€‚</p><h2 id="commitlint"><a href="#commitlint" class="headerlink" title="commitlint"></a>commitlint</h2><p>æˆ‘ä»¬æäº¤çš„å‰æ–‡ä»¶å·²ç»ä¼šè‡ªåŠ¨æ ¼å¼åŒ–äº†ï¼Œæ¥ä¸‹æ¥è¦ææ commit æäº¤è§„èŒƒé—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add @commitlint&#x2F;cli @commitlint&#x2F;config-conventional -D</span><br></pre></td></tr></table></figure><p>é»˜è®¤ç±»å‹ git commit ç±»å‹æœ‰å¦‚ä¸‹å‡ ç§ï¼Œè¿™æ˜¯ angular é£æ ¼çš„ commitlint é…ç½®ï¼Œæˆ‘è‡ªå·±å¹³æ—¶ä¹ æƒ¯è¿™ä¸€å¥—è§„åˆ™ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  &#39;build&#39;,</span><br><span class="line">  &#39;ci&#39;,</span><br><span class="line">  &#39;chore&#39;,</span><br><span class="line">  &#39;docs&#39;,</span><br><span class="line">  &#39;feat&#39;,</span><br><span class="line">  &#39;fix&#39;,</span><br><span class="line">  &#39;perf&#39;,</span><br><span class="line">  &#39;refactor&#39;,</span><br><span class="line">  &#39;revert&#39;,</span><br><span class="line">  &#39;style&#39;,</span><br><span class="line">  &#39;test&#39;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•æ–°å»º<code>.commitlintrc.js</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  extends: [&#39;@commitlint&#x2F;config-conventional&#39;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£å¦‚æœå›¢é˜Ÿåˆšæ¥çš„äººæ²¡ç”¨è¿‡ä¹Ÿè®°ä¸ä½ä¸Šé¢é‚£äº›å¼€å¤´å•è¯æ€ä¹ˆåŠï¼Œäºæ˜¯æˆ‘ä»¬å¼„ä¸ªå‘½ä»¤å¯ä»¥è®©ä»–è‡ªå·±é€‰æ‹©ï¼Œå®‰è£…æ’ä»¶</p><ul><li><code>cz-conventional-changelog</code>ï¼šæ˜¯ä¸€ä¸ªé€‚é…å™¨ï¼Œä¸€ä¸ªç¬¦åˆ Angular å›¢é˜Ÿè§„èŒƒçš„ preset</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add cz-conventional-changelog -D</span><br></pre></td></tr></table></figure><p>åœ¨<code>package.json</code>ä¸­é…ç½®</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">        &quot;commit&quot;: &quot;git-cz&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;config&quot;: &#123;</span><br><span class="line">        &quot;commitizen&quot;: &#123;</span><br><span class="line">          &quot;path&quot;: &quot;node_modules&#x2F;cz-conventional-changelog&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>yarn commit</code>ï¼Œå³å‡ºç°è¯¥é¡µé¢ï¼Œä¾›æˆ‘ä»¬é€‰æ‹©</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34ecb85ac98b4bf6b17c7fda0edfb659~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>åŸºæœ¬é¡¹ç›®è§„èŒƒé…ç½®å°±å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥æ˜¯åšé¡¹ç›®çš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©äº†æœ€ç»å…¸çš„ Reduxï¼Œå¼‚æ­¥å¤„ç†é€‰æ‹©<code>redux-saga</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add redux react-redux redux-saga</span><br><span class="line">yarn add -D @types&#x2F;react-redux @types&#x2F;redux-saga redux-devtools-extension next-redux-wrapper</span><br></pre></td></tr></table></figure><p>ç¤¾åŒºè¿˜æœ‰å…¶ä»– redux ç®€åŒ–æ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨ <a href="https://github.com/redux-utilities/redux-actions" target="_blank" rel="noopener">redux-actions</a>,ä½†è¯¥é¡¹ç›®ç»´æŠ¤ä¼¼ä¹å‡ºç°å›°éš¾ï¼Œå°±ä¸åŠ å…¥ä½¿ç”¨äº†ï¼›è¿˜æœ‰ dva ç­‰ç­‰æˆ–è€…é‡‡ç”¨å…¶ä»–çŠ¶æ€ç®¡ç†åº“ä¾‹å¦‚ mobxï¼Œå„ä½å¯ä»¥è‡ªè¡Œè€ƒè™‘æ›¿æ¢ï¼Œè¿™é‡Œåªæ˜¯ç»™ä¸ªå¸¸ç”¨æ–¹æ¡ˆã€‚</p><p><code>src/redux/index.ts</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createWrapper, MakeStore &#125; <span class="keyword">from</span> <span class="string">'next-redux-wrapper'</span></span><br><span class="line"><span class="keyword">import</span> &#123; applyMiddleware, createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">'redux-saga'</span></span><br><span class="line"><span class="keyword">import</span> &#123; composeWithDevTools &#125; <span class="keyword">from</span> <span class="string">'redux-devtools-extension/developmentOnly'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'src/redux/rootReducers'</span></span><br><span class="line"><span class="keyword">import</span> rootSaga <span class="keyword">from</span> <span class="string">'src/redux/rootSagas'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> makeStore: MakeStore&lt;Store.RootState&gt; = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> sagaMiddleware = createSagaMiddleware()</span><br><span class="line">  <span class="keyword">const</span> store = createStore(rootReducer, composeWithDevTools(applyMiddleware(sagaMiddleware)))</span><br><span class="line">  sagaMiddleware.run(rootSaga)</span><br><span class="line">  <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> wrapper = createWrapper &lt; Store.RootState &gt; makeStore</span><br></pre></td></tr></table></figure><p>å†æ–°å»ºæ–‡ä»¶<code>pages/_app.tsx</code>å¼•å…¥ reduxï¼Œè¦†ç›– Next.js é»˜è®¤çš„ App</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; AppProps &#125; <span class="keyword">from</span> <span class="string">'next/app'</span></span><br><span class="line"><span class="keyword">import</span> &#123; wrapper &#125; <span class="keyword">from</span> <span class="string">'src/redux'</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'src/components/Layout'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WrappedApp: FC&lt;AppProps&gt; = <span class="function">(<span class="params">&#123; Component, pageProps &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;Component &#123;...pageProps&#125; /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default wrapper.withRedux(WrappedApp)</span></span><br></pre></td></tr></table></figure><p>å…¶ä»–ä»£ç åŠä¾‹å­æ¼”ç¤ºè¯·çœ‹<a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-starter/tree/master/src/redux" target="_blank" rel="noopener">æºä»£ç </a></p><p>redux çš„é¡¹ç›®ç»“æ„æœ‰å‡ ç§ï¼Œå“ªç§å¥½è§†ä¹é¡¹ç›®å¤§å°å’Œå¤æ‚ç¨‹åº¦é€‰æ‹©ï¼Œè¯¥è„šæ‰‹æ¶åªæ˜¯å±•ç¤ºä¸€ç§ï¼ŒæŒ‰æ¨¡å—æ¥åˆ’åˆ† redux æ•°æ®ç»“æ„ï¼Œå¹¶ä¸æ˜¯è¯´æ­¤ç§æ–¹å¼æœ‰å¤šå¥½ï¼Œå…·ä½“è¿˜æ˜¯ä¾æ®é¡¹ç›®æ¥è°ƒæ•´ç›®å½•ç»“æ„ã€‚</p><p>æˆ‘åšä¸ªå° demo æ˜¯ saga è¯·æ±‚ç”¨æˆ·æ•°æ®ï¼Œè¿”å›å¹¶å±•ç¤ºåœ¨é¡µé¢ä¸Šï¼Œå…³äº redux <code>State</code>çš„ç±»å‹å®šä¹‰ï¼Œæˆ‘æ”¾åœ¨äº†æ ¹ç›®å½•<code>types</code>æ–‡ä»¶å¤¹é‡Œã€‚</p><p>å½“ç„¶è¿™ä¹Ÿåªæ˜¯ä¸€ç§å‚ç…§æ–¹å¼ï¼Œä¹Ÿå¯ä»¥åœ¨ redux ç›®å½•æ¨¡å—é‡Œæ–°å»º<code>types</code>æ–‡ä»¶æ”¾ç½®<code>State</code>ç±»å‹å®šä¹‰ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50d165eeeda34712885de2c32c6e5a6a~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="Ant-Desgin-æ”¯æŒ"><a href="#Ant-Desgin-æ”¯æŒ" class="headerlink" title="Ant Desgin æ”¯æŒ"></a>Ant Desgin æ”¯æŒ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add antd</span><br><span class="line">yarn add -D babel-plugin-import</span><br></pre></td></tr></table></figure><p><code>babel.config.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">'import'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        libraryName: <span class="string">'antd'</span>,</span><br><span class="line">        libraryDirectory: <span class="string">'lib'</span>,</span><br><span class="line">        style: <span class="string">'index.css'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>src/_app.tsx</code>ä¸­å¼•å…¥ antd æ ·å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#39;antd&#x2F;dist&#x2F;antd.css&#39;</span><br></pre></td></tr></table></figure><h2 id="Travis-è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#Travis-è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="Travis è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>Travis è‡ªåŠ¨åŒ–éƒ¨ç½²</h2><p>é»˜è®¤å…ˆè¿™æ ·è®¾ç½®äº†ï¼ˆåé¢åŠ äº† Jest åå†åŠ å…¥è„šæœ¬<code>yarn test</code>ï¼‰ã€‚ä¸è§£é‡Šï¼Œä¸æ‡‚çš„çœ‹æˆ‘è¿™ç¯‡æ–‡ç«  <a href="https://juejin.cn/post/6895508265304915982" target="_blank" rel="noopener">æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ Travis è‡ªåŠ¨åŒ–éƒ¨ç½²</a></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">language: node_js</span><br><span class="line"></span><br><span class="line">node_js:</span><br><span class="line">  - &quot;stable&quot;</span><br><span class="line"></span><br><span class="line">cache: yarn</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">  - yarn</span><br><span class="line">script:</span><br><span class="line">  - yarn build</span><br></pre></td></tr></table></figure><h2 id="Storybook-æ­å»ºç»„ä»¶æ–‡æ¡£"><a href="#Storybook-æ­å»ºç»„ä»¶æ–‡æ¡£" class="headerlink" title="Storybook æ­å»ºç»„ä»¶æ–‡æ¡£"></a>Storybook æ­å»ºç»„ä»¶æ–‡æ¡£</h2><blockquote><p>Storybook æ˜¯åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸åº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œçš„. å®ƒå¯ä»¥å¸®åŠ©æ‚¨æ„å»º UI ç»„ä»¶,å¹¶ä¸åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘å’Œä¸Šä¸‹æ–‡éš”ç¦»å¼€æ¥</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npx -p @storybook&#x2F;cli sb init</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæ¯•ï¼Œè¿è¡Œå³å¼€å¯</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn storybook</span><br></pre></td></tr></table></figure><p>ç„¶åä¼šæœ‰åˆå§‹ä¸€äº›ç»„ä»¶ä¾‹å­ï¼Œçœ‹çœ‹å°±å¯ä»¥åˆ äº†ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53fa250176a84173a05177a461176da9~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p><a href="https://storybook.js.org/docs/react/writing-stories/introduction" target="_blank" rel="noopener">How to write stories</a> é€šè¿‡ç»™ç»„ä»¶å†™ storiesï¼Œå¯ä»¥è®©æˆ‘ä»¬å¯¹æ•´ä¸ªé¡¹ç›®ç”¨åˆ°çš„ç»„ä»¶æœ‰å¤§è‡´äº†è§£ï¼Œæ¯”å¦‚é•¿ä»€ä¹ˆæ ·ç­‰ç­‰ï¼Œè¿˜æœ‰åŒ…æ‹¬æ˜¯å¦ UI æ”¹å˜ï¼Œä¸‹é¢ä¼šå†™ã€‚</p><h2 id="å›½é™…åŒ–"><a href="#å›½é™…åŒ–" class="headerlink" title="å›½é™…åŒ–"></a>å›½é™…åŒ–</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add react-i18next i18next</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <a href="https://github.com/isaachinman/next-i18next" target="_blank" rel="noopener">next-i18next</a></p><p><code>src/i18n/index.ts</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> i18n <span class="keyword">from</span> <span class="string">'i18next'</span></span><br><span class="line"><span class="keyword">import</span> &#123; initReactI18next &#125; <span class="keyword">from</span> <span class="string">'react-i18next'</span></span><br><span class="line"><span class="keyword">import</span> zhCN <span class="keyword">from</span> <span class="string">'./locales/zh_CN.json'</span></span><br><span class="line"><span class="keyword">import</span> enUS <span class="keyword">from</span> <span class="string">'./locales/en_US.json'</span></span><br><span class="line"></span><br><span class="line">i18n.use(initReactI18next).init(&#123;</span><br><span class="line">  lng: <span class="string">'zh_CN'</span>,</span><br><span class="line">  fallbackLng: <span class="string">'zh_CN'</span>,</span><br><span class="line">  resources: &#123;</span><br><span class="line">    zh_CN: &#123;</span><br><span class="line">      translation: zhCN,</span><br><span class="line">    &#125;,</span><br><span class="line">    en_US: &#123;</span><br><span class="line">      translation: enUS,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  debug: <span class="literal">false</span>,</span><br><span class="line">  interpolation: &#123;</span><br><span class="line">    escapeValue: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> i18n</span><br></pre></td></tr></table></figure><p>å…·ä½“è¿˜æ˜¯ç›´æ¥çœ‹ä»£ç äº†ï¼Œè¿™é‡Œå°±ä»‹ç»è¿™ä¹ˆå¤šï¼›ç„¶åå°±å¯ä»¥åˆ‡æ¢è¯­è¨€ï¼ŒæŠŠé¡¹ç›®ç”¨åˆ°çš„ä¸€äº›è¯è¯­å¥å­éƒ½é›†ä¸­åˆ°<code>zh_CN.json</code>å’Œ<code>en_US.json</code>ç­‰ç­‰å†™ã€‚</p><h2 id="Jest-å•å…ƒæµ‹è¯•"><a href="#Jest-å•å…ƒæµ‹è¯•" class="headerlink" title="Jest å•å…ƒæµ‹è¯•"></a>Jest å•å…ƒæµ‹è¯•</h2><p>ä¸ºäº†ä»£ç çš„å¥å£®æ€§ï¼Œå½“ç„¶æ˜¯åŠ å…¥å•å…ƒæµ‹è¯•ã€‚å¦‚æœä¸æ‡‚å•å…ƒæµ‹è¯•ï¼Œè¯·å…ˆçœ‹æˆ‘è¿™ç¯‡ <a href="https://juejin.cn/post/6891625768184070152" target="_blank" rel="noopener">ä¸€æ–‡å¸¦ä½ äº†è§£ Jest å•å…ƒæµ‹è¯•</a></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add -D jest @types&#x2F;jest eslint-plugin-jest babel-jest @storybook&#x2F;addon-storyshots</span><br></pre></td></tr></table></figure><p>é…ç½®<code>.eslintrc.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  extends: [<span class="string">'plugin:jest/recommended'</span>],</span><br><span class="line">  plugins: [<span class="string">'jest'</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶<code>jest.config.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  moduleFileExtensions: [<span class="string">'ts'</span>, <span class="string">'tsx'</span>, <span class="string">'js'</span>, <span class="string">'json'</span>],</span><br><span class="line">  testPathIgnorePatterns: [<span class="string">'&lt;rootDir&gt;/dist/'</span>, <span class="string">'&lt;rootDir&gt;/node_modules/'</span>, <span class="string">'&lt;rootDir&gt;/.next/'</span>],</span><br><span class="line">  moduleNameMapper: &#123;</span><br><span class="line">    <span class="string">'^src(.*)$'</span>: <span class="string">'&lt;rootDir&gt;/src$1'</span>,</span><br><span class="line">    <span class="string">'^server(.*)$'</span>: <span class="string">'&lt;rootDir&gt;/server$1'</span>,</span><br><span class="line">    <span class="string">'^pages(.*)$'</span>: <span class="string">'&lt;rootDir&gt;/pages$1'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  collectCoverageFrom: [</span><br><span class="line">    <span class="string">'./&#123;src,server&#125;/**/*.&#123;ts,tsx,js,jsx&#125;'</span>,</span><br><span class="line">    <span class="string">'!**/node_modules/**'</span>,</span><br><span class="line">    <span class="string">'!**/dist/**'</span>,</span><br><span class="line">    <span class="string">'!**/coverage/**'</span>,</span><br><span class="line">    <span class="string">'!**/*.stories.&#123;ts,tsx,js,jsx&#125;'</span>,</span><br><span class="line">    <span class="string">'!**/&#123;config,constants,styles,types,__fixtures__&#125;/**'</span>,</span><br><span class="line">  ],</span><br><span class="line">  watchPathIgnorePatterns: [<span class="string">'dist'</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Storybook-å’Œ-Jest-çš„-Snapshots-ç»“åˆ"><a href="#Storybook-å’Œ-Jest-çš„-Snapshots-ç»“åˆ" class="headerlink" title="Storybook å’Œ Jest çš„ Snapshots ç»“åˆ"></a>Storybook å’Œ Jest çš„ Snapshots ç»“åˆ</h3><p>Jest å¯ä»¥ç”Ÿæˆå¿«ç…§æµ‹è¯•ï¼ˆSnapshotï¼‰ï¼Œé€šè¿‡ snapshot å˜åŒ–ç»™æˆ‘ä»¬åˆ¤æ–­é¡µé¢å…ƒç´ æ˜¯å¦å¼‚å¸¸ï¼Œç¼ºå¤±æˆ–å¢åŠ æˆ–é…ç½®æ–‡ä»¶æ˜¯å¦æ›´æ”¹ç­‰ç­‰ã€‚ä¸Šé¢å®‰è£…äº† storybookï¼Œå¦‚æœæ˜¯ react ç»„ä»¶çš„ snapshotï¼Œéœ€è¦å€ŸåŠ©å…¶ä»–æ’ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬è½¬ä¸ºä¾é  storybook çš„ stories ç”Ÿæˆã€‚</p><p>é’ˆå¯¹ reactï¼ŒJest å°†ä¸ºè™šæ‹Ÿ DOM æ‹æ‘„å¿«ç…§ï¼Œå°†å…¶è½¬åŒ–ä¸º json æ•°æ®ï¼Œåœ¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶æ¯”å¯¹ä¸¤å¼ å¿«ç…§æ˜¯å¦æœ‰åå·®ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add -D @storybook&#x2F;addon-storyshots</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•æ–°å»º<code>jest.config.js</code>,é’ˆå¯¹ snapshot çš„é…ç½®å¦‚ä¸‹ï¼Œå…¶å®ƒé…ç½®æŒ‰é¡¹ç›®é…ç½®äº†ï¼Œå‚è€ƒ <a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter/blob/master/jest.config.js" target="_blank" rel="noopener">jest.config.js</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  transform: &#123;</span><br><span class="line">    <span class="string">'^.+\\.stories\\.[tj]sx?$'</span>: <span class="string">'@storybook/addon-storyshots/injectFileName'</span>,</span><br><span class="line">    <span class="string">'^.+\\.[tj]sx?$'</span>: <span class="string">'babel-jest'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶<code>src/__tests__/storyshot.test.ts</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> initStoryshots, &#123; multiSnapshotWithOptions &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-storyshots'</span></span><br><span class="line"></span><br><span class="line">initStoryshots(&#123;</span><br><span class="line">  test: multiSnapshotWithOptions(),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¹‹åç»„ä»¶ä¸­æœ‰å†™<code>stories</code>çš„åœ°æ–¹ï¼Œä½¿ç”¨<code>yarn jest</code>ï¼Œé™¤äº†è¿è¡Œæµ‹è¯•ï¼Œä¹Ÿä¼šè‡ªåŠ¨ä¸º<code>*.stories.tsx</code>æ¯”å¯¹/ç”Ÿæˆ snapshotã€‚</p><p>å¯¹äºç”Ÿæˆçš„ snapshot ä½ ä¼šçœ‹åˆ°<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35bdab0b215b44b492fa58d36e0f7200~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>æ¯”å¦‚æˆ‘å†™äº†<code>Footer</code>ç»„ä»¶çš„ï¼Œåªæœ‰ HTML æ ‡ç­¾å’Œå¯¹åº”å±æ€§ï¼Œè¿™æ ·æ£€æµ‹è¿˜ä¸å¤Ÿï¼Œå› ä¸ºä¸çŸ¥é“ css ç±»çš„å±æ€§åšäº†ä»€ä¹ˆæ”¹å˜ï¼Œç”±äºæˆ‘ç”¨çš„ css æ–¹æ¡ˆæ˜¯<code>styled-components</code>ï¼Œæ‰€ä»¥éœ€è¦å†è¿›è¡Œé…ç½®:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add -D jest-specific-snapshot jest-styled-components</span><br></pre></td></tr></table></figure><p>é…ç½®<code>src/__tests__/storyshot.test.ts</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> initStoryshots, &#123; multiSnapshotWithOptions &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-storyshots'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'jest-styled-components'</span></span><br><span class="line"><span class="keyword">import</span> &#123; addSerializer &#125; <span class="keyword">from</span> <span class="string">'jest-specific-snapshot'</span></span><br><span class="line"><span class="keyword">import</span> styleSheetSerializer <span class="keyword">from</span> <span class="string">'jest-styled-components/src/styleSheetSerializer'</span></span><br><span class="line"></span><br><span class="line">addSerializer(styleSheetSerializer)</span><br><span class="line"></span><br><span class="line">initStoryshots(&#123;</span><br><span class="line">  test: multiSnapshotWithOptions(),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ç°åœ¨çš„ snapshotï¼Œå·²ç»æœ‰äº†ä¸€å †æ ·å¼å¯ä»¥å‚è€ƒå¯¹æ¯”äº†ï¼Œè¿™æ ·ç»†å¾®ç»„ä»¶æ ·å¼ä¿®æ”¹éƒ½å¯ä»¥è¢«æ•æ‰åˆ°äº†ï¼›<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65ec364160d047ee919968fdeade6024~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h3 id="Enzyme"><a href="#Enzyme" class="headerlink" title="Enzyme"></a>Enzyme</h3><p>Jest å¯ä»¥å¯¹å‡½æ•°ï¼Œç±»ç­‰ç­‰æœ‰å……è¶³çš„ API æ¥æµ‹è¯•ï¼Œä½†å¯¹äº React ç»„ä»¶ï¼Œæƒ³è¯¦ç»†è¿›è¡Œæµ‹è¯•ï¼Œåˆ™éœ€è¦å®‰è£…å…¶ä»–æ’ä»¶æ¥æ”¯æŒï¼Œå¦‚<code>react-test-library</code>å’Œ<code>enzyme</code>ï¼Œè¿™é‡Œæˆ‘å°±é€‰æˆ‘ç”¨è¿‡ç›¸å¯¹å¤šä¸€ç‚¹çš„ <a href="https://enzymejs.github.io/enzyme/" target="_blank" rel="noopener">enzyme</a> ï¼ˆå‡ºè‡ª Airbnb å…¬å¸ï¼‰ï¼ŒåŒæ—¶éœ€è¦å®‰è£…å®ƒçš„é€‚é…å™¨ã€‚</p><p>è¿™é‡Œç”±äº React å·²ç»å‡çº§åˆ° 17 ç‰ˆæœ¬äº†ï¼Œä½†æ˜¯ enzyme å®˜æ–¹é€‚é…å™¨è¿˜æ²¡æœ‰å‡çº§åˆ°å¯¹åº” 17 ç‰ˆæœ¬çš„ï¼Œæœ‰äº›æµ‹è¯•æ–¹æ³•å¯èƒ½ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æš‚æ—¶ä½¿ç”¨ç›®å‰ Github ä½¿ç”¨è¾ƒå¤šçš„ä»£æ›¿ç‰ˆæœ¬çš„è¿™ä¸ªåº“<code>@wojtekmaj/enzyme-adapter-react-17</code>ï¼Œç­‰å®˜æ–¹æ›´æ–°äº†å†æ›¿æ¢ã€‚è¿™ä¸ªåªæ˜¯ä¾›æµ‹è¯•ç”¨ï¼Œä¸ä¼šå½±å“åˆ°çº¿ä¸Šç¯å¢ƒï¼Œåªè¦ enzyme è‡ªå¸¦æ‰€æœ‰æ–¹æ³•èƒ½æŒ‰é¢„æœŸè¿è¡Œä¸æŠ¥é”™å°±è¡Œï¼Œè¿™æ ·å°±èƒ½å¥½å¥½å†™æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add enzyme @wojtekmaj&#x2F;enzyme-adapter-react-17 -D</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶<code>jest.setup.ts</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import Enzyme from &#39;enzyme&#39;</span><br><span class="line">import Adapter from &#39;@wojtekmaj&#x2F;enzyme-adapter-react-17&#39;</span><br><span class="line"></span><br><span class="line">Enzyme.configure(&#123; adapter: new Adapter() &#125;)</span><br></pre></td></tr></table></figure><p>åŒæ—¶åœ¨<code>jest.config.js</code>ä¸­å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  setupFiles: [&#39;&lt;rootDir&gt;&#x2F;jest.setup.ts&#39;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µï¼Œæµ‹è¯• React ç»„ä»¶æ˜¯æ„ä¹‰ä¸å¤§çš„ï¼Œæ¯”è¾ƒéœ€è¦æµ‹è¯•çš„å°±æ˜¯æ¯”å¦‚ UI ç»„ä»¶ï¼Œç”¨å¾—è¾ƒå¤šçš„é€šç”¨ç»„ä»¶ï¼Œè¿˜æœ‰ä¸€äº›ç»„ä»¶å¦‚ä¸€æ”¹åŠ¨å…¨èº«çš„å®¹æ˜“æœ‰ bug è¡Œä¸ºçš„æ¥é’ˆå¯¹æµ‹è¯•ã€‚</p><h2 id="ç”Ÿæˆ-CHANGELOG-å’Œè‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†"><a href="#ç”Ÿæˆ-CHANGELOG-å’Œè‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="ç”Ÿæˆ CHANGELOG å’Œè‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†"></a>ç”Ÿæˆ CHANGELOG å’Œè‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†</h2><p>è¿™é‡Œæˆ‘ä½¿ç”¨<code>standard-version</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add -D standard-version</span><br></pre></td></tr></table></figure><blockquote><p>standard-version æ˜¯ä¸€æ¬¾éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆ semverï¼‰å’Œ commit message æ ‡å‡†è§„èŒƒ çš„ç‰ˆæœ¬å’Œ changlog è‡ªåŠ¨åŒ–å·¥å…·ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;bump-version&quot;: &quot;standard-version --skip.commit --skip.tag&quot;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>yarn bump-version</code>åï¼Œä¼šå‘ç° package.json çš„ç‰ˆæœ¬å·å˜äº†ï¼ˆå‰æä½ æœ‰äº† feat æˆ– fix ç­‰ç­‰ commit çš„æ”¹åŠ¨ï¼‰ï¼Œè¿˜æœ‰è‡ªåŠ¨ç”Ÿæˆ CAHNGEALOG.mdï¼Œè¿™äº›éƒ½å¯ä»¥è‡ªå®šä¹‰é…ç½®</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e6493286d5c444e88f11320dfc747e0~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="Github-æ‰“-tag-ç‰ˆæœ¬"><a href="#Github-æ‰“-tag-ç‰ˆæœ¬" class="headerlink" title="Github æ‰“ tag ç‰ˆæœ¬"></a>Github æ‰“ tag ç‰ˆæœ¬</h2><p>ç‚¹å‡» Github é¡¹ç›®é¡µé¢å³è¾¹åˆ›å»º release<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0c6529a09bd4eeb8b90e7172054ffec~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>ç„¶åå¡«å…¥ç‰ˆæœ¬å·ï¼Œè¯¦ç»†ä¿¡æ¯æˆ‘æŠŠ CHANGELOG.md çš„å†…å®¹ç›´æ¥æ¬è¿‡æ¥ï¼Œç„¶åæŒ‰<code>Publish release</code>å°±å¯ä»¥äº†ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/768d72503b254cf5b2b8b1d33d472c5a~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="å®Œå–„-script-å‘½ä»¤"><a href="#å®Œå–„-script-å‘½ä»¤" class="headerlink" title="å®Œå–„ script å‘½ä»¤"></a>å®Œå–„ script å‘½ä»¤</h2><p>åœ¨<code>package.json</code>ä¸­</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;dev&quot;: &quot;next dev&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;next build&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;next start&quot;,</span><br><span class="line">  &quot;commit&quot;: &quot;git-cz&quot;,</span><br><span class="line">  &quot;test&quot;: &quot;jest&quot;,</span><br><span class="line">  &quot;coverage&quot;: &quot;yarn jest --coverage&quot;,</span><br><span class="line">  &quot;lint&quot;: &quot;yarn lint:eslint &amp;&amp; yarn lint:css&quot;,</span><br><span class="line">  &quot;lint:eslint&quot;: &quot;eslint --ext js,jsx,ts,tsx .&quot;,</span><br><span class="line">  &quot;lint:css&quot;: &quot;stylelint **&#x2F;*.&#123;ts,tsx&#125;&quot;,</span><br><span class="line">  &quot;prettier&quot;: &quot;prettier --write \&quot;**&#x2F;*.&#123;js,jsx,tsx,ts,less,md,json&#125;\&quot;&quot;,</span><br><span class="line">  &quot;tsc:client&quot;: &quot;tsc --noEmit -p tsconfig.json&quot;,</span><br><span class="line">  &quot;storybook&quot;: &quot;start-storybook -p 6006&quot;,</span><br><span class="line">  &quot;build-storybook&quot;: &quot;build-storybook -o .&#x2F;dist_storybook&quot;,</span><br><span class="line">  &quot;bump-version&quot;: &quot;standard-version --skip.commit --skip.tag&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="LICENSE"><a href="#LICENSE" class="headerlink" title="LICENSE"></a>LICENSE</h2><p>æ·»åŠ ä¸ªå¼€æºåè®®ï¼Œæˆ‘é€‰æ‹©å®½æ¾çš„ MIT åè®®</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MIT License</span><br><span class="line"></span><br><span class="line">Copyright (c) 2020 nextjs-ts-redux-antd-starter</span><br><span class="line"></span><br><span class="line">Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line">of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line">in the Software without restriction, including without limitation the rights</span><br><span class="line">to use, copy, modify, merge, publish, distribute, sublicense, and&#x2F;or sell</span><br><span class="line">copies of the Software, and to permit persons to whom the Software is</span><br><span class="line">furnished to do so, subject to the following conditions:</span><br><span class="line"></span><br><span class="line">The above copyright notice and this permission notice shall be included in all</span><br><span class="line">copies or substantial portions of the Software.</span><br><span class="line"></span><br><span class="line">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span><br><span class="line">SOFTWARE.</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œé¡¹ç›®"><a href="#è¿è¡Œé¡¹ç›®" class="headerlink" title="è¿è¡Œé¡¹ç›®"></a>è¿è¡Œé¡¹ç›®</h2><p>å¦‚ä¸Šæ¼”ç¤ºè¿˜ç•¥è¿‡ä¸€äº›ç»†èŠ‚å…¶ä»–é…ç½®ï¼Œéœ€è¦è¯¦ç»†çš„å°±çœ‹<a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter" target="_blank" rel="noopener">æºç </a>å§ã€‚</p><p>æ•´ä¸ªè„šæ‰‹æ¶æˆ‘æ˜¯ä¸æ‰“ç®—åŠ å…¥å¤ªå¤šä¸œè¥¿çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯•ç«Ÿåšä¸ºæ¨¡æ¿è„šæ‰‹æ¶ï¼ŒåŠ å¤ªå¤šåŠŸèƒ½åè€Œè¦ç”¨çš„æ—¶å€™è¦åˆ é™¤ä¸€å¤§å †éº»çƒ¦ï¼Œå› ä¸ºåšçš„ä¸æ˜¯æŸç±»å‹ä¸šåŠ¡ç½‘ç«™ï¼Œæœ‰ä¸€äº›åªèƒ½å°½é‡æœ‰ä¸ª Demo å‚è€ƒå°±è¡Œã€‚æ‰€ä»¥æˆ‘ä¼šå°½é‡ä¿æŒç®€æ´ï¼Œä¹‹åç»´æŠ¤æˆ‘ä¼šå€¾å‘äº Next.js é…ç½®å’Œå‰ç«¯å·¥ç¨‹åŒ–åŠæ€§èƒ½ä¼˜åŒ–çš„è§’åº¦è¿›è¡Œå®Œå–„ï¼Œç„¶åå°±æ˜¯ä¸€äº›é€šç”¨çš„å‡½æ•°å’ŒåŠŸèƒ½ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8071fa608e01412c878c3dcc3e07a021~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è„šæ‰‹æ¶åˆ°è¿™é‡Œå°±å®Œäº†ï¼Ÿè¿˜æ²¡æœ‰ï¼Œè¿˜æœ‰å¾ˆå¤šæ²¡åŠ ï¼Œæ¯”å¦‚æ•´ç† Next.js çš„ config é…ç½®ï¼Œä¼˜åŒ– SEOï¼Œå‘å¸ƒåˆ°çº¿ä¸Šç½‘ç«™å’Œ npmï¼Œä¸€äº›å…¼å®¹ï¼Œç‰¹æ®Šé¡µé¢å¤„ç†ï¼Œå“åº”å¼ç­‰ç­‰ã€‚</p><p>å½“ç„¶ï¼Œåœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« æ—¶çš„è„šæ‰‹æ¶å¤šå°‘ä¹Ÿæœ‰å†™çš„ä¸å¥½æˆ–ä¸å®Œå–„çš„åœ°æ–¹ï¼Œå› ä¸ºåˆšèµ·æ­¥ï¼Œæ‰€ä»¥è¯¥è„šæ‰‹æ¶ä¼šæŒç»­ç»´æŠ¤ï¼ŒæŠŠå·¥ä½œå®è·µå’Œå­¦ä¹ åˆ°çš„æœ€ä½³å®è·µè¿è¡Œåˆ°è¯¥é¡¹ç›®é‡Œï¼Œä¸æ–­ä¿æŒæ›´æ–°ï¼Œæ•¬è¯·å…³æ³¨ï¼Œæ¬¢è¿ star ğŸŒŸğŸŒŸğŸŒŸ <a href="https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter" target="_blank" rel="noopener">https://github.com/Jacky-Summer/nextjs-ts-antd-redux-storybook-starter</a></p><br><ul><li>psï¼š<ul><li><a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a></li><li><a href="https://github.com/Jacky-Summer/monki-ui" target="_blank" rel="noopener">monki-ui</a>ï¼šåŸºäº React + TypeScript + Dumi + Jest + Enzyme å¼€å‘ UI ç»„ä»¶åº“ï¼Œæœªæ¥ä¼šå†™ç›¸å…³æ–‡ç« </li></ul></li></ul><p>è§‰å¾—ä¸é”™çš„è¯èµä¸ª starï¼Œç»™æˆ‘æŒç»­åˆ›ä½œçš„åŠ¨åŠ›å§ï¼ä¸‹æ¬¡ç»§ç»­â€¦</p>]]></content>
      <categories>
        <category>å‰ç«¯å·¥ç¨‹åŒ–</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>Redux</tag>
        <tag>NextJS</tag>
        <tag>Ant Design</tag>
        <tag>TypeScript</tag>
        <tag>Jest</tag>
        <tag>redux-saga</tag>
        <tag>Storybook</tag>
        <tag>Styled-components</tag>
        <tag>Enzyme</tag>
      </tags>
  </entry>
  <entry>
    <title>å›é¡¾ HTTP1.0-HTTP1.1-HTTP2.0åŒºåˆ«</title>
    <url>/2020/12/10/%E5%9B%9E%E9%A1%BE-HTTP1-0-HTTP1-1-HTTP2-0%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>å›é¡¾ HTTP1 HTTP1.1 HTTP2.0 åŒºåˆ«</p><a id="more"></a><h2 id="HTTP1-0-å’Œ-HTTP1-1-çš„ä¸€äº›åŒºåˆ«"><a href="#HTTP1-0-å’Œ-HTTP1-1-çš„ä¸€äº›åŒºåˆ«" class="headerlink" title="HTTP1.0 å’Œ HTTP1.1 çš„ä¸€äº›åŒºåˆ«"></a>HTTP1.0 å’Œ HTTP1.1 çš„ä¸€äº›åŒºåˆ«</h2><h3 id="ç¼“å­˜å¤„ç†"><a href="#ç¼“å­˜å¤„ç†" class="headerlink" title="ç¼“å­˜å¤„ç†"></a>ç¼“å­˜å¤„ç†</h3><p>åœ¨ HTTP1.0 ä¸­ä¸»è¦ä½¿ç”¨ header é‡Œçš„ <code>If-Modified-Since</code>ï¼ˆæ¯”è¾ƒèµ„æºæœ€åçš„æ›´æ–°æ—¶é—´æ˜¯å¦ä¸€è‡´ï¼‰,<code>Expires</code>ï¼ˆèµ„æºçš„è¿‡æœŸæ—¶é—´ï¼ˆå–å†³äºå®¢æˆ·ç«¯æœ¬åœ°æ—¶é—´ï¼‰ï¼‰ æ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ã€‚</p><p>HTTP1.1 åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ï¼š</p><ul><li><code>Entity tag</code>ï¼šèµ„æºçš„åŒ¹é…ä¿¡æ¯</li><li><code>If-Unmodified-Since</code>ï¼šæ¯”è¾ƒèµ„æºæœ€åçš„æ›´æ–°æ—¶é—´æ˜¯å¦ä¸ä¸€è‡´</li><li><code>If-Match</code>ï¼šæ¯”è¾ƒ ETag æ˜¯å¦ä¸€è‡´</li><li><code>If-None-Match</code>ï¼šæ¯”è¾ƒ ETag æ˜¯å¦ä¸ä¸€è‡´</li></ul><p>ç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</p><h3 id="å¸¦å®½ä¼˜åŒ–"><a href="#å¸¦å®½ä¼˜åŒ–" class="headerlink" title="å¸¦å®½ä¼˜åŒ–"></a>å¸¦å®½ä¼˜åŒ–</h3><p>HTTP1.0 ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚</p><p>HTTP 1.1é»˜è®¤æ”¯æŒæ–­ç‚¹ç»­ä¼ ã€‚</p><h3 id="Host-å¤´å¤„ç†"><a href="#Host-å¤´å¤„ç†" class="headerlink" title="Host å¤´å¤„ç†"></a>Host å¤´å¤„ç†</h3><p>åœ¨ HTTP1.0 ä¸­è®¤ä¸ºæ¯å°æœåŠ¡å™¨éƒ½ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ï¼Œå› æ­¤ï¼Œè¯·æ±‚æ¶ˆæ¯ä¸­çš„ URL å¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºåï¼ˆhostnameï¼‰ã€‚ä½†éšç€è™šæ‹Ÿä¸»æœºæŠ€æœ¯çš„å‘å±•ï¼Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¹¶ä¸”å®ƒä»¬å…±äº«ä¸€ä¸ª IP åœ°å€ã€‚HTTP1.1 çš„è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯éƒ½åº”æ”¯æŒ Host å¤´åŸŸï¼Œä¸”è¯·æ±‚æ¶ˆæ¯ä¸­å¦‚æœæ²¡æœ‰ Host å¤´åŸŸä¼šæŠ¥å‘Šä¸€ä¸ªé”™è¯¯ï¼ˆ400 Bad Requestï¼‰ã€‚</p><h3 id="é•¿è¿æ¥"><a href="#é•¿è¿æ¥" class="headerlink" title="é•¿è¿æ¥"></a>é•¿è¿æ¥</h3><p>HTTP1.0 éœ€è¦ä½¿ç”¨<code>keep-alive</code>å‚æ•°æ¥å‘ŠçŸ¥æœåŠ¡å™¨ç«¯è¦å»ºç«‹ä¸€ä¸ªé•¿è¿æ¥ï¼Œè€Œ HTTP1.1 é»˜è®¤æ”¯æŒé•¿è¿æ¥ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº† HTTP1.0 æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ›å»ºè¿æ¥çš„ç¼ºç‚¹ã€‚</p><p>HTTP æ˜¯åŸºäº TCP/IP åè®®çš„ï¼Œåˆ›å»ºä¸€ä¸ª TCP è¿æ¥æ˜¯éœ€è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹çš„,æœ‰ä¸€å®šçš„å¼€é”€ï¼Œå¦‚æœæ¯æ¬¡é€šè®¯éƒ½è¦é‡æ–°å»ºç«‹è¿æ¥çš„è¯ï¼Œå¯¹æ€§èƒ½æœ‰å½±å“ã€‚å› æ­¤æœ€å¥½èƒ½ç»´æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œå¯ä»¥ç”¨ä¸ªé•¿è¿æ¥æ¥å‘å¤šä¸ªè¯·æ±‚ã€‚</p><p>HTTP1.1 æ”¯æŒé•¿è¿æ¥ï¼ˆPersistentConnectionï¼‰å’Œè¯·æ±‚çš„æµæ°´çº¿ï¼ˆPipeliningï¼‰å¤„ç†ï¼Œåœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå¯ä»¥ä¼ é€å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿã€‚</p><h3 id="é”™è¯¯é€šçŸ¥çš„ç®¡ç†"><a href="#é”™è¯¯é€šçŸ¥çš„ç®¡ç†" class="headerlink" title="é”™è¯¯é€šçŸ¥çš„ç®¡ç†"></a>é”™è¯¯é€šçŸ¥çš„ç®¡ç†</h3><p>åœ¨ HTTP1.1 ä¸­æ–°å¢äº† 24 ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚ 409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</p><h3 id="æ–°å¢è¯·æ±‚æ–¹å¼"><a href="#æ–°å¢è¯·æ±‚æ–¹å¼" class="headerlink" title="æ–°å¢è¯·æ±‚æ–¹å¼"></a>æ–°å¢è¯·æ±‚æ–¹å¼</h3><ul><li>PUTï¼šè¯·æ±‚æœåŠ¡å™¨å­˜å‚¨ä¸€ä¸ªèµ„æº</li><li>DELETEï¼šè¯·æ±‚æœåŠ¡å™¨åˆ é™¤æ ‡è¯†çš„èµ„æº</li><li>OPTIONSï¼šè¯·æ±‚æŸ¥è¯¢æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæˆ–è€…æŸ¥è¯¢ä¸èµ„æºç›¸å…³çš„é€‰é¡¹å’Œéœ€æ±‚</li><li>CONNECTï¼šä¿ç•™è¯·æ±‚ä»¥ä¾›å°†æ¥ä½¿ç”¨</li><li>TRACEï¼šè¯·æ±‚æœåŠ¡å™¨å›é€æ”¶åˆ°çš„è¯·æ±‚ä¿¡æ¯ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­</li></ul><h2 id="HTTP2-0-ä¸-HTTP1-X-çš„åŒºåˆ«"><a href="#HTTP2-0-ä¸-HTTP1-X-çš„åŒºåˆ«" class="headerlink" title="HTTP2.0 ä¸ HTTP1.X çš„åŒºåˆ«"></a>HTTP2.0 ä¸ HTTP1.X çš„åŒºåˆ«</h2><p>HTTP1.X ç‰ˆæœ¬çš„ç¼ºé™·æ¦‚æ‹¬æ¥è¯´æ˜¯ï¼šçº¿ç¨‹é˜»å¡ï¼Œåœ¨åŒä¸€æ—¶é—´ï¼ŒåŒä¸€åŸŸåçš„è¯·æ±‚æœ‰ä¸€å®šçš„æ•°é‡é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶æ•°ç›®çš„è¯·æ±‚ä¼šè¢«é˜»å¡ã€‚</p><h3 id="äºŒè¿›åˆ¶åˆ†å¸§"><a href="#äºŒè¿›åˆ¶åˆ†å¸§" class="headerlink" title="äºŒè¿›åˆ¶åˆ†å¸§"></a>äºŒè¿›åˆ¶åˆ†å¸§</h3><p>HTTP1.x çš„è§£ææ˜¯åŸºäºæ–‡æœ¬ã€‚åŸºäºæ–‡æœ¬åè®®çš„æ ¼å¼è§£æå­˜åœ¨å¤©ç„¶ç¼ºé™·ï¼Œæ–‡æœ¬çš„è¡¨ç°å½¢å¼æœ‰å¤šæ ·æ€§ï¼Œè¦åšåˆ°å¥å£®æ€§è€ƒè™‘çš„åœºæ™¯å¿…ç„¶å¾ˆå¤šï¼ŒäºŒè¿›åˆ¶åˆ™ä¸åŒï¼Œåªè®¤ 0 å’Œ 1 çš„ç»„åˆã€‚åŸºäºè¿™ç§è€ƒè™‘ HTTP2.0 çš„åè®®è§£æå†³å®šé‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œå®ç°æ–¹ä¾¿ä¸”å¥å£®ã€‚</p><p>HTTP2.0 åœ¨ åº”ç”¨å±‚(HTTP2.0)å’Œä¼ è¾“å±‚(TCP/UDP)ä¹‹é—´å¢åŠ ä¸€ä¸ªäºŒè¿›åˆ¶åˆ†å¸§å±‚ã€‚åœ¨ä¸æ”¹åŠ¨ HTTP1.X çš„è¯­ä¹‰ã€æ–¹æ³•ã€çŠ¶æ€ç ã€URI ä»¥åŠé¦–éƒ¨å­—æ®µçš„æƒ…å†µä¸‹, è§£å†³äº† HTTP1.1 çš„æ€§èƒ½é™åˆ¶ï¼Œæ”¹è¿›ä¼ è¾“æ€§èƒ½ï¼Œå®ç°ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚åœ¨äºŒè¿›åˆ¶åˆ†å¸§å±‚ä¸­ï¼ŒHTTP2.0 ä¼šå°†æ‰€æœ‰ä¼ è¾“çš„ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼ˆframeï¼‰,å¹¶å¯¹å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼çš„ç¼–ç  ï¼Œå…¶ä¸­ HTTP1.X çš„é¦–éƒ¨ä¿¡æ¯ä¼šè¢«å°è£…åˆ° HEADER frameï¼Œè€Œç›¸åº”çš„ Request Body åˆ™å°è£…åˆ° DATA frame é‡Œé¢ã€‚</p><ul><li><p>å¸§ï¼šHTTP2.0 æ•°æ®é€šä¿¡çš„æœ€å°å•ä½æ¶ˆæ¯ï¼šæŒ‡ HTTP2.0 ä¸­é€»è¾‘ä¸Šçš„ HTTP æ¶ˆæ¯ã€‚ä¾‹å¦‚è¯·æ±‚å’Œå“åº”ç­‰ï¼Œæ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚</p></li><li><p>æµï¼šå­˜åœ¨äºè¿æ¥ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿé€šé“ã€‚æµå¯ä»¥æ‰¿è½½åŒå‘æ¶ˆæ¯ï¼Œæ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•° IDã€‚</p></li></ul><h3 id="å¤šè·¯å¤ç”¨ï¼ˆMultiPlexingï¼‰"><a href="#å¤šè·¯å¤ç”¨ï¼ˆMultiPlexingï¼‰" class="headerlink" title="å¤šè·¯å¤ç”¨ï¼ˆMultiPlexingï¼‰"></a>å¤šè·¯å¤ç”¨ï¼ˆMultiPlexingï¼‰</h3><p>å¤šè·¯å¤ç”¨å…è®¸åŒæ—¶é€šè¿‡å•ä¸€çš„ HTTP2.0 è¿æ¥å‘èµ·å¤šé‡çš„è¯·æ±‚-å“åº”æ¶ˆæ¯ã€‚å³æ˜¯è¿æ¥å…±äº«ï¼Œæé«˜äº†è¿æ¥çš„åˆ©ç”¨ç‡ï¼Œé™ä½å»¶è¿Ÿã€‚å³æ¯ä¸€ä¸ª request éƒ½æ˜¯æ˜¯ç”¨ä½œè¿æ¥å…±äº«æœºåˆ¶çš„ã€‚ä¸€ä¸ª request å¯¹åº”ä¸€ä¸ª idï¼Œè¿™æ ·ä¸€ä¸ªè¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ª requestï¼Œæ¯ä¸ªè¿æ¥çš„ request å¯ä»¥éšæœºçš„æ··æ‚åœ¨ä¸€èµ·ï¼Œæ¥æ”¶æ–¹å¯ä»¥æ ¹æ® request çš„ id å°† request å†å½’å±åˆ°å„è‡ªä¸åŒçš„æœåŠ¡ç«¯è¯·æ±‚é‡Œé¢ã€‚</p><p>åœ¨ HTTP1.1 åè®®ä¸­æµè§ˆå™¨å®¢æˆ·ç«¯åœ¨åŒä¸€æ—¶é—´ï¼Œé’ˆå¯¹åŒä¸€åŸŸåä¸‹çš„è¯·æ±‚æœ‰ä¸€å®šæ•°é‡é™åˆ¶ã€‚è¶…è¿‡é™åˆ¶æ•°ç›®çš„è¯·æ±‚ä¼šè¢«é˜»å¡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä½•ä¸€äº›ç«™ç‚¹ä¼šæœ‰å¤šä¸ªé™æ€èµ„æº CDN åŸŸåçš„åŸå› ä¹‹ä¸€ã€‚</p><p>å½“ç„¶ HTTP1.1 ä¹Ÿå¯ä»¥å¤šå»ºç«‹å‡ ä¸ª TCP è¿æ¥ï¼Œæ¥æ”¯æŒå¤„ç†æ›´å¤šå¹¶å‘çš„è¯·æ±‚ï¼Œä½†æ˜¯åˆ›å»º TCP è¿æ¥æœ¬èº«ä¹Ÿæ˜¯æœ‰å¼€é”€çš„ã€‚</p><p>TCP è¿æ¥æœ‰ä¸€ä¸ªé¢„çƒ­å’Œä¿æŠ¤çš„è¿‡ç¨‹ï¼Œå…ˆæ£€æŸ¥æ•°æ®æ˜¯å¦ä¼ é€æˆåŠŸï¼Œä¸€æ—¦æˆåŠŸè¿‡ï¼Œåˆ™æ…¢æ…¢åŠ å¤§ä¼ è¾“é€Ÿåº¦ã€‚å› æ­¤å¯¹åº”ç¬æ—¶å¹¶å‘çš„è¿æ¥ï¼ŒæœåŠ¡å™¨çš„å“åº”å°±ä¼šå˜æ…¢ã€‚æ‰€ä»¥æœ€å¥½èƒ½ä½¿ç”¨ä¸€ä¸ªå»ºç«‹å¥½çš„è¿æ¥ï¼Œå¹¶ä¸”è¿™ä¸ªè¿æ¥å¯ä»¥æ”¯æŒç¬æ—¶å¹¶å‘çš„è¯·æ±‚ã€‚</p><p>HTTP2.0 å¯ä»¥å¾ˆå®¹æ˜“çš„å»å®ç°å¤šæµå¹¶è¡Œè€Œä¸ç”¨ä¾èµ–å»ºç«‹å¤šä¸ª TCP è¿æ¥ï¼ŒåŒä¸ªåŸŸååªéœ€è¦å ç”¨ä¸€ä¸ª TCP è¿æ¥ï¼Œæ¶ˆé™¤äº†å› å¤šä¸ª TCP è¿æ¥è€Œå¸¦æ¥çš„å»¶æ—¶å’Œå†…å­˜æ¶ˆè€—ã€‚HTTP2.0 æŠŠ HTTP åè®®é€šä¿¡çš„åŸºæœ¬å•ä½ç¼©å°ä¸ºä¸€ä¸ªä¸€ä¸ªçš„å¸§ï¼Œè¿™äº›å¸§å¯¹åº”ç€é€»è¾‘æµä¸­çš„æ¶ˆæ¯ã€‚å¹¶è¡Œåœ°åœ¨åŒä¸€ä¸ª TCP è¿æ¥ä¸ŠåŒå‘äº¤æ¢æ¶ˆæ¯ã€‚</p><h3 id="header-å‹ç¼©"><a href="#header-å‹ç¼©" class="headerlink" title="header å‹ç¼©"></a>header å‹ç¼©</h3><p>HTTP1.x çš„ header å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ï¼ŒHTTP2.0 ä½¿ç”¨ HPACK ç®—æ³•å¯¹ header çš„æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘éœ€è¦ä¼ è¾“çš„ header å¤§å°ï¼Œé€šè®¯åŒæ–¹å„è‡ª cache ä¸€ä»½ header fields è¡¨ï¼Œå·®é‡æ›´æ–° HTTP å¤´éƒ¨ï¼Œæ—¢é¿å…äº†é‡å¤ header çš„ä¼ è¾“ï¼Œåˆå‡å°äº†éœ€è¦ä¼ è¾“çš„å¤§å°ã€‚</p><p>header é‡‡å–çš„å‹ç¼©ç­–ç•¥ï¼š</p><ul><li>HTTP2.0 åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨â€œé¦–éƒ¨è¡¨â€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®ï¼å€¼å¯¹ï¼Œå¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€ï¼›</li><li>é¦–éƒ¨è¡¨åœ¨ HTTP2.0 çš„è¿æ¥å­˜ç»­æœŸå†…å§‹ç»ˆå­˜åœ¨ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ¸è¿›åœ°æ›´æ–°;</li><li>æ¯ä¸ªæ–°çš„é¦–éƒ¨é”®ï¼å€¼å¯¹è¦ä¹ˆè¢«è¿½åŠ åˆ°å½“å‰è¡¨çš„æœ«å°¾ï¼Œè¦ä¹ˆæ›¿æ¢è¡¨ä¸­ä¹‹å‰çš„å€¼ã€‚</li></ul><h3 id="æœåŠ¡ç«¯æ¨é€ï¼ˆserver-pushï¼‰"><a href="#æœåŠ¡ç«¯æ¨é€ï¼ˆserver-pushï¼‰" class="headerlink" title="æœåŠ¡ç«¯æ¨é€ï¼ˆserver pushï¼‰"></a>æœåŠ¡ç«¯æ¨é€ï¼ˆserver pushï¼‰</h3><p>æœåŠ¡ç«¯æ¨é€æ˜¯ä¸€ç§åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¹‹å‰å‘é€æ•°æ®çš„æœºåˆ¶ã€‚</p><p>æœåŠ¡ç«¯å¯ä»¥åœ¨å‘é€é¡µé¢ HTML æ—¶ä¸»åŠ¨æ¨é€å…¶å®ƒèµ„æºï¼Œè€Œä¸ç”¨ç­‰åˆ°æµè§ˆå™¨è§£æåˆ°ç›¸åº”ä½ç½®ï¼Œå‘èµ·è¯·æ±‚å†å“åº”ã€‚ä¾‹å¦‚æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨æŠŠ JS å’Œ CSS æ–‡ä»¶æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯è§£æ HTML æ—¶å†å‘é€è¿™äº›è¯·æ±‚ã€‚</p><p>æœåŠ¡å™¨ç«¯æ¨é€çš„è¿™äº›èµ„æºå…¶å®å­˜åœ¨å®¢æˆ·ç«¯çš„æŸå¤„åœ°æ–¹ï¼Œå®¢æˆ·ç«¯ç›´æ¥ä»æœ¬åœ°åŠ è½½è¿™äº›èµ„æºå°±å¯ä»¥äº†ï¼Œä¸ç”¨èµ°ç½‘ç»œï¼Œé€Ÿåº¦è‡ªç„¶æ˜¯å¿«å¾ˆå¤šçš„ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://juejin.cn/post/6844903824390537230" target="_blank" rel="noopener">HTTP1.0ï¼ŒHTTP1.1ï¼ŒHTTPS å’Œ HTTP2.0 çš„åŒºåˆ«</a></li><li><a href="https://zhuanlan.zhihu.com/p/26559480" target="_blank" rel="noopener">ä¸€æ–‡è¯»æ‡‚ HTTP/2 ç‰¹æ€§</a></li></ul><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>HTTPç³»åˆ—</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯å®‰å…¨-XSSå’ŒCSRF</title>
    <url>/2020/12/03/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8-XSS%E5%92%8CCSRF/</url>
    <content><![CDATA[<p>æœ¬ç¯‡ä¸»è¦è®²ä¸‹å…³äºå‰ç«¯å®‰å…¨â€”â€”XSS å’Œ CSRF</p><a id="more"></a><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>XSSï¼ˆCross Site Scriptï¼‰ï¼ŒæŒ‡<strong>è·¨ç«™è„šæœ¬æ”»å‡»</strong>ã€‚åŸæœ¬ç¼©å†™ä¸º CSSï¼Œä½†å› ä¸ºä¸å±‚å æ ·å¼è¡¨ç¼©å†™ï¼ˆCSSï¼‰é‡åè¦åšåŒºåˆ†ï¼Œæ‰€ä»¥æ”¹ä¸º XSSã€‚</p><h3 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h3><p>æ”»å‡»è€…é€šè¿‡å‘ç½‘ç«™é¡µé¢æ³¨å…¥æ¶æ„è„šæœ¬ï¼ˆä¸€èˆ¬æ˜¯ JavaScriptï¼‰ï¼Œé€šè¿‡æ¶æ„è„šæœ¬å¯¹å®¢æˆ·ç«¯ç½‘é¡µè¿›è¡Œç¯¡æ”¹ï¼Œè¾¾åˆ°çªƒå–ä¿¡æ¯ç­‰ç›®çš„ï¼Œæœ¬è´¨æ˜¯æ•°æ®è¢«å½“ä½œç¨‹åºæ‰§è¡Œã€‚</p><h3 id="XSS-çš„æ³¨å…¥ç‚¹"><a href="#XSS-çš„æ³¨å…¥ç‚¹" class="headerlink" title="XSS çš„æ³¨å…¥ç‚¹"></a>XSS çš„æ³¨å…¥ç‚¹</h3><ul><li>HTML çš„èŠ‚ç‚¹å†…å®¹æˆ–å±æ€§ï¼Œå­˜åœ¨è¯»å–å¯è¾“å…¥æ•°æ®</li><li>javascript ä»£ç ï¼Œå­˜åœ¨ç”±åå°æ³¨å…¥çš„å˜é‡æˆ–ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯</li><li>å¯Œæ–‡æœ¬</li></ul><h3 id="XSS-å±å®³"><a href="#XSS-å±å®³" class="headerlink" title="XSS å±å®³"></a>XSS å±å®³</h3><ul><li>é€šè¿‡ document.cookie ç›—å– cookie</li><li>ä½¿ç”¨ js æˆ– css ç ´åé¡µé¢æ­£å¸¸çš„ç»“æ„ä¸æ ·å¼</li><li>æµé‡åŠ«æŒï¼ˆé€šè¿‡è®¿é—®æŸæ®µå…·æœ‰ window.location.href å®šä½åˆ°å…¶ä»–é¡µé¢:<code>&lt;script&gt;window.location.href=&quot;www.baidu.com&quot;;&lt;/script&gt;</code>ï¼‰</li><li>Dos æ”»å‡»ï¼šåˆ©ç”¨åˆç†çš„å®¢æˆ·ç«¯è¯·æ±‚æ¥å ç”¨è¿‡å¤šçš„æœåŠ¡å™¨èµ„æºï¼Œä»è€Œä½¿åˆæ³•ç”¨æˆ·æ— æ³•å¾—åˆ°æœåŠ¡å™¨å“åº”</li><li>åˆ©ç”¨ iframeã€frameã€XMLHttpRequest æˆ–ä¸Šè¿° Flash ç­‰æ–¹å¼ï¼Œä»¥ï¼ˆè¢«æ”»å‡»ï¼‰ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œä¸€äº›ç®¡ç†åŠ¨ä½œï¼Œæˆ–æ‰§è¡Œä¸€äº›ä¸€èˆ¬çš„å¦‚å‘å¾®åšã€åŠ å¥½å‹ã€å‘ç§ä¿¡ç­‰æ“ä½œ</li><li>åˆ©ç”¨å¯è¢«æ”»å‡»çš„åŸŸå—åˆ°å…¶ä»–åŸŸä¿¡ä»»çš„ç‰¹ç‚¹ï¼Œä»¥å—ä¿¡ä»»æ¥æºçš„èº«ä»½è¯·æ±‚ä¸€äº›å¹³æ—¶ä¸å…è®¸çš„æ“ä½œï¼Œå¦‚è¿›è¡Œä¸å½“çš„æŠ•ç¥¨æ´»åŠ¨</li><li>å·å–ç½‘ç«™ä»»æ„æ•°æ®ã€ç”¨æˆ·èµ„æ–™ç­‰ç­‰</li></ul><h3 id="XSS-çš„ç±»å‹"><a href="#XSS-çš„ç±»å‹" class="headerlink" title="XSS çš„ç±»å‹"></a>XSS çš„ç±»å‹</h3><h4 id="åå°„å‹ï¼ˆéæŒä¹…ï¼‰"><a href="#åå°„å‹ï¼ˆéæŒä¹…ï¼‰" class="headerlink" title="åå°„å‹ï¼ˆéæŒä¹…ï¼‰"></a>åå°„å‹ï¼ˆéæŒä¹…ï¼‰</h4><p>åå°„å‹ XSSï¼Œä¹Ÿå«éæŒä¹…å‹ XSSï¼Œæ˜¯æŒ‡å‘ç”Ÿè¯·æ±‚æ—¶ï¼ŒXSS ä»£ç å‡ºç°åœ¨è¯·æ±‚ URL ä¸­ï¼Œä½œä¸ºå‚æ•°æäº¤åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è§£æå¹¶å“åº”ã€‚å“åº”å†…å®¹åŒ…å« XSS ä»£ç ï¼Œè¿”å›ç»™æµè§ˆå™¨è§£æå¹¶æ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒä¸€æ¬¡åå°„ï¼Œæ‰€ä»¥å«åå°„å‹ XSSã€‚</p><p>è¿™ç§æ”»å‡»æ–¹å¼é€šå¸¸éœ€è¦æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæ¶æ„é“¾æ¥ï¼Œæˆ–è€…æäº¤ä¸€ä¸ªè¡¨å•ï¼Œæˆ–è€…è¿›å…¥ä¸€ä¸ªæ¶æ„ç½‘ç«™æ—¶ï¼Œæ³¨å…¥è„šæœ¬è¿›å…¥è¢«æ”»å‡»è€…çš„ç½‘ç«™ã€‚</p><p>è¯¥æ–¹å¼åªä¼šç»è¿‡æœåŠ¡å™¨ï¼Œä¸ä¼šç»è¿‡æ•°æ®åº“ã€‚</p><p>ä¾‹å­ï¼š<br>æ¯”å¦‚ç”¨æˆ·è¿›è¡Œæœç´¢æ—¶ï¼Œç‚¹å‡»æœç´¢æŒ‰é’®è®¿é—®åˆ°å¦‚ä¸‹é“¾æ¥</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxx.com&#x2F;search?keyword&#x3D;&quot;&gt;&lt;script&gt;alert(&#39;XSSæ”»å‡»&#39;);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>å½“æµè§ˆå™¨è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨è§£æå‚æ•° keywordï¼Œå¾—åˆ°<code>&quot;&gt;&lt;script&gt;alert(&#39;XSSæ”»å‡»&#39;);&lt;/script&gt;</code>ï¼Œæ‹¼æ¥åˆ° HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">  alert(<span class="string">'XSSæ”»å‡»'</span>)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">"&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>æœç´¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  æ‚¨æœç´¢çš„å…³é”®è¯æ˜¯ï¼š"&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    alert(<span class="string">'XSSæ”»å‡»'</span>)</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å› æ­¤å°†å…¶æ‰§è¡Œäº†ã€‚</p><h4 id="å­˜å‚¨å‹ï¼ˆæŒä¹…ï¼‰"><a href="#å­˜å‚¨å‹ï¼ˆæŒä¹…ï¼‰" class="headerlink" title="å­˜å‚¨å‹ï¼ˆæŒä¹…ï¼‰"></a>å­˜å‚¨å‹ï¼ˆæŒä¹…ï¼‰</h4><p>å­˜å‚¨å‹ XSSï¼Œä¹Ÿå«æŒä¹…å‹ XSSï¼Œä¸»è¦æ˜¯å°† XSS ä»£ç å‘é€åˆ°æœåŠ¡å™¨ï¼Œå½“æµè§ˆå™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œè„šæœ¬ä»æœåŠ¡å™¨ä¸Šä¼ å›å¹¶æ‰§è¡Œã€‚ä¸åå°„å‹ XSS çš„å·®åˆ«åœ¨äºï¼Œæäº¤çš„ä»£ç ä¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ç›®æ ‡é¡µé¢æ—¶ä¸ç”¨å†æäº¤ XSS ä»£ç ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„åœºæ™¯å°±æ˜¯ç½‘é¡µçš„ç•™è¨€æ¿ï¼Œæ”»å‡»è€…åœ¨ç•™è¨€æ¿å†™ä¸‹åŒ…å«æ”»å‡»æ€§çš„è„šæœ¬ä»£ç ï¼Œå‘è¡¨ä¹‹åæ‰€æœ‰è®¿é—®è¯¥ç•™è¨€çš„ç”¨æˆ·ï¼Œç•™è¨€å†…å®¹ä»æœåŠ¡å™¨è§£æä¹‹åå‘ç°æœ‰ XSS ä»£ç äºæ˜¯å½“åšæ­£å¸¸çš„ HTML å’Œ JS è§£ææ‰§è¡Œï¼Œå°±å‘ç”Ÿäº† XSS æ”»å‡»ã€‚</p><p>è¯¥æ–¹å¼ä¼šç»è¿‡æœåŠ¡å™¨ï¼Œä¹Ÿä¼šç»è¿‡æ•°æ®åº“ã€‚</p><h4 id="DOM-å‹"><a href="#DOM-å‹" class="headerlink" title="DOM å‹"></a>DOM å‹</h4><p>åŸºäº DOM çš„ XSS æ”»å‡»æ˜¯æŒ‡é€šè¿‡æ¶æ„è„šæœ¬ä¿®æ”¹é¡µé¢çš„ DOM ç»“æ„ï¼Œå°†æ”»å‡»è„šæœ¬å†™åœ¨ URL ä¸­ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»è¯¥ URLï¼Œå¦‚æœ URL è¢«è§£æï¼Œé‚£ä¹ˆæ”»å‡»è„šæœ¬å°±ä¼šè¢«è¿è¡Œï¼Œå’Œå‰ä¸¤è€… XSS æ”»å‡»åŒºåˆ«æ˜¯ï¼šå–å‡ºå’Œæ‰§è¡Œæ¶æ„ä»£ç ç”±æµè§ˆå™¨ç«¯å®Œæˆï¼Œä¸ç»è¿‡æœåŠ¡ç«¯ï¼Œå±äºå‰ç«¯ JavaScript è‡ªèº«çš„å®‰å…¨æ¼æ´ï¼Œè€Œå…¶ä»–ä¸¤ç§ XSS éƒ½å±äºæœåŠ¡ç«¯çš„å®‰å…¨æ¼æ´ä¸»è¦åœ¨äº DOM å‹æ”»å‡»ã€‚</p><p>ä¾‹å­å¼•ç”¨è‡ªï¼š<a href="https://juejin.im/post/6844904090019840007#heading-5" target="_blank" rel="noopener">DOM å‹æ”»å‡»ä¾‹å­</a></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>XSS:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"input"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'input'</span>)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'div'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> val</span></span><br><span class="line"></span><br><span class="line">  input.addEventListener(</span><br><span class="line"><span class="actionscript">    <span class="string">'change'</span>,</span></span><br><span class="line">    e =&gt; &#123;</span><br><span class="line">      val = e.target.value</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    <span class="literal">false</span></span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  btn.addEventListener(</span><br><span class="line"><span class="actionscript">    <span class="string">'click'</span>,</span></span><br><span class="line">    () =&gt; &#123;</span><br><span class="line"><span class="handlebars"><span class="xml">      div.innerHTML = `<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">$&#123;val&#125;</span>&gt;</span>testLink<span class="tag">&lt;/<span class="name">a</span>&gt;</span>`</span></span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    <span class="literal">false</span></span></span><br><span class="line">  )</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç‚¹å‡» Submit æŒ‰é’®åï¼Œä¼šåœ¨å½“å‰é¡µé¢æ’å…¥ä¸€ä¸ªé“¾æ¥ï¼Œå…¶åœ°å€ä¸ºç”¨æˆ·çš„è¾“å…¥å†…å®¹ã€‚å¦‚æœç”¨æˆ·åœ¨è¾“å…¥æ—¶æ„é€ äº†å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;&#39; onclick&#x3D;alert(&#x2F;xss&#x2F;)</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·æäº¤ä¹‹åï¼Œé¡µé¢ä»£ç å°±å˜æˆäº†ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> <span class="attr">onlick</span>=<span class="string">"alert(/xss/)"</span>&gt;</span>testLink<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œç”¨æˆ·ç‚¹å‡»ç”Ÿæˆçš„é“¾æ¥ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„è„šæœ¬ã€‚</p><h3 id="å¦‚ä½•é˜²èŒƒ-XSS"><a href="#å¦‚ä½•é˜²èŒƒ-XSS" class="headerlink" title="å¦‚ä½•é˜²èŒƒ XSS"></a>å¦‚ä½•é˜²èŒƒ XSS</h3><p>æ€»ä½“å°±æ˜¯<strong>ä¸èƒ½å°†ç”¨æˆ·çš„è¾“å…¥ç›´æ¥å­˜åˆ°æœåŠ¡å™¨ï¼Œéœ€è¦å¯¹ä¸€äº›æ•°æ®è¿›è¡Œç‰¹æ®Šå¤„ç†</strong></p><h4 id="è®¾ç½®-HttpOnly"><a href="#è®¾ç½®-HttpOnly" class="headerlink" title="è®¾ç½® HttpOnly"></a>è®¾ç½® HttpOnly</h4><p>HttpOnly æ˜¯ä¸€ä¸ªè®¾ç½® cookie æ˜¯å¦å¯ä»¥è¢« javasript è„šæœ¬è¯»å–çš„å±æ€§ï¼Œæµè§ˆå™¨ä¼šç¦æ­¢é¡µé¢çš„ Javascript è®¿é—®å¸¦æœ‰ HttpOnly å±æ€§çš„ Cookieã€‚</p><p>ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ç§æ–¹å¼ä¸æ˜¯é˜²å¾¡ XSSï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·è¢« XSS æ”»å‡»ä¹‹åï¼Œä¸è¢«è·å– Cookie æ•°æ®ã€‚</p><h4 id="CSP-å†…å®¹å®‰å…¨ç­–ç•¥"><a href="#CSP-å†…å®¹å®‰å…¨ç­–ç•¥" class="headerlink" title="CSP å†…å®¹å®‰å…¨ç­–ç•¥"></a>CSP å†…å®¹å®‰å…¨ç­–ç•¥</h4><p>CSP(content security policy)ï¼Œæ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œç”¨äºæ£€æµ‹å¹¶å‰Šå¼±æŸäº›ç‰¹å®šç±»å‹çš„æ”»å‡»ï¼ŒåŒ…æ‹¬è·¨ç«™è„šæœ¬ (XSS) å’Œæ•°æ®æ³¨å…¥æ”»å‡»ç­‰ã€‚</p><p>CSP å¯ä»¥é€šè¿‡ HTTP å¤´éƒ¨ï¼ˆContent-Security-Policyï¼‰æˆ–</p><meta>å…ƒç´ é…ç½®é¡µé¢çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œä»¥æ§åˆ¶æµè§ˆå™¨å¯ä»¥ä¸ºè¯¥é¡µé¢è·å–å“ªäº›èµ„æºã€‚æ¯”å¦‚ä¸€ä¸ªå¯ä»¥ä¸Šä¼ æ–‡ä»¶å’Œæ˜¾ç¤ºå›¾ç‰‡é¡µé¢ï¼Œåº”è¯¥å…è®¸å›¾ç‰‡æ¥è‡ªä»»ä½•åœ°æ–¹ï¼Œä½†é™åˆ¶è¡¨å•çš„ action å±æ€§åªå¯ä»¥èµ‹å€¼ä¸ºæŒ‡å®šçš„ç«¯ç‚¹ã€‚<p></p><p>ç°åœ¨ä¸»æµçš„æµè§ˆå™¨å†…ç½®äº†é˜²èŒƒ XSS çš„æªæ–½ï¼Œå¼€å¯ CSPï¼Œå³å¼€å¯ç™½åå•ï¼Œå¯é˜»æ­¢ç™½åå•ä»¥å¤–çš„èµ„æºåŠ è½½å’Œè¿è¡Œ</p><h4 id="è¾“å…¥æ£€æŸ¥"><a href="#è¾“å…¥æ£€æŸ¥" class="headerlink" title="è¾“å…¥æ£€æŸ¥"></a>è¾“å…¥æ£€æŸ¥</h4><p>å¯¹äºç”¨æˆ·çš„ä»»ä½•è¾“å…¥è¦è¿›è¡Œç¼–ç ã€è§£ç å’Œè¿‡æ»¤ï¼š</p><ul><li>ç¼–ç ï¼šä¸èƒ½å¯¹ç”¨æˆ·è¾“å…¥çš„å†…å®¹éƒ½ä¿æŒåŸæ ·ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œå­—ç¬¦å®ä½“ç¼–ç è½¬ä¹‰</li><li>è§£ç ï¼šåŸæ ·æ˜¾ç¤ºå†…å®¹çš„æ—¶å€™å¿…é¡»è§£ç ï¼Œä¸ç„¶æ˜¾ç¤ºä¸åˆ°å†…å®¹äº†</li><li>è¿‡æ»¤ï¼šæŠŠè¾“å…¥çš„ä¸€äº›ä¸åˆæ³•çš„ä¸œè¥¿éƒ½è¿‡æ»¤æ‰ï¼Œä»è€Œä¿è¯å®‰å…¨æ€§ã€‚å¦‚ç§»é™¤ç”¨æˆ·ä¸Šä¼ çš„ DOM å±æ€§ï¼Œå¦‚ onerrorï¼Œç§»é™¤ç”¨æˆ·ä¸Šä¼ çš„ Style èŠ‚ç‚¹ã€iframeã€script èŠ‚ç‚¹ç­‰</li></ul><p>å¯¹ç”¨æˆ·è¾“å…¥æ‰€åŒ…å«çš„ç‰¹æ®Šå­—ç¬¦æˆ–æ ‡ç­¾è¿›è¡Œç¼–ç æˆ–è¿‡æ»¤ï¼Œå¦‚ <code>&lt;</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>script</code>ï¼Œé˜²æ­¢ XSS æ”»å‡»</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escHTML</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!str) <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">    .replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)</span><br><span class="line">    .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</span><br><span class="line">    .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>)</span><br><span class="line">    .replace(<span class="regexp">/x27/g</span>, <span class="string">'&amp;#039;'</span>)</span><br><span class="line">    .replace(<span class="regexp">/x22/g</span>, <span class="string">'&amp;quto;'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¾“å‡ºæ£€æŸ¥"><a href="#è¾“å‡ºæ£€æŸ¥" class="headerlink" title="è¾“å‡ºæ£€æŸ¥"></a>è¾“å‡ºæ£€æŸ¥</h4><p>ç”¨æˆ·çš„è¾“å…¥ä¼šå­˜åœ¨é—®é¢˜ï¼ŒæœåŠ¡ç«¯çš„è¾“å‡ºä¹Ÿä¼šå­˜åœ¨é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé™¤å¯Œæ–‡æœ¬çš„è¾“å‡ºå¤–ï¼Œåœ¨å˜é‡è¾“å‡ºåˆ° HTML é¡µé¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç æˆ–è½¬ä¹‰çš„æ–¹å¼æ¥é˜²å¾¡ XSS æ”»å‡»ã€‚ä¾‹å¦‚åˆ©ç”¨ <a href="https://github.com/apostrophecms/sanitize-html" target="_blank" rel="noopener">sanitize-html</a> å¯¹è¾“å‡ºå†…å®¹è¿›è¡Œæœ‰è§„åˆ™çš„è¿‡æ»¤ä¹‹åå†è¾“å‡ºåˆ°é¡µé¢ä¸­ã€‚</p><h4 id="è¾“å…¥å†…å®¹é•¿åº¦æ§åˆ¶"><a href="#è¾“å…¥å†…å®¹é•¿åº¦æ§åˆ¶" class="headerlink" title="è¾“å…¥å†…å®¹é•¿åº¦æ§åˆ¶"></a>è¾“å…¥å†…å®¹é•¿åº¦æ§åˆ¶</h4><p>å¯¹äºä¸å—ä¿¡ä»»çš„è¾“å…¥ï¼Œéƒ½åº”è¯¥é™å®šä¸€ä¸ªåˆç†çš„é•¿åº¦ã€‚è™½ç„¶æ— æ³•å®Œå…¨é˜²æ­¢ XSS å‘ç”Ÿï¼Œä½†å¯ä»¥å¢åŠ  XSS æ”»å‡»çš„éš¾åº¦ã€‚</p><h4 id="éªŒè¯ç "><a href="#éªŒè¯ç " class="headerlink" title="éªŒè¯ç "></a>éªŒè¯ç </h4><p>é˜²æ­¢è„šæœ¬å†’å……ç”¨æˆ·æäº¤å±é™©æ“ä½œã€‚</p><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>CSRF(Cross Site Request Forgery)æŒ‡çš„æ˜¯<strong>è·¨ç«™è¯·æ±‚ä¼ªé€ </strong>ï¼Œæ˜¯ä¸€ç§åŠ«æŒå—ä¿¡ä»»ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€éé¢„æœŸè¯·æ±‚çš„æ”»å‡»æ–¹å¼ã€‚è·¨åŸŸæŒ‡çš„æ˜¯è¯·æ±‚æ¥æºäºå…¶ä»–ç½‘ç«™ï¼Œä¼ªé€ æŒ‡çš„æ˜¯éç”¨æˆ·è‡ªèº«çš„æ„æ„¿ã€‚</p><h3 id="æ”»å‡»æ–¹å¼-1"><a href="#æ”»å‡»æ–¹å¼-1" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h3><p>æ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚</p><p>ä¸ XSS æ”»å‡»ä¸åŒçš„æ˜¯ï¼šXSS æ˜¯æ”»å‡»è€…ç›´æ¥å¯¹æˆ‘ä»¬çš„ç½‘ç«™ A è¿›è¡Œæ³¨å…¥æ”»å‡»ï¼ŒCSRF æ˜¯é€šè¿‡ç½‘ç«™ B å¯¹æˆ‘ä»¬çš„ç½‘ç«™ A è¿›è¡Œä¼ªé€ è¯·æ±‚ã€‚</p><p>ä¾‹å­ï¼šä½ ç™»å½•è´­ç‰©ç½‘ç«™ A ä¹‹åç‚¹å‡»ä¸€ä¸ªæ¶æ„é“¾æ¥ Bï¼ŒB è¯·æ±‚äº†ç½‘ç«™ A çš„ä¸‹å•æ¥å£ï¼Œç»“æœæ˜¯åœ¨ç½‘ç«™ A çš„å¸å·ç”Ÿæˆä¸€ä¸ªè®¢å•ã€‚å…¶èƒŒåçš„åŸç†æ˜¯ï¼šç½‘ç«™ B é€šè¿‡è¡¨å•ã€get è¯·æ±‚æ¥ä¼ªé€ ç½‘ç«™ A çš„è¯·æ±‚ï¼Œè¿™æ—¶å€™è¯·æ±‚ä¼šå¸¦ä¸Šç½‘ç«™ A çš„ cookiesï¼Œè‹¥ç™»å½•æ€æ˜¯ä¿å­˜åœ¨ cookies ä¸­ï¼Œåˆ™å®ç°äº†ä¼ªé€ æ”»å‡»ã€‚</p><p>è·¨ç«™è¯·æ±‚å¯ä»¥ç”¨å„ç§æ–¹å¼ï¼šå›¾ç‰‡ URLã€è¶…é“¾æ¥ã€CORSã€Form æäº¤ç­‰ç­‰ã€‚éƒ¨åˆ†è¯·æ±‚æ–¹å¼å¯ä»¥ç›´æ¥åµŒå…¥åœ¨ç¬¬ä¸‰æ–¹è®ºå›ã€æ–‡ç« ä¸­ã€‚</p><h3 id="CSRF-å±å®³"><a href="#CSRF-å±å®³" class="headerlink" title="CSRF å±å®³"></a>CSRF å±å®³</h3><ul><li>ç”¨æˆ·çš„ç™»å½•æ€è¢«ç›—ç”¨</li><li>å†’å……ç”¨æˆ·å®Œæˆæ“ä½œæˆ–ä¿®æ”¹æ•°æ®</li></ul><h3 id="CSRF-çš„ç±»å‹"><a href="#CSRF-çš„ç±»å‹" class="headerlink" title="CSRF çš„ç±»å‹"></a>CSRF çš„ç±»å‹</h3><h4 id="GET-ç±»å‹çš„-CSRF"><a href="#GET-ç±»å‹çš„-CSRF" class="headerlink" title="GET ç±»å‹çš„ CSRF"></a>GET ç±»å‹çš„ CSRF</h4><p>ä¾‹å­å¼•å…¥è‡ªï¼š<a href="https://juejin.im/post/6844903904585449479#heading-1" target="_blank" rel="noopener">GET CSRF ä¾‹å­</a></p><p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç›®æ ‡ç½‘ç«™ A(<code>www.a.com</code>)ï¼Œæ¶æ„ç½‘ç«™ B(<code>www.b.com</code>)</p><p>ä¸¤ä¸ªç½‘ç«™çš„åŸŸåä¸ä¸€æ ·ï¼Œç›®æ ‡ç½‘ç«™ A ä¸Šæœ‰ä¸€ä¸ªåˆ é™¤æ–‡ç« çš„åŠŸèƒ½ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·å•å‡»â€™åˆ é™¤æ–‡ç« â€™é“¾æ¥æ—¶æ‰ä¼šåˆ é™¤æŒ‡å®šçš„æ–‡ç« ã€‚è¿™ä¸ªé“¾æ¥æ˜¯<code>www.a.com/blog/del?id=1</code>, id ä»£è¡¨ä¸åŒçš„æ–‡ç« ã€‚å®é™…ä¸Šå°±æ˜¯å‘èµ·ä¸€ä¸ª GET è¯·æ±‚</p><ul><li>æ— æ³•ä½¿ç”¨ Ajax å‘èµ· GET è¯·æ±‚ã€‚å› ä¸º CSRF è¯·æ±‚æ˜¯è·¨åŸŸçš„ï¼Œè€Œ Ajax æœ‰åŒæºç­–ç•¥çš„é™åˆ¶</li><li>å¯ä»¥é€šè¿‡åœ¨æ¶æ„ç½‘ç«™ B ä¸Šé™æ€æˆ–è€…åŠ¨æ€åˆ›å»º img,script ç­‰æ ‡ç­¾å‘èµ· GET è¯·æ±‚ã€‚å°†å…¶ src å±æ€§æŒ‡å‘<code>www.a.com/blog/del?id=1</code>ã€‚é€šè¿‡æ ‡ç­¾çš„æ–¹å¼å‘èµ·çš„è¯·æ±‚ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶</li><li>æœ€åæ¬ºéª—å·²ç»ç™»å½•ç›®æ ‡ç½‘ç«™ A çš„ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™ Bï¼Œé‚£ä¹ˆå°±ä¼šæºå¸¦ç½‘ç«™ A æºçš„ç™»å½•å‡­è¯å‘ç½‘ç«™ A åå°å‘èµ·è¯·æ±‚ï¼Œè¿™æ ·æ”»å‡»å°±å‘ç”Ÿäº†</li></ul><p>CSRF æ”»å‡»æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ul><li>è¯·æ±‚æ˜¯è·¨åŸŸçš„ï¼Œå¯ä»¥çœ‹å‡ºè¯·æ±‚æ˜¯ä»æ¶æ„ç½‘ç«™ B ä¸Šå‘å‡ºçš„</li><li>é€šè¿‡ img, script ç­‰æ ‡ç­¾æ¥å‘èµ·ä¸€ä¸ª GET è¯·æ±‚ï¼Œå› ä¸ºè¿™äº›æ ‡ç­¾ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶</li><li>å‘å‡ºçš„è¯·æ±‚æ˜¯èº«ä»½è®¤è¯åçš„</li></ul><h4 id="POST-ç±»å‹çš„-CSRF"><a href="#POST-ç±»å‹çš„-CSRF" class="headerlink" title="POST ç±»å‹çš„ CSRF"></a>POST ç±»å‹çš„ CSRF</h4><p>å‡å¦‚ç›®æ ‡ç½‘ç«™ A ä¸Šæœ‰å‘è¡¨æ–‡ç« çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŠ¨æ€åˆ›å»º form æ ‡ç­¾ï¼Œç„¶åä¿®æ”¹æ–‡ç« çš„é¢˜ç›®ã€‚</p><p>åœ¨ç½‘ç«™ B ä¸­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setForm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> form = <span class="built_in">document</span>.createElement(<span class="string">'form'</span>)</span><br><span class="line">  form.action = <span class="string">'www.a.com/blog/article/update'</span></span><br><span class="line">  form.methods = <span class="string">'POST'</span></span><br><span class="line">  <span class="keyword">var</span> input = <span class="built_in">document</span>.createElement(<span class="string">'input'</span>)</span><br><span class="line">  input.type = <span class="string">'text'</span></span><br><span class="line">  input.value = <span class="string">'csfræ”»å‡»å•¦ï¼'</span></span><br><span class="line">  input.id = <span class="string">'title'</span></span><br><span class="line">  form.appendChild(input)</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(form)</span><br><span class="line">  form.submit()</span><br><span class="line">&#125;</span><br><span class="line">setForm()</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒåŠ¨æ€åˆ›å»ºäº† form è¡¨å•ï¼Œç„¶åè°ƒç”¨ submit æ–¹æ³•ï¼Œå°±å¯ä»¥é€šè¿‡è·¨åŸŸçš„ä¼ªé€ è¯·æ±‚æ¥å®ç°ä¿®æ”¹ç›®æ ‡ç½‘ç«™ A çš„æŸç¯‡æ–‡ç« çš„æ ‡é¢˜äº†ã€‚</p><p>é€šå¸¸æ˜¯åˆ©ç”¨è‡ªåŠ¨æäº¤çš„è¡¨å•</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://xxx.com/money"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"account"</span> <span class="attr">value</span>=<span class="string">"jacky"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"amount"</span> <span class="attr">value</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.forms[<span class="number">0</span>].submit()</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é“¾æ¥ç±»å‹çš„-CSRF"><a href="#é“¾æ¥ç±»å‹çš„-CSRF" class="headerlink" title="é“¾æ¥ç±»å‹çš„ CSRF"></a>é“¾æ¥ç±»å‹çš„ CSRF</h4><p>é“¾æ¥ç±»å‹çš„ CSRF å¹¶ä¸å¸¸è§ï¼Œæ¯”èµ·å…¶ä»–ä¸¤ç§ç”¨æˆ·æ‰“å¼€é¡µé¢å°±ä¸­æ‹›çš„æƒ…å†µï¼Œè¿™ç§éœ€è¦ç”¨æˆ·ç‚¹å‡»é“¾æ¥æ‰ä¼šè§¦å‘ã€‚è¿™ç§ç±»å‹é€šå¸¸æ˜¯åœ¨è®ºå›ä¸­å‘å¸ƒçš„å›¾ç‰‡ä¸­åµŒå…¥æ¶æ„é“¾æ¥ï¼Œæˆ–è€…ä»¥å¹¿å‘Šçš„å½¢å¼è¯±å¯¼ç”¨æˆ·ä¸­æ‹›ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šä»¥æ¯”è¾ƒå¤¸å¼ çš„è¯è¯­è¯±éª—ç”¨æˆ·ç‚¹å‡»ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker"</span> <span class="attr">taget</span>=<span class="string">"_blank"</span>&gt;</span> é‡ç£…æ¶ˆæ¯ï¼ï¼ <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•é˜²èŒƒ-CSRF"><a href="#å¦‚ä½•é˜²èŒƒ-CSRF" class="headerlink" title="å¦‚ä½•é˜²èŒƒ CSRF"></a>å¦‚ä½•é˜²èŒƒ CSRF</h3><h4 id="éªŒè¯ç -1"><a href="#éªŒè¯ç -1" class="headerlink" title="éªŒè¯ç "></a>éªŒè¯ç </h4><p>ç”±äº CSRF æ”»å‡»ä¼ªé€ è¯·æ±‚ä¸ä¼šç»è¿‡å—æ”»å‡»çš„ç½‘ç«™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ç½‘ç«™åŠ å…¥éªŒè¯ç ï¼Œè¿™æ ·å¿…é¡»é€šè¿‡éªŒè¯ç ä¹‹åæ‰èƒ½è¿›è¡Œè¯·æ±‚ï¼Œæœ‰æ•ˆçš„éåˆ¶äº† CSRF è¯·æ±‚ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½åŠ éªŒè¯ç ï¼Œé‚£æ ·ç”¨æˆ·ä½“éªŒä¼šéå¸¸ä¸å¥½ï¼Œåªèƒ½åœ¨éƒ¨åˆ†è¯·æ±‚æ·»åŠ ï¼Œä½œä¸ºä¸€ç§è¾…åŠ©çš„é˜²å¾¡æ‰‹æ®µã€‚</p><h4 id="éªŒè¯-Referer"><a href="#éªŒè¯-Referer" class="headerlink" title="éªŒè¯ Referer"></a>éªŒè¯ Referer</h4><p>åœ¨ HTTP åè®®ä¸­ï¼Œå¤´éƒ¨æœ‰ä¸ª Referer å­—æ®µï¼Œä»–è®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ï¼Œåœ¨æœåŠ¡ç«¯è®¾ç½®è¯¥å­—æ®µçš„æ£€éªŒï¼Œé€šè¿‡æ£€æŸ¥è¯¥å­—æ®µï¼Œå°±å¯ä»¥çŸ¥é“è¯¥è¯·æ±‚æ˜¯å¦åˆæ³•ï¼Œä¸è¿‡è¯·æ±‚å¤´ä¹Ÿå®¹æ˜“ä¼ªé€ ã€‚</p><h4 id="cookie-è®¾ç½®-SameSite"><a href="#cookie-è®¾ç½®-SameSite" class="headerlink" title="cookie è®¾ç½® SameSite"></a>cookie è®¾ç½® SameSite</h4><p>è®¾ç½® SameSiteï¼šè®¾ç½® cookie çš„ SameSite å€¼ä¸º strictï¼Œè¿™æ ·åªæœ‰åŒæºç½‘ç«™çš„è¯·æ±‚æ‰ä¼šå¸¦ä¸Š cookieã€‚è¿™æ · cookies å°±ä¸èƒ½è¢«å…¶ä»–åŸŸåç½‘ç«™ä½¿ç”¨ï¼Œè¾¾åˆ°äº†é˜²å¾¡çš„ç›®çš„ã€‚</p><h4 id="æ·»åŠ -token-éªŒè¯"><a href="#æ·»åŠ -token-éªŒè¯" class="headerlink" title="æ·»åŠ  token éªŒè¯"></a>æ·»åŠ  token éªŒè¯</h4><p>æµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ª tokenï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åŒæ—¶å¸¦ä¸Š token å’Œ cookie æ‰ä¼šè¢«è®¤ä¸ºæ˜¯åˆæ³•è¯·æ±‚</p><p>è¿™æ˜¯ä¸€ç§ç›¸å¯¹æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚è¦æŠµå¾¡ CSRFï¼Œå…³é”®åœ¨äºåœ¨è¯·æ±‚ä¸­æ”¾å…¥æ”»å‡»è€…æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯ä¸å­˜åœ¨äº Cookie ä¹‹ä¸­ã€‚åœ¨æœåŠ¡ç«¯éšæœºç”Ÿæˆ tokenï¼Œåœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥è¿™ä¸ª tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯å»ºç«‹ä¸€ä¸ªæ‹¦æˆªå™¨æ¥éªŒè¯è¿™ä¸ª tokenï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºå¯èƒ½æ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚</p><h4 id="æ›´æ¢ç™»å½•æ€æ–¹æ¡ˆ"><a href="#æ›´æ¢ç™»å½•æ€æ–¹æ¡ˆ" class="headerlink" title="æ›´æ¢ç™»å½•æ€æ–¹æ¡ˆ"></a>æ›´æ¢ç™»å½•æ€æ–¹æ¡ˆ</h4><p>å› ä¸º CSRF æœ¬è´¨æ˜¯ä¼ªé€ è¯·æ±‚æºå¸¦äº†ä¿å­˜åœ¨ cookies ä¸­çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹ session æœºåˆ¶çš„ç™»å½•æ€æ¯”è¾ƒä¸åˆ©ï¼Œå¦‚æœæ›´æ¢ JWTï¼ˆJSON Web Tokenï¼‰æ–¹æ¡ˆï¼Œå…¶ token ä¿¡æ¯ä¸€èˆ¬è®¾ç½®åˆ° HTTP å¤´éƒ¨çš„ï¼Œæ‰€ä»¥å¯ä»¥é˜²å¾¡ CSRF æ”»å‡»ã€‚</p><h2 id="CSRF-ä¸-XSS-åŒºåˆ«"><a href="#CSRF-ä¸-XSS-åŒºåˆ«" class="headerlink" title="CSRF ä¸ XSS åŒºåˆ«"></a>CSRF ä¸ XSS åŒºåˆ«</h2><p>æœ¬è´¨ä¸Šè®²ï¼ŒXSS æ˜¯ä»£ç æ³¨å…¥é—®é¢˜ï¼ŒCSRF æ˜¯ HTTP é—®é¢˜ã€‚XSS æ˜¯å†…å®¹æ²¡æœ‰è¿‡æ»¤å¯¼è‡´æµè§ˆå™¨å°†æ”»å‡»è€…çš„è¾“å…¥å½“ä»£ç æ‰§è¡Œã€‚CSRF åˆ™æ˜¯å› ä¸ºæµè§ˆå™¨åœ¨å‘é€ HTTP è¯·æ±‚æ—¶å€™è‡ªåŠ¨å¸¦ä¸Š cookieï¼Œè€Œä¸€èˆ¬ç½‘ç«™çš„ session éƒ½å­˜åœ¨ cookie é‡Œé¢ã€‚XSS åˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRF åˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·ç½‘é¡µæµè§ˆå™¨çš„ä¿¡ä»»ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><p><a href="https://juejin.im/post/6844903876106125319" target="_blank" rel="noopener">WEB å‰ç«¯å®‰å…¨â€”â€”XSS å’Œ CSRF</a></p><br></li><li><p>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œæ¬¢è¿ star</p></li></ul>]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>XSS</tag>
        <tag>CSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>è°ˆè°ˆå¯¹ React æ–°æ—§ç”Ÿå‘½å‘¨æœŸçš„ç†è§£</title>
    <url>/2020/11/30/%E8%B0%88%E8%B0%88%E5%AF%B9-React-%E6%96%B0%E6%97%A7%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<p>åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒReact å·²ç»å‡ºäº† 17.0.1 ç‰ˆæœ¬äº†ï¼Œè™½è¯´è¿˜æ¥è®¨è®ºç›®å‰ React æ–°æ—§ç”Ÿå‘½å‘¨æœŸæœ‰ç‚¹æ™šäº†ï¼ŒReact ä¸¤ä¸ªæ–°ç”Ÿå‘½å‘¨æœŸè™½ç„¶å‡ºäº†å¾ˆä¹…ï¼Œä½†å®é™…å¼€å‘æˆ‘å´æ²¡æœ‰ç”¨è¿‡ï¼Œå› ä¸º React 16 ç‰ˆæœ¬åæˆ‘ä»¬ç›´æ¥ React Hook èµ·é£å¼€å‘é¡¹ç›®ã€‚</p><p>ä½†å¯¹æ–°æ—§ç”Ÿå‘½å‘¨æœŸçš„æ¢ç´¢ï¼Œè¿˜æ˜¯æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½ç†è§£ React å›¢é˜Ÿä¸€äº›æ€æƒ³å’Œåšæ³•ï¼Œäºæ˜¯ä»Šå¤©å°±è¦å›é¡¾ä¸‹è¿™ä¸ªé—®é¢˜å’Œç†è§£æ€»ç»“ã€‚</p><a id="more"></a><p>æœ¬æ–‡åªè®¨è®º React17 ç‰ˆæœ¬å‰çš„ã€‚</p><h2 id="React-16-ç‰ˆæœ¬ååšäº†ä»€ä¹ˆ"><a href="#React-16-ç‰ˆæœ¬ååšäº†ä»€ä¹ˆ" class="headerlink" title="React 16 ç‰ˆæœ¬ååšäº†ä»€ä¹ˆ"></a>React 16 ç‰ˆæœ¬ååšäº†ä»€ä¹ˆ</h2><p>é¦–å…ˆæ˜¯ç»™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°åŠ ä¸Šäº† UNSAFEï¼š</p><ul><li>UNSAFE_componentWillMount</li><li>UNSAFE_componentWillReceiveProps</li><li>UNSAFE_componentWillUpdate</li></ul><p>è¿™é‡Œå¹¶ä¸æ˜¯è¡¨ç¤ºä¸å®‰å…¨çš„æ„æ€ï¼Œå®ƒåªæ˜¯ä¸å»ºè®®ç»§ç»­ä½¿ç”¨ï¼Œå¹¶è¡¨ç¤ºä½¿ç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„ä»£ç å¯èƒ½åœ¨æœªæ¥çš„ React ç‰ˆæœ¬ï¼ˆç›®å‰ React17 è¿˜æ²¡æœ‰å®Œå…¨åºŸé™¤ï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå¦‚ React Fiber å¼‚æ­¥æ¸²æŸ“çš„å‡ºç°ã€‚</p><p>åŒæ—¶æ–°å¢äº†ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š</p><ul><li>getDerivedStateFromProps</li><li>getSnapshotBeforeUpdate</li></ul><h2 id="UNSAFE-componentWillReceiveProps"><a href="#UNSAFE-componentWillReceiveProps" class="headerlink" title="UNSAFE_componentWillReceiveProps"></a>UNSAFE_componentWillReceiveProps</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UNSAFE_componentWillReceiveProps(nextProps)</span><br></pre></td></tr></table></figure><p>å…ˆæ¥è¯´è¯´è¿™ä¸ªå‡½æ•°ï¼Œ<code>componentWillReceiveProps</code></p><p>è¯¥å­ç»„ä»¶æ–¹æ³•å¹¶ä¸æ˜¯çˆ¶ç»„ä»¶ props æ”¹å˜æ‰è§¦å‘ï¼Œå®˜æ–¹å›ç­”æ˜¯ï¼š</p><blockquote><p>å¦‚æœçˆ¶ç»„ä»¶å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿ props æ²¡æœ‰æ›´æ”¹ï¼Œä¹Ÿä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚å¦‚æœåªæƒ³å¤„ç†æ›´æ”¹ï¼Œè¯·ç¡®ä¿è¿›è¡Œå½“å‰å€¼ä¸å˜æ›´å€¼çš„æ¯”è¾ƒã€‚</p></blockquote><p>å…ˆæ¥è¯´è¯´ React ä¸ºä»€ä¹ˆåºŸé™¤è¯¥å‡½æ•°ï¼ŒåºŸé™¤è‚¯å®šæœ‰å®ƒä¸å¥½çš„åœ°æ–¹ã€‚</p><p><code>componentWillReceiveProps</code>å‡½æ•°çš„ä¸€èˆ¬ä½¿ç”¨åœºæ™¯æ˜¯ï¼š</p><ul><li>å¦‚æœç»„ä»¶è‡ªèº«çš„æŸä¸ª state è·Ÿçˆ¶ç»„ä»¶ä¼ å…¥çš„ props å¯†åˆ‡ç›¸å…³çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­åˆ¤æ–­å‰åä¸¤ä¸ª props æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸åŒå°±æ ¹æ® props æ¥æ›´æ–°ç»„ä»¶è‡ªèº«çš„ stateã€‚<br>ç±»ä¼¼çš„ä¸šåŠ¡éœ€æ±‚æ¯”å¦‚ï¼šä¸€ä¸ªå¯ä»¥æ¨ªå‘æ»‘åŠ¨çš„åˆ—è¡¨ï¼Œå½“å‰é«˜äº®çš„ Tab æ˜¾ç„¶éš¶å±äºåˆ—è¡¨è‡ªèº«çš„çŠ¶æ€ï¼Œä½†å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸šåŠ¡éœ€æ±‚ä¼šè¦æ±‚ä»å¤–éƒ¨è·³è½¬è‡³åˆ—è¡¨æ—¶ï¼Œæ ¹æ®ä¼ å…¥çš„æŸä¸ªå€¼ï¼Œç›´æ¥å®šä½åˆ°æŸä¸ª Tabã€‚</li></ul><p>ä½†è¯¥æ–¹æ³•ç¼ºç‚¹æ˜¯ä¼šç ´å state æ•°æ®çš„å•ä¸€æ•°æ®æºï¼Œå¯¼è‡´ç»„ä»¶çŠ¶æ€å˜å¾—ä¸å¯é¢„æµ‹ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¼šå¢åŠ ç»„ä»¶çš„é‡ç»˜æ¬¡æ•°ã€‚</p><p>è€Œåœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå®˜æ–¹å°†æ›´æ–° state ä¸è§¦å‘å›è°ƒé‡æ–°åˆ†é…åˆ°äº† <code>getDerivedStateFromProps</code> ä¸ <code>componentDidUpdate</code> ä¸­ï¼Œä½¿å¾—ç»„ä»¶æ•´ä½“çš„æ›´æ–°é€»è¾‘æ›´ä¸ºæ¸…æ™°ã€‚</p><p>æ–°ç”Ÿå‘½å‘¨æœŸæ–¹æ³•<code>static getDerivedStateFromProps(props, state)</code>æ€ä¹ˆç”¨å‘¢ï¼Ÿ</p><blockquote><p>getDerivedStateFromProps ä¼šåœ¨è°ƒç”¨ render æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå¹¶ä¸”åœ¨åˆå§‹æŒ‚è½½åŠåç»­æ›´æ–°æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚å®ƒåº”è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° stateï¼Œå¦‚æœè¿”å› null åˆ™ä¸æ›´æ–°ä»»ä½•å†…å®¹ã€‚</p></blockquote><p>ä»å‡½æ•°åå­—å°±å¯ä»¥çœ‹å‡ºå¤§æ¦‚æ„æ€ï¼šä½¿ç”¨ props æ¥æ´¾ç”Ÿ/æ›´æ–° stateã€‚è¿™å°±æ˜¯é‡ç‚¹äº†ï¼Œä½†å‡¡ä½ æƒ³ä½¿ç”¨è¯¥å‡½æ•°ï¼Œéƒ½å¿…é¡»å‡ºäºè¯¥ç›®çš„ï¼Œä½¿ç”¨å®ƒæ‰æ˜¯æ­£ç¡®ä¸”ç¬¦åˆè§„èŒƒçš„ã€‚</p><p>è·Ÿ<code>getDerivedStateFromProps</code>ä¸åŒçš„æ˜¯ï¼Œå®ƒåœ¨æŒ‚è½½å’Œæ›´æ–°é˜¶æ®µéƒ½ä¼šæ‰§è¡Œï¼ˆ<code>componentWillReceiveProps</code>æŒ‚è½½é˜¶æ®µä¸ä¼šæ‰§è¡Œï¼‰ï¼Œå› ä¸ºæ›´æ–° state è¿™ç§éœ€æ±‚ä¸ä»…åœ¨ props æ›´æ–°æ—¶å­˜åœ¨ï¼Œåœ¨ props åˆå§‹åŒ–æ—¶ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚</p><p>è€Œä¸”<code>getDerivedStateFromProps</code>åœ¨ç»„ä»¶è‡ªèº« state æ›´æ–°ä¹Ÿä¼šæ‰§è¡Œè€Œ<code>componentWillReceiveProps</code>æ–¹æ³•æ‰§è¡Œåˆ™å–å†³äºçˆ¶ç»„ä»¶çš„æ˜¯å¦è§¦å‘é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿå¯ä»¥çœ‹å‡º<code>getDerivedStateFromProps</code>å¹¶ä¸æ˜¯ <code>componentWillReceiveProps</code>æ–¹æ³•çš„æ›¿ä»£å“.</p><p>å¼•èµ·æˆ‘ä»¬æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸ä¾èµ–ç»„ä»¶å®ä¾‹è€Œå­˜åœ¨ï¼Œæ•…åœ¨è¯¥æ–¹æ³•å†…éƒ¨æ˜¯æ— æ³•è®¿é—® this çš„ã€‚æ–°ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸæ–¹æ³•èƒ½åšçš„äº‹æƒ…åè€Œæ›´å°‘äº†ï¼Œé™åˆ¶æˆ‘ä»¬åªèƒ½æ ¹æ® props æ¥æ´¾ç”Ÿ stateï¼Œå®˜æ–¹æ˜¯åŸºäºä»€ä¹ˆè€ƒé‡å‘¢ï¼Ÿ</p><p>å› ä¸ºæ— æ³•æ‹¿åˆ°ç»„ä»¶å®ä¾‹çš„ thisï¼Œè¿™ä¹Ÿå¯¼è‡´æˆ‘ä»¬æ— æ³•åœ¨å‡½æ•°å†…éƒ¨åš this.fetch()è¯·æ±‚ï¼Œæˆ–è€…ä¸åˆç†çš„ this.setState()æ“ä½œå¯¼è‡´å¯èƒ½çš„æ­»å¾ªç¯æˆ–å…¶ä»–å‰¯ä½œç”¨ã€‚æœ‰æ²¡æœ‰å‘ç°ï¼Œè¿™éƒ½æ˜¯ä¸åˆç†ä¸è§„èŒƒçš„æ“ä½œï¼Œä½†å¼€å‘è€…ä»¬éƒ½æœ‰æœºä¼šè¿™æ ·ç”¨ã€‚å¯å¦‚æœåŠ äº†ä¸ªé™æ€ staticï¼Œé—´æ¥å¼ºåˆ¶æˆ‘ä»¬éƒ½æ— æ³•åšäº†ï¼Œä¹Ÿä»è€Œé¿å…å¯¹ç”Ÿå‘½å‘¨æœŸçš„æ»¥ç”¨ã€‚</p><p>React å®˜æ–¹ä¹Ÿæ˜¯é€šè¿‡è¯¥é™åˆ¶ï¼Œå°½é‡ä¿æŒç”Ÿå‘½å‘¨æœŸè¡Œä¸ºçš„å¯æ§å¯é¢„æµ‹ï¼Œæ ¹æºä¸Šå¸®åŠ©äº†æˆ‘ä»¬é¿å…ä¸åˆç†çš„ç¼–ç¨‹æ–¹å¼ï¼Œå³ä¸€ä¸ª API è¦ä¿æŒå•ä¸€æ€§ï¼Œåšä¸€ä»¶äº‹çš„ç†å¿µã€‚</p><p>å¦‚ä¸‹ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line">componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">  <span class="keyword">if</span> (nextProps.isLogin !== <span class="keyword">this</span>.props.isLogin) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      isLogin: nextProps.isLogin,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (nextProps.isLogin) &#123;</span><br><span class="line">    <span class="keyword">this</span>.handleClose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="keyword">static</span> getDerivedStateFromProps(nextProps, prevState) &#123;</span><br><span class="line">  <span class="keyword">if</span> (nextProps.isLogin !== prevState.isLogin) &#123; <span class="comment">// è¢«å¯¹æ¯”çš„propsä¼šè¢«ä¿å­˜ä¸€ä»½åœ¨stateé‡Œ</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      isLogin: nextProps.isLogin, <span class="comment">// getDerivedStateFromProps çš„è¿”å›å€¼ä¼šè‡ªåŠ¨ setState</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidUpdate(prevProps, prevState) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!prevState.isLogin &amp;&amp; <span class="keyword">this</span>.props.isLogin) &#123;</span><br><span class="line">    <span class="keyword">this</span>.handleClose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="UNSAVE-componentWillMount"><a href="#UNSAVE-componentWillMount" class="headerlink" title="UNSAVE_componentWillMount"></a>UNSAVE_componentWillMount</h2><blockquote><p>UNSAFE_componentWillMount() åœ¨æŒ‚è½½ä¹‹å‰è¢«è°ƒç”¨ã€‚å®ƒåœ¨ render() ä¹‹å‰è°ƒç”¨ï¼Œå› æ­¤åœ¨æ­¤æ–¹æ³•ä¸­åŒæ­¥è°ƒç”¨ setState() ä¸ä¼šè§¦å‘é¢å¤–æ¸²æŸ“ã€‚</p></blockquote><p>æˆ‘ä»¬åº”è¯¥é¿å…åœ¨æ­¤æ–¹æ³•ä¸­å¼•å…¥ä»»ä½•å‰¯ä½œç”¨æˆ–äº‹ä»¶è®¢é˜…ï¼Œè€Œæ˜¯é€‰ç”¨<code>componentDidMount()</code>ã€‚</p><p>åœ¨ React åˆå­¦è€…åˆšæ¥è§¦çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰è¿™æ ·ä¸€ä¸ªç–‘é—®ï¼šä¸€èˆ¬éƒ½æ˜¯æ•°æ®è¯·æ±‚æ”¾åœ¨<code>componentDidMount</code>é‡Œé¢ï¼Œä½†æ”¾åœ¨<code>componentWillMount</code>ä¸æ˜¯ä¼šæ›´å¿«è·å–æ•°æ®å—ï¼Ÿ</p><p>å› ä¸ºç†è§£æ˜¯<code>componentWillMount</code>åœ¨ render ä¹‹å‰æ‰§è¡Œï¼Œæ—©ä¸€ç‚¹æ‰§è¡Œå°±æ—©æ‹¿åˆ°è¯·æ±‚ç»“æœï¼›ä½†æ˜¯å…¶å®ä¸ç®¡ä½ è¯·æ±‚å¤šå¿«ï¼Œéƒ½èµ¶ä¸ä¸Šé¦–æ¬¡ renderï¼Œé¡µé¢é¦–æ¬¡æ¸²æŸ“ä¾æ—§å¤„äºæ²¡æœ‰è·å–å¼‚æ­¥æ•°æ®çš„çŠ¶æ€ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªåŸå› ï¼Œ<code>componentWillMount</code>æ˜¯æœåŠ¡ç«¯æ¸²æŸ“å”¯ä¸€ä¼šè°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¦‚æœä½ åœ¨æ­¤æ–¹æ³•ä¸­è¯·æ±‚æ•°æ®ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½ä¼šåˆ†åˆ«è¯·æ±‚ä¸¤æ¬¡ç›¸åŒçš„æ•°æ®ï¼Œè¿™æ˜¾ç„¶ä¹Ÿæˆ‘ä»¬æƒ³çœ‹åˆ°çš„ç»“æœã€‚</p><p>ç‰¹åˆ«æ˜¯æœ‰äº† React Fiberï¼Œæ›´æœ‰æœºä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œæ•…è¯·æ±‚ä¸åº”è¯¥æ”¾åœ¨<code>componentWillMount</code>ä¸­ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé”™è¯¯çš„ä½¿ç”¨æ˜¯åœ¨<code>componentWillMount</code>ä¸­è®¢é˜…äº‹ä»¶ï¼Œå¹¶åœ¨<code>componentWillUnmount</code>ä¸­å–æ¶ˆæ‰ç›¸åº”çš„äº‹ä»¶è®¢é˜…ã€‚äº‹å®ä¸Šåªæœ‰è°ƒç”¨<code>componentDidMount</code>åï¼ŒReact æ‰èƒ½ä¿è¯ç¨åè°ƒç”¨<code>componentWillUnmount</code>è¿›è¡Œæ¸…ç†ã€‚è€Œä¸”æœåŠ¡ç«¯æ¸²æŸ“æ—¶ä¸ä¼šè°ƒç”¨<code>componentWillUnmount</code>ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p><p>è¿˜æœ‰äººä¼šå°†äº‹ä»¶ç›‘å¬å™¨ï¼ˆæˆ–è®¢é˜…ï¼‰æ·»åŠ åˆ° <code>componentWillMount</code> ä¸­ï¼Œä½†è¿™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨æ¸²æŸ“ï¼ˆæ°¸è¿œä¸ä¼šè°ƒç”¨ <code>componentWillUnmount</code>ï¼‰å’Œå¼‚æ­¥æ¸²æŸ“ï¼ˆåœ¨æ¸²æŸ“å®Œæˆä¹‹å‰å¯èƒ½è¢«ä¸­æ–­ï¼Œå¯¼è‡´ä¸è°ƒç”¨ <code>componentWillUnmount</code>ï¼‰çš„å†…å­˜æ³„æ¼ã€‚</p><p>å¯¹äºè¯¥å‡½æ•°ï¼Œä¸€èˆ¬æƒ…å†µï¼Œå¦‚æœé¡¹ç›®æœ‰ä½¿ç”¨ï¼Œåˆ™æ˜¯é€šå¸¸æŠŠç°æœ‰ <code>componentWillMount</code> ä¸­çš„ä»£ç è¿ç§»è‡³ <code>componentDidMount</code> å³å¯ã€‚</p><h2 id="UNSAFE-componentWillUpdate"><a href="#UNSAFE-componentWillUpdate" class="headerlink" title="UNSAFE_componentWillUpdate"></a>UNSAFE_componentWillUpdate</h2><blockquote><p>å½“ç»„ä»¶æ”¶åˆ°æ–°çš„ props æˆ– state æ—¶ï¼Œä¼šåœ¨æ¸²æŸ“ä¹‹å‰è°ƒç”¨ <code>UNSAFE_componentWillUpdate()</code>ã€‚ä½¿ç”¨æ­¤ä½œä¸ºåœ¨æ›´æ–°å‘ç”Ÿä¹‹å‰æ‰§è¡Œå‡†å¤‡æ›´æ–°çš„æœºä¼šã€‚åˆå§‹æ¸²æŸ“ä¸ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚</p></blockquote><p>æ³¨æ„ï¼Œä¸èƒ½åœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨ this.setState()ï¼›åœ¨ <code>componentWillUpdate</code> è¿”å›ä¹‹å‰ï¼Œä½ ä¹Ÿä¸åº”è¯¥æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚ï¼Œdispatch Redux çš„ actionï¼‰è§¦å‘å¯¹ React ç»„ä»¶çš„æ›´æ–°ã€‚</p><p>é¦–å…ˆè·Ÿä¸Šé¢ä¸¤ä¸ªå‡½æ•°ä¸€æ ·ï¼Œè¯¥å‡½æ•°ä¹Ÿå‘ç”Ÿåœ¨ render ä¹‹å‰ï¼Œä¹Ÿå­˜åœ¨ä¸€æ¬¡æ›´æ–°è¢«è°ƒç”¨å¤šæ¬¡çš„å¯èƒ½ï¼Œä»è¿™ä¸€ç‚¹ä¸Šçœ‹å°±ä¾ç„¶ä¸å¯å–äº†ã€‚</p><p>å…¶æ¬¡ï¼Œè¯¥æ–¹æ³•å¸¸è§çš„ç”¨æ³•æ˜¯åœ¨ç»„ä»¶æ›´æ–°å‰ï¼Œè¯»å–å½“å‰æŸä¸ª DOM å…ƒç´ çš„çŠ¶æ€ï¼Œå¹¶åœ¨ <code>componentDidUpdate</code> ä¸­è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ä½† React 16 ç‰ˆæœ¬åæœ‰ suspenseã€å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ç­‰ç­‰ï¼Œrender è¿‡ç¨‹å¯ä»¥è¢«åˆ†å‰²æˆå¤šæ¬¡å®Œæˆï¼Œè¿˜å¯ä»¥è¢«æš‚åœç”šè‡³å›æº¯ï¼Œè¿™å¯¼è‡´ <code>componentWillUpdate</code> å’Œ <code>componentDidUpdate</code> æ‰§è¡Œå‰åå¯èƒ½ä¼šé—´éš”å¾ˆé•¿æ—¶é—´ï¼Œè¿™å¯¼è‡´ DOM å…ƒç´ çŠ¶æ€æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè¿™æ—¶çš„å€¼å¾ˆæœ‰å¯èƒ½å·²ç»å¤±æ•ˆäº†ã€‚è€Œä¸”è¶³å¤Ÿä½¿ç”¨æˆ·è¿›è¡Œäº¤äº’æ“ä½œæ›´æ”¹å½“å‰ç»„ä»¶çš„çŠ¶æ€ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥è¿½è¸ªçš„ BUGã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯å°±æœ‰äº†æ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getSnapshotBeforeUpdate(prevProps, prevState)</span><br></pre></td></tr></table></figure><blockquote><p><code>getSnapshotBeforeUpdate</code> åœ¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“è¾“å‡ºï¼ˆæäº¤åˆ° DOM èŠ‚ç‚¹ï¼‰ä¹‹å‰è°ƒç”¨ã€‚å®ƒä½¿å¾—ç»„ä»¶èƒ½åœ¨å‘ç”Ÿæ›´æ”¹ä¹‹å‰ä» DOM ä¸­æ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œæ»šåŠ¨ä½ç½®ï¼‰ã€‚æ­¤ç”Ÿå‘½å‘¨æœŸçš„ä»»ä½•è¿”å›å€¼å°†ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥<code>componentDidUpdate(prevProps, prevState, snapshot)</code></p></blockquote><p>ä¸ <code>componentWillUpdate</code> ä¸åŒï¼Œ<code>getSnapshotBeforeUpdate</code> ä¼šåœ¨æœ€ç»ˆçš„ render ä¹‹å‰è¢«è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ <code>getSnapshotBeforeUpdate</code> ä¸­è¯»å–åˆ°çš„ DOM å…ƒç´ çŠ¶æ€æ˜¯å¯ä»¥ä¿è¯ä¸ <code>componentDidUpdate</code> ä¸­ä¸€è‡´çš„ã€‚</p><p>è™½ç„¶ <code>getSnapshotBeforeUpdate</code> ä¸æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä½†æˆ‘ä»¬ä¹Ÿåº”è¯¥å°½é‡ä½¿ç”¨å®ƒå»è¿”å›ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªå€¼ä¼šéšåè¢«ä¼ å…¥åˆ° <code>componentDidUpdate</code> ä¸­ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨ <code>componentDidUpdate</code> ä¸­å»æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯åœ¨ <code>getSnapshotBeforeUpdate</code> ä¸­ç›´æ¥æ›´æ–°ç»„ä»¶çŠ¶æ€ã€‚é¿å…äº† <code>componentWillUpdate</code> å’Œ <code>componentDidUpdate</code> é…åˆä½¿ç”¨æ—¶å°†ç»„ä»¶ä¸´æ—¶çš„çŠ¶æ€æ•°æ®å­˜åœ¨ç»„ä»¶å®ä¾‹ä¸Šæµªè´¹å†…å­˜ï¼Œ<code>getSnapshotBeforeUpdate</code> è¿”å›çš„æ•°æ®åœ¨ <code>componentDidUpdate</code> ä¸­ç”¨å®Œå³è¢«é”€æ¯ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8eb7f64f3f94a9f8038949001284385~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>æ¥çœ‹å®˜æ–¹çš„ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class ScrollingList extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.listRef &#x3D; React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class="line">    &#x2F;&#x2F; æˆ‘ä»¬æ˜¯å¦åœ¨ list ä¸­æ·»åŠ æ–°çš„ itemsï¼Ÿ</span><br><span class="line">    &#x2F;&#x2F; æ•è·æ»šåŠ¨ä½ç½®ä»¥ä¾¿æˆ‘ä»¬ç¨åè°ƒæ•´æ»šåŠ¨ä½ç½®ã€‚</span><br><span class="line">    if (prevProps.list.length &lt; this.props.list.length) &#123;</span><br><span class="line">      const list &#x3D; this.listRef.current;</span><br><span class="line">      return list.scrollHeight - list.scrollTop;</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate(prevProps, prevState, snapshot) &#123;</span><br><span class="line">    &#x2F;&#x2F; å¦‚æœæˆ‘ä»¬ snapshot æœ‰å€¼ï¼Œè¯´æ˜æˆ‘ä»¬åˆšåˆšæ·»åŠ äº†æ–°çš„ itemsï¼Œ</span><br><span class="line">    &#x2F;&#x2F; è°ƒæ•´æ»šåŠ¨ä½ç½®ä½¿å¾—è¿™äº›æ–° items ä¸ä¼šå°†æ—§çš„ items æ¨å‡ºè§†å›¾ã€‚</span><br><span class="line">    &#x2F;&#x2F;ï¼ˆè¿™é‡Œçš„ snapshot æ˜¯ getSnapshotBeforeUpdate çš„è¿”å›å€¼ï¼‰</span><br><span class="line">    if (snapshot !&#x3D;&#x3D; null) &#123;</span><br><span class="line">      const list &#x3D; this.listRef.current;</span><br><span class="line">      list.scrollTop &#x3D; list.scrollHeight - snapshot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div ref&#x3D;&#123;this.listRef&#125;&gt;&#123;&#x2F;* ...contents... *&#x2F;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœé¡¹ç›®ä¸­æœ‰ç”¨åˆ°<code>componentWillUpdate</code>çš„è¯ï¼Œå‡çº§æ–¹æ¡ˆå°±æ˜¯å°†ç°æœ‰çš„ <code>componentWillUpdate</code> ä¸­çš„å›è°ƒå‡½æ•°è¿ç§»è‡³ <code>componentDidUpdate</code>ã€‚å¦‚æœè§¦å‘æŸäº›å›è°ƒå‡½æ•°æ—¶éœ€è¦ç”¨åˆ° DOM å…ƒç´ çš„çŠ¶æ€ï¼Œåˆ™å°†å¯¹æ¯”æˆ–è®¡ç®—çš„è¿‡ç¨‹è¿ç§»è‡³ <code>getSnapshotBeforeUpdate</code>ï¼Œç„¶ååœ¨ <code>componentDidUpdate</code> ä¸­ç»Ÿä¸€è§¦å‘å›è°ƒæˆ–æ›´æ–°çŠ¶æ€ã€‚</p><p>é™¤äº†è¿™äº›ï¼ŒReact 16 ç‰ˆæœ¬çš„ä¾ç„¶è¿˜æœ‰å¤§æ”¹åŠ¨ï¼Œå…¶ä¸­å¼•äººæ³¨ç›®çš„å°±æ˜¯ Fiberï¼Œä¹‹åæˆ‘è¿˜ä¼šæŠ½ç©ºå†™ä¸€ç¯‡å…³äº React Fiber çš„æ–‡ç« ï¼Œå¯ä»¥å…³æ³¨æˆ‘çš„<a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.html.cn/qa/react/14367.html" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆåºŸå¼ƒ react ç”Ÿå‘½å‘¨æœŸå‡½æ•°</a></li><li><a href="https://juejin.cn/post/6844903600309665799" target="_blank" rel="noopener">React v16.3 ç‰ˆæœ¬æ–°ç”Ÿå‘½å‘¨æœŸå‡½æ•°æµ…æåŠå‡çº§æ–¹æ¡ˆ</a></li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>ç”Ÿå‘½å‘¨æœŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTP å’Œ HTTPS åè®®</title>
    <url>/2020/11/23/HTTP-%E5%92%8C-HTTPS-%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<p>HTTP æ˜¯å‰ç«¯å¼€å‘äººå‘˜å¿…é¡»çŸ¥é“çš„çŸ¥è¯†ï¼Œä¹Ÿæ˜¯æ—¥å¸¸å¤„ç†è¯·æ±‚éƒ½ä¼šæ¥è§¦çš„ï¼Œä½†å¦‚æœè¦æ„æˆçŸ¥è¯†ä½“ç³»ï¼Œåˆ™éœ€è¦ä¸€ç‚¹ç‚¹å¡«å……çŸ¥è¯†ï¼Œä»Šå¤©å°±è¦è®²ä¸‹ HTTP å’Œ HTTPS åè®®ã€‚</p><a id="more"></a><h2 id="HTTP-åè®®æ˜¯ä»€ä¹ˆ"><a href="#HTTP-åè®®æ˜¯ä»€ä¹ˆ" class="headerlink" title="HTTP åè®®æ˜¯ä»€ä¹ˆ"></a>HTTP åè®®æ˜¯ä»€ä¹ˆ</h2><p>HTTP åè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯<code>Hyper Text Transfer Protocol</code>ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäºè¯·æ±‚ä¸å“åº”ï¼Œæ— çŠ¶æ€çš„ï¼Œåº”ç”¨å±‚çš„åè®®ï¼Œå¸¸åŸºäº<code>TCP/IP</code>åè®®ä¼ è¾“æ•°æ®ï¼Œäº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚è®¾è®¡ HTTP çš„åˆè¡·æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶ HTML é¡µé¢çš„æ–¹æ³•ã€‚</p><p>HTTP æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯<code>HTTP/1.1</code>ç‰ˆæœ¬ã€‚</p><h2 id="HTTP-ç‰¹ç‚¹"><a href="#HTTP-ç‰¹ç‚¹" class="headerlink" title="HTTP ç‰¹ç‚¹"></a>HTTP ç‰¹ç‚¹</h2><ul><li><strong>è¯·æ±‚å’Œå“åº”</strong>ï¼šåŸºæœ¬çš„ç‰¹æ€§ï¼Œç”±å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”</li><li><strong>ç®€å•å¿«é€Ÿ</strong>ï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚è¯·æ±‚æ–¹æ³•å¸¸ç”¨çš„æœ‰ GETã€HEADã€POSTã€‚</li><li><strong>çµæ´»</strong>ï¼šHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚ä¼ è¾“çš„ç±»å‹ç”±<code>Content-Type</code>ä»¥æ ‡è®°ã€‚</li><li><strong>æ— è¿æ¥</strong>ï¼šé™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ï¼Œä½†æ˜¯å´ä¸åˆ©äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¿æŒä¼šè¯è¿æ¥ï¼Œä¸ºäº†å¼¥è¡¥è¿™ç§ä¸è¶³ï¼Œäº§ç”Ÿäº†ä¸¤é¡¹è®°å½• HTTP çŠ¶æ€çš„æŠ€æœ¯ï¼Œä¸€ä¸ªå«åš Cookie,ä¸€ä¸ªå«åš Sessionã€‚</li><li><strong>æ— çŠ¶æ€</strong>ï¼šæ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†ï¼Œåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å¿…é¡»é‡ä¼ ã€‚</li></ul><h2 id="å¸¸è§çš„è¯·æ±‚æ–¹æ³•"><a href="#å¸¸è§çš„è¯·æ±‚æ–¹æ³•" class="headerlink" title="å¸¸è§çš„è¯·æ±‚æ–¹æ³•"></a>å¸¸è§çš„è¯·æ±‚æ–¹æ³•</h2><ul><li>GETï¼šè¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›å®ä½“ä¸»ä½“ã€‚</li><li>POSTï¼šå‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚</li><li>HEADï¼šç±»ä¼¼äº GET è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´</li><li>PUTï¼šä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹ã€‚</li><li>DELETEï¼šè¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢ã€‚</li></ul><h2 id="HTTP-çš„ç¼ºç‚¹"><a href="#HTTP-çš„ç¼ºç‚¹" class="headerlink" title="HTTP çš„ç¼ºç‚¹"></a>HTTP çš„ç¼ºç‚¹</h2><ul><li><p><strong>æ˜æ–‡ä¼ è¾“</strong>ï¼šæ•°æ®å®Œå…¨è‚‰çœ¼å¯è§ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°ç ”ç©¶å’Œåˆ†æï¼Œä½†ä¹Ÿå®¹æ˜“è¢«çªƒå¬</p></li><li><p>HTTP æ˜¯ä¸å®‰å…¨çš„ï¼Œ<strong>æ— æ³•éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½</strong>ï¼Œä¹Ÿä¸èƒ½åˆ¤æ–­æŠ¥æ–‡æ˜¯å¦è¢«ä¿®æ”¹</p></li></ul><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨-HTTPS"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-HTTPS" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ HTTPS"></a>ä¸ºä»€ä¹ˆè¦ç”¨ HTTPS</h2><p>HTTP åè®®ä»¥æ˜æ–‡æ–¹å¼ä¼ é€’ä¿¡æ¯ï¼Œä¸æä¾›ä»»ä½•æ–¹å¼çš„æ•°æ®åŠ å¯†ï¼Œä¸é€‚åˆä¼ è¾“ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šå„ç§è´¦å·ã€å¯†ç ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨ HTTP åè®®ä¼ è¾“éšç§ä¿¡æ¯éå¸¸ä¸å®‰å…¨ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šè¿° HTTP å­˜åœ¨çš„é—®é¢˜ï¼Œå°±å‡ºç°äº† HTTPSã€‚</p><p>HTTPS åè®®çš„ä¸»è¦ä½œç”¨å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯å»ºç«‹ä¸€ä¸ªä¿¡æ¯å®‰å…¨é€šé“ï¼Œæ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼›å¦ä¸€ç§å°±æ˜¯ç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ï¼›è§£å†³äº† HTTP å­˜åœ¨çš„ç¼ºç‚¹é—®é¢˜ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-HTTPS"><a href="#ä»€ä¹ˆæ˜¯-HTTPS" class="headerlink" title="ä»€ä¹ˆæ˜¯ HTTPS?"></a>ä»€ä¹ˆæ˜¯ HTTPS?</h2><p>HTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šä¸€èˆ¬ç†è§£ä¸º<code>HTTP</code>+<code>SSL/TLS</code>ï¼Œé€šè¿‡ SSL è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†ã€‚</p><p>HTTPS æ˜¯ä¸€ç§é€šè¿‡è®¡ç®—æœºç½‘ç»œè¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¼ è¾“åè®®ï¼Œç»ç”± HTTP è¿›è¡Œé€šä¿¡ï¼Œåˆ©ç”¨<code>SSL/TLS</code>å»ºç«‹å…¨ä¿¡é“ï¼ŒåŠ å¯†æ•°æ®åŒ…ã€‚HTTPS ä½¿ç”¨çš„ä¸»è¦ç›®çš„æ˜¯æä¾›å¯¹ç½‘ç«™æœåŠ¡å™¨çš„èº«ä»½è®¤è¯ï¼ŒåŒæ—¶ä¿æŠ¤äº¤æ¢æ•°æ®çš„éšç§ä¸å®Œæ•´æ€§ã€‚</p><h3 id="SSL-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#SSL-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="SSL æ˜¯ä»€ä¹ˆï¼Ÿ"></a>SSL æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>SSLï¼ˆSecure Socket Layerï¼Œå®‰å…¨å¥—æ¥å­—å±‚ï¼‰ï¼šSSL åè®®ä½äº <code>TCP/IP</code> åè®®ä¸å„ç§åº”ç”¨å±‚åè®®ä¹‹é—´ï¼Œä¸ºæ•°æ®é€šè®¯æä¾›å®‰å…¨æ”¯æŒã€‚</p><p>TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰ï¼šå…¶å‰èº«æ˜¯ SSLï¼Œå®ƒæœ€åˆçš„å‡ ä¸ªç‰ˆæœ¬ï¼ˆSSL 1.0ã€SSL 2.0ã€SSL 3.0ï¼‰ç”±ç½‘æ™¯å…¬å¸å¼€å‘ï¼Œç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯<code>TLS 1.1</code>ã€<code>TLS 1.2</code>ã€‚</p><h2 id="æµè§ˆå™¨åœ¨ä½¿ç”¨-HTTPS-ä¼ è¾“æ•°æ®çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æµè§ˆå™¨åœ¨ä½¿ç”¨-HTTPS-ä¼ è¾“æ•°æ®çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æµè§ˆå™¨åœ¨ä½¿ç”¨ HTTPS ä¼ è¾“æ•°æ®çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æµè§ˆå™¨åœ¨ä½¿ç”¨ HTTPS ä¼ è¾“æ•°æ®çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>é¦–å…ˆå®¢æˆ·ç«¯é€šè¿‡ URL è®¿é—®æœåŠ¡å™¨å»ºç«‹ SSL è¿æ¥ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œä¼šå°†ç½‘ç«™æ”¯æŒçš„è¯ä¹¦ä¿¡æ¯ï¼ˆè¯ä¹¦ä¸­åŒ…å«å…¬é’¥ï¼‰ä¼ é€ä¸€ä»½ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯çš„æœåŠ¡å™¨å¼€å§‹åå•† SSL è¿æ¥çš„å®‰å…¨ç­‰çº§ï¼Œä¹Ÿå°±æ˜¯ä¿¡æ¯åŠ å¯†çš„ç­‰çº§ã€‚</li><li>å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ ¹æ®åŒæ–¹åŒæ„çš„å®‰å…¨ç­‰çº§ï¼Œå»ºç«‹ä¼šè¯å¯†é’¥ï¼Œç„¶ååˆ©ç”¨ç½‘ç«™çš„å…¬é’¥å°†ä¼šè¯å¯†é’¥åŠ å¯†ï¼Œå¹¶ä¼ é€ç»™ç½‘ç«™ã€‚</li><li>æœåŠ¡å™¨åˆ©ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºä¼šè¯å¯†é’¥ã€‚</li><li>æœåŠ¡å™¨åˆ©ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ã€‚</li></ul><h2 id="HTTPS-çš„ç‰¹ç‚¹"><a href="#HTTPS-çš„ç‰¹ç‚¹" class="headerlink" title="HTTPS çš„ç‰¹ç‚¹"></a>HTTPS çš„ç‰¹ç‚¹</h2><ol><li><strong>å†…å®¹åŠ å¯†</strong>ï¼šé‡‡ç”¨æ··åˆåŠ å¯†æŠ€æœ¯ï¼Œä¸­é—´è€…æ— æ³•ç›´æ¥æŸ¥çœ‹æ˜æ–‡å†…å®¹</li><li><strong>éªŒè¯èº«ä»½</strong>ï¼šé€šè¿‡è¯ä¹¦è®¤è¯å®¢æˆ·ç«¯è®¿é—®çš„æ˜¯è‡ªå·±çš„æœåŠ¡å™¨ï¼ˆç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ï¼‰</li><li><strong>ä¿æŠ¤æ•°æ®å®Œæ•´æ€§</strong>ï¼šé˜²æ­¢ä¼ è¾“çš„å†…å®¹è¢«ä¸­é—´äººå†’å……æˆ–è€…ç¯¡æ”¹</li></ol><p><strong>å¯¹ç§°åŠ å¯†</strong></p><p>ä¹Ÿå«åšå…±äº«å¯†é’¥åŠ å¯†ã€‚é€šä¿¡çš„åŒæ–¹ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œä¼˜ç‚¹æ˜¯åŠ è§£å¯†é€Ÿåº¦å¿«ã€‚è¿ç”¨å¯¹ç§°åŠ å¯†æœ‰ä¸€ä¸ªå‰æå°±æ˜¯åœ¨å‘é€ä¿¡æ¯å‰åŒæ–¹éƒ½å¿…é¡»çŸ¥é“åŠ å¯†çš„è§„åˆ™ï¼Œä½†æ˜¯åœ¨äº’è”ç½‘çš„ç¯å¢ƒä¸‹æˆ‘ä»¬æ¯å¤©å¯èƒ½è·Ÿä¸åŒäººå‘é€ä¿¡æ¯ï¼Œå¾ˆå¤šäººæˆ‘ä»¬ä¹‹å‰æ ¹æœ¬æ²¡è®¤è¯†è¿‡ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ ¹æœ¬ä¸å¯èƒ½äº‹å…ˆå°±çº¦å®šå¥½åŠ å¯†è§„åˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åªèƒ½é€šè¿‡ä¿¡æ¯æŠŠåŠ å¯†è§„åˆ™ï¼ˆå¯†é’¥ï¼‰å‘é€ç»™å¯¹æ–¹ï¼Œç„¶åæˆ‘ä»¬å†æ ¹æ®åŠ å¯†è§„åˆ™æ¥åŠ å¯†èŠå¤©ä¿¡æ¯ï¼Œå¾ˆæ˜¾ç„¶è¿™è‚¯å®šæ˜¯ä¸å¯å–çš„ï¼Œä¸ç»è¿‡åŠ å¯†çš„æ•°æ®åœ¨ç½‘ç»œä¼ è¾“æ˜¯æ²¡æœ‰ä»»ä½•å®‰å…¨æ€§å¯è¨€çš„ã€‚</p><p><strong>éå¯¹ç§°åŠ å¯†</strong></p><p>åˆç§°ä½œå…¬å¼€å¯†é’¥åŠ å¯†ã€‚ä½¿ç”¨ä¸€å¯¹éå¯¹ç§°çš„å¯†é’¥ï¼Œç§é’¥ä¿å­˜åœ¨æœ¬åœ°ï¼Œå…¬é’¥å¯ä»¥å…¬å¼€ã€‚å‘é€å¯†æ–‡çš„ä¸€æ–¹ä½¿ç”¨å¯¹æ–¹çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°åï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ã€‚ä¼˜ç‚¹æ˜¯è§£å¯†çš„ç§é’¥ä¸éœ€è¦è¿›è¡Œåˆ†å‘ã€‚ç¼ºç‚¹æ˜¯åŠ è§£å¯†é€Ÿåº¦æ…¢ï¼ŒåŒæ—¶å…¬é’¥å¯èƒ½è¢«æ›¿æ¢ã€‚</p><p><strong>æ··åˆåŠ å¯†</strong></p><p>ä½¿ç”¨æ··åˆåŠ å¯†çš„åŸå› ï¼šéå¯¹ç§°ç§˜é’¥åŠ å¯†ä¼šæ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯ç§é’¥ä¸ç”¨ä¼ è¾“å®‰å…¨ï¼Œè€Œå¯¹ç§°ç§˜é’¥æ–¹å¼åˆ™ç›¸åï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨ä¸¤è€…ä¼˜ç¼ºç‚¹ï¼Œäº§ç”Ÿäº†æ··åˆåŠ å¯†æœºåˆ¶<br>è§£å†³æ–¹æ¡ˆï¼šå³é€šä¿¡å»ºç«‹ä¹‹åˆé‡‡ç”¨å…¬å¼€åŠ å¯†çš„æ–¹å¼ä¼ è¾“å¯¹ç§°ç§˜é’¥æ–¹å¼ä¸­çš„åŒä¸€ç§˜é’¥ï¼Œè¿™æ ·ç¡®ä¿äº†å…±äº«ç§˜é’¥çš„å®‰å…¨æ€§ï¼Œç„¶åä»¥åçš„é€šä¿¡å‡é‡‡ç”¨å¯¹ç§°åŠ å¯†æ–¹å¼ï¼Œè¿™æ ·æå‡äº†é€šä¿¡é€Ÿåº¦ã€‚</p><p><strong>æ•°å­—æ‘˜è¦</strong></p><p>ä¸€æ®µä¿¡æ¯ï¼Œç»è¿‡æ‘˜è¦ç®—æ³•å¾—åˆ°ä¸€ä¸²å“ˆå¸Œå€¼ï¼Œå°±æ˜¯æ‘˜è¦ã€‚é€šè¿‡å•å‘ hash å‡½æ•°å¯¹åŸæ–‡è¿›è¡Œå“ˆå¸Œï¼Œå°†éœ€åŠ å¯†çš„æ˜æ–‡â€œæ‘˜è¦â€æˆä¸€ä¸²å›ºå®šé•¿åº¦(å¦‚ 128bit)çš„å¯†æ–‡ï¼Œä¸åŒçš„æ˜æ–‡æ‘˜è¦æˆçš„å¯†æ–‡å…¶ç»“æœæ€»æ˜¯ä¸ç›¸åŒï¼ŒåŒæ ·çš„æ˜æ–‡å…¶æ‘˜è¦å¿…å®šä¸€è‡´ï¼Œå¹¶ä¸”å³ä½¿çŸ¥é“äº†æ‘˜è¦ä¹Ÿä¸èƒ½åæ¨å‡ºæ˜æ–‡ã€‚</p><p><strong>æ•°å­—ç­¾å</strong></p><p>æ•°å­—ç­¾åå»ºç«‹åœ¨å…¬é’¥åŠ å¯†ä½“åˆ¶åŸºç¡€ä¸Šï¼Œæ˜¯å…¬é’¥åŠ å¯†æŠ€æœ¯çš„å¦ä¸€ç±»åº”ç”¨ã€‚æ‘˜è¦ç»è¿‡ç§é’¥çš„åŠ å¯†åï¼Œä¾¿æœ‰äº†ä¸€ä¸ªæ–°çš„åå­— â€”â€” æ•°å­—ç­¾åã€‚</p><p><strong>æ•°å­—è¯ä¹¦</strong></p><p>éå¯¹ç§°åŠ å¯†è¿‡ç¨‹éœ€è¦ç”¨åˆ°å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œé‚£ä¹ˆå…¬é’¥ä»ä½•è€Œæ¥ï¼Ÿå…¶å®å…¬é’¥å°±è¢«åŒ…å«åœ¨æ•°å­—è¯ä¹¦ä¸­ï¼Œæ•°å­—è¯ä¹¦é€šå¸¸æ¥è¯´æ˜¯ç”±å—ä¿¡ä»»çš„æ•°å­—è¯ä¹¦é¢å‘æœºæ„ CAï¼Œåœ¨éªŒè¯æœåŠ¡å™¨èº«ä»½åé¢å‘ï¼Œè¯ä¹¦ä¸­åŒ…å«äº†ä¸€ä¸ªå¯†é’¥å¯¹ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰å’Œæ‰€æœ‰è€…è¯†åˆ«ä¿¡æ¯ã€‚æ•°å­—è¯ä¹¦ï¼ˆ<br>å®é™…å°±æ˜¯ä¸€ä¸ª <code>.crt</code> æ–‡ä»¶ï¼‰è¢«æ”¾åˆ°æœåŠ¡ç«¯ï¼Œå…·æœ‰æœåŠ¡å™¨èº«ä»½éªŒè¯å’Œæ•°æ®ä¼ è¾“åŠ å¯†åŠŸèƒ½ã€‚</p><h2 id="HTTPS-çš„ç¼ºç‚¹"><a href="#HTTPS-çš„ç¼ºç‚¹" class="headerlink" title="HTTPS çš„ç¼ºç‚¹"></a>HTTPS çš„ç¼ºç‚¹</h2><ul><li>HTTPS åè®®å¤šæ¬¡æ¡æ‰‹ï¼Œå¯¼è‡´é¡µé¢çš„åŠ è½½æ—¶é—´å»¶é•¿è¿‘ 50%ï¼›</li><li>HTTPS è¿æ¥ç¼“å­˜ä¸å¦‚ HTTP é«˜æ•ˆï¼Œä¼šå¢åŠ æ•°æ®å¼€é”€å’ŒåŠŸè€—ï¼›</li><li>ç”³è¯· SSL è¯ä¹¦éœ€è¦é’±ï¼ŒåŠŸèƒ½è¶Šå¼ºå¤§çš„è¯ä¹¦è´¹ç”¨è¶Šé«˜ã€‚</li><li>SSL è¯ä¹¦é€šå¸¸éœ€è¦ç»‘å®š IPï¼Œä¸èƒ½åœ¨åŒä¸€ IP ä¸Šç»‘å®šå¤šä¸ªåŸŸåï¼ŒIPv4 èµ„æºä¸å¯èƒ½æ”¯æ’‘è¿™ä¸ªæ¶ˆè€—ã€‚</li><li>SSL æ¶‰åŠåˆ°çš„å®‰å…¨ç®—æ³•ä¼šæ¶ˆè€— CPU èµ„æºï¼Œå¯¹æœåŠ¡å™¨èµ„æºæ¶ˆè€—è¾ƒå¤§ã€‚</li></ul><h2 id="æ€»ç»“-HTTPS-å’Œ-HTTP-çš„åŒºåˆ«"><a href="#æ€»ç»“-HTTPS-å’Œ-HTTP-çš„åŒºåˆ«" class="headerlink" title="æ€»ç»“ HTTPS å’Œ HTTP çš„åŒºåˆ«"></a>æ€»ç»“ HTTPS å’Œ HTTP çš„åŒºåˆ«</h2><ul><li><strong>å®‰å…¨æ€§</strong>ï¼šHTTP çš„è¿æ¥å¾ˆç®€å•ï¼Œæ˜¯æ— çŠ¶æ€çš„ï¼›HTTPS åè®®æ˜¯ç”± SSL+HTTP åè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œæ¯” HTTP åè®®å®‰å…¨ã€‚</li><li><strong>è¿æ¥ç«¯å£</strong>ï¼šHTTP æ ‡å‡†ç«¯å£æ˜¯ 80ï¼Œè€Œ HTTPS çš„æ ‡å‡†ç«¯å£æ˜¯ 443ã€‚</li><li><strong>è´¹ç”¨</strong>ï¼šHTTPS åè®®éœ€è¦åˆ° CA ç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬å…è´¹è¯ä¹¦è¾ƒå°‘ï¼Œå› è€Œéœ€è¦ä¸€å®šè´¹ç”¨</li><li><strong>ä¼ è¾“æ–¹å¼</strong>ï¼šHTTP æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œè€Œ HTTPS æ˜¯ SSL åŠ å¯†ä¼ è¾“åè®®ã€‚</li><li><strong>å·¥ä½œå±‚</strong>ï¼šåœ¨ OSI ç½‘ç»œæ¨¡å‹ä¸­ï¼ŒHTTP å·¥ä½œäºåº”ç”¨å±‚ï¼Œè€Œ HTTPS å·¥ä½œåœ¨ä¼ è¾“å±‚ã€‚</li><li><strong>å·¥ä½œè€—æ—¶</strong>ï¼šHTTP è€—æ—¶=TCP æ¡æ‰‹ï¼Œè€Œ HTTPS è€—æ—¶=TCP æ¡æ‰‹+SSL æ¡æ‰‹ã€‚</li><li><strong>æ˜¾ç¤ºå½¢å¼</strong>ï¼šHTTP çš„ URL ä»¥<code>http://</code>å¼€å¤´ï¼Œè€Œ HTTPS çš„ URL ä»¥<code>https://</code>å¼€å¤´ã€‚</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/72616216" target="_blank" rel="noopener">ååˆ†é’Ÿææ‡‚ HTTP å’Œ HTTPS åè®®ï¼Ÿ</a></li></ul>]]></content>
      <categories>
        <category>HTTPç³»åˆ—</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ Travis è‡ªåŠ¨åŒ–éƒ¨ç½²</title>
    <url>/2020/11/16/%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-Travis-%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä¸»è¦è®²å¦‚ä½•ç”¨ Travis æ¥å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå¹¶å‚ç…§ Github çœŸå®é¡¹ç›®å¼€å‘ç®€å•åœºæ™¯æ¥ä»‹ç»ã€‚</p><a id="more"></a><h2 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI/CD"></a>CI/CD</h2><p>åœ¨è¯´ Travis ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹ CI/CD çš„æ¦‚å¿µã€‚</p><h3 id="CI"><a href="#CI" class="headerlink" title="CI"></a>CI</h3><p><strong>CIï¼ˆContinuous integrationï¼‰â€”â€” æŒç»­é›†æˆ</strong>ã€‚æŒç»­é›†æˆæ˜¯æŒ‡é¢‘ç¹åœ°ï¼ˆä¸€å¤©å¤šæ¬¡ï¼‰å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ï¼Œæ³¨é‡å°†å„ä¸ªå¼€å‘è€…çš„å·¥ä½œé›†åˆåˆ°ä¸€ä¸ªä»£ç ä»“åº“ä¸­ï¼Œåœ¨æºä»£ç å˜æ›´åä¼šè‡ªåŠ¨æ£€æµ‹ã€æ‹‰å–ã€æ„å»ºå’Œè¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå…¶ç›®çš„åœ¨äºè®©äº§å“å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶ä¿è¯é«˜è´¨é‡ã€‚</p><p>æ¯”å¦‚æ—¥å¸¸å·¥ä½œä¸­ï¼Œå‘<code>development</code>åˆ†æ”¯æäº¤ä¸€ä¸ª PRï¼Œé…ç½®å¥½ Travis å°±ä¼šè¿›è¡Œè‡ªåŠ¨æµ‹è¯•ç­‰ç­‰å·¥ä½œï¼Œé€šè¿‡å¹¶è¢« review åæ‰èƒ½å…è®¸åˆå¹¶åˆ°å¼€å‘åˆ†æ”¯ã€‚ä¸€æ—¦è‡ªåŠ¨æµ‹è¯•è„šæœ¬æœ‰é”™è¯¯ï¼Œåˆ™ä¸å…è®¸åˆå¹¶ã€‚</p><h3 id="CD"><a href="#CD" class="headerlink" title="CD"></a>CD</h3><p>CD å¯å¯¹åº”å¤šä¸ªè‹±æ–‡åç§°ï¼Œä¸€ä¸ªæ˜¯<strong>æŒç»­äº¤ä»˜ï¼ˆContinuous deliveryï¼‰</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>æŒç»­éƒ¨ç½²ï¼ˆContinuous deploymentï¼‰</strong>ã€‚</p><p><strong>æŒç»­äº¤ä»˜</strong>æŒ‡é¢‘ç¹åœ°å°†è½¯ä»¶çš„æ–°ç‰ˆæœ¬äº¤ä»˜ç»™è´¨é‡å›¢é˜Ÿæˆ–è€…ç”¨æˆ·ï¼Œä»¥ä¾›è¯„å®¡ã€‚å¦‚æœè¯„å®¡é€šè¿‡ï¼Œä»£ç å°±è¿›å…¥ç”Ÿäº§é˜¶æ®µã€‚<br>ç›®æ ‡æ˜¯æ‹¥æœ‰ä¸€ä¸ªå¯éšæ—¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„ä»£ç åº“ã€‚å¥½å¤„åœ¨äºï¼Œæ¯æ¬¡ä»£ç çš„å°å¹…å˜æ›´ï¼Œå°±èƒ½çœ‹åˆ°è¿è¡Œç»“æœï¼Œä»è€Œä¸æ–­ç´¯ç§¯å°çš„å˜æ›´ï¼Œè€Œä¸æ˜¯åœ¨å¼€å‘å‘¨æœŸç»“æŸæ—¶ï¼Œä¸€ä¸‹å­åˆå¹¶ä¸€å¤§å—ä»£ç ã€‚</p><p><strong>æŒç»­éƒ¨ç½²</strong>æŒ‡æŒç»­äº¤ä»˜çš„ä¸‹ä¸€æ­¥ï¼ŒæŒ‡çš„æ˜¯ä»£ç é€šè¿‡è¯„å®¡ä»¥åï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ç›®æ ‡æ˜¯ä»£ç åœ¨ä»»ä½•æ—¶åˆ»éƒ½æ˜¯å¯éƒ¨ç½²çš„ï¼Œå¯ä»¥è¿›å…¥ç”Ÿäº§é˜¶æ®µã€‚</p><p>æŒç»­äº¤ä»˜å¹¶ä¸æ˜¯æŒ‡è½¯ä»¶æ¯ä¸€ä¸ªæ”¹åŠ¨éƒ½è¦å°½å¿«éƒ¨ç½²åˆ°äº§å“ç¯å¢ƒä¸­ï¼Œå®ƒæŒ‡çš„æ˜¯ä»»ä½•çš„ä»£ç ä¿®æ”¹éƒ½å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å®æ–½éƒ¨ç½²ã€‚</p><p>æŒç»­äº¤ä»˜è¡¨ç¤ºçš„æ˜¯ä¸€ç§èƒ½åŠ›ï¼Œè€ŒæŒç»­éƒ¨ç½²è¡¨ç¤ºçš„åˆ™ä¸€ç§æ–¹å¼ã€‚æŒç»­éƒ¨ç½²æ˜¯æŒç»­äº¤ä»˜çš„æœ€é«˜é˜¶æ®µ</p><h2 id="Travis-æ˜¯ä»€ä¹ˆ"><a href="#Travis-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Travis æ˜¯ä»€ä¹ˆ"></a>Travis æ˜¯ä»€ä¹ˆ</h2><p><strong>Travis CI</strong> æä¾›çš„æ˜¯æŒç»­é›†æˆæœåŠ¡ï¼Œå®ƒå¯ä»¥ç»‘å®š Github ä¸Šé¢çš„é¡¹ç›®ï¼Œåªè¦æœ‰æ–°çš„ä»£ç ï¼Œå°±ä¼šè‡ªåŠ¨æŠ“å–ã€‚ç„¶åï¼Œæä¾›ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œæ‰§è¡Œæµ‹è¯•ï¼Œå®Œæˆæ„å»ºï¼Œè¿˜èƒ½éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚å½“ç„¶è¿™åªæ˜¯å…¶ä¸­ä¸€ç§ CI å·¥å…·ï¼Œå¦å¤–è¿˜æœ‰<code>Jenkins</code>ç­‰ã€‚</p><p>æœ¬æ–‡ä»…ä»…åšçš„æŠ›ç –å¼•ç‰ï¼Œè®©ä½ å¯¹è¿™äº›æ¦‚å¿µå’Œ Travis æœ‰åˆæ­¥äº†è§£å’Œä½¿ç”¨ï¼Œä¸å†é™Œç”Ÿï¼Œå‰©ä½™çš„å°±é ä½ è‡ªå·±å»å­¦ä¹ äº†ã€‚ä¹Ÿè®¸ä½ è§‰å¾—è¿™æ˜¯å…¬å¸ä¼ä¸šçº§é¡¹ç›®æ‰é…ä¸Šçš„ä¸œè¥¿ï¼Œä½†å…¶å® Travis æ˜¯å…è´¹çš„ï¼Œä¸ªäººå¼€å‘è€…ä¹Ÿå¯ä»¥è¿›è¡Œä½¿ç”¨ï¼Œè€Œä¸”æ˜¯æŒºå¥½ç”¨ã€‚</p><h2 id="æ³¨å†Œ-Travis"><a href="#æ³¨å†Œ-Travis" class="headerlink" title="æ³¨å†Œ Travis"></a>æ³¨å†Œ Travis</h2><p>è¿›å…¥<a href="https://travis-ci.com" target="_blank" rel="noopener">https://travis-ci.com</a>ï¼Œ</p><p>æ¯”å¦‚æˆ‘é€‰æ‹© Github æ–¹å¼ç™»å½•</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/787b470e99dd429d80bf261034d8eaaa~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>ç™»å½•ä¹‹å Github çš„ repo æˆæƒç»™ travisï¼Œæˆ‘ç›´æ¥é€‰ Allï¼Œå¼€å¯å¯¹é¡¹ç›®çš„ç›‘æ§<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1404af30c57487096695a447cdaa0d3~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>é€‰å®Œä¹‹åå›åˆ°ä¸»é¡µå°±èƒ½çœ‹åˆ°ä½ çš„ä»“åº“é¡µé¢äº†ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªé¡¹ç›®æˆ‘æ˜¯é…ç½®äº† travis çš„ï¼Œæ‰€ä»¥æ˜¾ç¤ºç»¿è‰²çŠ¶æ€ã€‚<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da48d7d8418748a9b137354a27ecfe27~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>è¿™é¡¹ç›®æ˜¯æœ€è¿‘åœ¨è‡ªå·±åŠ¨æ‰‹åšçš„ React ç»„ä»¶åº“é¡¹ç›® <a href="https://github.com/Jacky-Summer/monki-ui" target="_blank" rel="noopener">monki-ui</a>ï¼Œå°½é‡å‚ç…§ä¼ä¸šçº§æ ‡å‡†æ­å»ºçš„ï¼ŒæŠ€æœ¯æ ˆæ˜¯<code>React + TypeScript + Dumi + Jest</code>ï¼Œè§‰å¾—ä¸é”™å¯ä¾›å€Ÿé‰´å­¦ä¹ çš„è¯å¯ä»¥ âœ¨ star ä¸€ä¸‹å“¦â€¦</p><h2 id="è·å–-Github-Access-Token"><a href="#è·å–-Github-Access-Token" class="headerlink" title="è·å– Github Access Token"></a>è·å– Github Access Token</h2><p>æ¥ç€è¿›å…¥ <code>Github -&gt; Developer settings -&gt; Personal access tokens -&gt; Generate new token</code></p><p>å‹¾é€‰<code>repo</code>ä¸‹çš„æ‰€æœ‰é¡¹ï¼Œä»¥åŠ<code>user</code>ä¸‹çš„<code>user:email</code>åï¼Œä¼šç”Ÿæˆä¸€ä¸ª tokenï¼Œç„¶åè®°å¾—å¤åˆ¶ä¿å­˜å¥½ï¼Œå› ä¸ºç”Ÿæˆåä»¥åå°±ä¸ä¼šå†æ˜¾ç¤ºäº†ï¼Œå¦‚æœå¿˜è®°é‚£å¿…é¡»é‡æ–°ç”Ÿæˆ<code>token</code>æ‰å¯ä»¥</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/469af906c946480fad3312c9fe2d3e53~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="é…ç½®-Travis"><a href="#é…ç½®-Travis" class="headerlink" title="é…ç½® Travis"></a>é…ç½® Travis</h2><p>æˆ‘è‡ªå·±ç”¨ create-react-app åˆå§‹åŒ–äº†ä¸€ä¸ª Github é¡¹ç›® <a href="https://github.com/Jacky-Summer/travis-demo" target="_blank" rel="noopener">travis-demo</a>ï¼Œåˆ é™¤æ–‡ä»¶åˆ°æœ€ç®€å•çš„é¡¹ç›®ç»“æ„ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/302028aa4f9746e78173be6f04195f29~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>ç„¶åæ¨¡æ‹Ÿä¸€ä¸‹æ—¥å¸¸å¼€å‘åœºæ™¯ï¼Œè®©å¤§å®¶ä½“ä¼šå·¥ä½œä¸­çš„åº”ç”¨ï¼Œæˆ‘å…ˆæ˜¯ä»<code>master</code>åˆ†æ”¯ checkout å‡º<code>development</code>åˆ†æ”¯ï¼Œå¹¶æŠŠ<code>development</code>åˆ†æ”¯è®¾ç½®ä¸º<code>default</code>åˆ†æ”¯ï¼Œè¿™ä¸ªå°±å½“åšæˆ‘ä»¬å¼€å‘ä¸­çš„ dev åˆ†æ”¯ï¼Œæ—¥å¸¸ PR éƒ½ä¼šåˆå¹¶åˆ°è¯¥åˆ†æ”¯ä¸Šã€‚</p><p>ç„¶åä»<code>development</code>åˆ†æ”¯ checkout å‡ºä¸€æ¡åˆ†æ”¯<code>docs/update-readme</code>ï¼Œæ¥ç€ä¿®æ”¹ readme çš„å†…å®¹ï¼Œgit add å’Œ git commit åå°±å¾… push äº†ã€‚</p><p>æˆ‘ä»¬ä¸Šé¢ç”Ÿæˆçš„ token å·²ç»è¯´äº†è¦å…ˆä¿å­˜å¥½çš„ï¼Œæ¥ç€å»<a href="https://travis-ci.com/" target="_blank" rel="noopener">travis-ci å®˜ç½‘</a>ï¼Œæ‰¾åˆ°åˆšæ‰åˆ›å»ºçš„é¡¹ç›®<code>Jacky-Summer/travis-demo</code>ï¼Œç‚¹è¿›å»é€‰æ‹©<code>Settings</code></p><ul><li>è®¾ç½®å…¨å±€å˜é‡(Environment Variables)</li></ul><p><code>NAME</code>ä¸€èˆ¬è§„èŒƒæ˜¯å¤§å†™å’Œä¸‹åˆ’çº¿æ¥å‘½åï¼Œè¿™é‡Œæˆ‘å–ä¸º<code>GITHUB_TOKEN</code>ï¼Œ<code>VALUE</code>ä¸ºæˆ‘ä»¬ä¿å­˜çš„ tokenï¼Œç„¶åé€‰æ‹©<code>Add</code>æ·»åŠ </p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b3d10cde4aa425d9cc1f717bd737074~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="é¡¹ç›®æ–°å»ºé…ç½®æ–‡ä»¶"><a href="#é¡¹ç›®æ–°å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="é¡¹ç›®æ–°å»ºé…ç½®æ–‡ä»¶"></a>é¡¹ç›®æ–°å»ºé…ç½®æ–‡ä»¶</h2><p>åœ¨é¡¹ç›®æ ¹ç›®å½•é…ç½®<code>.travis.yml</code>é…ç½®æ–‡ä»¶ï¼ˆå½“å‰åœ¨<code>docs/udpate-readne</code>ï¼‰</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">language: node_js  # è®¾ç½®è¯­è¨€</span><br><span class="line"></span><br><span class="line">node_js:</span><br><span class="line">  - 12 # æŒ‡å®šnode.jsç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">cache: yarn # å¼€å¯ç¼“å­˜</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">  - yarn</span><br><span class="line">script:</span><br><span class="line">  - yarn build</span><br></pre></td></tr></table></figure><p>æ¥ç€å°± push åˆ°è¿œç¨‹åˆ†æ”¯ï¼Œæ­¤æ—¶æ‰“å¼€ github é¡¹ç›®ä»“åº“ï¼Œç‚¹å‡»<code>Create pull request</code>ï¼Œ</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a1d39c8f3814549bd5197da825d2d2f~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>å°±ä¼šçœ‹åˆ°æ­¤æ—¶ Travis æ­£åœ¨è¿è¡Œäº†ï¼Œå®ƒåœ¨å¹²ä»€ä¹ˆäº‹ï¼Œå¯ä»¥ç‚¹è¿›<code>Details</code>å»çœ‹çœ‹ï¼Œå®ƒå°±æ˜¯ä»å¤´æ¥ä¸€éæˆ‘ä»¬é¡¹ç›®ï¼Œ<code>git clone</code>å¼€å§‹ï¼Œç„¶å<code>yarn install</code>ï¼Œ<code>yarn build</code>ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰é”™è¯¯ï¼Œé‚£å°±é€šè¿‡äº†ï¼Œé€šè¿‡ä¹‹åçœ‹åˆ°æ­¤æ—¶ PR è¿™æ ·æ˜¾ç¤ºçš„ï¼š</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e83b62a55c34480a2e79724fa7a3f7f~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>é€šè¿‡è¯´æ˜æˆ‘ä»¬å¯ä»¥ Merge äº†ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©<code>Squash and merge</code>åˆå¹¶ï¼Œåˆå¹¶åä¼šå†æ¬¡è·‘ä¸€æ¬¡ Travisï¼ˆä½†æ—¥å¸¸å¼€å‘æˆ‘å¸æ˜¯è¦å…ˆæœ‰å…¶ä»–åŒäº‹ review é€šè¿‡æ‰èƒ½ merge çš„ï¼‰ã€‚æ­¤æ—¶æˆ‘ä»¬çš„ PR å°±åˆå¹¶åˆ°<code>development</code>åˆ†æ”¯ä¸Šäº†ï¼Œä½ çš„é‚®ç®±æ•´ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šæœ‰é‚®ä»¶é€šçŸ¥ä½ ã€‚</p><p>ä½†å…¶å®ä½ ä¼šå‘ç°ä½ ä¸ç”¨ç­‰å®ƒ Travis è¿è¡Œå®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ç‚¹<code>Merge</code>æŒ‰é’®ï¼ŒæŒ‰é“ç†å®ƒåº”è¯¥æš‚æ—¶ç¦ç”¨æ‰å¯¹ï¼Œç­‰åˆ° Travis é€šè¿‡æ‰å…è®¸æŒ‰ã€‚è¿™ä¸ªåœ¨<code>Githubè¯¥é¡¹ç›®ç›®å½• -&gt; Settings -&gt; Branches -&gt; Add rules</code>ï¼Œè¿™é‡Œåªæ˜¯ç®€å•ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a631937cc8e54619a5cf48577b2fdc01~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>ä»…ä»…è¿™æ ·å¯èƒ½å¹¶æ„Ÿå—ä¸åˆ°ä»€ä¹ˆä½œç”¨ï¼Œç°åœ¨æˆ‘ä»¬åˆ‡æ¢å›<code>development</code>åˆ†æ”¯ï¼Œ<code>git pull</code>æœ€æ–°ä»£ç ï¼Œå† checkout ä¸€æ¡æ–°åˆ†æ”¯<code>test/test-case-example</code>ï¼Œæ·»åŠ ä¸ªæµ‹è¯•æ–‡ä»¶<code>src/index.test.js</code></p><p>å¦‚æœä¸çŸ¥é“ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•çš„å¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.im/post/6891625768184070152" target="_blank" rel="noopener">ä¸€æ–‡å¸¦ä½ äº†è§£ Jest å•å…ƒæµ‹è¯•</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'å•å…ƒæµ‹è¯•'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'æµ‹è¯•ç”¨ä¾‹'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> foo = <span class="literal">true</span></span><br><span class="line">    expect(foo).toBeTruthy() <span class="comment">// æœŸæœ› foo å˜é‡çš„å€¼ä¸º true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™æ˜¯ä¸ªç™½ç—´æ²¡æœ‰æ„ä¹‰çš„æµ‹è¯•ï¼Œè¿è¡Œ<code>yarn test</code>ï¼Œæµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹ä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'å•å…ƒæµ‹è¯•'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'æµ‹è¯•ç”¨ä¾‹'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> foo = <span class="literal">true</span></span><br><span class="line">    expect(foo).toBeFalsy() <span class="comment">// æµ‹è¯•ä¸ä¼šé€šè¿‡</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>yarn test</code>ä¸ä¼šé€šè¿‡ï¼Œè¿™å°±å¯¹åº”æˆ‘ä»¬æ—¥å¸¸ä¿®æ”¹ä»£ç åï¼Œå‡è®¾ä½ æ²¡æœ‰é‡æ–°è¿è¡Œæµ‹è¯•ï¼ˆä½†æµ‹è¯•ç”¨ä¾‹å®é™…æ˜¯è¿è¡Œé”™è¯¯çš„ï¼‰ï¼Œä½ å´ push ä¸Šå»äº†ï¼Œåˆåˆå¹¶äº†å°±éº»çƒ¦äº†ï¼Œå› ä¸ºæµ‹è¯•ä¸è¿‡è¯´æ˜ä½ ä»£ç å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚</p><p>æ¥ç€éœ€è¦ Travis å¸®å¿™äº†ï¼Œä¿®æ”¹<code>.travis.yml</code>æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">language: node_js</span><br><span class="line"></span><br><span class="line">node_js:</span><br><span class="line">  - 12</span><br><span class="line"></span><br><span class="line">cache: yarn</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">  - yarn</span><br><span class="line">script:</span><br><span class="line">  - yarn test # è¿è¡Œæµ‹è¯•</span><br><span class="line">  - yarn build</span><br></pre></td></tr></table></figure><ul><li>æ¥ç€åŒä¸Šæ­¥éª¤ï¼Œå¼€ä¸ª PRï¼Œæ­¤æ—¶æ˜¾ç¤ºå¦‚ä¸‹ï¼Œæ­¤æ—¶å°±çœ‹åˆ° Travis æ˜¾ç¤º<code>Required</code>ï¼Œä½†å› ä¸ºæˆ‘æ˜¯é¡¹ç›®å”¯ä¸€æ‹¥æœ‰è€…å…¼ç®¡ç†å‘˜ï¼Œæ‰€ä»¥ä¾ç„¶å¯ä»¥ç›´æ¥ mergeï¼Œä½†å¦‚æœå…¶ä»–äºº PR ä¸Šæ¥ï¼Œåˆ™æ˜¯ä¸è¡Œçš„è¦ç­‰ Travis é€šè¿‡æ‰å…è®¸æŒ‰ merge æŒ‰é’®</li></ul><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/105f64f7f1aa47a9861bbc4b069ff912~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>ç­‰ä¸€ä¼šä½ ä¼šå‘ç°å®ƒæŒ‚äº†ï¼Œè¿™é‡Œå°±æ˜¾ç¤º<code>Ã—</code>å·äº†ï¼Œæ­¤æ—¶å¤±è´¥ä¸èƒ½åˆå¹¶ï¼ˆéç®¡ç†å‘˜ï¼‰ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be5e913ce34f4fd2a7ca1d6dd3898bfe~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>æˆ‘ä»¬å»<code>Details</code>é‡Œé¢çœ‹çœ‹å“ªé‡Œå‡ºé”™äº†ï¼Œçœ‹åˆ°æ˜¯æµ‹è¯•ç”¨ä¾‹å‡ºé”™å¯¼è‡´ Travis æ— æ³•é€šè¿‡ï¼š</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4836319529964437b806bbc19a0820a2~tplv-k3u1fbpfcp-watermark.image" alt=""></p><ul><li><p>äºæ˜¯æ­¤æ—¶æˆ‘ä»¬åº”è¯¥æ˜¯å»ä¿®æ”¹ä»£ç ï¼Œå†æäº¤ï¼Œè¿™å°±æ˜¯ Travis çš„å…¶ä¸­ä¸€ä¸ªå¸¸è§çš„ä½œç”¨äº†ã€‚</p></li><li><p>å…¶åå®ƒè¿˜æœ‰å¾ˆå¤šå…¶å®ƒå¯ä»¥ç©çš„ï¼Œæ¯”å¦‚è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ° Github page é¡µé¢ï¼Œåœ¨æˆ‘ç°åœ¨çš„ React å¼€æºç»„ä»¶åº“ <a href="https://github.com/Jacky-Summer/monki-ui/blob/development/.travis.yml" target="_blank" rel="noopener">monki-ui - travis é…ç½®</a> ä½œä¸ºä¾‹å­</p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  provider: pages  # æŒ‡å®šéƒ¨ç½²åˆ°Github Pagesï¼Œå³ gh-pagesåˆ†æ”¯</span><br><span class="line">  github_token: $GITHUB_TOKEN # åå­—å¯¹åº”æˆ‘ä»¬ä¸Šæ–¹çš„ token</span><br><span class="line">  skip_cleanup: true # æŒ‡å®šä¿ç•™æ„å»ºåçš„æ–‡ä»¶</span><br><span class="line">  keep-history: true # æŒ‡å®šæ¯æ¬¡éƒ¨ç½²ä¼šæ–°å¢ä¸€ä¸ªæäº¤è®°å½•å†æ¨é€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ git push --force</span><br><span class="line">  local_dir: docs-dist # æŒ‡å®šæ„å»ºåè¦éƒ¨ç½²çš„ç›®å½•</span><br><span class="line">  on:</span><br><span class="line">    branch: master # æŒ‡å®š master åˆ†æ”¯æœ‰æäº¤è¡Œä¸ºæ—¶ï¼Œå°†è§¦å‘æ„å»ºåéƒ¨ç½²</span><br></pre></td></tr></table></figure><ul><li><p>æœ¬æ–‡ä»‹ç»åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼ŒTravis è¿˜æœ‰å¾ˆå¤šå…¶ä»–æœ‰ç”¨çš„é…ç½®ï¼Œå°±éœ€è¦æ—¥å¸¸å¼€å‘è‡ªå·±å»äº†è§£äº†ã€‚</p></li><li><p>æœ¬æ–‡æ¡ˆä¾‹ä»£ç åœ°å€<a href="https://github.com/Jacky-Summer/travis-demo" target="_blank" rel="noopener">travis-demo</a><br>å‚è€ƒæ–‡ç« ï¼š</p></li><li><p><a href="http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html" target="_blank" rel="noopener">æŒç»­é›†æˆæœåŠ¡ Travis CI æ•™ç¨‹</a></p></li></ul><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>å‰ç«¯å·¥ç¨‹åŒ–</category>
      </categories>
      <tags>
        <tag>Travis</tag>
      </tags>
  </entry>
  <entry>
    <title>escapeã€encodeURIã€encodeURIComponentåŒºåˆ«</title>
    <url>/2020/11/11/escape%E3%80%81encodeURI%E3%80%81encodeURIComponent%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>JS ä¸­æœ‰ä¸‰ä¸ªå¯ä»¥å¯¹å­—ç¬¦ä¸²ç¼–ç çš„å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š escape,encodeURI,encodeURIComponent</p><a id="more"></a><h2 id="escape"><a href="#escape" class="headerlink" title="escape()"></a>escape()</h2><p>é€šå¸¸ç”¨äºå¯¹å­—ç¬¦ä¸²ç¼–ç ï¼Œä¸é€‚ç”¨äºå¯¹ URL ç¼–ç </p><p>é™¤äº† ASCII å­—æ¯ã€æ•°å­—å’Œç‰¹å®šçš„ç¬¦å·å¤–ï¼Œå¯¹ä¼ è¿›æ¥çš„å­—ç¬¦ä¸²å…¨éƒ¨è¿›è¡Œè½¬ä¹‰ç¼–ç ï¼Œå› æ­¤å¦‚æœæƒ³å¯¹ URL ç¼–ç ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</p><p>escape ä¸ä¼šç¼–ç çš„å­—ç¬¦æœ‰ 69 ä¸ªï¼š<code>* + - . / @ _ 0-9 a-z A-Z</code></p><p>å½“ç„¶å¦‚æœæ²¡æœ‰å¿…è¦ï¼Œä¸è¦ä½¿ç”¨ escapeã€‚</p><h2 id="encodeURI"><a href="#encodeURI" class="headerlink" title="encodeURI()"></a>encodeURI()</h2><p><code>encodeURI()</code>ä¸ä¼šè¿›è¡Œç¼–ç çš„å­—ç¬¦æœ‰ 82 ä¸ª ï¼š<code>; , / ? : @ &amp; = + $ - _ . ! ~ * &#39; ( ) # 0-9 a-z A-Z</code></p><p>ä½¿ç”¨<code>encodeURI()</code>ç¼–ç åçš„ç»“æœæ˜¯é™¤äº†ç©ºæ ¼ä¹‹å¤–çš„å…¶ä»–å­—ç¬¦éƒ½åŸå°ä¸åŠ¨ï¼Œåªæœ‰ç©ºæ ¼è¢«æ›¿æ¢æˆäº†<code>%20</code>,<code>encodeURI</code>ä¸»è¦ç”¨äºç›´æ¥èµ‹å€¼ç»™åœ°å€æ ã€‚</p><h2 id="encodeURIComponent"><a href="#encodeURIComponent" class="headerlink" title="encodeURIComponent()"></a>encodeURIComponent()</h2><p><code>encodeURIComponent</code>:ä¸ä¼šè¿›è¡Œç¼–ç çš„å­—ç¬¦æœ‰ 71 ä¸ªï¼š<code>! &#39; ( ) * - . _ ~ 0-9 a-z A-Z</code></p><p><code>encodeURIComponent</code>æ¯”<code>encodeURI</code>ç¼–ç çš„èŒƒå›´æ›´å¤§ï¼Œå¦‚<code>encodeURIComponent</code>ä¼šæŠŠ <code>http://</code> ç¼–ç æˆ <code>http%3A%2F%2F</code> è€Œ<code>encodeURI</code>ä¸è§£ç ç»´æŒ<code>http://</code></p><p><code>encodeURIComponent()</code> æ–¹æ³•åœ¨ç¼–ç å•ä¸ª URIComponentï¼ˆæŒ‡è¯·æ±‚å‚æ•°ï¼‰åº”å½“æ˜¯æœ€å¸¸ç”¨çš„ï¼Œå®ƒå¯ä»¥å°†å‚æ•°ä¸­çš„ä¸­æ–‡ã€ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè€Œä¸ä¼šå½±å“æ•´ä¸ª URL</p><h2 id="å¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨ä¸‰ä¸ªå‡½æ•°"><a href="#å¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨ä¸‰ä¸ªå‡½æ•°" class="headerlink" title="å¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨ä¸‰ä¸ªå‡½æ•°"></a>å¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨ä¸‰ä¸ªå‡½æ•°</h2><ul><li>å¦‚æœåªæ˜¯ç¼–ç <strong>å­—ç¬¦ä¸²</strong>ï¼Œå’Œ URL æ²¡æœ‰å…³ç³»ï¼Œæ‰å¯ä»¥ç”¨<code>escape</code>ã€‚ï¼ˆä½†å®ƒå·²ç»è¢«åºŸå¼ƒï¼Œå°½é‡é¿å…ä½¿ç”¨ï¼Œåº”ç”¨<code>encodeURI</code> æˆ– <code>encodeURIComponent</code>ï¼‰</li><li>å¦‚æœéœ€è¦ç¼–ç <strong>æ•´ä¸ª URL</strong>ï¼Œç„¶åéœ€è¦ä½¿ç”¨è¿™ä¸ª URLï¼Œé‚£ä¹ˆç”¨<code>encodeURI</code></li><li>å¦‚æœéœ€è¦ç¼–ç  <strong>URL ä¸­çš„å‚æ•°</strong>çš„æ—¶å€™ï¼Œé‚£ä¹ˆ<code>encodeURIComponent</code>æ˜¯æœ€å¥½æ–¹æ³•ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">encodeURI(&quot;https:&#x2F;&#x2F;github.com&#x2F;Jacky-Summer&#x2F;test params&quot;);</span><br></pre></td></tr></table></figure><p>ç¼–ç åå˜æˆ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;Jacky-Summer&#x2F;test%20params</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç©ºæ ¼è¢«ç¼–ç æˆäº†<code>%20</code>ï¼Œè€Œå¦‚æœæ˜¯ç”¨<code>encodeURIComponent</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https%3A%2F%2Fgithub.com%2FJacky-Summer%2Ftest%20params</span><br></pre></td></tr></table></figure><p>è¿ <code>/</code> éƒ½è¢«ç¼–ç äº†ï¼Œæ•´ä¸ª URL å·²ç»æ²¡æ³•ç”¨äº†ã€‚</p><p>å½“ç¼–ç  URL çš„ç‰¹æ®Šå‚æ•°æ—¶ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; å‚æ•°çš„ &#x2F; æ˜¯éœ€è¦ç¼–ç çš„ï¼Œè€Œå¦‚æœæ˜¯ encodeURI ç¼–ç åˆ™ä¸ç¼–ç  &#x2F; å°±ä¼šå‡ºé—®é¢˜</span><br><span class="line">let param &#x3D; &quot;https:&#x2F;&#x2F;github.com&#x2F;Jacky-Summer&#x2F;&quot;;</span><br><span class="line">param &#x3D; encodeURIComponent(param);</span><br><span class="line">const url &#x3D; &quot;https:&#x2F;&#x2F;github.com?param&#x3D;&quot; + param;</span><br><span class="line">console.log(url) &#x2F;&#x2F; &quot;https:&#x2F;&#x2F;github.com?param&#x3D;https%3A%2F%2Fgithub.com%2FJacky-Summer%2F&quot;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://www.zhihu.com/question/21861899" target="_blank" rel="noopener">https://www.zhihu.com/question/21861899</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>encodeURIComponent</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ–‡å¸¦ä½ äº†è§£ Jest å•å…ƒæµ‹è¯•</title>
    <url>/2020/11/05/%E4%B8%80%E6%96%87%E5%B8%A6%E4%BD%A0%E4%BA%86%E8%A7%A3-Jest-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<p>å‰ç«¯æµ‹è¯•æ™®åŠåº¦è™½ç„¶ä¸ç®—é«˜ï¼Œä½†å¯¹é¡¹ç›®ä»£ç è´¨é‡ä»¥åŠåæœŸç»´æŠ¤é¡¹ç›®ä¸Šå´æœ‰å¾ˆå¤§çš„ä½œç”¨ã€‚æœ¬æ–‡ä¼šæŠ›ç –å¼•ç‰çš„è®²ä¸‹ Jest å•å…ƒæµ‹è¯•ï¼Œå› ä¸ºå¾ˆå¤š API å…·ä½“çœ‹å®˜ç½‘å°±å¯ä»¥äº†ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-Jest"><a href="#ä»€ä¹ˆæ˜¯-Jest" class="headerlink" title="ä»€ä¹ˆæ˜¯ Jest"></a>ä»€ä¹ˆæ˜¯ Jest</h2><p>Jest æ˜¯ç”¨æ¥åˆ›å»ºã€æ‰§è¡Œå’Œæ„å»ºæµ‹è¯•ç”¨ä¾‹çš„ä¸€ä¸ª JavaScript æµ‹è¯•<br>åº“ã€‚å¯ä»¥åœ¨ä»»ä½•é¡¹ç›®ä¸­å®‰è£…ä½¿ç”¨å®ƒï¼Œå¦‚ Vue/React/Angular/Node/TypeScript ç­‰ã€‚</p><h2 id="ä½¿ç”¨-Jest-çš„å¥½å¤„"><a href="#ä½¿ç”¨-Jest-çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨ Jest çš„å¥½å¤„"></a>ä½¿ç”¨ Jest çš„å¥½å¤„</h2><p>ç›®å‰å‰ç«¯æµ‹è¯•åœ¨å¼€å‘åº”ç”¨åœºæ™¯ä¸»è¦æ˜¯ UI ç»„ä»¶åº“ï¼Œä½†å…¶å®ä¸æ­¢æ˜¯ç»„ä»¶åº“ï¼Œæ—¥å¸¸é¡¹ç›®å¼€å‘ä¹Ÿå¯ä»¥åŠ å…¥å•å…ƒæµ‹è¯•ï¼Œä¿è¯é¡¹ç›®çš„ç¨³å®šã€‚</p><p>å®ƒçš„å¥½å¤„æœ‰å“ªäº›å‘¢ï¼Ÿ</p><ul><li>é€Ÿåº¦å¿«ï¼Œä½¿ç”¨ç®€å•å’Œå®¹æ˜“é…ç½®</li><li>é€šè¿‡ç¼–å†™æµ‹è¯•ï¼Œè®©ä»£ç å‡ºç° bug çš„æ¦‚ç‡æ›´å°</li><li>æœ‰åˆ©äºå†™å‡ºå¥å£®æ€§æ›´å¥½çš„ä»£ç ï¼Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§å¢å¼º</li><li>å¥½çš„æµ‹è¯•ï¼Œå°±å…·æœ‰æ–‡æ¡£è§£é‡Šçš„ä½œç”¨</li><li>å‡å°‘å›å½’æµ‹è¯•ä¸­çš„ bug</li></ul><h2 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h2><p>æ¯”å¦‚å†™ä¸€ä¸ªåŠ æ³•å’Œå‡æ³•å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function add(a, b) &#123;</span><br><span class="line">  return a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function minus(a, b) &#123;</span><br><span class="line">  return a - b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»æœ€ç®€å•çš„å‡½æ•°å¼€å§‹å…¥æ‰‹è®²èµ·æ¥ï¼Œå‡è®¾è¦å¯¹æ”¹å‡½æ•°è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬æµ‹è¯•çš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå³æ˜¯ä»–çš„åŠŸèƒ½ï¼Œè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œè¿”å›ç»“æœä¸ºä»–ä»¬ç›¸åŠ çš„å€¼ã€‚æ¯”å¦‚ä¼ å…¥<code>add(1, 1)</code>ï¼Œæˆ‘ä»¬æœŸæœ›ç»“æœæ˜¯è¿”å›ç›¸åŠ ç»“æœ<code>2</code><br>å†™æˆä»£ç å¯ä»¥è¿™æ ·<code>expect(add(1, 1)) === 2</code>ï¼Œå†å°è£…å¾—è¯­ä¹‰åŒ–ä¸€ç‚¹çš„è¯ï¼Œ<code>expect(add(1, 1)).toBe(2)</code>ä¸ºæˆ‘ä»¬æœŸæœ›çš„æµ‹è¯•å‡½æ•°ï¼Œæ¥å®ç°è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">expect</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    toBe(actual) &#123;</span><br><span class="line">      <span class="keyword">if</span> (result !== actual) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`ä¸é¢„æœŸç»“æœä¸ç›¸ç­‰ã€‚å®é™…ç»“æœï¼š<span class="subst">$&#123;actual&#125;</span>ï¼ŒæœŸæœ›ç»“æœï¼š<span class="subst">$&#123;result&#125;</span>`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">expect(add(<span class="number">1</span>, <span class="number">1</span>)).toBe(<span class="number">2</span>)</span><br><span class="line">expect(minus(<span class="number">2</span>, <span class="number">1</span>)).toBe(<span class="number">1</span>)</span><br><span class="line">expect(add(<span class="number">2</span>, <span class="number">2</span>)).toBe(<span class="number">3</span>) <span class="comment">// Error: ä¸é¢„æœŸç»“æœä¸ç›¸ç­‰ã€‚å®é™…ç»“æœï¼š3ï¼ŒæœŸæœ›ç»“æœï¼š4</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸é€šè¿‡æˆ‘ä»¬å°±è®©å®ƒæŠ›å‡ºé”™è¯¯</p><p>è¿™æ ·å†™çš„è¯å®é™…æœ‰ç‚¹æ··ä¹±ï¼Œå› ä¸ºä¸€çœ¼çœ‹ä¸‹å»ä¸çŸ¥é“åœ¨æµ‹è¯•å•¥ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬å¤šå°è£…ä¸€ä¸ªå‡½æ•°ï¼Œä»£è¡¨æˆ‘ä»¬æ­£åœ¨åšä»€ä¹ˆæµ‹è¯•</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; desc ç”¨æ¥æè¿°æµ‹è¯•è¡Œä¸ºï¼Œ fnåˆ™ä¸ºæˆ‘ä»¬æ‰§è¡Œæµ‹è¯•çš„å‡½æ•°</span><br><span class="line">function test(desc, fn) &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    fn()</span><br><span class="line">    console.log(&#96;$&#123;desc&#125;é€šè¿‡æµ‹è¯•&#96;)</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    console.log(&#96;$&#123;desc&#125;æµ‹è¯•ä¸é€šè¿‡ $&#123;e&#125;&#96;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(&#39;åŠ æ³•æµ‹è¯•&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">  expect(add(1, 1)).toBe(2)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(&#39;å‡æ³•æµ‹è¯•&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">  expect(minus(2, 1)).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»£ç ï¼Œè¾“å‡º</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åŠ æ³•æµ‹è¯•é€šè¿‡æµ‹è¯•</span><br><span class="line">å‡æ³•æµ‹è¯•é€šè¿‡æµ‹è¯•</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æˆ‘ä»¬åŠ¨æ‰‹çš„æœ€ç®€å•çš„æµ‹è¯•äº†ï¼Œå› ä¸ºæˆ‘ä»¬å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šè§‰å¾—åœ¨åšç€å•°å—¦çš„å·¥ä½œã€‚</p><p>ä»æµç¨‹ä¸Šçœ‹ï¼Œä¸€ä¸ªç®€å•çš„æµ‹è¯•æµç¨‹ï¼ˆè¾“å…¥ â€”â€” é¢„æœŸè¾“å‡º â€”â€” éªŒè¯ç»“æœï¼‰å¦‚ä¸‹ï¼š</p><ol><li>å¼•å…¥è¦æµ‹è¯•çš„å‡½æ•°</li><li>ä¼ å…¥æµ‹è¯•å‡½æ•°æ‰§è¡Œç»“æœ</li><li>å®šä¹‰é¢„æœŸè¾“å‡º</li><li>æ£€æŸ¥å‡½æ•°æ˜¯å¦è¿”å›äº†é¢„æœŸçš„è¾“å‡ºç»“æœ</li></ol><h2 id="åˆå§‹åŒ–ç¯å¢ƒ"><a href="#åˆå§‹åŒ–ç¯å¢ƒ" class="headerlink" title="åˆå§‹åŒ–ç¯å¢ƒ"></a>åˆå§‹åŒ–ç¯å¢ƒ</h2><p>åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹è¿›å…¥åˆå§‹åŒ–</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><p>å®‰è£… jest</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add --dev jest</span><br></pre></td></tr></table></figure><p>åœ¨<code>package.json</code>é…ç½®è„šæœ¬å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶<code>babel.config.js</code>ï¼Œå®‰è£…ä¾èµ–å¹¶é…ç½®</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add --dev babel-jest @babel&#x2F;core @babel&#x2F;preset-env</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// babel.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">'@babel/preset-env'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        targets: &#123;</span><br><span class="line">          node: <span class="string">'current'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¯æ®µä»‹ç»éƒ½ä¼šé‡‡å–<code>example.js</code>é‡Œé¢å†™ä»£ç ï¼Œå†åˆ°<code>*.test.js</code>æ–‡ä»¶å¼•å…¥<code>example.js</code>çš„å‡½æ•°å¹¶æµ‹è¯•ã€‚</p><h2 id="åŒ¹é…å™¨-Matchers"><a href="#åŒ¹é…å™¨-Matchers" class="headerlink" title="åŒ¹é…å™¨ Matchers"></a>åŒ¹é…å™¨ Matchers</h2><p>ä½¿ç”¨ Matchers è®©ä½ å¯ä»¥ç”¨å„ç§æ–¹å¼æµ‹è¯•ä½ çš„ä»£ç </p><p>è·Ÿæˆ‘ä»¬ä¸Šé¢å†™çš„ä»£ç ä¸€æ ·ï¼Œjest æä¾›äº†<code>test</code>,<code>expect</code>,<code>toBe</code>æ–¹æ³•</p><p><code>example.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> multiply = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶<code>matcher.test.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; multiply &#125; <span class="keyword">from</span> <span class="string">'./example'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'æµ‹è¯•ä¹˜æ³•'</span>, () =&gt; &#123;</span><br><span class="line">  expect(multiply(<span class="number">4</span>, <span class="number">2</span>)).toBe(<span class="number">8</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>toBe</code> ä½¿ç”¨ <code>Object.is</code> æ¥æµ‹è¯•ç²¾ç¡®ç›¸ç­‰ã€‚ å¦‚æœæƒ³è¦æ£€æŸ¥å¯¹è±¡çš„å€¼ï¼Œä½¿ç”¨ <code>toEqual</code> ä»£æ›¿ã€‚</p><p><code>matcher.test.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">test(<span class="string">'æµ‹è¯•å¯¹è±¡æ˜¯å¦ç›¸ç­‰'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123; <span class="attr">name</span>: <span class="string">'jacky'</span> &#125;</span><br><span class="line">  data[<span class="string">'age'</span>] = <span class="number">23</span></span><br><span class="line">  expect(data).toEqual(&#123; <span class="attr">name</span>: <span class="string">'jacky'</span>, <span class="attr">age</span>: <span class="number">23</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>yarn test</code>ï¼Œå¯çœ‹åˆ°æ§åˆ¶å°æ˜¾ç¤ºä¸¤ä¸ªæµ‹è¯•é€šè¿‡ï¼›å¦‚ä¸é€šè¿‡æ§åˆ¶å°ä¹Ÿä¼šæç¤ºå“ªä¸ªæµ‹è¯•ç”¨ä¾‹å‡ºé”™ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/804c59a4689b4b2bb980115f77e7d29f~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>å½“è¿è¡Œè¯¥å‘½ä»¤çš„æ—¶å€™ï¼Œjest ä¼šè‡ªåŠ¨æœå¯»é¡¹ç›®ä¸­æœ‰<code>.test.js</code>åç¼€çš„æ–‡ä»¶ï¼Œå¹¶è¿è¡Œæµ‹è¯•ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿæœ‰å…¶ä»–åŒ¹é…å™¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">test(<span class="string">'åŒ¹é…å™¨'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> n = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> isTrue = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="number">3</span></span><br><span class="line">  expect(n).toBeNull() <span class="comment">// åªåŒ¹é… null</span></span><br><span class="line">  expect(n).toBeDefined() <span class="comment">// åªåŒ¹é… undefined</span></span><br><span class="line">  expect(n).not.toBeUndefined() <span class="comment">// ä¸ toBeUndefined ç›¸å</span></span><br><span class="line">  expect(isTrue).toBeTruthy() <span class="comment">// åŒ¹é…ä»»ä½• if è¯­å¥ä¸ºçœŸ</span></span><br><span class="line"></span><br><span class="line">  expect(value).toBeGreaterThan(<span class="number">2</span>)</span><br><span class="line">  expect(value).toBeLessThan(<span class="number">5</span>)</span><br><span class="line">  expect(value).toBeLessThanOrEqual(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•å¼‚æ­¥ä»£ç "><a href="#æµ‹è¯•å¼‚æ­¥ä»£ç " class="headerlink" title="æµ‹è¯•å¼‚æ­¥ä»£ç "></a>æµ‹è¯•å¼‚æ­¥ä»£ç </h2><p><code>example.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">'https://jsonplaceholder.typicode.com/todos/1'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>async.test.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fetchData &#125; <span class="keyword">from</span> <span class="string">'./example'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'æµ‹è¯• async await'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> fetchData()</span><br><span class="line">  expect(data.data.id).toBe(<span class="number">1</span>) <span class="comment">// è¯·æ±‚apiè¿”å›çš„idå€¼æ˜¯å¦ä¸º1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'æµ‹è¯• Promise'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> fetchData().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    expect(data.data.id).toBe(<span class="number">1</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="mock-å‡½æ•°"><a href="#mock-å‡½æ•°" class="headerlink" title="mock å‡½æ•°"></a>mock å‡½æ•°</h2><p>å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šå¼‚æ­¥è¯·æ±‚çš„å‡½æ•°éœ€è¦æµ‹è¯•ï¼Œä¼šä½¿æµ‹è¯•å˜å¾—ç¼“æ…¢ï¼Œé‚£ä¹ˆä¸Šè¿°ç”¨çœŸå®æ¥å£è¯·æ±‚çš„æ–¹å¼å°±ä¸å¤ªé€‚åˆäº†ï¼›æˆ–è€…æƒ³è¦æ•è·å¯¹å‡½æ•°çš„è°ƒç”¨ï¼Œè¿™æ—¶å°±éœ€è¦ Mockï¼Œå®ƒå¯ä»¥åšåˆ°ï¼š</p><ol><li>æ•è·å¯¹å‡½æ•°çš„è°ƒç”¨ï¼Œä»¥åŠ this å’Œè°ƒç”¨é¡ºåº</li><li>å®ƒå…è®¸æµ‹è¯•æ—¶é…ç½®è¿”å›å€¼</li><li>æ”¹å˜å‡½æ•°çš„å†…éƒ¨å®ç°</li></ol><p>mock.test.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchData &#125; <span class="keyword">from</span> <span class="string">'./example'</span></span><br><span class="line">jest.mock(<span class="string">'axios'</span>) <span class="comment">// è‡ªåŠ¨æ¨¡æ‹Ÿ axios æ¨¡å—ã€‚</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'æµ‹è¯•è¯·æ±‚æ¥å£'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  axios.get.mockResolvedValue(&#123; <span class="attr">data</span>: <span class="string">'hello'</span> &#125;) <span class="comment">// è¿”å›å‡æ•°æ® &#123; data: 'hello' &#125; ç”¨äºæµ‹è¯•</span></span><br><span class="line">  <span class="keyword">await</span> fetchData().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    expect(data).toEqual(&#123; <span class="attr">data</span>: <span class="string">'hello'</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯èƒ½ä½ ä¼šæƒ³ï¼Œè¿™æ ·æµ‹è¯•æœ‰ä»€ä¹ˆç”¨ï¼Œéƒ½æ˜¯å‡æ•°æ®ï¼Œä½œä¸ºå‰ç«¯è¿™è¾¹ï¼Œæˆ‘ä»¬åªè¦ç¡®ä¿å‡½æ•°è¢«è°ƒç”¨å’Œæ­£å¸¸è¿”å›ç»“æœå°±å¤Ÿäº†ï¼›å½“ç„¶è¿™ä¸ªä¾‹å­æ˜¯æ¯”è¾ƒç®€å•ï¼Œæ¶‰åŠå¤æ‚æ¥å£æµ‹è¯•çš„è¯è¿˜æœ‰å…¶ä»– API å¯ç”¨ã€‚å…¶ä»–æ›´æ·±å…¥å…·ä½“çš„æ¥å£è¯·æ±‚æµ‹è¯•æ˜¯åç«¯è¦åšçš„ã€‚</p><p>åœ¨<code>example.js</code>å¢åŠ ä¸€ä¸ªå‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰§è¡Œè¯¥å‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç„¶åå›è°ƒå‡½æ•°ä¼ é€’ä¸€ä¸ªå‚æ•°å¹¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runFn</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  fn(<span class="string">'å‡½æ•°æ‰§è¡Œäº†'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³æµ‹è¯•å°±è®©å®ƒæ‰§è¡Œï¼Œå°±å¯ä»¥ç”¨ mock æ¥æµ‹è¯•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">test(<span class="string">'å‡½æ•°è¢«è°ƒç”¨äº†'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn()</span><br><span class="line">  runFn(fn) <span class="comment">// è°ƒç”¨å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">  expect(fn).toHaveBeenCalled() <span class="comment">// æœŸæœ›fnè¢«è°ƒç”¨äº†</span></span><br><span class="line">  expect(fn).toHaveBeenLastCalledWith(<span class="string">'å‡½æ•°æ‰§è¡Œäº†'</span>) <span class="comment">// å‡½æ•°fnè¢«è°ƒç”¨æ—¶çš„å‚æ•°æ˜¯å¦ç¬¦åˆ</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰è®¾ç½®è¿”å›å‚æ•°ï¼Œæµ‹è¯•è¢«æ‰§è¡Œæ¬¡æ•°ç­‰ç­‰ï¼Œå…·ä½“æŸ¥å®˜æ–¹æ–‡æ¡£ã€‚</p><h2 id="Snapshot"><a href="#Snapshot" class="headerlink" title="Snapshot"></a>Snapshot</h2><p>æ¯å½“æˆ‘ä»¬æƒ³è¦ç¡®ä¿ UIï¼ˆæŒ‡ html css ç­‰ï¼‰æˆ–è€…é…ç½®æ–‡ä»¶ä¸ä¼šæ”¹å˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¿«ç…§æµ‹è¯•ã€‚</p><p>è¿™é‡Œåªä¸¾ä¾‹é…ç½®æ–‡ä»¶</p><p><code>example.test.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getConfig</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    url: <span class="string">'http://localhost:3000'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>snapshot.test.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getConfig &#125; <span class="keyword">from</span> <span class="string">'./example'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'æµ‹è¯•é…ç½®æ–‡ä»¶æœ‰æ²¡æœ‰æ›´æ”¹'</span>, () =&gt; &#123;</span><br><span class="line">  expect(getConfig()).toMatchSnapshot()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>npm run test</code>ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œï¼Œä¼šå‘ç°æ–‡ä»¶æ‰€åœ¨ä½ç½®ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤¹<code>__snapshots__</code>,é‡Œé¢æœ‰ä¸ª<code>snapshot.test.js.snap</code>æ–‡ä»¶ï¼Œé‡Œé¢å†…å®¹æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; Jest Snapshot v1, https:&#x2F;&#x2F;goo.gl&#x2F;fbAQLP</span><br><span class="line"></span><br><span class="line">exports[&#96;æµ‹è¯•é…ç½®æ–‡ä»¶æœ‰æ²¡æœ‰æ›´æ”¹ 1&#96;] &#x3D; &#96;</span><br><span class="line">Object &#123;</span><br><span class="line">  &quot;port&quot;: 8080,</span><br><span class="line">  &quot;url&quot;: &quot;http:&#x2F;&#x2F;localhost:3000&quot;,</span><br><span class="line">&#125;</span><br><span class="line">&#96;;</span><br></pre></td></tr></table></figure><p>é‡Œé¢ä¿å­˜äº†æˆ‘ä»¬é…ç½®ä¿¡æ¯ï¼Œå¦‚æœä½ ä¸å°å¿ƒæ”¹äº†é…ç½®ä¿¡æ¯çš„è¯ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ä¸ç¬¦åˆï¼›è¿™æ—¶ä½ å°±çŸ¥é“äº†ä½ æ”¹åˆ°ä¸åº”è¯¥æ”¹çš„ä½ç½®äº†<br>æ¯”å¦‚æŠŠç«¯å£å¥½æ”¹æˆ<code>8081</code>ï¼Œå†è¿è¡Œ<code>npm run test</code></p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d398cf43a34149d69a0868bbcd8833de~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>ä½†å¦‚æœçœŸçš„è¦æ”¹çš„è¯å‘¢ï¼Œé‚£å°±æŒ‰æç¤ºé‡Œé¢çš„ä¿¡æ¯åšï¼Œæ›´æ–°å¿«ç…§ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm test -- -u</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåå°±ä¼šåœ¨ç»ˆç«¯çœ‹åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Snapshots:   1 updated, 1 total</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡å†æ‰§è¡Œæµ‹è¯•å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œå°±æŠŠé…ç½®ä¿¡æ¯æ›´æ–°äº†ã€‚</p><h2 id="Timers-Mocks"><a href="#Timers-Mocks" class="headerlink" title="Timers Mocks"></a>Timers Mocks</h2><p>å½“è¦æµ‹è¯•æœ‰å®šæ—¶å™¨çš„å‡½æ•°æ—¶ï¼Œæ¯”å¦‚è¿‡ 5 ç§’æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´å¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œè¦çœŸæ­£ç­‰å¾…å®ƒç»è¿‡ä¸€å®šæ—¶é—´æ‰§è¡Œï¼Œè¿™æ˜¯å¯ä»¥æ¨¡æ‹Ÿå®šæ—¶å™¨å‡½æ•°ã€‚</p><p><code>example.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">timerGame</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Ready....go!'</span>)</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Time's up -- stop!"</span>)</span><br><span class="line">    callback &amp;&amp; callback()</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; timerGame &#125; <span class="keyword">from</span> <span class="string">'./example'</span></span><br><span class="line"></span><br><span class="line">jest.useFakeTimers()</span><br><span class="line"></span><br><span class="line">test(<span class="string">'æµ‹è¯•ä¸€å®šæ—¶é—´åæ‰§è¡Œå‡½æ•°'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn()</span><br><span class="line">  timerGame(fn)</span><br><span class="line">  jest.advanceTimersByTime(<span class="number">3000</span>) <span class="comment">// æŠŠæ—¶é—´æå‰äº†ä¸‰ç§’</span></span><br><span class="line">  expect(fn).toBeCalled() <span class="comment">// å‡½æ•°è¢«è°ƒç”¨äº†</span></span><br><span class="line">  expect(fn).toHaveBeenCalledTimes(<span class="number">1</span>) <span class="comment">// å‡½æ•°è¢«æ‰§è¡Œäº†1æ¬¡</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•è¦†ç›–ç‡"><a href="#æµ‹è¯•è¦†ç›–ç‡" class="headerlink" title="æµ‹è¯•è¦†ç›–ç‡"></a>æµ‹è¯•è¦†ç›–ç‡</h2><p>å¢åŠ ä¸€ä¸ªè„šæœ¬å‘½ä»¤ï¼Œå°†æµ‹è¯•è¦†ç›–ç‡ä¿¡æ¯è¾“å‡ºä¸ºæŠ¥å‘Š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;coverage&quot;: &quot;jest --coverage&quot;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥å‘½ä»¤<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa658fe9b80540b9b9e5e8dee53af03c~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>å¯ä»¥åœ¨ç»ˆç«¯çœ‹åˆ°ç”Ÿæˆäº†æŠ¥å‘Šï¼Œä¸Šè¿°ä¾‹å­çš„ä»£ç æµ‹è¯•è¦†ç›–ç‡æ˜¯ 100%ï¼Œè¿™æ˜¯å› ä¸ºæµ‹è¯•çš„å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥è½»æ˜“ 100%ã€‚</p><p>åŒæ—¶é¡¹ç›®æ ¹ç›®å½•ä¹ŸæˆåŠŸäº†ä¸€ä¸ªæ–‡ä»¶å¤¹<code>coverage</code>ï¼Œé‡Œé¢çš„<code>lcov-report</code>ç›®å½•é‡Œç”Ÿæˆ HTML æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰“å¼€æŸ¥çœ‹ã€‚</p><p>å¦‚ä¸‹ï¼š<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d07e062bd224e21819cbd3118fec6ed~tplv-k3u1fbpfcp-watermark.image" alt=""></p><h2 id="TDD-ä¸-BDD"><a href="#TDD-ä¸-BDD" class="headerlink" title="TDD ä¸ BDD"></a>TDD ä¸ BDD</h2><p>ç°åœ¨æµè¡Œçš„å•å…ƒæµ‹è¯•é£æ ¼ä¸»è¦æœ‰ TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰å’Œ BDDï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰ä¸¤ç§ã€‚æ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«æ˜¯ä¸€ä¸ªæ˜¯å…ˆå†™æµ‹è¯•ç”¨ä¾‹å†å†™ä»£ç ï¼Œä¸€ä¸ªæ˜¯å…ˆå†™ä»£ç å†å†™æµ‹è¯•ç”¨ä¾‹ã€‚</p><h3 id="TDD"><a href="#TDD" class="headerlink" title="TDD"></a>TDD</h3><p>TDD çš„å¼€å‘æµç¨‹ä¸€èˆ¬æ˜¯å…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå†ç¼–å†™ä»£ç ã€‚</p><p>æ¯”å¦‚å†™ä¸€ä¸ª Todolistï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å…ˆæƒ³å¥½å®ƒçš„åŠŸèƒ½å’Œæ³¨æ„ç‚¹ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½éƒ½å…·å¤‡å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæ²¡å†™ä»£ç ä¹‹å‰è‚¯å®šæ˜¯é€šä¸è¿‡çš„ï¼›ç„¶åå†™å®Œå¼€å§‹ç¼–å†™ä»£ç ï¼Œä½¿æµ‹è¯•ç”¨ä¾‹é€šè¿‡æµ‹è¯•ï¼Œå†ç»§ç»­é‡å¤æ­¥éª¤ï¼Œå®Œæˆå¼€å‘ã€‚è¿™æ ·å†™å‡ºæ¥çš„ä»£ç è´¨é‡å’Œç»´æŠ¤æ€§ä¹Ÿä¼šæ›´å¥½ã€‚</p><p>æ‰€ä»¥ TDD ä¸€èˆ¬å°±æ˜¯ä½œä¸ºå•å…ƒæµ‹è¯•ï¼Œå³æ˜¯å•ä¸€ç»„ä»¶åŠŸèƒ½ä¸Šæµ‹è¯•å¾—è¾ƒä¸ºå®Œå–„ï¼Œä½†å‡ ä¸ªç»„ä»¶åŠ èµ·æ¥æµ‹è¯•è¿™ç§å´ä¸ä¸€å®šèƒ½æµ‹è¯•å®Œå–„ã€‚</p><p>å•å…ƒæµ‹è¯•åº”ç”¨æ¯”è¾ƒå¤šçš„æ˜¯å‡½æ•°åº“ï¼Œå¯å¯¹æ¯ä¸ªå‡½æ•°è¿›è¡Œå•ç‹¬ç»†è‡´æµ‹è¯•ã€‚</p><p>å•å…ƒæµ‹è¯•æ¯”è¾ƒç‹¬ç«‹ï¼Œä½†è¿‡äºç‹¬ç«‹ä¹Ÿä¼šéšè—ä¸€äº›æ½œåœ¨é—®é¢˜æ— æ³•æµ‹åˆ°ï¼Œè¿™ä¸ªæ—¶å€™å°±æœ‰é›†æˆæµ‹è¯•è¾…åŠ©äº†ã€‚</p><h3 id="BDD"><a href="#BDD" class="headerlink" title="BDD"></a>BDD</h3><p>BDD çš„å¼€å‘æµç¨‹ä¸€èˆ¬æ˜¯å…ˆç¼–å†™ä»£ç ï¼Œå†å†™æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>è¿™ä¸ªå°±æ¯”è¾ƒç¬¦åˆæˆ‘ä»¬ä»¥å¾€çš„å¼€å‘æ¨¡å¼ï¼Œä¸è¿‡ BDD æ›´å…³æ³¨çš„æ˜¯æ•´ä½“çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œä¸€èˆ¬ç»“åˆé›†æˆæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä½“å¥½å¤šä¸ªç»„ä»¶æ•´ä½“ä¸šåŠ¡æµ‹è¯•è¿™ç§ã€‚</p><p>é›†æˆæµ‹è¯•é‡ç‚¹å…³å¿ƒçš„æ˜¯ç»“æœï¼Œè€Œä¸æ˜¯ä»£ç ï¼Œæ›´é€‚åˆä¸šåŠ¡å¼€å‘ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä¸¤ç§æµ‹è¯•é£æ ¼éƒ½æœ‰å®ƒè‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¾‹ä¸€éƒ¨åˆ†ï¼›æ•´ä½“ç®€å•ç†è§£ä¸‹æ¥ï¼Œå‰ç«¯æµ‹è¯•èƒ½è®©æˆ‘ä»¬å†™å‡ºæ›´å¥½çš„ä»£ç ï¼Œå‡å°‘ bug çš„äº§ç”Ÿï¼›è€Œä¸”ï¼Œåœ¨ç»´æŠ¤ä¸€äº›è€é¡¹ç›®æ–¹é¢ï¼Œä¹Ÿæ˜¯æœ‰ä¼˜åŠ¿ï¼Œæ¯”å¦‚ä½ åœ¨æ”¹åŠ¨æ—§é¡¹ç›®ä»£ç çš„æ—¶å€™ï¼Œå¯èƒ½æ€•å½±å“å…¶ä»–ç»„ä»¶æˆ–åŠŸèƒ½ä½†ä½ æ— æ³•çŸ¥æ™“ï¼Œä½†å¦‚æœæœ‰æµ‹è¯•ï¼Œç›´æ¥æ”¹å®Œè¿è¡Œæ‰€æœ‰æµ‹è¯•ä»£ç å°±çŸ¥é“æœ‰æ²¡æœ‰å½±å“åˆ°å…¶ä»–çš„åŠŸèƒ½ä»£ç äº†ï¼›è€Œå¦‚æœè€é¡¹ç›®æ²¡æœ‰å†™å•å…ƒ/é›†æˆæµ‹è¯•ï¼Œä¸ºäº†æ›´å¥½çš„ç»´æŠ¤ï¼Œä½ ä¹Ÿå¯ä»¥åŠ å…¥æµ‹è¯•ä»£ç ã€‚</p><p>å¦‚æœè¦å­¦ä¹ æ›´å¤šæœ‰å…³ Jest æµ‹è¯•çš„å†…å®¹ï¼Œå½“ç„¶æ˜¯ç›´æ¥å» <a href="https://jestjs.io/" target="_blank" rel="noopener">Jest å®˜ç½‘</a> çœ‹äº†ï¼Œç„¶ååœ¨å®é™…å¼€å‘è¿ç”¨ä¸­æ‰ä¼šé€æ¸ä½“ä¼šåˆ°å®ƒå¸¦æ¥çš„å¥½å¤„ã€‚</p><p><a href="https://github.com/Jacky-Summer/jest-tutorial" target="_blank" rel="noopener">æœ¬æ–‡ä»£ç åœ°å€</a></p><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>å‰ç«¯å·¥ç¨‹åŒ–</category>
      </categories>
      <tags>
        <tag>Jest</tag>
        <tag>å‰ç«¯æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹æ‰‹å†™æµ…æ‹·è´å’Œæ·±æ‹·è´</title>
    <url>/2020/11/03/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E6%89%8B%E5%86%99%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D/</url>
    <content><![CDATA[<p>æ·±æ‹·è´ä¸æµ…æ‹·è´æ˜¯ç»å¸¸è§åˆ°çš„ä¸€ä¸ªå‰ç«¯ JS çƒ­é—¨è¯é¢˜äº†ï¼Œä»Šå¤©å°±æ¥å†™ä¸‹æ‰‹å†™æµ…æ‹·è´å’Œæ·±æ‹·è´</p><a id="more"></a><h2 id="æµ…æ‹·è´"><a href="#æµ…æ‹·è´" class="headerlink" title="æµ…æ‹·è´"></a>æµ…æ‹·è´</h2><p>è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ¥æ¥å—ä½ è¦é‡æ–°å¤åˆ¶æˆ–å¼•ç”¨çš„å¯¹è±¡å€¼ã€‚å¦‚æœå¯¹è±¡å±æ€§æ˜¯åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¤åˆ¶çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ç»™æ–°å¯¹è±¡ï¼›ä½†å¦‚æœå±æ€§æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå¤åˆ¶çš„å°±æ˜¯å†…å­˜ä¸­çš„åœ°å€ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªå†…å­˜ä¸­çš„åœ°å€ï¼Œè‚¯å®šä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p><h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign"></a>Object.assign</h3><p>Object.assign å¾ªç¯éå†åŸå¯¹è±¡çš„å±æ€§ï¼Œé€šè¿‡å¤åˆ¶çš„æ–¹å¼å°†å…¶èµ‹å€¼ç»™ç›®æ ‡å¯¹è±¡çš„ç›¸åº”å±æ€§</p><ul><li>å®ƒä¸ä¼šæ‹·è´å¯¹è±¡çš„ç»§æ‰¿å±æ€§ï¼›</li><li>å®ƒä¸ä¼šæ‹·è´å¯¹è±¡çš„ä¸å¯æšä¸¾çš„å±æ€§ï¼›</li><li>å¯ä»¥æ‹·è´ Symbol ç±»å‹çš„å±æ€§ã€‚</li></ul><h3 id="æ‰©å±•è¿ç®—ç¬¦æ–¹å¼"><a href="#æ‰©å±•è¿ç®—ç¬¦æ–¹å¼" class="headerlink" title="æ‰©å±•è¿ç®—ç¬¦æ–¹å¼"></a>æ‰©å±•è¿ç®—ç¬¦æ–¹å¼</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cloneObj = &#123; ...obj &#125;</span><br></pre></td></tr></table></figure><h3 id="concat-æ‹·è´æ•°ç»„"><a href="#concat-æ‹·è´æ•°ç»„" class="headerlink" title="concat æ‹·è´æ•°ç»„"></a>concat æ‹·è´æ•°ç»„</h3><p>æ•°ç»„çš„ concat æ–¹æ³•å…¶å®ä¹Ÿæ˜¯æµ…æ‹·è´ï¼Œæ‰€ä»¥è¿æ¥ä¸€ä¸ªå«æœ‰å¼•ç”¨ç±»å‹çš„æ•°ç»„æ—¶ï¼Œéœ€è¦æ³¨æ„ä¿®æ”¹åŸæ•°ç»„ä¸­çš„å…ƒç´ çš„å±æ€§ï¼Œå› ä¸ºå®ƒä¼šå½±å“æ‹·è´ä¹‹åè¿æ¥çš„æ•°ç»„ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> newArr = arr.concat()</span><br><span class="line">newArr[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [ 1, 2, 3 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(newArr) <span class="comment">// [ 1, 100, 3 ]</span></span><br></pre></td></tr></table></figure><h3 id="slice-æ‹·è´æ•°ç»„"><a href="#slice-æ‹·è´æ•°ç»„" class="headerlink" title="slice æ‹·è´æ•°ç»„"></a>slice æ‹·è´æ•°ç»„</h3><p>slice æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡ç”±è¯¥æ–¹æ³•çš„å‰ä¸¤ä¸ªå‚æ•°æ¥å†³å®šåŸæ•°ç»„æˆªå–çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œæ˜¯ä¸ä¼šå½±å“å’Œæ”¹å˜åŸå§‹æ•°ç»„çš„ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, &#123; <span class="attr">val</span>: <span class="number">4</span> &#125;]</span><br><span class="line"><span class="keyword">let</span> newArr = arr.slice()</span><br><span class="line">newArr[<span class="number">2</span>].val = <span class="number">1000</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">//[ 1, 2, &#123; val: 1000 &#125; ]</span></span><br></pre></td></tr></table></figure><h3 id="æ‰‹å†™æµ…æ‹·è´"><a href="#æ‰‹å†™æµ…æ‹·è´" class="headerlink" title="æ‰‹å†™æµ…æ‹·è´"></a>æ‰‹å†™æµ…æ‹·è´</h3><ol><li>å¯¹åŸºç¡€ç±»å‹åšä¸€ä¸ªæœ€åŸºæœ¬çš„ä¸€ä¸ªæ‹·è´ï¼›</li><li>å¯¹å¼•ç”¨ç±»å‹å¼€è¾Ÿä¸€ä¸ªæ–°çš„å­˜å‚¨ï¼Œå¹¶ä¸”æ‹·è´ä¸€å±‚å¯¹è±¡å±æ€§ã€‚</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> shallowClone = <span class="function"><span class="params">target</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">'object'</span> &amp;&amp; target !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="built_in">Array</span>.isArray(target) ? [] : &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">      <span class="keyword">if</span> (target.hasOwnProperty(prop)) &#123;</span><br><span class="line">        cloneTarget[prop] = target[prop]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneTarget</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ·±æ‹·è´"><a href="#æ·±æ‹·è´" class="headerlink" title="æ·±æ‹·è´"></a>æ·±æ‹·è´</h2><p>å°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­å®Œæ•´åœ°æ‹·è´å‡ºæ¥ä¸€ä»½ç»™ç›®æ ‡å¯¹è±¡ï¼Œå¹¶ä»å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå…¨æ–°çš„ç©ºé—´å­˜æ”¾æ–°å¯¹è±¡ï¼Œä¸”æ–°å¯¹è±¡çš„ä¿®æ”¹å¹¶ä¸ä¼šæ”¹å˜åŸå¯¹è±¡ï¼ŒäºŒè€…å®ç°çœŸæ­£çš„åˆ†ç¦»ã€‚</p><h3 id="JSON-stringify"><a href="#JSON-stringify" class="headerlink" title="JSON.stringify"></a>JSON.stringify</h3><p>JSON.stringify() æ˜¯ç›®å‰å¼€å‘è¿‡ç¨‹ä¸­æœ€ç®€å•çš„æ·±æ‹·è´æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆä¸º JSON çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†å¯¹è±¡é‡Œé¢çš„å†…å®¹è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œæœ€åå†ç”¨ JSON.parse() çš„æ–¹æ³•å°† JSON å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><ol><li>æ‹·è´çš„å¯¹è±¡çš„å€¼ä¸­å¦‚æœæœ‰å‡½æ•°ã€undefinedã€symbol è¿™å‡ ç§ç±»å‹ï¼Œç»è¿‡ JSON.stringify åºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²ä¸­è¿™ä¸ªé”®å€¼å¯¹ä¼šæ¶ˆå¤±ï¼›</li><li>æ‹·è´ Date å¼•ç”¨ç±»å‹ä¼šå˜æˆå­—ç¬¦ä¸²ï¼›</li><li>æ— æ³•æ‹·è´ä¸å¯æšä¸¾çš„å±æ€§ï¼›</li><li>æ— æ³•æ‹·è´å¯¹è±¡çš„åŸå‹é“¾ï¼›</li><li>æ‹·è´ RegExp å¼•ç”¨ç±»å‹ä¼šå˜æˆç©ºå¯¹è±¡ï¼›</li><li>å¯¹è±¡ä¸­å«æœ‰ NaNã€Infinity ä»¥åŠ -Infinityï¼ŒJSON åºåˆ—åŒ–çš„ç»“æœä¼šå˜æˆ nullï¼›</li><li>æ— æ³•æ‹·è´å¯¹è±¡çš„å¾ªç¯åº”ç”¨ï¼Œå³å¯¹è±¡æˆç¯ (obj[key] = obj)ã€‚</li></ol><h3 id="æ‰‹å†™æ·±æ‹·è´"><a href="#æ‰‹å†™æ·±æ‹·è´" class="headerlink" title="æ‰‹å†™æ·±æ‹·è´"></a>æ‰‹å†™æ·±æ‹·è´</h3><ol><li><p>é’ˆå¯¹èƒ½å¤Ÿéå†å¯¹è±¡çš„ä¸å¯æšä¸¾å±æ€§ä»¥åŠ Symbol ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Reflect.ownKeys æ–¹æ³•ï¼› Reflect.ownKeys è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰è‡ªèº«å±æ€§ï¼ˆä¸åŒ…å«ç»§æ‰¿å±æ€§ï¼‰çš„æ•°ç»„ã€‚(ç±»ä¼¼äº Object.keys(), ä½†ä¸ä¼šå— enumerable å½±å“ï¼Œä¸”èƒ½åŒ…å« Symbol å±æ€§)</p></li><li><p>å½“å‚æ•°ä¸º Dateã€RegExp ç±»å‹ï¼Œåˆ™ç›´æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å®ä¾‹è¿”å›ï¼›</p></li><li><p>åˆ©ç”¨ Object çš„ getOwnPropertyDescriptors æ–¹æ³•å¯ä»¥è·å¾—å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä»¥åŠå¯¹åº”çš„ç‰¹æ€§ï¼Œé¡ºä¾¿ç»“åˆ Object çš„ create æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶ç»§æ‰¿ä¼ å…¥åŸå¯¹è±¡çš„åŸå‹é“¾ï¼›</p><blockquote><p>Object.create(object, [,propertiesObject])åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç»§æ‰¿ object çš„å±æ€§ï¼Œå¯æ·»åŠ  propertiesObject æ·»åŠ å±æ€§ï¼Œå¹¶å¯¹å±æ€§ä½œå‡ºè¯¦ç»†è§£é‡Š(æ­¤è¯¦ç»†è§£é‡Šç±»ä¼¼äº defineProperty ç¬¬äºŒä¸ªå‚æ•°çš„ç»“æ„)</p></blockquote></li><li><p>è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é¢å¤–å¼€è¾Ÿä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œæ¥å­˜å‚¨å½“å‰å¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„å¯¹åº”å…³ç³»ï¼Œå½“éœ€è¦æ‹·è´å½“å‰å¯¹è±¡æ—¶ï¼Œå…ˆå»å­˜å‚¨ç©ºé—´ä¸­æ‰¾ï¼Œæœ‰æ²¡æœ‰æ‹·è´è¿‡è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœæœ‰çš„è¯ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ç»§ç»­æ‹·è´ï¼Œè¿™æ ·å°±å·§å¦™åŒ–è§£çš„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚è¿™ä¸ªå­˜å‚¨ç©ºé—´ï¼Œéœ€è¦å¯ä»¥å­˜å‚¨ key-value å½¢å¼çš„æ•°æ®ï¼Œä¸” key å¯ä»¥æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹© Map è¿™ç§æ•°æ®ç»“æ„ï¼š</p></li></ol><ul><li>æ£€æŸ¥ map ä¸­æœ‰æ— å…‹éš†è¿‡çš„å¯¹è±¡</li><li>æœ‰ - ç›´æ¥è¿”å›</li><li>æ²¡æœ‰ - å°†å½“å‰å¯¹è±¡ä½œä¸º keyï¼Œå…‹éš†å¯¹è±¡ä½œä¸º value è¿›è¡Œå­˜å‚¨</li><li>ç»§ç»­å…‹éš†</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isComplexDataType = <span class="function"><span class="params">obj</span> =&gt;</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span> || <span class="keyword">typeof</span> obj === <span class="string">'function'</span>) &amp;&amp; obj !== <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deepClone = <span class="function"><span class="keyword">function</span> (<span class="params">target, hash = new Map(</span>)) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (target <span class="keyword">instanceof</span> <span class="built_in">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(target) <span class="comment">// æ—¥æœŸå¯¹è±¡ç›´æ¥è¿”å›ä¸€ä¸ªæ–°çš„æ—¥æœŸå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (target <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(target) <span class="comment">// æ­£åˆ™å¯¹è±¡ç›´æ¥è¿”å›ä¸€ä¸ªæ–°çš„æ­£åˆ™å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// å¾ªç¯å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">if</span> (hash.has(target)) <span class="keyword">return</span> hash.get(target)</span><br><span class="line">  <span class="comment">// éå†ä¼ å…¥å‚æ•°æ‰€æœ‰é”®çš„ç‰¹æ€§</span></span><br><span class="line">  <span class="keyword">let</span> allDesc = <span class="built_in">Object</span>.getOwnPropertyDescriptors(target)</span><br><span class="line">  <span class="comment">// ç»§æ‰¿åŸå‹é“¾</span></span><br><span class="line">  <span class="keyword">let</span> cloneTarget = <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.getPrototypeOf(target), allDesc)</span><br><span class="line"></span><br><span class="line">  hash.set(target, cloneTarget)</span><br><span class="line">  <span class="comment">// Reflect.ownKeysï¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰è‡ªèº«å±æ€§ï¼ˆä¸åŒ…å«ç»§æ‰¿å±æ€§ï¼‰çš„æ•°ç»„ï¼Œèƒ½åŒ…å«enumerable(false)ã€Symbolå±æ€§</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="built_in">Reflect</span>.ownKeys(target)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hash'</span>, hash)</span><br><span class="line">    cloneTarget[key] =</span><br><span class="line">      isComplexDataType(target[key]) &amp;&amp; <span class="keyword">typeof</span> target[key] !== <span class="string">'function'</span> ? deepClone(target[key], hash) : target[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneTarget</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ·±æ‹·è´</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™æ¨¡æ‹Ÿå®ç° React Hooks</title>
    <url>/2020/10/26/%E6%89%8B%E5%86%99%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0-React-Hooks/</url>
    <content><![CDATA[<p>ä¼šä½¿ç”¨ React Hookï¼Œè¿˜è¦å­¦ä¼šç®€å•æ‰‹å†™ React Hook</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é¦–å…ˆä½¿ç”¨<code>create-react-app</code>æ–°å»ºä¸ªé¡¹ç›®ï¼Œç„¶ååœ¨<code>index.js</code>å†™æˆ‘ä»¬çš„ä»£ç ï¼Œé˜…è¯»æœ¬æ–‡å‰éœ€è¦çŸ¥é“å¸¸ç”¨ React Hooks çš„åŸºæœ¬ç”¨æ³•ã€‚</p><h2 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> memorizedState</span><br><span class="line"><span class="keyword">const</span> useState = <span class="function"><span class="params">initialState</span> =&gt;</span> &#123;</span><br><span class="line">  memorizedState = memorizedState || initialState <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">const</span> setState = <span class="function"><span class="params">newState</span> =&gt;</span> &#123;</span><br><span class="line">    memorizedState = newState</span><br><span class="line">    render() <span class="comment">// setState ä¹‹åè§¦å‘é‡æ–°æ¸²æŸ“</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [memorizedState, setState]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count1, setCount1] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;useStateï¼š &#123;count1&#125;&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            setCount1(count1 + 1)</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          æ·»åŠ count1</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd76376f5288400697f3b2b6f29c2034~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>ä½†åˆ°è¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“å¢åŠ ç¬¬äºŒä¸ª useState çš„æ—¶å€™ä¼šå‘ç°æ”¹å˜ä¸¤ä¸ª state éƒ½æ˜¯æ”¹åŒä¸€ä¸ªå€¼ï¼ŒåŒæ­¥å˜åŒ–ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ•°ç»„çš„æ–¹å¼ä¸‹æ ‡æ¥æ–¹å¼æ¥åŒºåˆ†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> memorizedState = [] <span class="comment">// é€šè¿‡æ•°ç»„å½¢å¼å­˜å‚¨æœ‰å…³ä½¿ç”¨hookçš„å€¼</span></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span> <span class="comment">// é€šè¿‡ä¸‹æ ‡è®°å½• state çš„å€¼</span></span><br><span class="line"><span class="keyword">const</span> useState = <span class="function"><span class="params">initialState</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> currentIndex = index</span><br><span class="line">  memorizedState[currentIndex] = memorizedState[index] || initialState</span><br><span class="line">  <span class="keyword">const</span> setState = <span class="function"><span class="params">newState</span> =&gt;</span> &#123;</span><br><span class="line">    memorizedState[currentIndex] = newState</span><br><span class="line">    render() <span class="comment">// setState ä¹‹åè§¦å‘é‡æ–°æ¸²æŸ“</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [memorizedState[index++], setState]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count1, setCount1] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [count2, setCount2] = useState(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;</span><br><span class="line">          useStateï¼š &#123;count1&#125;--&#123;count2&#125;</span><br><span class="line">        &lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            setCount1(count1 + 1)</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          æ·»åŠ count1</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            setCount2(count2 + <span class="number">10</span>)</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          æ·»åŠ count2</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const render = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  index = 0</span></span><br><span class="line"><span class="regexp">  ReactDOM.render(&lt;App /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®ç°æ•ˆæœäº†ï¼š<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f9fd70c764d4b16874dc4f36cd0663a~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>åˆ†æï¼š</p><ul><li>ç¬¬ä¸€æ¬¡é¡µé¢æ¸²æŸ“çš„æ—¶å€™ï¼Œæ ¹æ® <code>useState</code> é¡ºåºï¼Œå£°æ˜äº† count1 å’Œ count2 ä¸¤ä¸ª stateï¼Œå¹¶æŒ‰ä¸‹æ ‡é¡ºåºä¾æ¬¡å­˜å…¥æ•°ç»„ä¸­</li><li>å½“è°ƒç”¨<code>setState</code>çš„æ—¶å€™ï¼Œæ›´æ–° count1/count2 çš„å€¼ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“çš„æ—¶å€™ï¼Œindex è¢«é‡ç½®ä¸º 0ã€‚ç„¶ååˆé‡æ–°æŒ‰ <code>useState</code> çš„å£°æ˜é¡ºåºï¼Œä¾æ¬¡æ‹¿å‡ºæœ€æ–° state çš„å€¼ï¼›ç”±æ­¤ä¹Ÿå¯è§ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬ä½¿ç”¨ hook æ—¶ï¼Œè¦æ³¨æ„ç‚¹ hook ä¸èƒ½åœ¨å¾ªç¯ã€åˆ¤æ–­è¯­å¥å†…éƒ¨ä½¿ç”¨ï¼Œè¦å£°æ˜åœ¨ç»„ä»¶é¡¶éƒ¨ã€‚</li></ul><p><code>memorizedState</code>è¿™ä¸ªæ•°ç»„æˆ‘ä»¬ä¸‹é¢å®ç°éƒ¨åˆ† hook éƒ½ä¼šç”¨åˆ°ï¼Œç°åœ¨<code>memorizedState</code>æ•°ç»„é•¿åº¦ä¸º 2ï¼Œä¾æ¬¡å­˜æ”¾ç€ä¸¤ä¸ªä½¿ç”¨<code>useState</code>åè¿”å›çš„ state å€¼ï¼›</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0: 0</span><br><span class="line">1: 10</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡æ›´æ”¹æ•°æ®åï¼Œè°ƒç”¨<code>render</code>æ–¹æ³•ï¼Œ<code>App</code>å‡½æ•°ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œåˆé‡æ–°è°ƒç”¨<code>useState</code>ï¼Œä½†å¤–éƒ¨å˜é‡<code>memorizedState</code>ä¹‹å‰å·²ç»ä¾æ¬¡ä¸‹æ ‡è®°å½•ä¸‹äº† state çš„å€¼ï¼Œæ•…é‡æ–°æ¸²æŸ“æ˜¯ç›´æ¥èµ‹å€¼ä¹‹å‰çš„ state å€¼åšåˆå§‹å€¼ã€‚çŸ¥é“è¿™ä¸ªåšæ³•ï¼Œä¸‹é¢çš„<code>useEffect</code>,<code>useCallback</code>,<code>useMemo</code>ä¹Ÿæ˜¯è¿™ä¸ªåŸç†ã€‚</p><p>å½“ç„¶å®é™…æºç ï¼Œ<code>useState</code>æ˜¯ç”¨é“¾è¡¨è®°å½•é¡ºåºçš„ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯æ¨¡æ‹Ÿæ•ˆæœã€‚</p><h2 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h2><p>useReducer æ¥å— Reducer å‡½æ•°å’ŒçŠ¶æ€çš„åˆå§‹å€¼ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯çŠ¶æ€çš„å½“å‰å€¼ï¼Œç¬¬äºŒä¸ªæˆå‘˜æ˜¯å‘é€ action çš„ dispatch å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> reducerState</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useReducer = <span class="function">(<span class="params">reducer, initialArg, init</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> initialState</span><br><span class="line">  <span class="keyword">if</span> (init !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    initialState = init(initialArg) <span class="comment">// åˆå§‹åŒ–å‡½æ•°èµ‹å€¼</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    initialState = initialArg</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    reducerState = reducer(reducerState, action)</span><br><span class="line">    render()</span><br><span class="line">  &#125;</span><br><span class="line">  reducerState = reducerState || initialState</span><br><span class="line">  <span class="keyword">return</span> [reducerState, dispatch]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> init = <span class="function"><span class="params">initialNum</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">num</span>: initialNum &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'increment'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">num</span>: state.num + <span class="number">1</span> &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'decrement'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">num</span>: state.num - <span class="number">1</span> &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, <span class="number">20</span>, init)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;useReducerï¼š&#123;state.num&#125;&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; dispatch(&#123; type: 'decrement' &#125;)&#125;&gt;-&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; dispatch(&#123; <span class="attr">type</span>: <span class="string">'increment'</span> &#125;)&#125;&gt;+&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h2><p>å¯¹äº useEffect é’©å­ï¼Œå½“æ²¡æœ‰ä¾èµ–å€¼çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°é›å½¢ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> useEffect = <span class="function">(<span class="params">callback, dependencies</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!dependencies) &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰æ·»åŠ ä¾èµ–é¡¹åˆ™æ¯æ¬¡æ‰§è¡Œï¼Œæ·»åŠ ä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„</span></span><br><span class="line">    callback()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœæœ‰ä¾èµ– state å€¼ï¼Œå³æ˜¯æˆ‘ä»¬ä½¿ç”¨ useState åè¿”å›çš„å€¼ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬å°±éœ€è¦ç”¨ä¸Šæ–¹å®šä¹‰çš„æ•°ç»„ memorizedState æ¥è®°å½•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> memorizedState = [] <span class="comment">// å­˜æ”¾ hook</span></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span> <span class="comment">// hook æ•°ç»„ä¸‹æ ‡ä½ç½®</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * useState å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> useState = <span class="function"><span class="params">initialState</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> currentIndex = index</span><br><span class="line">  memorizedState[currentIndex] = memorizedState[index] || initialState</span><br><span class="line">  <span class="keyword">const</span> setState = <span class="function"><span class="params">newState</span> =&gt;</span> &#123;</span><br><span class="line">    memorizedState[currentIndex] = newState</span><br><span class="line">    render() <span class="comment">// setState ä¹‹åè§¦å‘é‡æ–°æ¸²æŸ“</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [memorizedState[index++], setState]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * useEffect å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> useEffect = <span class="function">(<span class="params">callback, dependencies</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (memorizedState[index]) &#123;</span><br><span class="line">    <span class="comment">// ä¸æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">let</span> lastDependencies = memorizedState[index] <span class="comment">// ä¾èµ–é¡¹æ•°ç»„</span></span><br><span class="line">    <span class="keyword">let</span> hasChanged = !dependencies.every(<span class="function">(<span class="params">item, index</span>) =&gt;</span> item === lastDependencies[index]) <span class="comment">// å¾ªç¯éå†ä¾èµ–é¡¹æ˜¯å¦ä¸ä¸Šæ¬¡çš„å€¼ç›¸åŒ</span></span><br><span class="line">    <span class="keyword">if</span> (hasChanged) &#123;</span><br><span class="line">      <span class="comment">// ä¾èµ–é¡¹æœ‰æ”¹å˜å°±æ‰§è¡Œ callback å‡½æ•°</span></span><br><span class="line">      memorizedState[index++] = dependencies</span><br><span class="line">      setTimeout(callback) <span class="comment">// è®¾ç½®å®ä»»åŠ¡ï¼Œåœ¨ç»„ä»¶renderä¹‹åå†æ‰§è¡Œ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      index++ <span class="comment">// æ¯ä¸ªhookå æ®ä¸€ä¸ªä¸‹æ ‡ä½ç½®ï¼Œé˜²æ­¢é¡ºåºé”™ä¹±</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">    memorizedState[index++] = dependencies</span><br><span class="line">    setTimeout(callback)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count1, setCount1] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [count2, setCount2] = useState(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'useEffect1'</span>)</span><br><span class="line">  &#125;, [count1, count2])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'useEffect2'</span>)</span><br><span class="line">  &#125;, [count1])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;</span><br><span class="line">          useStateï¼š &#123;count1&#125;--&#123;count2&#125;</span><br><span class="line">        &lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            setCount1(count1 + 1)</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          æ·»åŠ count1</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            setCount2(count2 + <span class="number">10</span>)</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          æ·»åŠ count2</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const render = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  index = 0</span></span><br><span class="line"><span class="regexp">  ReactDOM.render(&lt;App /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br></pre></td></tr></table></figure><p>ç¨‹åºç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œæ¯•åï¼ŒmemorizedState æ•°ç»„å€¼å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0: 0</span><br><span class="line">1: 10</span><br><span class="line">2: [0, 10]</span><br><span class="line">3: [0]</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å›è°ƒå‡½æ•°æ‰§è¡Œï¼Œæœ¬æ¥æˆ‘ä»¬å¯ä»¥ç”¨<code>callback()</code>æ‰§è¡Œå³å¯ï¼Œä½†å› ä¸º<code>useEffect</code>åœ¨æ¸²æŸ“æ—¶æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œå¹¶ä¸”è¦ç­‰åˆ°æµè§ˆå™¨å°†æ‰€æœ‰å˜åŒ–æ¸²æŸ“åˆ°å±å¹•åæ‰ä¼šè¢«æ‰§è¡Œï¼›</p><p>å› ä¸ºæ˜¯å¼‚æ­¥ä¸”ç­‰é¡µé¢æ¸²æŸ“å®Œæ¯•æ‰æ‰§è¡Œï¼Œæ ¹æ®å¯¹ JS äº‹ä»¶å¾ªç¯çš„ç†è§£ï¼Œæˆ‘ä»¬æƒ³è¦å®ƒå¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œå°±åœ¨æ­¤åˆ›å»ºä¸€ä¸ªå®ä»»åŠ¡<code>setTimeout(callback)</code>è®©å®ƒè¿›å…¥å®ä»»åŠ¡é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œï¼Œå½“ç„¶è¿™å…¶ä¸­å…·ä½“çš„æ¸²æŸ“è¿‡ç¨‹æˆ‘è¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ª hook æ˜¯<code>useLayoutEffect</code>ï¼Œé™¤äº†æ‰§è¡Œå›è°ƒçš„ä¸¤å¤„åœ°æ–¹ä»£ç å®ç°ä¸åŒï¼Œå…¶ä»–ä»£ç ç›¸åŒï¼Œ<code>callback</code>è¿™é‡Œæˆ‘ç”¨å¾®ä»»åŠ¡<code>Promise.resolve().then(callback)</code>ï¼ŒæŠŠå‡½æ•°æ‰§è¡ŒåŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</p><p>å› ä¸º<code>useLayoutEffect</code>åœ¨æ¸²æŸ“æ—¶æ˜¯åŒæ­¥æ‰§è¡Œï¼Œä¼šåœ¨æ‰€æœ‰çš„ DOM å˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨ï¼Œä¸€èˆ¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å– DOM å¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼Œ<code>useLayoutEffect</code> å°†è¢«åŒæ­¥åˆ·æ–°ã€‚</p><p>æ€ä¹ˆè¯æ˜å‘¢ï¼Ÿå¦‚æœä½ åœ¨<code>useLayoutEffect</code>åŠ äº†æ­»å¾ªç¯ï¼Œç„¶åé‡æ–°æ‰“å¼€ç½‘é¡µï¼Œä½ ä¼šå‘ç°çœ‹ä¸åˆ°é¡µé¢æ¸²æŸ“çš„å†…å®¹å°±è¿›å…¥æ­»å¾ªç¯äº†ï¼›è€Œå¦‚æœæ˜¯<code>useEffect</code>çš„è¯ï¼Œä¼šçœ‹åˆ°é¡µé¢æ¸²æŸ“å®Œæˆåæ‰è¿›å…¥æ­»å¾ªç¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">useLayoutEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;&#125;</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure><h2 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h2><p><code>useCallback</code>å’Œ<code>useMemo</code>ä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ‰§è¡Œï¼Œä¹‹åä¼šåœ¨å…¶ä¾èµ–çš„å˜é‡å‘ç”Ÿæ”¹å˜æ—¶å†æ¬¡æ‰§è¡Œï¼›å¹¶ä¸”è¿™ä¸¤ä¸ª hooks éƒ½è¿”å›ç¼“å­˜çš„å€¼ï¼ŒuseMemo è¿”å›ç¼“å­˜è®¡ç®—æ•°æ®çš„å€¼ï¼Œ<code>useCallback</code>è¿”å›ç¼“å­˜å‡½æ•°çš„å¼•ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> useCallback = <span class="function">(<span class="params">callback, dependencies</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (memorizedState[index]) &#123;</span><br><span class="line">    <span class="comment">// ä¸æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">let</span> [lastCallback, lastDependencies] = memorizedState[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> hasChanged = !dependencies.every(<span class="function">(<span class="params">item, index</span>) =&gt;</span> item === lastDependencies[index]) <span class="comment">// åˆ¤æ–­ä¾èµ–å€¼æ˜¯å¦å‘ç”Ÿæ”¹å˜</span></span><br><span class="line">    <span class="keyword">if</span> (hasChanged) &#123;</span><br><span class="line">      memorizedState[index++] = [callback, dependencies]</span><br><span class="line">      <span class="keyword">return</span> callback</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      index++</span><br><span class="line">      <span class="keyword">return</span> lastCallback <span class="comment">// ä¾èµ–å€¼ä¸å˜ï¼Œè¿”å›ä¸Šæ¬¡ç¼“å­˜çš„å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">    memorizedState[index++] = [callback, dependencies]</span><br><span class="line">    <span class="keyword">return</span> callback</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h2><p>è€Œ<code>useMemo</code>å®ç°ä¸<code>useCallback</code>ä¹Ÿå¾ˆç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒè¿”å›çš„å‡½æ•°æ‰§è¡Œåçš„è®¡ç®—è¿”å›å€¼ï¼Œç›´æ¥æŠŠå‡½æ•°æ‰§è¡Œäº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> useMemo = <span class="function">(<span class="params">memoFn, dependencies</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (memorizedState[index]) &#123;</span><br><span class="line">    <span class="comment">// ä¸æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">let</span> [lastMemo, lastDependencies] = memorizedState[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> hasChanged = !dependencies.every(<span class="function">(<span class="params">item, index</span>) =&gt;</span> item === lastDependencies[index])</span><br><span class="line">    <span class="keyword">if</span> (hasChanged) &#123;</span><br><span class="line">      memorizedState[index++] = [memoFn(), dependencies]</span><br><span class="line">      <span class="keyword">return</span> memoFn()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      index++</span><br><span class="line">      <span class="keyword">return</span> lastMemo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">    memorizedState[index++] = [memoFn(), dependencies]</span><br><span class="line">    <span class="keyword">return</span> memoFn()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h2><p>ä»£ç å‡ºä¹æ„æ–™çš„å°‘å§â€¦</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const useContext &#x3D; context &#x3D;&gt; &#123;</span><br><span class="line">  return context._currentValue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h2><p><code>useRef</code> è¿”å›ä¸€ä¸ªå¯å˜çš„ <code>ref</code> å¯¹è±¡ï¼Œå…¶ <code>.current</code> å±æ€§è¢«åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°ï¼ˆinitialValueï¼‰ã€‚è¿”å›çš„ <code>ref</code> å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> lastRef</span><br><span class="line"><span class="keyword">const</span> useRef = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  lastRef = lastRef || &#123; <span class="attr">current</span>: value &#125;</span><br><span class="line">  <span class="keyword">return</span> lastRef</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åé¢å‡ ä¸ªä¾‹å­æˆ‘å°±æ²¡å±•ç¤ºå‡º Demo äº†ï¼Œé™„ä¸Š Github åœ°å€ï¼š<a href="https://github.com/Jacky-Summer/mini-react-hooks" target="_blank" rel="noopener">ä¸Šè¿° hooks å®ç°å’Œæ¡ˆä¾‹</a><br><br></p><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeScript å…¥é—¨çŸ¥è¯†ç‚¹æ€»ç»“</title>
    <url>/2020/10/21/TypeScript-%E5%85%A5%E9%97%A8%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>TypeScript å·²ç»é€æ¸æˆä¸ºå‰ç«¯å¿…å¤‡æŠ€èƒ½äº†ï¼Œéšç€ TS 4.0 å’Œ Vue 3 çš„å‘å¸ƒï¼ŒTS å‡†å¤‡è¿æ¥å¤§æµè¡Œçš„è¶‹åŠ¿äº†ï¼Œè¿™ç¯‡æ–‡ç« ï¼Œè®©ä½ å¯¹ TS æœ‰åŸºæœ¬çš„è®¤è¯†å’Œå…¥é—¨ã€‚</p><a id="more"></a><h2 id="TypeScript-ä»‹ç»"><a href="#TypeScript-ä»‹ç»" class="headerlink" title="TypeScript ä»‹ç»"></a>TypeScript ä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯-TypeScript"><a href="#ä»€ä¹ˆæ˜¯-TypeScript" class="headerlink" title="ä»€ä¹ˆæ˜¯ TypeScript"></a>ä»€ä¹ˆæ˜¯ TypeScript</h3><p>æ˜¯ JavaScript çš„ä¸€ä¸ªè¶…é›†ï¼Œå®ƒå¯ä»¥ç¼–è¯‘æˆçº¯ JavaScriptã€‚ç¼–è¯‘å‡ºæ¥çš„ JavaScript å¯ä»¥è¿è¡Œåœ¨ä»»ä½•æµè§ˆå™¨ä¸Šï¼Œä¸»è¦æä¾›äº†<strong>ç±»å‹ç³»ç»Ÿ</strong>å’Œ<strong>å¯¹ ES6 çš„æ”¯æŒ</strong>ã€‚</p><h3 id="ä¸ºä»€ä¹ˆé€‰æ‹©-TypeScript"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-TypeScript" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹© TypeScript"></a>ä¸ºä»€ä¹ˆé€‰æ‹© TypeScript</h3><ul><li>å¢åŠ äº†ä»£ç çš„å¯ç»´æŠ¤æ€§</li><li>åŒ…å®¹æ€§å¼ºï¼Œæ”¯æŒ ES6 è¯­æ³•ï¼Œ<code>.js</code>æ–‡ä»¶ç›´æ¥é‡å‘½åä¸º<code>.ts</code>å³å¯</li><li>å…¼å®¹ç¬¬ä¸‰æ–¹åº“ï¼Œå³ä½¿ç¬¬ä¸‰æ–¹åº“ä¸æ˜¯ TypeScript å†™çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å•ç‹¬ç¼–å†™ç±»å‹æ–‡ä»¶ä¾›è¯†åˆ«è¯»å–</li><li>ç¤¾åŒºæ´»è·ƒï¼Œç›®å‰ä¸‰å¤§æ¡†æ¶è¿˜æœ‰è¶Šæ¥è¶Šå¤šçš„åº“éƒ½æ”¯æŒ TypeScript äº†</li></ul><p>TypeScript åªä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™å¯¹ç±»å‹è¿›è¡Œé™æ€æ£€æŸ¥ï¼Œå¦‚æœå‘ç°æœ‰é”™è¯¯ï¼Œç¼–è¯‘çš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚</p><h3 id="å®‰è£…-TypeScript"><a href="#å®‰è£…-TypeScript" class="headerlink" title="å®‰è£… TypeScript"></a>å®‰è£… TypeScript</h3><ol><li>å…¨å±€å®‰è£… TS</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i -g typescript</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹ TypeScript ç‰ˆæœ¬å·</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tsc -v</span><br></pre></td></tr></table></figure><p>æˆ‘å½“å‰ç‰ˆæœ¬ä¸º Version 4.0.2</p><ol start="3"><li>åˆå§‹åŒ–ç”Ÿæˆ tsconfig.json æ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tsc --init</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨ tsconfig.json ä¸­è®¾ç½®æºä»£ç ç›®å½•å’Œç¼–è¯‘ç”Ÿæˆ js æ–‡ä»¶çš„ç›®å½•</li></ol><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"outDir": "./dist",</span><br><span class="line">"rootDir": "./src"</span><br></pre></td></tr></table></figure><ol start="5"><li>ç›‘å¬ ts æ–‡ä»¶çš„å˜åŒ–ï¼Œæ¯å½“æ–‡ä»¶å‘ç”Ÿæ”¹å˜å°±è‡ªåŠ¨ç¼–è¯‘</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tsc -w</span><br></pre></td></tr></table></figure><p>ä¹‹åä½ å†™çš„ ts æ–‡ä»¶ç¼–è¯‘é”™è¯¯éƒ½ä¼šç›´æ¥æç¤ºï¼Œå¦‚æœæƒ³è¿è¡Œæ–‡ä»¶ï¼Œå°±åˆ° <code>/dist</code>ç›®å½•ä¸‹æ‰¾ç›¸åº”çš„ js æ–‡ä»¶ï¼Œä½¿ç”¨ node è¿è¡Œå³å¯</p><h2 id="ts-node-å®‰è£…"><a href="#ts-node-å®‰è£…" class="headerlink" title="ts-node å®‰è£…"></a>ts-node å®‰è£…</h2><p>å½“ç„¶è¿™æ ·å…¶å®ä¹ŸæŒºéº»çƒ¦ï¼Œæˆ‘ä»¬æƒ³ç›´æ¥è¿è¡Œ TS æ–‡ä»¶, è¿™æ—¶å¯ä»¥å€ŸåŠ©<code>ts-node</code>æ’ä»¶</p><p>å…¨å±€å®‰è£…</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g ts-node</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°æ–‡ä»¶è·¯å¾„ï¼Œè¿è¡Œå³å¯</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ts-node demo.ts</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç±»å‹"><a href="#åŸºç¡€ç±»å‹" class="headerlink" title="åŸºç¡€ç±»å‹"></a>åŸºç¡€ç±»å‹</h2><h3 id="Number-ç±»å‹"><a href="#Number-ç±»å‹" class="headerlink" title="Number ç±»å‹"></a>Number ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="Boolean-ç±»å‹"><a href="#Boolean-ç±»å‹" class="headerlink" title="Boolean ç±»å‹"></a>Boolean ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isShow: <span class="built_in">boolean</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="String-ç±»å‹"><a href="#String-ç±»å‹" class="headerlink" title="String ç±»å‹"></a>String ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str: <span class="built_in">string</span> = <span class="string">'hello'</span></span><br></pre></td></tr></table></figure><h3 id="Array-ç±»å‹"><a href="#Array-ç±»å‹" class="headerlink" title="Array ç±»å‹"></a>Array ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> arr2: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure><h3 id="Any-ç±»å‹"><a href="#Any-ç±»å‹" class="headerlink" title="Any ç±»å‹"></a>Any ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo: <span class="built_in">any</span> = <span class="string">'hello'</span></span><br><span class="line">foo = <span class="number">12</span></span><br><span class="line">foo = <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="Null-å’Œ-Undefined-ç±»å‹"><a href="#Null-å’Œ-Undefined-ç±»å‹" class="headerlink" title="Null å’Œ Undefined ç±»å‹"></a>Null å’Œ Undefined ç±»å‹</h3><p>null å’Œ undefined å¯ä»¥èµ‹å€¼ç»™ä»»æ„ç±»å‹çš„å˜é‡</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> test1: <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> test2: <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> test3: <span class="built_in">number</span></span><br><span class="line"><span class="keyword">let</span> test4: <span class="built_in">string</span></span><br><span class="line">test3 = <span class="literal">null</span></span><br><span class="line">test4 = <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><h3 id="Void-ç±»å‹"><a href="#Void-ç±»å‹" class="headerlink" title="Void ç±»å‹"></a>Void ç±»å‹</h3><p>void ç±»å‹åƒæ˜¯ä¸ any ç±»å‹ç›¸åï¼Œå®ƒè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹ã€‚å½“ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œå…¶è¿”å›å€¼ç±»å‹æ˜¯ void</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> test5: <span class="built_in">void</span> = <span class="literal">undefined</span> <span class="comment">// å£°æ˜ä¸€ä¸ª void ç±»å‹çš„å˜é‡æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå› ä¸ºå®ƒçš„å€¼åªèƒ½ä¸º undefined æˆ– null</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFunc</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;&#125; <span class="comment">// å‡½æ•°æ²¡æœ‰è¿”å›å€¼</span></span><br></pre></td></tr></table></figure><h3 id="Never-ç±»å‹"><a href="#Never-ç±»å‹" class="headerlink" title="Never ç±»å‹"></a>Never ç±»å‹</h3><p>never ç±»å‹è¡¨ç¤ºçš„æ˜¯é‚£äº›æ°¸ä¸å­˜åœ¨çš„å€¼çš„ç±»å‹ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'never reach'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Unknown-ç±»å‹"><a href="#Unknown-ç±»å‹" class="headerlink" title="Unknown ç±»å‹"></a>Unknown ç±»å‹</h3><p>æ‰€æœ‰ç±»å‹éƒ½å¯ä»¥èµ‹å€¼ç»™ anyï¼Œæ‰€æœ‰ç±»å‹ä¹Ÿéƒ½å¯ä»¥èµ‹å€¼ç»™ unknownã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> value: unknown</span><br><span class="line">value = <span class="number">123</span></span><br><span class="line">value = <span class="string">'Hello'</span></span><br><span class="line">value = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> value1: unknown = value</span><br><span class="line"><span class="keyword">let</span> value2: <span class="built_in">any</span> = value</span><br><span class="line"><span class="keyword">let</span> value3: <span class="built_in">boolean</span> = value <span class="comment">// Error</span></span><br><span class="line"><span class="keyword">let</span> value4: <span class="built_in">number</span> = value <span class="comment">// Error</span></span><br><span class="line"><span class="keyword">let</span> value5: <span class="built_in">string</span> = value <span class="comment">// Error</span></span><br><span class="line"><span class="keyword">let</span> value6: object = value <span class="comment">// Error</span></span><br><span class="line"><span class="keyword">let</span> value7: <span class="built_in">any</span>[] = value <span class="comment">// Error</span></span><br><span class="line"><span class="keyword">let</span> value8: <span class="built_in">Function</span> = value <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>unknown ç±»å‹åªèƒ½è¢«èµ‹å€¼ç»™ any ç±»å‹å’Œ unknown ç±»å‹æœ¬èº«ã€‚</p><h3 id="Tuple-ç±»å‹"><a href="#Tuple-ç±»å‹" class="headerlink" title="Tuple ç±»å‹"></a>Tuple ç±»å‹</h3><p>æ•°ç»„åˆå¹¶äº†ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œè€Œå…ƒç»„ï¼ˆTupleï¼‰åˆå¹¶äº†ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚å…ƒç»„è¡¨ç¤ºä¸€ä¸ªæ•°é‡å’Œç±»å‹éƒ½å·²çŸ¥çš„æ•°ç»„</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> tupleArr1: [<span class="built_in">string</span>, <span class="built_in">number</span>] = [<span class="string">'hello'</span>, <span class="number">10</span>]</span><br><span class="line"><span class="comment">// let tupleArr2: [string, number] = [10, 'hello'] // Error</span></span><br></pre></td></tr></table></figure><h3 id="Enum-ç±»å‹"><a href="#Enum-ç±»å‹" class="headerlink" title="Enum ç±»å‹"></a>Enum ç±»å‹</h3><p>ä½¿ç”¨æšä¸¾å¯ä»¥å®šä¹‰ä¸€äº›å¸¦åå­—çš„å¸¸é‡ã€‚ TypeScript æ”¯æŒæ•°å­—çš„å’ŒåŸºäºå­—ç¬¦ä¸²çš„æšä¸¾ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">enum</span> Season &#123;</span><br><span class="line">    Spring,</span><br><span class="line">    Summer,</span><br><span class="line">    Autumn,</span><br><span class="line">    Winter,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> a: Season = Season.Spring</span><br><span class="line">  <span class="keyword">let</span> b: Season = Season.Summer</span><br><span class="line">  <span class="keyword">let</span> c: Season = Season.Autumn</span><br><span class="line">  <span class="keyword">let</span> d: Season = Season.Winter</span><br><span class="line">  <span class="built_in">console</span>.log(a, b, c, d) <span class="comment">// 0 1 2 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°ç±»å‹"><a href="#å‡½æ•°ç±»å‹" class="headerlink" title="å‡½æ•°ç±»å‹"></a>å‡½æ•°ç±»å‹</h2><h3 id="å‡½æ•°å£°æ˜"><a href="#å‡½æ•°å£°æ˜" class="headerlink" title="å‡½æ•°å£°æ˜"></a>å‡½æ•°å£°æ˜</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// JS</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TS</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°è¡¨è¾¾å¼"><a href="#å‡½æ•°è¡¨è¾¾å¼" class="headerlink" title="å‡½æ•°è¡¨è¾¾å¼"></a>å‡½æ•°è¡¨è¾¾å¼</h3><p>åœ¨ TypeScript çš„ç±»å‹å®šä¹‰ä¸­ï¼Œ<code>=&gt;</code> ç”¨æ¥è¡¨ç¤ºå‡½æ•°çš„å®šä¹‰ï¼Œå·¦è¾¹æ˜¯è¾“å…¥ç±»å‹ï¼Œéœ€è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œå³è¾¹æ˜¯è¾“å‡ºç±»å‹ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// JS</span></span><br><span class="line"><span class="keyword">let</span> func3 = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TS ç¬¬ä¸€ç§æ–¹å¼</span></span><br><span class="line"><span class="keyword">let</span> func4 = <span class="function"><span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TS ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line"><span class="comment">// =&gt; ç”¨æ¥è¡¨ç¤ºå‡½æ•°çš„å®šä¹‰ï¼Œå·¦è¾¹æ˜¯è¾“å…¥ç±»å‹ï¼Œéœ€è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œå³è¾¹æ˜¯è¾“å‡ºç±»å‹ã€‚</span></span><br><span class="line"><span class="keyword">let</span> func5: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = <span class="function"><span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¥å£å®šä¹‰å‡½æ•°çš„å½¢çŠ¶"><a href="#æ¥å£å®šä¹‰å‡½æ•°çš„å½¢çŠ¶" class="headerlink" title="æ¥å£å®šä¹‰å‡½æ•°çš„å½¢çŠ¶"></a>æ¥å£å®šä¹‰å‡½æ•°çš„å½¢çŠ¶</h3><p>é‡‡ç”¨å‡½æ•°è¡¨è¾¾å¼|æ¥å£å®šä¹‰å‡½æ•°çš„æ–¹å¼æ—¶ï¼Œå¯¹ç­‰å·å·¦ä¾§è¿›è¡Œç±»å‹é™åˆ¶ï¼Œå¯ä»¥ä¿è¯ä»¥åå¯¹å‡½æ•°åèµ‹å€¼æ—¶ä¿è¯å‚æ•°ä¸ªæ•°ã€å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹ä¸å˜ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> SearchFunc &#123;</span><br><span class="line">  (source: <span class="built_in">string</span>, subString: <span class="built_in">string</span>): <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">source: <span class="built_in">string</span>, subString: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> source.search(subString) !== <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯é€‰å‚æ•°"><a href="#å¯é€‰å‚æ•°" class="headerlink" title="å¯é€‰å‚æ•°"></a>å¯é€‰å‚æ•°</h3><p>å¯¹äº TS çš„å‡½æ•°ï¼Œè¾“å…¥å¤šä½™çš„ï¼ˆæˆ–è€…å°‘äºè¦æ±‚çš„ï¼‰å‚æ•°ï¼Œæ˜¯ä¸å…è®¸çš„ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆè®¾ç½®å¯é€‰å‚æ•°å‘¢ï¼Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å£°æ˜ä¹‹ååŠ ä¸€ä¸ªé—®å·</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName1</span>(<span class="params">firstName: <span class="built_in">string</span>, lastName?: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¯é€‰å‚æ•°å¿…é¡»æ¥åœ¨å¿…éœ€å‚æ•°åé¢</span></span><br><span class="line">  <span class="keyword">if</span> (lastName) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> firstName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> name1 = getName1(<span class="string">'jacky'</span>)</span><br><span class="line"><span class="keyword">let</span> name2 = getName1(<span class="string">'jacky'</span>, <span class="string">'lin'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(name1, name2)</span><br></pre></td></tr></table></figure><h3 id="å‚æ•°é»˜è®¤å€¼"><a href="#å‚æ•°é»˜è®¤å€¼" class="headerlink" title="å‚æ•°é»˜è®¤å€¼"></a>å‚æ•°é»˜è®¤å€¼</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName2</span>(<span class="params">firstName: <span class="built_in">string</span> = 'monkey', lastName: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getName2(<span class="string">'jacky'</span>, <span class="string">'Lin'</span>))</span><br><span class="line"><span class="built_in">console</span>.log(getName2(<span class="literal">undefined</span>, <span class="string">'Lin'</span>)) <span class="comment">// monkey Lin</span></span><br></pre></td></tr></table></figure><h3 id="void-å’Œ-never-ç±»å‹"><a href="#void-å’Œ-never-ç±»å‹" class="headerlink" title="void å’Œ never ç±»å‹"></a>void å’Œ never ç±»å‹</h3><p>å½“å‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œå¯ä»¥ç”¨ void æ¥è¡¨ç¤ºã€‚</p><p>å½“ä¸€ä¸ªå‡½æ•°æ°¸è¿œä¸ä¼šè¿”å›æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜è¿”å›å€¼ç±»å‹ä¸º never</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func6</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="comment">// return null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func7</span>(<span class="params"></span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'never reach'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰©ä½™å‚æ•°"><a href="#å‰©ä½™å‚æ•°" class="headerlink" title="å‰©ä½™å‚æ•°"></a>å‰©ä½™å‚æ•°</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push1</span>(<span class="params">arr, ...items</span>) </span>&#123;</span><br><span class="line">  items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    arr.push(item)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a: <span class="built_in">any</span>[] = []</span><br><span class="line">push1(a, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push2</span>(<span class="params">arr: <span class="built_in">any</span>[], ...items: <span class="built_in">any</span>[]</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    arr.push(item)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> b: <span class="built_in">any</span>[] = []</span><br><span class="line">push1(b, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">'5'</span>)</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å‚æ•°ä¸ºå¯¹è±¡ï¼ˆè§£æ„ï¼‰æ—¶"><a href="#å‡½æ•°å‚æ•°ä¸ºå¯¹è±¡ï¼ˆè§£æ„ï¼‰æ—¶" class="headerlink" title="å‡½æ•°å‚æ•°ä¸ºå¯¹è±¡ï¼ˆè§£æ„ï¼‰æ—¶"></a>å‡½æ•°å‚æ•°ä¸ºå¯¹è±¡ï¼ˆè§£æ„ï¼‰æ—¶</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// jså†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">&#123; one, two &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> one + two</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> total = add(&#123; one: <span class="number">1</span>, two: <span class="number">2</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ts å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add1</span>(<span class="params">&#123; one, two &#125;: &#123; one: <span class="built_in">number</span>; two: <span class="built_in">number</span> &#125;</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> one + two</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> three = add1(&#123; one: <span class="number">1</span>, two: <span class="number">2</span> &#125;)</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°é‡è½½"><a href="#å‡½æ•°é‡è½½" class="headerlink" title="å‡½æ•°é‡è½½"></a>å‡½æ•°é‡è½½</h3><p>é‡è½½å…è®¸ä¸€ä¸ªå‡½æ•°æ¥å—ä¸åŒæ•°é‡æˆ–ç±»å‹çš„å‚æ•°æ—¶ï¼Œä½œå‡ºä¸åŒçš„å¤„ç†ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">x: <span class="built_in">number</span></span>): <span class="title">number</span> // å‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">x: <span class="built_in">string</span></span>): <span class="title">string</span> // å‡½æ•°å®šä¹‰</span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">x: <span class="built_in">number</span> | <span class="built_in">string</span></span>): <span class="title">number</span> | <span class="title">string</span> </span>&#123;</span></span></span><br><span class="line"><span class="function"><span class="function">  // å‡½æ•°å®ç°</span></span></span><br><span class="line"><span class="function"><span class="function">  <span class="title">if</span> (<span class="params"><span class="keyword">typeof</span> x === '<span class="built_in">number</span>'</span>) </span>&#123;</span></span><br><span class="line"><span class="function">    <span class="title">return</span> <span class="title">Number</span>(<span class="params">x.toString().split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span>)</span></span><br><span class="line"><span class="function">  &#125; <span class="title">else</span> <span class="title">if</span> (<span class="params"><span class="keyword">typeof</span> x === '<span class="built_in">string</span>'</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h2><p>TypeScript å…è®¸ä½ è¦†ç›–å®ƒçš„æ¨æ–­ï¼Œå¹¶ä¸”èƒ½ä»¥ä½ ä»»ä½•ä½ æƒ³è¦çš„æ–¹å¼åˆ†æå®ƒï¼Œè¿™ç§æœºåˆ¶è¢«ç§°ä¸ºã€Œç±»å‹æ–­è¨€ã€ã€‚</p><p>TypeScript ç±»å‹æ–­è¨€ç”¨æ¥å‘Šè¯‰ç¼–è¯‘å™¨ä½ æ¯”å®ƒæ›´äº†è§£è¿™ä¸ªç±»å‹ï¼Œä½ çŸ¥é“ä½ è‡ªå·±åœ¨å¹²ä»€ä¹ˆï¼Œå¹¶ä¸”å®ƒä¸åº”è¯¥å†å‘å‡ºé”™è¯¯ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Cat &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  run(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Fish &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  swim(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªèƒ½è®¿é—®å…±æœ‰çš„å±æ€§</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">animal: Cat | Fish</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> animal.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† animal æ–­è¨€æˆ Fish å°±å¯ä»¥è§£å†³è®¿é—® animal.swim æ—¶æŠ¥é”™çš„é—®é¢˜</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFish</span>(<span class="params">animal: Cat | Fish</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> (animal <span class="keyword">as</span> Fish).swim === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»»ä½•ç±»å‹éƒ½å¯ä»¥è¢«æ–­è¨€ä¸º any</span></span><br><span class="line">;(<span class="built_in">window</span> <span class="keyword">as</span> <span class="built_in">any</span>).randomFoo = <span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹æ–­è¨€ç¬¬ä¸€ç§æ–¹å¼ï¼š"å°–æ‹¬å·"è¯­æ³•</span></span><br><span class="line"><span class="keyword">let</span> value1: <span class="built_in">any</span> = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">let</span> value1Length: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;value1).length</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹æ–­è¨€ç¬¬äºŒç§æ–¹å¼ï¼šas</span></span><br><span class="line"><span class="keyword">let</span> value2: <span class="built_in">any</span> = <span class="string">'world'</span></span><br><span class="line"><span class="keyword">let</span> value2Length: <span class="built_in">number</span> = (value2 <span class="keyword">as</span> <span class="built_in">string</span>).length</span><br></pre></td></tr></table></figure><h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><h3 id="å­˜å–å™¨"><a href="#å­˜å–å™¨" class="headerlink" title="å­˜å–å™¨"></a>å­˜å–å™¨</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// getter</span></span><br><span class="line">  <span class="keyword">get</span> name() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'åå­—'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// setter</span></span><br><span class="line">  <span class="keyword">set</span> name(value: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'setter: '</span> + value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> animal = <span class="keyword">new</span> Animal(<span class="string">'monkey'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(animal.name) <span class="comment">// monkey</span></span><br><span class="line">animal.name = <span class="string">'mk'</span> <span class="comment">// setter: mk</span></span><br></pre></td></tr></table></figure><h3 id="è®¿é—®ä¿®é¥°ç¬¦"><a href="#è®¿é—®ä¿®é¥°ç¬¦" class="headerlink" title="è®¿é—®ä¿®é¥°ç¬¦"></a>è®¿é—®ä¿®é¥°ç¬¦</h3><ul><li>public ä¿®é¥°çš„å±æ€§æˆ–æ–¹æ³•æ˜¯å…¬æœ‰çš„ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è®¿é—®åˆ°ï¼Œé»˜è®¤æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯ public çš„</li><li>private ä¿®é¥°çš„å±æ€§æˆ–æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½åœ¨å£°æ˜å®ƒçš„ç±»çš„å¤–éƒ¨è®¿é—®</li><li>protected ä¿®é¥°çš„å±æ€§æˆ–æ–¹æ³•æ˜¯å—ä¿æŠ¤çš„ï¼Œå®ƒå’Œ private ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯å®ƒåœ¨å­ç±»ä¸­ä¹Ÿæ˜¯å…è®¸è¢«è®¿é—®çš„</li></ul><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Person &#123;</span><br><span class="line">  <span class="keyword">public</span> name</span><br><span class="line">  <span class="keyword">private</span> age</span><br><span class="line">  <span class="keyword">protected</span> sex</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, sex: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">    <span class="keyword">this</span>.sex = sex</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person1 = <span class="keyword">new</span> Person(<span class="string">'jacky'</span>, <span class="number">22</span>, <span class="string">'man'</span>)</span><br><span class="line">person1.name = <span class="string">'monkey'</span> <span class="comment">// nameå€¼å¯ä»¥è®¿é—®ä¸”ä¿®æ”¹</span></span><br><span class="line"><span class="comment">// person1.age // Property 'age' is private and only accessible within class 'Person'.</span></span><br><span class="line"><span class="comment">// person1.sex // Property 'sex' is private and only accessible within class 'Person'.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Person1 <span class="keyword">extends</span> Person &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, sex: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name, age, sex)</span><br><span class="line">    <span class="comment">// console.log(this.name, this.age, this.sex) // Property 'age' is private and only accessible within class 'Person'.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚æ•°å±æ€§"><a href="#å‚æ•°å±æ€§" class="headerlink" title="å‚æ•°å±æ€§"></a>å‚æ•°å±æ€§</h3><p>åŒæ—¶ç»™ç±»ä¸­å®šä¹‰å±æ€§çš„åŒæ—¶èµ‹å€¼</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal3 &#123;</span><br><span class="line">  <span class="keyword">public</span> name</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Animal3(<span class="string">'animal3'</span>).name) <span class="comment">// animal3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Animal2 &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;&#125; <span class="comment">// ç®€æ´å½¢å¼</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Animal2(<span class="string">'animal2'</span>).name) <span class="comment">// animal2</span></span><br></pre></td></tr></table></figure><ul><li>readonly åªè¯»å±æ€§</li></ul><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal4 &#123;</span><br><span class="line">  readonly name</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> animal4 = <span class="keyword">new</span> Animal4(<span class="string">'animal4'</span>)</span><br><span class="line"><span class="comment">// animal4.name = '5' // Cannot assign to 'name' because it is a read-only property</span></span><br></pre></td></tr></table></figure><h3 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŠ½è±¡ç±»æ˜¯è¡Œä¸ºçš„æŠ½è±¡ï¼Œä¸€èˆ¬æ¥å°è£…å…¬å…±å±æ€§çš„æ–¹æ³•çš„ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> CommonAnimal &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">abstract</span> speak(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="static"><a href="#static" class="headerlink" title="static"></a>static</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal5 &#123;</span><br><span class="line">  <span class="keyword">static</span> sayHi() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello Animal5'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Animal5.sayHi()</span><br></pre></td></tr></table></figure><h2 id="è”åˆç±»å‹"><a href="#è”åˆç±»å‹" class="headerlink" title="è”åˆç±»å‹"></a>è”åˆç±»å‹</h2><p>è”åˆç±»å‹ï¼ˆUnion Typesï¼‰è¡¨ç¤ºå–å€¼å¯ä»¥ä¸ºå¤šç§ç±»å‹ä¸­çš„ä¸€ç§ã€‚ä½¿ç”¨ä¸€ä¸ª<code>|</code>åˆ†å‰²ç¬¦æ¥åˆ†å‰²å¤šç§ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo: <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">boolean</span></span><br><span class="line">foo = <span class="string">'test'</span></span><br><span class="line">foo = <span class="number">3</span></span><br><span class="line">foo = <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="äº¤å‰ç±»å‹"><a href="#äº¤å‰ç±»å‹" class="headerlink" title="äº¤å‰ç±»å‹"></a>äº¤å‰ç±»å‹</h2><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> IPerson &#123;</span><br><span class="line">  id: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IWorker &#123;</span><br><span class="line">  companyId: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IStaff = IPerson &amp; IWorker</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> staff: IStaff = &#123; id: <span class="string">'007'</span>, age: <span class="number">24</span>, companyId: <span class="string">'1'</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»å‹åˆ«å"><a href="#ç±»å‹åˆ«å" class="headerlink" title="ç±»å‹åˆ«å"></a>ç±»å‹åˆ«å</h2><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Message = <span class="built_in">string</span> | <span class="built_in">string</span>[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> getMsg = <span class="function">(<span class="params">message: Message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Weather = <span class="string">'SPRING'</span> | <span class="string">'SUMMER'</span> | <span class="string">'AUTUMN'</span> | <span class="string">'WINTER'</span></span><br><span class="line"><span class="keyword">let</span> weather1: Weather = <span class="string">'SPRING'</span></span><br><span class="line"><span class="keyword">let</span> weather2: Weather = <span class="string">'AUTUMN'</span></span><br></pre></td></tr></table></figure><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><h3 id="å¯¹è±¡çš„å½¢çŠ¶"><a href="#å¯¹è±¡çš„å½¢çŠ¶" class="headerlink" title="å¯¹è±¡çš„å½¢çŠ¶"></a>å¯¹è±¡çš„å½¢çŠ¶</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person1 &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person1: Person1 = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  age: <span class="number">23</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æè¿°è¡Œä¸ºçš„æŠ½è±¡"><a href="#æè¿°è¡Œä¸ºçš„æŠ½è±¡" class="headerlink" title="æè¿°è¡Œä¸ºçš„æŠ½è±¡"></a>æè¿°è¡Œä¸ºçš„æŠ½è±¡</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> AnimalLike &#123;</span><br><span class="line">  eat(): <span class="built_in">void</span></span><br><span class="line">  move(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> PersonLike <span class="keyword">extends</span> AnimalLike &#123;</span><br><span class="line">  speak(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Human <span class="keyword">implements</span> PersonLike &#123;</span><br><span class="line">  speak() &#123;&#125;</span><br><span class="line">  eat() &#123;&#125;</span><br><span class="line">  move() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å«æ„å»ºå‡½æ•°ä½œå‚æ•°çš„å†™æ³•"><a href="#å«æ„å»ºå‡½æ•°ä½œå‚æ•°çš„å†™æ³•" class="headerlink" title="å«æ„å»ºå‡½æ•°ä½œå‚æ•°çš„å†™æ³•"></a>å«æ„å»ºå‡½æ•°ä½œå‚æ•°çš„å†™æ³•</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal1 &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;&#125;</span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Animal2 &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> WithNameClass &#123;</span><br><span class="line">  <span class="keyword">new</span> (name: <span class="built_in">string</span>): Animal1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createClass</span>(<span class="params">classname: WithNameClass, name: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> classname(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance1 = createClass(Animal1, <span class="string">'monkey'</span>)</span><br><span class="line"><span class="comment">// let instance2 = createClass(Animal2, 'monkey') // æ²¡æœ‰nameå±æ€§åˆ™æŠ¥é”™</span></span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒä»»æ„å±æ€§"><a href="#å…¶å®ƒä»»æ„å±æ€§" class="headerlink" title="å…¶å®ƒä»»æ„å±æ€§"></a>å…¶å®ƒä»»æ„å±æ€§</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person2 &#123;</span><br><span class="line">  readonly id: <span class="built_in">number</span></span><br><span class="line">  [propName: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//ä»»æ„å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><p>æ³›å‹æ˜¯æŒ‡å®šä¹‰å‡½æ•°ã€æ¥å£æˆ–ç±»çš„æ—¶å€™ï¼Œä¸é¢„å…ˆæŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œè€Œåœ¨ä½¿ç”¨çš„æ—¶å€™å†æŒ‡å®šç±»å‹çš„ä¸€ç§ç‰¹æ€§ï¼›é€šå¸¸ç”¨ T è¡¨ç¤ºï¼Œä½†ä¸æ˜¯å¿…é¡»ä½¿ç”¨æ”¹å­—æ¯ï¼Œåªæ˜¯å¸¸è§„ï¼Œé€šå¸¸è¿˜æœ‰å…¶ä»–å¸¸ç”¨å­—æ¯ï¼š</p><ul><li>Tï¼ˆTypeï¼‰ï¼šè¡¨ç¤ºä¸€ä¸ª TypeScript ç±»å‹</li><li>Kï¼ˆKeyï¼‰ï¼šè¡¨ç¤ºå¯¹è±¡ä¸­çš„é”®ç±»å‹</li><li>Vï¼ˆValueï¼‰ï¼šè¡¨ç¤ºå¯¹è±¡ä¸­çš„å€¼ç±»å‹</li><li>Eï¼ˆElementï¼‰ï¼šè¡¨ç¤ºå…ƒç´ ç±»å‹</li></ul><h3 id="æ³›å‹ç±»"><a href="#æ³›å‹ç±»" class="headerlink" title="æ³›å‹ç±»"></a>æ³›å‹ç±»</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> GenericNumber&lt;T&gt; &#123;</span><br><span class="line">  name: T</span><br><span class="line">  add: <span class="function">(<span class="params">x: T, y: T</span>) =&gt;</span> T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generic = <span class="keyword">new</span> GenericNumber&lt;<span class="built_in">number</span>&gt;()</span><br><span class="line">generic.name = <span class="number">123</span></span><br></pre></td></tr></table></figure><h3 id="æ³›å‹æ•°ç»„"><a href="#æ³›å‹æ•°ç»„" class="headerlink" title="æ³›å‹æ•°ç»„"></a>æ³›å‹æ•°ç»„</h3><ul><li>å†™æ³•ä¸€</li></ul><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>&lt;<span class="title">T</span>&gt;(<span class="params">params: T[]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br><span class="line">func&lt;<span class="built_in">string</span>&gt;([<span class="string">'1'</span>, <span class="string">'2'</span>])</span><br><span class="line">func&lt;<span class="built_in">number</span>&gt;([<span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure><ul><li>å†™æ³•äºŒ</li></ul><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span>&lt;<span class="title">T</span>&gt;(<span class="params">params: <span class="built_in">Array</span>&lt;T&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br><span class="line">func1&lt;<span class="built_in">string</span>&gt;([<span class="string">'1'</span>, <span class="string">'2'</span>])</span><br><span class="line">func1&lt;<span class="built_in">number</span>&gt;([<span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹æ¥å£"><a href="#æ³›å‹æ¥å£" class="headerlink" title="æ³›å‹æ¥å£"></a>æ³›å‹æ¥å£</h3><p>å¯ä»¥ç”¨æ¥çº¦æŸå‡½æ•°</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Cart&lt;T&gt; &#123;</span><br><span class="line">  list: T[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cart: Cart&lt;<span class="built_in">number</span>&gt; = &#123; list: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125;</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹åˆ«å"><a href="#æ³›å‹åˆ«å" class="headerlink" title="æ³›å‹åˆ«å"></a>æ³›å‹åˆ«å</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Cart2&lt;T&gt; = &#123; list: T[] &#125; | T[]</span><br><span class="line"><span class="keyword">let</span> c1: Cart2&lt;<span class="built_in">number</span>&gt; = &#123; list: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125;</span><br><span class="line"><span class="keyword">let</span> c2: Cart2&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure><p>æ³›å‹æ¥å£ VS æ³›å‹åˆ«å</p><ul><li>æ¥å£åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åå­—ï¼Œå®ƒå¯ä»¥åœ¨å…¶ä»–ä»»æ„åœ°æ–¹è¢«è°ƒç”¨ã€‚è€Œç±»å‹åˆ«åå¹¶ä¸åˆ›å»ºæ–°çš„åå­—</li><li>ç±»å‹åˆ«åä¸èƒ½è¢« extends å’Œ implementsï¼Œè¿™æ—¶æˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨æ¥å£ä»£æ›¿ç±»å‹åˆ«å</li><li>å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨è”åˆç±»å‹æˆ–è€…å…ƒç»„ç±»å‹çš„æ—¶å€™ï¼Œç±»å‹åˆ«åä¼šæ›´åˆé€‚</li></ul><h3 id="å¤šä¸ªæ³›å‹"><a href="#å¤šä¸ªæ³›å‹" class="headerlink" title="å¤šä¸ªæ³›å‹"></a>å¤šä¸ªæ³›å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸å€ŸåŠ©ä¸­é—´å˜é‡äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">swap</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt;(<span class="params">tuple: [T, P]</span>): [<span class="title">P</span>, <span class="title">T</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [tuple[<span class="number">1</span>], tuple[<span class="number">0</span>]]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ret = swap([<span class="number">1</span>, <span class="string">'a'</span>])</span><br><span class="line">ret[<span class="number">0</span>].toLowerCase()</span><br><span class="line">ret[<span class="number">1</span>].toFixed(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><h3 id="é»˜è®¤æ³›å‹"><a href="#é»˜è®¤æ³›å‹" class="headerlink" title="é»˜è®¤æ³›å‹"></a>é»˜è®¤æ³›å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createArray</span>&lt;<span class="title">T</span> = <span class="title">number</span>&gt;(<span class="params">length: <span class="built_in">number</span>, value: T</span>): <span class="title">T</span>[] </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr: T[] = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    arr[i] = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr = createArray(<span class="number">3</span>, <span class="number">9</span>)</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹çº¦æŸ-ç»§æ‰¿"><a href="#æ³›å‹çº¦æŸ-ç»§æ‰¿" class="headerlink" title="æ³›å‹çº¦æŸ(ç»§æ‰¿)"></a>æ³›å‹çº¦æŸ(ç»§æ‰¿)</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> WithLength &#123;</span><br><span class="line">  length: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// extends æ¥ç»§æ‰¿</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">WithLength</span>&gt;(<span class="params">val: T</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(val.length)</span><br><span class="line">&#125;</span><br><span class="line">logger(<span class="string">'hello'</span>)</span><br><span class="line">logger([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="comment">// logger(true) // error æ²¡æœ‰lengthå±æ€§</span></span><br></pre></td></tr></table></figure><h3 id="æ³›å‹å·¥å…·ç±»å‹"><a href="#æ³›å‹å·¥å…·ç±»å‹" class="headerlink" title="æ³›å‹å·¥å…·ç±»å‹"></a>æ³›å‹å·¥å…·ç±»å‹</h3><p>ä¸ºäº†æ–¹ä¾¿å¼€å‘è€… TypeScript å†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„å·¥å…·ç±»å‹ï¼Œæ¯”å¦‚ Partialã€Requiredã€Readonlyã€Pick ç­‰ã€‚å®ƒä»¬éƒ½æ˜¯ä½¿ç”¨ keyof å®ç°ã€‚</p><p>keyof æ“ä½œç¬¦å¯ä»¥ç”¨æ¥ä¸€ä¸ªå¯¹è±¡ä¸­çš„æ‰€æœ‰ key å€¼ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person1 &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">  sex?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> PersonKey = keyof Person1 <span class="comment">// é™åˆ¶ key å€¼çš„å–å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValueByKey</span>(<span class="params">p: Person1, key: PersonKey</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> p[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…ç½®çš„å·¥å…·ç±»å‹"><a href="#å†…ç½®çš„å·¥å…·ç±»å‹" class="headerlink" title="å†…ç½®çš„å·¥å…·ç±»å‹"></a>å†…ç½®çš„å·¥å…·ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// type Partial&lt;T&gt; = &#123;[P in keyof T]?: T[P]&#125;</span></span><br><span class="line"><span class="keyword">type</span> PersonSearch = Partial&lt;Person&gt; <span class="comment">// å…¨éƒ¨å˜å¯é€‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// type Required&lt;T&gt; = &#123; [P in keyof T]-?: T[P] &#125;</span></span><br><span class="line"><span class="keyword">type</span> PersonRequired = Required&lt;Person&gt; <span class="comment">// å…¨éƒ¨å˜å¿…é€‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// type ReadOnly&lt;T&gt; = &#123; readonly [P in keyof T]: T[P] &#125;</span></span><br><span class="line"><span class="keyword">type</span> PersonReadOnly = Readonly&lt;Person&gt; <span class="comment">// å…¨éƒ¨å˜åªè¯»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// type Pick&lt;T, K extends keyof T&gt;  = &#123;[P in K]: T[P]&#125;</span></span><br><span class="line"><span class="keyword">type</span> PersonSub = Pick&lt;Person, <span class="string">'name'</span>&gt; <span class="comment">// é€šè¿‡ä»Typeä¸­é€‰æ‹©å±æ€§Keysçš„é›†åˆæ¥æ„é€ ç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="ç±»æ•°ç»„"><a href="#ç±»æ•°ç»„" class="headerlink" title="ç±»æ•°ç»„"></a>ç±»æ•°ç»„</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> root = <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line"><span class="keyword">let</span> children: HTMLCollection = root!.children <span class="comment">// ! ä»£è¡¨éç©ºæ–­è¨€æ“ä½œç¬¦</span></span><br><span class="line"><span class="keyword">let</span> childNodes: NodeListOf&lt;ChildNode&gt; = root!.childNodes</span><br></pre></td></tr></table></figure><h2 id="ç±»å‹ä¿æŠ¤"><a href="#ç±»å‹ä¿æŠ¤" class="headerlink" title="ç±»å‹ä¿æŠ¤"></a>ç±»å‹ä¿æŠ¤</h2><p>æ›´æ˜ç¡®çš„åˆ¤æ–­æŸä¸ªåˆ†æ”¯ä½œç”¨åŸŸä¸­çš„ç±»å‹ï¼Œä¸»è¦å°è¯•æ£€æµ‹å±æ€§ã€æ–¹æ³•æˆ–åŸå‹ï¼Œä»¥ç¡®å®šå¦‚ä½•å¤„ç†å€¼ã€‚</p><h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">double</span>(<span class="params">input: <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">boolean</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹çš„ç±»å‹ä¿æŠ¤</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> input === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> input.length</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> input === <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> input</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Monkey &#123;</span><br><span class="line">  climb: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> Person &#123;</span><br><span class="line">  sports: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAnimalName</span>(<span class="params">animal: Monkey | Person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (animal <span class="keyword">instanceof</span> Monkey) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(animal.climb)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(animal.sports)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="in"><a href="#in" class="headerlink" title="in"></a>in</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Student &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  play: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> Teacher &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  teach: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> SchoolRole = Student | Teacher</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRoleInformation</span>(<span class="params">role: SchoolRole</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'play'</span> <span class="keyword">in</span> role) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(role.play)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'teach'</span> <span class="keyword">in</span> role) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(role.teach)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ç±»å‹ä¿æŠ¤"><a href="#è‡ªå®šä¹‰ç±»å‹ä¿æŠ¤" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹ä¿æŠ¤"></a>è‡ªå®šä¹‰ç±»å‹ä¿æŠ¤</h3><p>æ¯”å¦‚æœ‰æ—¶ä¸¤ä¸ªç±»å‹æœ‰ä¸åŒçš„å–å€¼ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–å¯ä»¥åŒºåˆ†çš„å±æ€§</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Bird &#123;</span><br><span class="line">  leg: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> Dog &#123;</span><br><span class="line">  leg: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isBird</span>(<span class="params">x: Bird | Dog</span>): <span class="title">x</span> <span class="title">is</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x.leg === <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAnimal</span>(<span class="params">x: Bird | Dog</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isBird(x)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'bird'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'dog'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š<a href="https://github.com/Jacky-Summer/typescript-tutorial" target="_blank" rel="noopener">typescript-tutorial</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>TypeScriptç³»åˆ—</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç¼–å†™ä¸€ä¸ª Webpack Plugin</title>
    <url>/2020/10/18/%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA-Webpack-Plugin/</url>
    <content><![CDATA[<p>ä¸Šæ¬¡å†™äº† <a href="https://juejin.im/post/6882895689773383694" target="_blank" rel="noopener">å¦‚ä½•ç¼–å†™ä¸€ä¸ª Webpack Loader</a>ï¼Œä»Šå¤©æ¥è¯´è¯´å¦‚ä½•ç¼–å†™ä¸€ä¸ª Webpack Pluginã€‚</p><a id="more"></a><h2 id="webpack-å†…éƒ¨æ‰§è¡Œæµç¨‹"><a href="#webpack-å†…éƒ¨æ‰§è¡Œæµç¨‹" class="headerlink" title="webpack å†…éƒ¨æ‰§è¡Œæµç¨‹"></a>webpack å†…éƒ¨æ‰§è¡Œæµç¨‹</h2><p>ä¸€æ¬¡å®Œæ•´çš„ webpack æ‰“åŒ…å¤§è‡´æ˜¯è¿™æ ·çš„è¿‡ç¨‹ï¼š</p><ul><li>å°†å‘½ä»¤è¡Œå‚æ•°ä¸ webpack é…ç½®æ–‡ä»¶ åˆå¹¶ã€è§£æå¾—åˆ°å‚æ•°å¯¹è±¡ã€‚</li><li>å‚æ•°å¯¹è±¡ä¼ ç»™ webpack æ‰§è¡Œå¾—åˆ° Compiler å¯¹è±¡ã€‚</li><li>æ‰§è¡Œ Compiler çš„ run æ–¹æ³•å¼€å§‹ç¼–è¯‘ã€‚æ¯æ¬¡æ‰§è¡Œ run ç¼–è¯‘éƒ½ä¼šç”Ÿæˆä¸€ä¸ª Compilation å¯¹è±¡ã€‚</li><li>è§¦å‘ Compiler çš„ make æ–¹æ³•åˆ†æå…¥å£æ–‡ä»¶ï¼Œè°ƒç”¨ compilation çš„ buildModule æ–¹æ³•åˆ›å»ºä¸»æ¨¡å—å¯¹è±¡ã€‚</li><li>ç”Ÿæˆå…¥å£æ–‡ä»¶ AST(æŠ½è±¡è¯­æ³•æ ‘)ï¼Œé€šè¿‡ AST åˆ†æå’Œé€’å½’åŠ è½½ä¾èµ–æ¨¡å—ã€‚</li><li>æ‰€æœ‰æ¨¡å—åˆ†æå®Œæˆåï¼Œæ‰§è¡Œ compilation çš„ seal æ–¹æ³•å¯¹æ¯ä¸ª chunk è¿›è¡Œæ•´ç†ã€ä¼˜åŒ–ã€å°è£…ã€‚</li><li>æœ€åæ‰§è¡Œ Compiler çš„ emitAssets æ–¹æ³•æŠŠç”Ÿæˆçš„æ–‡ä»¶è¾“å‡ºåˆ° output çš„ç›®å½•ä¸­ã€‚</li></ul><h2 id="Plugin-ä½œç”¨"><a href="#Plugin-ä½œç”¨" class="headerlink" title="Plugin ä½œç”¨"></a>Plugin ä½œç”¨</h2><p>æŒ‰æˆ‘çš„ç†è§£ï¼ŒWebpack æ’ä»¶çš„ä½œç”¨å°±æ˜¯åœ¨ webpack è¿è¡Œåˆ°æŸä¸ªæ—¶åˆ»çš„æ—¶å€™ï¼Œå¸®æˆ‘ä»¬åšä¸€äº›äº‹æƒ…ã€‚</p><p>åœ¨ Webpack è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå¹¿æ’­å‡ºè®¸å¤šäº‹ä»¶ï¼ŒPlugin å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºé€šè¿‡ Webpack æä¾›çš„ API æ”¹å˜è¾“å‡ºç»“æœã€‚</p><p>å®˜æ–¹è§£é‡Šæ˜¯ï¼š</p><blockquote><p>æ’ä»¶å‘ç¬¬ä¸‰æ–¹å¼€å‘è€…æä¾›äº† webpack å¼•æ“ä¸­å®Œæ•´çš„èƒ½åŠ›ã€‚ä½¿ç”¨é˜¶æ®µå¼çš„æ„å»ºå›è°ƒï¼Œå¼€å‘è€…å¯ä»¥å¼•å…¥å®ƒä»¬è‡ªå·±çš„è¡Œä¸ºåˆ° webpack æ„å»ºæµç¨‹ä¸­ã€‚</p></blockquote><h2 id="ç¼–å†™-Plugin"><a href="#ç¼–å†™-Plugin" class="headerlink" title="ç¼–å†™ Plugin"></a>ç¼–å†™ Plugin</h2><p>webpack æ’ä»¶çš„ç»„æˆï¼š</p><ul><li>ä¸€ä¸ª JS å‘½åå‡½æ•°æˆ–ä¸€ä¸ªç±»ï¼ˆå¯ä»¥æƒ³ä¸‹æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æ’ä»¶å°±æ˜¯ <code>new XXXPlugin()</code>çš„æ–¹å¼ï¼‰</li><li>åœ¨æ’ä»¶ç±»/å‡½æ•°çš„ (prototype) ä¸Šå®šä¹‰ä¸€ä¸ª apply æ–¹æ³•ã€‚</li><li>é€šè¿‡ apply å‡½æ•°ä¸­ä¼ å…¥ compiler å¹¶æ’å…¥æŒ‡å®šçš„äº‹ä»¶é’©å­ï¼Œåœ¨é’©å­å›è°ƒä¸­å–åˆ° compilation å¯¹è±¡</li><li>é€šè¿‡ compilation å¤„ç† webpack å†…éƒ¨ç‰¹å®šçš„å®ä¾‹æ•°æ®</li><li>å¦‚æœæ˜¯æ’ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œåœ¨æ’ä»¶çš„é€»è¾‘ç¼–å†™å®Œåè°ƒç”¨ webpack æä¾›çš„ callback</li></ul><p>æ¯”å¦‚æˆ‘ä»¬å†™ä¸€ä¸ªæ’ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªç‰ˆæƒçš„æ–‡ä»¶ã€‚</p><h3 id="åŸºæœ¬é›å½¢"><a href="#åŸºæœ¬é›å½¢" class="headerlink" title="åŸºæœ¬é›å½¢"></a>åŸºæœ¬é›å½¢</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CopyrightWebpackPlugin</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">CopyrightWebpackPlugin.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">compiler</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CopyrightWebpackPlugin</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å†™æˆç±»çš„å½¢å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CopyrightWebpackPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(compiler)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CopyrightWebpackPlugin</span><br></pre></td></tr></table></figure><p>webpack åœ¨å¯åŠ¨ä¹‹åï¼Œåœ¨è¯»å–é…ç½®çš„è¿‡ç¨‹ä¸­ä¼šå…ˆæ‰§è¡Œ<code>new CopyrightWebpackPlugin(options)</code>æ“ä½œï¼Œåˆå§‹åŒ–ä¸€ä¸ª<code>CopyrightWebpackPlugin</code>å®ä¾‹å¯¹è±¡ã€‚åœ¨åˆå§‹åŒ– compiler å¯¹è±¡ä¹‹åï¼Œä¼šè°ƒç”¨ä¸Šè¿°å®ä¾‹å¯¹è±¡çš„<code>apply</code>æ–¹æ³•å¹¶å°†<code>compiler</code>å¯¹è±¡ä¼ å…¥ã€‚</p><p>åœ¨<code>apply</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>compiler</code>å¯¹è±¡æ¥ç›‘å¬ webpack ç”Ÿå‘½å‘¨æœŸä¸­å¹¿æ’­å‡ºæ¥çš„äº‹ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ compiler å¯¹è±¡æ¥æ“ä½œ webpack çš„è¾“å‡ºã€‚</p><h3 id="Compiler-å’Œ-Compilation"><a href="#Compiler-å’Œ-Compilation" class="headerlink" title="Compiler å’Œ Compilation"></a>Compiler å’Œ Compilation</h3><p>åœ¨æ’ä»¶å¼€å‘ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªå¯¹è±¡æ˜¯ <code>compiler</code> å’Œ <code>compilation</code> å¯¹è±¡ã€‚</p><blockquote><p>compiler å¯¹è±¡ä»£è¡¨äº†å®Œæ•´çš„ webpack ç¯å¢ƒé…ç½®ï¼Œåœ¨åˆå§‹åŒ– compiler å¯¹è±¡ä¹‹åï¼Œé€šè¿‡è°ƒç”¨æ’ä»¶å®ä¾‹çš„ apply æ–¹æ³•ï¼Œä½œä¸ºå…¶å‚æ•°ä¼ å…¥ã€‚è¿™ä¸ªå¯¹è±¡åœ¨å¯åŠ¨ webpack æ—¶è¢«ä¸€æ¬¡æ€§å»ºç«‹ï¼Œå¹¶åŒ…å«äº† webpack ç¯å¢ƒçš„æ‰€æœ‰çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ optionsï¼Œloader å’Œ pluginã€‚å½“åœ¨ webpack ç¯å¢ƒä¸­åº”ç”¨ä¸€ä¸ªæ’ä»¶æ—¶ï¼Œæ’ä»¶å°†æ”¶åˆ°æ­¤ compiler å¯¹è±¡çš„å¼•ç”¨ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¿é—® webpack çš„ä¸»ç¯å¢ƒã€‚</p></blockquote><blockquote><p>compilation å¯¹è±¡ä¼šä½œä¸º plugin å†…ç½®äº‹ä»¶å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œä¸€ä¸ª compilation å¯¹è±¡åŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ã€‚å½“ Webpack ä»¥å¼€å‘æ¨¡å¼è¿è¡Œæ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œä¸€æ¬¡æ–°çš„ compilation å°†è¢«åˆ›å»ºã€‚compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šäº‹ä»¶å›è°ƒä¾›æ’ä»¶åšæ‰©å±•ã€‚é€šè¿‡ compilation ä¹Ÿèƒ½è¯»å–åˆ° compiler å¯¹è±¡ã€‚</p></blockquote><h3 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h3><p>ä¸‹é¢ä»£ç ä¸ºç”Ÿæˆä¸€ä¸ªç‰ˆæƒ txt æ–‡ä»¶ï¼Œæ–°å»ºæ–‡ä»¶<code>src/plugins/copyright-webpack-plugin.js</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CopyrightWebpackPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    <span class="comment">// emit é’©å­æ˜¯ç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å‰æ‰§è¡Œï¼Œemit æ˜¯ä¸€ä¸ªå¼‚æ­¥ä¸²è¡Œé’©å­ï¼Œéœ€è¦ç”¨ tapAsync æ¥æ³¨å†Œ</span></span><br><span class="line">    compiler.hooks.emit.tapAsync(<span class="string">'CopyrightWebpackPlugin'</span>, (compilation, callback) =&gt; &#123;</span><br><span class="line">      <span class="comment">// å›è°ƒæ–¹å¼æ³¨å†Œå¼‚æ­¥é’©å­</span></span><br><span class="line">      <span class="keyword">const</span> copyrightText = <span class="string">'ç‰ˆæƒå½’ JackySummer æ‰€æœ‰'</span></span><br><span class="line">      <span class="comment">// compilationå­˜æ”¾äº†è¿™æ¬¡æ‰“åŒ…çš„æ‰€æœ‰å†…å®¹</span></span><br><span class="line">      <span class="comment">// æ‰€æœ‰å¾…ç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨å®ƒçš„ assets å±æ€§ä¸Š</span></span><br><span class="line">      compilation.assets[<span class="string">'copyright.txt'</span>] = &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ copyright.txt</span></span><br><span class="line">        source: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> copyrightText</span><br><span class="line">        &#125;,</span><br><span class="line">        size: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">// æ–‡ä»¶å¤§å°</span></span><br><span class="line">          <span class="keyword">return</span> copyrightText.length</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">      callback() <span class="comment">// å¿…é¡»è°ƒç”¨</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CopyrightWebpackPlugin</span><br></pre></td></tr></table></figure><p>webpack ä¸­è®¸å¤šå¯¹è±¡æ‰©å±•è‡ª Tapable ç±»ã€‚è¿™ä¸ªç±»æš´éœ² tap, tapAsync å’Œ tapPromise æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œæ³¨å…¥è‡ªå®šä¹‰çš„æ„å»ºæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤å°†åœ¨æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­ä¸åŒæ—¶æœºè§¦å‘ã€‚</p><p>ä½¿ç”¨ tapAsync æ–¹æ³•æ¥è®¿é—®æ’ä»¶æ—¶ï¼Œéœ€è¦è°ƒç”¨ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°æä¾›çš„å›è°ƒå‡½æ•°ã€‚</p><p>åœ¨ webpack.config.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyrightWebpackPlugin = <span class="built_in">require</span>(<span class="string">'./src/plugins/copyright-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name].js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="keyword">new</span> CopyrightWebpackPlugin()],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ webpack å‘½ä»¤ï¼Œå°±ä¼šçœ‹åˆ° dist ç›®å½•ä¸‹ç”Ÿæˆ<code>copyright.txt</code>æ–‡ä»¶</p><p>å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä½¿ç”¨ plugin æ—¶ä¼ å…¥å‚æ•°è¯¥æ€ä¹ˆè·å¾—å‘¢ï¼Œå¯ä»¥åœ¨æ’ä»¶ç±»æ·»åŠ æ„é€ å‡½æ•°æ‹¿åˆ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> plugins: [</span><br><span class="line">  <span class="keyword">new</span> CopyrightWebpackPlugin(&#123;</span><br><span class="line">    name: <span class="string">'jacky'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>åœ¨<code>copyright-webpack-plugin.js</code>ä¸­</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CopyrightWebpackPlugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options = &#123;&#125;) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'options'</span>, options) <span class="comment">// options &#123; name: 'jacky' &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« ï¼š <a href="https://www.jianshu.com/p/8e92f36e52da" target="_blank" rel="noopener">æ­ç§˜ webpack plugin</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>å‰ç«¯å·¥ç¨‹åŒ–</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Plugin</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç¼–å†™ä¸€ä¸ª Webpack Loader</title>
    <url>/2020/10/13/%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA-Webpack-Loader/</url>
    <content><![CDATA[<p>åœ¨å¹³æ—¶è‡ªå·±ç”±é›¶æ­å»ºé¡¹ç›®æ—¶ï¼Œè™½ç„¶åŸºç¡€é…ç½®éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œæ¯”å¦‚é…ç½® file-loader, url-loader, css-loader ç­‰ï¼Œé…ç½®ä¸éš¾ï¼Œä½†ç©¶ç«Ÿæ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„å‘¢ï¼Œä»Šå¤©å°±æ¥è¯´è¯´å¦‚ä½•ç¼–å†™ä¸€ä¸ª Webpack Loaderã€‚</p><a id="more"></a><h2 id="Loader-ä½œç”¨"><a href="#Loader-ä½œç”¨" class="headerlink" title="Loader ä½œç”¨"></a>Loader ä½œç”¨</h2><p>æŒ‰æˆ‘è‡ªå·±çš„ç®€å•ç†è§£ï¼Œloader é€šå¸¸æŒ‡æ‰“åŒ…çš„æ–¹æ¡ˆï¼Œå³æŒ‰ä»€ä¹ˆæ–¹å¼æ¥å¤„ç†æ‰“åŒ…ï¼Œæ‰“åŒ…çš„æ—¶å€™å®ƒå¯ä»¥æ‹¿åˆ°æ¨¡å—æºä»£ç ï¼Œç»è¿‡ç‰¹å®š loader çš„è½¬æ¢åè¿”å›æ–°çš„ç»“æœã€‚</p><p>æ¯”å¦‚ sass-loader å¯ä»¥æŠŠ SCSS ä»£ç è½¬æ¢æˆ CSS ä»£ç </p><h2 id="ç¼–å†™-Loader"><a href="#ç¼–å†™-Loader" class="headerlink" title="ç¼–å†™ Loader"></a>ç¼–å†™ Loader</h2><h3 id="ä¿æŒåŠŸèƒ½å•ä¸€"><a href="#ä¿æŒåŠŸèƒ½å•ä¸€" class="headerlink" title="ä¿æŒåŠŸèƒ½å•ä¸€"></a>ä¿æŒåŠŸèƒ½å•ä¸€</h3><p>æˆ‘ä»¬é¡¹ç›®ä¸­å¯èƒ½ä¼šé…ç½®å¾ˆå¤šï¼Œä½†è¦è®°ä½ï¼Œè¦ä¿æŒä¸€ä¸ª Loader çš„åŠŸèƒ½å•ä¸€ï¼Œé¿å…åšå¤šç§åŠŸèƒ½ï¼Œåªéœ€å®Œæˆä¸€ç§åŠŸèƒ½è½¬æ¢å³å¯ã€‚</p><p>æ‰€ä»¥å¦‚ less æ–‡ä»¶è½¬æ¢æˆ css æ–‡ä»¶ï¼Œä¹Ÿä¸æ˜¯ä¸€æ­¥åˆ°ä½ï¼Œè€Œæ˜¯ less-loader, css-loader, style-loader å‡ ä¸ª loader çš„é“¾å¼è°ƒç”¨æ‰èƒ½å®Œæˆè½¬æ¢ã€‚</p><h3 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h3><p>å› ä¸º Webpack æœ¬èº«æ˜¯è¿è¡Œåœ¨ Node.js ä¹‹ä¸Šçš„ï¼Œä¸€ä¸ª loader å…¶å®å°±æ˜¯ä¸€ä¸ª node æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå³ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// source ä¸º compiler ä¼ é€’ç»™ Loader çš„ä¸€ä¸ªæ–‡ä»¶çš„åŸå†…å®¹</span></span><br><span class="line">  <span class="comment">// å¤„ç†...</span></span><br><span class="line">  <span class="keyword">return</span> source <span class="comment">// éœ€è¦è¿”å›å¤„ç†åçš„å†…å®¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¯¼å‡ºçš„å‡½æ•°çš„å·¥ä½œå°±æ˜¯è·å¾—å¤„ç†å‰çš„åŸå†…å®¹ï¼Œå¯¹åŸå†…å®¹æ‰§è¡Œå¤„ç†åï¼Œè¿”å›å¤„ç†åçš„å†…å®¹ã€‚</p><h3 id="æ›¿æ¢å­—ç¬¦ä¸²çš„-loader"><a href="#æ›¿æ¢å­—ç¬¦ä¸²çš„-loader" class="headerlink" title="æ›¿æ¢å­—ç¬¦ä¸²çš„ loader"></a>æ›¿æ¢å­—ç¬¦ä¸²çš„ loader</h3><p>æ¯”å¦‚æˆ‘ä»¬æ‰“åŒ…æ—¶ï¼Œæƒ³è¦æ›¿æ¢æºæ–‡ä»¶çš„å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ Loaderï¼Œå› ä¸º loader å°±æ˜¯è·å¾—æºæ–‡ä»¶å†…å®¹ç„¶åå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå†è¿”å›ã€‚</p><p>æ¯”å¦‚ src ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><p>src/msg1.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> msg1 = <span class="string">'å­¦ä¹ æ¡†æ¶'</span></span><br></pre></td></tr></table></figure><p>src/msg2.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> msg2 = <span class="string">'æ·±å…¥ç†è§£JS'</span></span><br></pre></td></tr></table></figure><p>src/index.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; msg1 &#125; <span class="keyword">from</span> <span class="string">'./msg1'</span></span><br><span class="line"><span class="keyword">import</span> &#123; msg2 &#125; <span class="keyword">from</span> <span class="string">'./msg2'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`è¾“å‡ºï¼š<span class="subst">$&#123;msg1&#125;</span>, <span class="subst">$&#123;msg2&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print()</span><br></pre></td></tr></table></figure><p>åšçš„äº‹æƒ…åˆ™æ˜¯æŠŠ msg1 å’Œ msg2 ä¸¤ä¸ªæ–‡ä»¶å¯¼å…¥ï¼Œç„¶åè¾“å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>æˆ‘ä»¬è¦åšçš„äº‹ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠâ€æ¡†æ¶â€è½¬ä¸ºâ€React æ¡†æ¶â€ï¼Œ â€œJSâ€è½¬ä¸ºâ€JavaScriptâ€ã€‚</p><p>æ–°å»º <code>src/loaders/replaceLoader.js</code>æ–‡ä»¶ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> handleContent = source.replace(<span class="string">'æ¡†æ¶'</span>, <span class="string">'Reactæ¡†æ¶'</span>).replace(<span class="string">'JS'</span>, <span class="string">'JavaScript'</span>)</span><br><span class="line">  <span class="keyword">return</span> handleContent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±è¿™æ ·ï¼Œloader å†™å®Œäº†ï¼ï¼ï¼</p><p>ä¸Šé¢æˆ‘ä»¬è®²åˆ°ï¼Œsource æ˜¯æºæ–‡ä»¶å†…å®¹ï¼Œå¦‚æœæ‰“å°çš„è¯ï¼Œåˆ™æ˜¯ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad0aa5b46ede404eb4d1c2602e609ccb~tplv-k3u1fbpfcp-watermark.webp" alt=""></p><h3 id="ä½¿ç”¨-Loader"><a href="#ä½¿ç”¨-Loader" class="headerlink" title="ä½¿ç”¨ Loader"></a>ä½¿ç”¨ Loader</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ¥ä½¿ç”¨å®ƒï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ webpack.config.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: <span class="string">'./src/loaders/replaceLoader.js'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name].js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>npx webpack</code>,<br>æŸ¥çœ‹æ‰“åŒ…ç»“æœ<code>dist/main.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">;<span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="meta">  'use strict'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'è¾“å‡ºï¼šå­¦ä¹ Reactæ¡†æ¶, æ·±å…¥ç†è§£JavaScript'</span>)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><p>æ›¿æ¢æˆåŠŸï¼</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>use</code>é‡Œé¢å¡«å†™çš„ loader æ˜¯å»<code>node_modules</code>ç›®å½•é‡Œé¢æ‰¾çš„ï¼Œç”±äºæˆ‘ä»¬æ˜¯è‡ªå®šä¹‰çš„ loaderï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å†™<code>use: &#39;replaceLoader&#39;</code>ï¼Œä½†ç›´æ¥å†™è·¯å¾„çš„æ–¹å¼æœªå…éš¾çœ‹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ webpack æ¥é…ç½®ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolveLoader: &#123;</span><br><span class="line">    modules: [<span class="string">'node_modules'</span>, <span class="string">'./src/loaders'</span>], <span class="comment">// node_modulesæ‰¾ä¸åˆ°ï¼Œå°±å»./src/loadersæ‰¾</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: <span class="string">'replaceLoader'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è·å–-loader-çš„-options"><a href="#è·å–-loader-çš„-options" class="headerlink" title="è·å– loader çš„ options"></a>è·å– loader çš„ options</h3><p>å†™å®Œä¹‹åï¼Œè®©æˆ‘ä»¬æ¥æƒ³æƒ³ï¼Œå…¶å®å°±æ˜¯å†™ä¸€ä¸ªåŠŸèƒ½å‡½æ•°å˜›ã€‚</p><p>å½“ç„¶ï¼Œè¿™åªæ˜¯æœ€ç®€å•çš„ä¾‹å­ï¼Œå¦‚æœ loader å¯ä»¥ä¼ å…¥å‚æ•°å‘¢ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">'replaceLoader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          params: <span class="string">'replaceString'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨<code>this.query</code>æ¥è·å–ï¼Œé€šè¿‡<code>this.query.params</code>å°±èƒ½æ‹¿åˆ°ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œthis ä¸Šä¸‹æ–‡æ˜¯æœ‰ç”¨çš„ï¼Œæ‰€ä»¥è¿™ä¸ª loader å¯¼å‡ºå‡½æ•°ä¸èƒ½æ˜¯ç®­å¤´å‡½æ•°ã€‚</p><p>ä½† webpack æ›´æ¨è<code>loader-utils</code>æ¨¡å—æ¥è·å–ï¼Œå®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„å·¥å…·ï¼Œæœ€å¸¸ç”¨çš„ä¸€ç§å·¥å…·æ˜¯è·å–ä¼ é€’ç»™ loader çš„é€‰é¡¹ã€‚</p><p>é¦–å…ˆè¦å®‰è£…</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i -D loader-utils</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>src/loaders/replaceLoader.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getOptions &#125; = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(getOptions(<span class="keyword">this</span>)) <span class="comment">// &#123; params: 'replaceString' &#125;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.query.params) <span class="comment">// replaceString</span></span><br><span class="line">  <span class="keyword">const</span> handleContent = source.replace(<span class="string">'æ¡†æ¶'</span>, <span class="string">'Reactæ¡†æ¶'</span>).replace(<span class="string">'JS'</span>, <span class="string">'JavaScript'</span>)</span><br><span class="line">  <span class="keyword">return</span> handleContent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>getOptions(this)</code>å‚æ•°ä¼ å…¥çš„æ˜¯ thisï¼Œä¹Ÿå°±æ˜¯è¯´</p><p>æ‰“å°ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123; params: &#39;replaceString&#39; &#125;</span><br><span class="line">&#123; params: &#39;replaceString&#39; &#125;</span><br><span class="line">&#123; params: &#39;replaceString&#39; &#125;</span><br></pre></td></tr></table></figure><h3 id="this-callback"><a href="#this-callback" class="headerlink" title="this.callback()"></a>this.callback()</h3><p>ä¸Šé¢éƒ½æ˜¯è¿”å›åŸæ¥å†…å®¹è½¬æ¢åçš„å†…å®¹ï¼Œä½†æœ‰äº›åœºæ™¯ä¸‹è¿˜éœ€è¦è¿”å›å…¶ä»–ä¸œè¥¿æ¯”å¦‚ sourceMap</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å‘Šè¯‰ Webpack è¿”å›çš„ç»“æœ</span></span><br><span class="line">  <span class="keyword">this</span>.callback(<span class="literal">null</span>, source, sourceMaps)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¹Ÿä¸éœ€è¦ return äº†ï¼Œæ‰€ä»¥ä¹Ÿå¯ä½¿ç”¨æ­¤ API æ›¿ä»£ return</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getOptions &#125; = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> handleContent = source.replace(<span class="string">'æ¡†æ¶'</span>, <span class="string">'Reactæ¡†æ¶'</span>).replace(<span class="string">'JS'</span>, <span class="string">'JavaScript'</span>)</span><br><span class="line">  <span class="keyword">this</span>.callback(<span class="literal">null</span>, handleContent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰-loader-åº”ç”¨åœºæ™¯"><a href="#è‡ªå®šä¹‰-loader-åº”ç”¨åœºæ™¯" class="headerlink" title="è‡ªå®šä¹‰ loader åº”ç”¨åœºæ™¯"></a>è‡ªå®šä¹‰ loader åº”ç”¨åœºæ™¯</h3><ol><li>åœ¨æ‰€æœ‰ function å¤–é¢åŠ ä¸€å±‚ try catch ä»£ç å—æ•è·é”™è¯¯ï¼Œé¿å…æ‰‹åŠ¨ç¹çæ·»åŠ ã€‚</li><li>å®ç°ä¸­è‹±æ–‡æ›¿æ¢ï¼šå¯ä»¥å°†æ–‡å­—ç”¨å ä½ç¬¦å¦‚<code>å¦‚ä½•ç¼–å†™ä¸€ä¸ª Webpack Loader</code>åŒ…è£¹ï¼Œæ£€æµ‹åˆ°å ä½ç¬¦åˆ™æ ¹æ®ç¯å¢ƒå˜é‡æ›¿æ¢ä¸ºä¸­è‹±æ–‡ã€‚</li></ol><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>å‰ç«¯å·¥ç¨‹åŒ–</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Loader</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™ç®€æ˜“çš„ Vue Router</title>
    <url>/2020/10/10/%E6%89%8B%E5%86%99%E7%AE%80%E6%98%93%E7%9A%84-Vue-Router/</url>
    <content><![CDATA[<p>è¿˜æ˜¯é‚£æ ·ï¼Œæ‡‚å¾—å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªå¸¸ç”¨åº“ï¼Œè¿˜å¾—äº†è§£å…¶åŸç†æˆ–è€…æ€ä¹ˆæ¨¡æ‹Ÿå®ç°ï¼Œä»Šå¤©å®ç°ä¸€ä¸‹ <code>vue-router</code>ã€‚</p><p>æœ‰ä¸€äº›çŸ¥è¯†æˆ‘è¿™ç¯‡æ–‡ç« æåˆ°äº†ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä¸€æ­¥æ­¥å†™ï¼Œè¯·çœ‹æˆ‘ <a href="https://github.com/Jacky-Summer/mini-vuex" target="_blank" rel="noopener">æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ Vuex</a></p><a id="more"></a><h2 id="åŸºæœ¬éª¨æ¶"><a href="#åŸºæœ¬éª¨æ¶" class="headerlink" title="åŸºæœ¬éª¨æ¶"></a>åŸºæœ¬éª¨æ¶</h2><ul><li>Vue é‡Œé¢ä½¿ç”¨æ’ä»¶çš„æ–¹å¼æ˜¯<code>Vue.use(plugin)</code>ï¼Œè¿™é‡Œè´´å‡ºå®ƒçš„ç”¨æ³•ï¼š</li></ul><blockquote><p>å®‰è£… Vue.js æ’ä»¶ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æä¾› install æ–¹æ³•ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«ä½œä¸º install æ–¹æ³•ã€‚install æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå°† Vue ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Vue æ„é€ å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹å¯¹è±¡ã€‚</p></blockquote><ul><li>å…¨å±€æ··å…¥</li></ul><p>ä½¿ç”¨ <code>Vue.mixin(mixin)</code></p><blockquote><p>å…¨å±€æ³¨å†Œä¸€ä¸ªæ··å…¥ï¼Œå½±å“æ³¨å†Œä¹‹åæ‰€æœ‰åˆ›å»ºçš„æ¯ä¸ª Vue å®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨æ··å…¥å‘ç»„ä»¶æ³¨å…¥è‡ªå®šä¹‰çš„è¡Œä¸ºï¼Œå®ƒå°†å½±å“æ¯ä¸€ä¸ªä¹‹ååˆ›å»ºçš„ Vue å®ä¾‹ã€‚</p></blockquote><ul><li>è·¯ç”±ç”¨æ³•</li></ul><p>æ¯”å¦‚ç®€å•çš„:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·¯ç”±æ•°ç»„</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    name: <span class="string">'Page1'</span>,</span><br><span class="line">    component: Page1,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/page2'</span>,</span><br><span class="line">    name: <span class="string">'Page2'</span>,</span><br><span class="line">    component: Page2,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>, <span class="comment">// æ¨¡å¼</span></span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®ƒæ˜¯ä¼ å…¥äº†<code>mode</code>å’Œ<code>routes</code>ï¼Œæˆ‘ä»¬å®ç°çš„æ—¶å€™éœ€è¦åœ¨<code>VueRouter</code>æ„é€ å‡½æ•°ä¸­æ¥æ”¶ã€‚</p><p>åœ¨ä½¿ç”¨è·¯ç”±æ ‡é¢˜çš„æ—¶å€™æ˜¯è¿™æ ·ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨ router-link ç»„ä»¶æ¥å¯¼èˆª. --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- é€šè¿‡ä¼ å…¥ `to` å±æ€§æŒ‡å®šé“¾æ¥. --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;router-link&gt; é»˜è®¤ä¼šè¢«æ¸²æŸ“æˆä¸€ä¸ª `&lt;a&gt;` æ ‡ç­¾ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/page1"</span>&gt;</span>Go to Foo<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/page2"</span>&gt;</span>Go to Bar<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è·¯ç”±å‡ºå£ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†æ¸²æŸ“åœ¨è¿™é‡Œ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•…æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>Vue.component(id, [definition])</code>æ³¨å†Œä¸€ä¸ªå…¨å±€ç»„ä»¶ã€‚</p><p>äº†è§£äº†å¤§æ¦‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä¸€ä¸ªåŸºæœ¬éª¨æ¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.mode = options.mode || <span class="string">'hash'</span></span><br><span class="line">    <span class="keyword">this</span>.routes = options.routes || []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VueRouter.install = <span class="function"><span class="keyword">function</span> (<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  Vue = _Vue</span><br><span class="line"></span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="comment">// æ ¹ç»„ä»¶</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$options &amp;&amp; <span class="keyword">this</span>.$options.router) &#123;</span><br><span class="line">        <span class="keyword">this</span>._root = <span class="keyword">this</span> <span class="comment">// æŠŠå½“å‰vueå®ä¾‹ä¿å­˜åˆ°_rootä¸Š</span></span><br><span class="line">        <span class="keyword">this</span>._router = <span class="keyword">this</span>.$options.router <span class="comment">// æŠŠrouterçš„å®ä¾‹æŒ‚è½½åœ¨_routerä¸Š</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._root) &#123;</span><br><span class="line">        <span class="comment">// å­ç»„ä»¶çš„è¯å°±å»ç»§æ‰¿çˆ¶ç»„ä»¶çš„å®ä¾‹ï¼Œè®©æ‰€æœ‰ç»„ä»¶å…±äº«ä¸€ä¸ªrouterå®ä¾‹</span></span><br><span class="line">        <span class="keyword">this</span>._root = <span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._root</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  Vue.component(<span class="string">'router-link'</span>, &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      to: &#123;</span><br><span class="line">        type: [<span class="built_in">String</span>, <span class="built_in">Object</span>],</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      tag: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="string">'a'</span>, <span class="comment">// router-link é»˜è®¤æ¸²æŸ“æˆ a æ ‡ç­¾</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    render(h) &#123;</span><br><span class="line">      <span class="keyword">let</span> tag = <span class="keyword">this</span>.tag || <span class="string">'a'</span></span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">tag</span> <span class="attr">href</span>=<span class="string">&#123;this.to&#125;</span>&gt;</span>&#123;this.$slots.default&#125;<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  Vue.component(<span class="string">'router-view'</span>, &#123;</span><br><span class="line">    render(h) &#123;</span><br><span class="line">      <span class="keyword">return</span> h(<span class="string">'h1'</span>, &#123;&#125;, <span class="string">'è§†å›¾æ˜¾ç¤ºçš„åœ°æ–¹'</span>) <span class="comment">// æš‚æ—¶ç½®ä¸ºh1æ ‡ç­¾ï¼Œä¸‹é¢ä¼šæ”¹</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> VueRouter</span><br></pre></td></tr></table></figure><h2 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h2><p><code>vue-router</code>æœ‰ä¸¤ç§æ¨¡å¼ï¼Œé»˜è®¤ä¸º hash æ¨¡å¼ã€‚</p><h3 id="history-æ¨¡å¼"><a href="#history-æ¨¡å¼" class="headerlink" title="history æ¨¡å¼"></a>history æ¨¡å¼</h3><p>é€šè¿‡<code>window.history.pushState</code>API æ¥æ·»åŠ æµè§ˆå™¨å†å²è®°å½•ï¼Œç„¶åé€šè¿‡ç›‘å¬<code>popState</code>äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯ç›‘å¬å†å²è®°å½•çš„æ”¹å˜ï¼Œæ¥åŠ è½½ç›¸åº”çš„å†…å®¹ã€‚</p><ul><li>popstate äº‹ä»¶</li></ul><blockquote><p>å½“æ´»åŠ¨å†å²è®°å½•æ¡ç›®æ›´æ”¹æ—¶ï¼Œå°†è§¦å‘ popstate äº‹ä»¶ã€‚å¦‚æœè¢«æ¿€æ´»çš„å†å²è®°å½•æ¡ç›®æ˜¯é€šè¿‡å¯¹ history.pushState()çš„è°ƒç”¨åˆ›å»ºçš„ï¼Œæˆ–è€…å—åˆ°å¯¹ history.replaceState()çš„è°ƒç”¨çš„å½±å“ï¼Œpopstate äº‹ä»¶çš„ state å±æ€§åŒ…å«å†å²æ¡ç›®çš„çŠ¶æ€å¯¹è±¡çš„å‰¯æœ¬ã€‚</p></blockquote><ul><li>History.pushState()æ–¹æ³•</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">window.history.pushState(state, title, url)</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ç”¨äºåœ¨å†å²ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stateï¼šä¸€ä¸ªä¸æ·»åŠ çš„è®°å½•ç›¸å…³è”çš„çŠ¶æ€å¯¹è±¡ï¼Œä¸»è¦ç”¨äºpopstateäº‹ä»¶ã€‚è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šä¼ å…¥å›è°ƒå‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨ä¼šå°†è¿™ä¸ªå¯¹è±¡åºåˆ—åŒ–ä»¥åä¿ç•™åœ¨æœ¬åœ°ï¼Œé‡æ–°è½½å…¥è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡ã€‚å¦‚æœä¸éœ€è¦è¿™ä¸ªå¯¹è±¡ï¼Œæ­¤å¤„å¯ä»¥å¡«nullã€‚</span><br><span class="line">titleï¼šæ–°é¡µé¢çš„æ ‡é¢˜ã€‚ä½†æ˜¯ï¼Œç°åœ¨æ‰€æœ‰æµè§ˆå™¨éƒ½å¿½è§†è¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å¡«ç©ºå­—ç¬¦ä¸²ã€‚</span><br><span class="line">urlï¼šæ–°çš„ç½‘å€ï¼Œå¿…é¡»ä¸å½“å‰é¡µé¢å¤„åœ¨åŒä¸€ä¸ªåŸŸã€‚æµè§ˆå™¨çš„åœ°å€æ å°†æ˜¾ç¤ºè¿™ä¸ªç½‘å€ã€‚</span><br></pre></td></tr></table></figure><h3 id="hash-æ¨¡å¼"><a href="#hash-æ¨¡å¼" class="headerlink" title="hash æ¨¡å¼"></a>hash æ¨¡å¼</h3><p>ä½¿ç”¨ URL çš„ hash æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ URLã€‚ï¼Œé€šè¿‡ç›‘å¬<code>hashchange</code>äº‹ä»¶ï¼Œç„¶åæ ¹æ®<code>hash</code>å€¼ï¼ˆå¯é€šè¿‡ window.location.hash å±æ€§è¯»å–ï¼‰å»åŠ è½½å¯¹åº”çš„å†…å®¹çš„ã€‚</p><p>ç»§ç»­å¢åŠ ä»£ç ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HistoryRoute</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.current = <span class="literal">null</span> <span class="comment">// å½“å‰è·¯å¾„</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.mode = options.mode || <span class="string">'hash'</span></span><br><span class="line">    <span class="keyword">this</span>.routes = options.routes || []</span><br><span class="line">    <span class="keyword">this</span>.routesMap = <span class="keyword">this</span>.createMap(<span class="keyword">this</span>.routes)</span><br><span class="line">    <span class="keyword">this</span>.history = <span class="keyword">new</span> HistoryRoute() <span class="comment">// å½“å‰è·¯ç”±</span></span><br><span class="line">    <span class="keyword">this</span>.initRoute() <span class="comment">// åˆå§‹åŒ–è·¯ç”±å‡½æ•°</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createMap(routes) &#123;</span><br><span class="line">    <span class="keyword">return</span> routes.reduce(<span class="function">(<span class="params">pre, current</span>) =&gt;</span> &#123;</span><br><span class="line">      pre[current.path] = current.component</span><br><span class="line">      <span class="keyword">return</span> pre</span><br><span class="line">    &#125;, &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  initRoute() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mode === <span class="string">'hash'</span>) &#123;</span><br><span class="line">      <span class="comment">// å…ˆåˆ¤æ–­ç”¨æˆ·æ‰“å¼€æ—¶æœ‰æ²¡æœ‰hashå€¼ï¼Œæ²¡æœ‰çš„è¯è·³è½¬åˆ° #/</span></span><br><span class="line">      location.hash ? <span class="string">''</span> : (location.hash = <span class="string">'/'</span>)</span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.current = location.hash.slice(<span class="number">1</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.current = location.hash.slice(<span class="number">1</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// historyæ¨¡å¼</span></span><br><span class="line">      location.pathname ? <span class="string">''</span> : (location.pathname = <span class="string">'/'</span>)</span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.current = location.pathname</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.current = location.pathname</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VueRouter.install = <span class="function"><span class="keyword">function</span> (<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  Vue = _Vue</span><br><span class="line"></span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$options &amp;&amp; <span class="keyword">this</span>.$options.router) &#123;</span><br><span class="line">        <span class="keyword">this</span>._root = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">this</span>._router = <span class="keyword">this</span>.$options.router</span><br><span class="line">        Vue.util.defineReactive(<span class="keyword">this</span>, <span class="string">'_route'</span>, <span class="keyword">this</span>._router.history) <span class="comment">// ç›‘å¬historyè·¯å¾„å˜åŒ–</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._root) &#123;</span><br><span class="line">        <span class="keyword">this</span>._root = <span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._root</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å½“è®¿é—®this.$routeræ—¶å³è¿”å›routerå®ä¾‹</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, <span class="string">'$router'</span>, &#123;</span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>._root._router</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// å½“è®¿é—®this.$routeæ—¶å³è¿”å›å½“å‰é¡µé¢è·¯ç”±ä¿¡æ¯</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, <span class="string">'$route'</span>, &#123;</span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>._root._router.history.current</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> VueRouter</span><br></pre></td></tr></table></figure><h2 id="router-link-å’Œ-router-view-ç»„ä»¶"><a href="#router-link-å’Œ-router-view-ç»„ä»¶" class="headerlink" title="router-link å’Œ router-view ç»„ä»¶"></a>router-link å’Œ router-view ç»„ä»¶</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">VueRouter.install = <span class="function"><span class="keyword">function</span> (<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  Vue = _Vue</span><br><span class="line"></span><br><span class="line">  Vue.component(<span class="string">'router-link'</span>, &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      to: &#123;</span><br><span class="line">        type: [<span class="built_in">String</span>, <span class="built_in">Object</span>],</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      tag: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="string">'a'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleClick(event) &#123;</span><br><span class="line">        <span class="comment">// é˜»æ­¢aæ ‡ç­¾é»˜è®¤è·³è½¬</span></span><br><span class="line">        event &amp;&amp; event.preventDefault &amp;&amp; event.preventDefault()</span><br><span class="line">        <span class="keyword">let</span> mode = <span class="keyword">this</span>._self._root._router.mode</span><br><span class="line">        <span class="keyword">let</span> path = <span class="keyword">this</span>.to</span><br><span class="line">        <span class="keyword">this</span>._self._root._router.history.current = path</span><br><span class="line">        <span class="keyword">if</span> (mode === <span class="string">'hash'</span>) &#123;</span><br><span class="line">          <span class="built_in">window</span>.history.pushState(<span class="literal">null</span>, <span class="string">''</span>, <span class="string">'#/'</span> + path.slice(<span class="number">1</span>))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">window</span>.history.pushState(<span class="literal">null</span>, <span class="string">''</span>, path.slice(<span class="number">1</span>))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    render(h) &#123;</span><br><span class="line">      <span class="keyword">let</span> mode = <span class="keyword">this</span>._self._root._router.mode</span><br><span class="line">      <span class="keyword">let</span> tag = <span class="keyword">this</span>.tag || <span class="string">'a'</span></span><br><span class="line">      <span class="keyword">let</span> to = mode === <span class="string">'hash'</span> ? <span class="string">'#'</span> + <span class="keyword">this</span>.to : <span class="keyword">this</span>.to</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'render'</span>, <span class="keyword">this</span>.to)</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;tag on-click=&#123;<span class="keyword">this</span>.handleClick&#125; href=&#123;to&#125;&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.$slots.default&#125;</span><br><span class="line">        &lt;<span class="regexp">/tag&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ return h(tag, &#123; attrs: &#123; href: to &#125;, on: &#123; click: this.handleClick &#125; &#125;, this.$slots.default)</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  Vue.component('router-view', &#123;</span></span><br><span class="line"><span class="regexp">    render(h) &#123;</span></span><br><span class="line"><span class="regexp">      let current = this._self._root._router.history.current /</span><span class="regexp">/ currentå·²ç»æ˜¯åŠ¨æ€å“åº”</span></span><br><span class="line"><span class="regexp">      let routesMap = this._self._root._router.routesMap</span></span><br><span class="line"><span class="regexp">      return h(routesMap[current]) /</span><span class="regexp">/ åŠ¨æ€æ¸²æŸ“å¯¹åº”ç»„ä»¶</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€æ˜“çš„<code>vue-router</code>å°±å®ç°å®Œäº†ï¼Œæ¡ˆä¾‹å®Œæ•´ä»£ç é™„ä¸Šï¼š<a href="https://github.com/Jacky-Summer/mini-vue-router/blob/master/src/myrouter.js" target="_blank" rel="noopener">mini-vue-router</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Vue ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>Vue</tag>
        <tag>Vue Router</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™ç®€æ˜“çš„ Vuex</title>
    <url>/2020/10/08/%E6%89%8B%E5%86%99%E7%AE%80%E6%98%93%E7%9A%84-Vuex/</url>
    <content><![CDATA[<p>æœ¬æ–‡é€‚åˆä½¿ç”¨è¿‡ Vuex çš„äººé˜…è¯»ï¼Œæ¥äº†è§£ä¸‹æ€ä¹ˆè‡ªå·±å®ç°ä¸€ä¸ª Vuexã€‚</p><a id="more"></a><h2 id="åŸºæœ¬éª¨æ¶"><a href="#åŸºæœ¬éª¨æ¶" class="headerlink" title="åŸºæœ¬éª¨æ¶"></a>åŸºæœ¬éª¨æ¶</h2><p>è¿™æ˜¯æœ¬é¡¹ç›®çš„<code>src/store/index.js</code>æ–‡ä»¶ï¼Œçœ‹çœ‹ä¸€èˆ¬ vuex çš„ä½¿ç”¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'./myvuex'</span> <span class="comment">// å¼•å…¥è‡ªå·±å†™çš„ vuex</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> getters <span class="keyword">from</span> <span class="string">'./getters'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">'./state'</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex) <span class="comment">// Vue.use(plugin)æ–¹æ³•ä½¿ç”¨vuexæ’ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vuex å¯¼å‡ºä¸€ä¸ªç±»å«Storeï¼Œå¹¶ä¼ å…¥å¯¹è±¡ä½œä¸ºå‚æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>Vue.use</code>çš„ç”¨æ³•ï¼š</p><blockquote><p>å®‰è£… Vue.js æ’ä»¶ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æä¾› install æ–¹æ³•ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«ä½œä¸º install æ–¹æ³•ã€‚install æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå°† Vue ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Vue æ„é€ å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹å¯¹è±¡ã€‚</p></blockquote><ul><li>è¯¥æ–¹æ³•éœ€è¦åœ¨è°ƒç”¨ new Vue() ä¹‹å‰è¢«è°ƒç”¨ã€‚</li><li>å½“ install æ–¹æ³•è¢«åŒä¸€ä¸ªæ’ä»¶å¤šæ¬¡è°ƒç”¨ï¼Œæ’ä»¶å°†åªä¼šè¢«å®‰è£…ä¸€æ¬¡ã€‚</li></ul><p>å³æ˜¯æˆ‘ä»¬éœ€è¦åœ¨<code>./myvuex.js</code>ä¸­å¯¼å‡º <code>install</code>æ–¹æ³•ï¼ŒåŒæ—¶å¯¼å‡ºä¸€ä¸ªç±»<code>Store</code>ï¼Œäºæ˜¯ç¬¬ä¸€æ­¥å¯ä»¥å†™å‡ºä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  Vue = _Vue <span class="comment">// ä¸Šé¢Storeç±»éœ€è¦èƒ½è·å–åˆ°Vue</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  Store,</span><br><span class="line">  install,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="install-æ–¹æ³•"><a href="#install-æ–¹æ³•" class="headerlink" title="install æ–¹æ³•"></a>install æ–¹æ³•</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨ vuex çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªç»„ä»¶ä¸Šé¢éƒ½æœ‰ä¸€ä¸ª<code>this.$store</code>å±æ€§ï¼Œé‡Œé¢åŒ…å«äº† stateï¼Œmutationsï¼Œ actionsï¼Œ getters ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨æ¯ä¸ªç»„ä»¶ä¸Šéƒ½æŒ‚è½½ä¸€ä¸ª$store å±æ€§,è¦è®©æ¯ä¸€ä¸ªç»„ä»¶éƒ½èƒ½è·å–åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>Vue.mixin(mixin)</code>ï¼Œç”¨æ³•ä»‹ç»å¦‚ä¸‹ï¼š</p><blockquote><p>å…¨å±€æ³¨å†Œä¸€ä¸ªæ··å…¥ï¼Œå½±å“æ³¨å†Œä¹‹åæ‰€æœ‰åˆ›å»ºçš„æ¯ä¸ª Vue å®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨æ··å…¥å‘ç»„ä»¶æ³¨å…¥è‡ªå®šä¹‰çš„è¡Œä¸ºï¼Œå®ƒå°†å½±å“æ¯ä¸€ä¸ªä¹‹ååˆ›å»ºçš„ Vue å®ä¾‹ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  Vue = _Vue <span class="comment">// installæ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå°†Vueä½œä¸ºå‚æ•°ä¼ å…¥ï¼ˆä¸Šé¢Storeç±»éœ€è¦ç”¨åˆ°Vueï¼‰</span></span><br><span class="line">  <span class="comment">// å®ç°æ¯ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½èƒ½é€šè¿‡thisè°ƒç”¨$store</span></span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="comment">// é€šè¿‡this.$optionså¯ä»¥è·å–new Vue(&#123;å‚æ•°&#125;) ä¼ é€’çš„å‚æ•°</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$options &amp;&amp; <span class="keyword">this</span>.$options.store) &#123;</span><br><span class="line">        <span class="comment">// è¯æ˜è¿™ä¸ªthisæ˜¯æ ¹å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯new Vueäº§ç”Ÿçš„é‚£ä¸ªå®ä¾‹</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$options.store</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent.$store) &#123;</span><br><span class="line">        <span class="comment">// å­ç»„ä»¶è·å–çˆ¶ç»„ä»¶çš„$storeå±æ€§</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$parent.$store</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p>ç”±äº Vuex æ˜¯åŸºäº Vue çš„å“åº”å¼åŸç†åŸºç¡€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®©æ•°æ®æ”¹å˜å¯åˆ·æ–°è§†å›¾ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ª vue å®ä¾‹<br>ç”±äº</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="comment">// options å³æ˜¯ Vuex.Store(&#123;&#125;)ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="comment">// vuex çš„æ ¸å¿ƒå°±æ˜¯å€Ÿç”¨äº†vueçš„å®ä¾‹ï¼Œå› ä¸ºvueçš„å®ä¾‹æ•°æ®å˜åŒ–ï¼Œä¼šåˆ·æ–°è§†å›¾</span></span><br><span class="line">    <span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        state: options.state,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// state</span></span><br><span class="line">    <span class="keyword">this</span>.state = vm.state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h2><p>æˆ‘ä»¬ä½¿ç”¨ vuex æ”¹å˜æ•°æ®æ—¶ï¼Œæ˜¯è§¦å‘ commit æ–¹æ³•ï¼Œå³æ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">this.$store.commit(&#39;eventName&#39;, &#39;å‚æ•°&#39; );</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬è¦å®ç°ä¸€ä¸ª<code>commit</code>æ–¹æ³•ï¼ŒæŠŠ Store æ„é€ å‡½æ•°ä¼ å…¥çš„ mutations åšä¸‹å¤„ç†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="comment">// å®ç° state ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// mutations</span></span><br><span class="line">    <span class="keyword">this</span>.mutations = &#123;&#125; <span class="comment">// å­˜å‚¨ä¼ è¿›æ¥çš„mutations</span></span><br><span class="line">    <span class="keyword">let</span> mutations = options.mutations || &#123;&#125;</span><br><span class="line">    <span class="comment">// å¾ªç¯å–å‡ºäº‹ä»¶åè¿›è¡Œå¤„ç†ï¼ˆmutations[äº‹ä»¶å]: æ‰§è¡Œæ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(mutations).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.mutations[key] = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">        mutations[key].call(<span class="keyword">this</span>, <span class="keyword">this</span>.state, params) <span class="comment">// ä¿®æ­£thisæŒ‡å‘</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  commit = <span class="function">(<span class="params">key, params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// keyä¸ºè¦è§¦å‘çš„äº‹ä»¶å</span></span><br><span class="line">    <span class="keyword">this</span>.mutations[key](params)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h2><p>è·Ÿä¸Šé¢çš„ commit æµç¨‹åŒç†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options = &#123;&#125;) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// actions</span></span><br><span class="line">    <span class="keyword">this</span>.actions = &#123;&#125;</span><br><span class="line">    <span class="keyword">let</span> actions = options.actions || &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(actions).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.actions[key] = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">        actions[key].call(<span class="keyword">this</span>, <span class="keyword">this</span>, params)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dispatch = <span class="function">(<span class="params">type, payload</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.actions[type](payload)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h2><p>getters å®é™…å°±æ˜¯è¿”å› state çš„å€¼ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™æ˜¯æ”¾åœ¨ computed å±æ€§ï¼Œæ¯ä¸€ä¸ª getter éƒ½æ˜¯å‡½æ•°å½¢å¼ï¼›</p><p>getters æ˜¯éœ€è¦åŒå‘ç»‘å®šçš„ã€‚ä½†ä¸éœ€è¦åŒå‘ç»‘å®šæ‰€æœ‰çš„ gettersï¼Œåªéœ€è¦ç»‘å®šé¡¹ç›®ä¸­äº‹ä»¶ä½¿ç”¨çš„ gettersã€‚</p><p>è¿™é‡Œä½¿ç”¨<code>Object.defineProperty()</code>æ–¹æ³•ï¼Œå®ƒä¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options = &#123;&#125;) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters</span></span><br><span class="line">    <span class="keyword">this</span>.getters = &#123;&#125;</span><br><span class="line">    <span class="keyword">let</span> getters = options.getters || &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(getters).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.getters, key, &#123;</span><br><span class="line">        <span class="keyword">get</span>: () =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> getters[key].call(<span class="keyword">this</span>, <span class="keyword">this</span>.state)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå·²ç»å¯ä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå·±å†™çš„ vuex åšä¸€äº›åŸºæœ¬æ“ä½œäº†ï¼Œä½†åªèƒ½é€šè¿‡<code>this.$store.xx</code>çš„å½¢å¼è°ƒç”¨ï¼Œæ•…éœ€è¦å†å®ç°æ–¹æ³•ã€‚</p><h2 id="map-è¾…åŠ©å‡½æ•°"><a href="#map-è¾…åŠ©å‡½æ•°" class="headerlink" title="map è¾…åŠ©å‡½æ•°"></a>map è¾…åŠ©å‡½æ•°</h2><p>å…ˆæ¥è¯´è¯´ mapState</p><p>æ²¡æœ‰ map è¾…åŠ©å‡½æ•°ä¹‹å‰è¿™æ ·ä½¿ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  count () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.count</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ˜ å°„çš„è®¡ç®—å±æ€§çš„åç§°ä¸ state çš„å­èŠ‚ç‚¹åç§°ç›¸åŒæ—¶ï¼Œç»™ mapState ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨å¯¹è±¡å±•å¼€è¿ç®—ç¬¦å°†æ­¤å¯¹è±¡æ··å…¥åˆ°å¤–éƒ¨å¯¹è±¡ä¸­</span></span><br><span class="line">  ...mapState([<span class="string">'count'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿™é‡Œç®€å•å°±åªå®ç°æ•°ç»„çš„æƒ…å†µ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapState = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.state[item]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åå‡ ä¸ª map è¾…åŠ©å‡½æ•°éƒ½æ˜¯ç±»ä¼¼</p><ul><li>mapGetters</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapGetters = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters[item]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mapMutations</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapMutations = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.commit(item, params)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mapActions</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapActions = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params">payload</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.dispatch(item, payload)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="comment">// vuex çš„æ ¸å¿ƒå°±æ˜¯å€Ÿç”¨äº†vueçš„å®ä¾‹ï¼Œå› ä¸ºvueçš„å®ä¾‹æ•°æ®å˜åŒ–ï¼Œä¼šåˆ·æ–°è§†å›¾</span></span><br><span class="line">    <span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        state: options.state,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// state</span></span><br><span class="line">    <span class="keyword">this</span>.state = vm.state</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mutations</span></span><br><span class="line">    <span class="keyword">this</span>.mutations = &#123;&#125; <span class="comment">// å­˜å‚¨ä¼ è¿›æ¥çš„mutations</span></span><br><span class="line">    <span class="keyword">let</span> mutations = options.mutations || &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(mutations).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.mutations[key] = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">        mutations[key].call(<span class="keyword">this</span>, <span class="keyword">this</span>.state, params)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// actions</span></span><br><span class="line">    <span class="keyword">this</span>.actions = &#123;&#125;</span><br><span class="line">    <span class="keyword">let</span> actions = options.actions || &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(actions).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.actions[key] = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">        actions[key].call(<span class="keyword">this</span>, <span class="keyword">this</span>, params)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters</span></span><br><span class="line">    <span class="keyword">this</span>.getters = &#123;&#125;</span><br><span class="line">    <span class="keyword">let</span> getters = options.getters || &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(getters).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.getters, key, &#123;</span><br><span class="line">        <span class="keyword">get</span>: () =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> getters[key].call(<span class="keyword">this</span>, <span class="keyword">this</span>.state)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  commit = <span class="function">(<span class="params">key, params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.mutations[key](params)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dispatch = <span class="function">(<span class="params">type, payload</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.actions[type](payload)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapState = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.state[item]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapGetters = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters[item]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapMutations = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.commit(item, params)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapActions = <span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  args.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="function"><span class="keyword">function</span> (<span class="params">payload</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.dispatch(item, payload)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  Vue = _Vue <span class="comment">// installæ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå°†Vueä½œä¸ºå‚æ•°ä¼ å…¥ï¼ˆä¸Šé¢Storeç±»éœ€è¦ç”¨åˆ°Vueï¼‰</span></span><br><span class="line">  <span class="comment">// å®ç°æ¯ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½èƒ½é€šè¿‡thisè°ƒç”¨$store</span></span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="comment">// é€šè¿‡this.$optionså¯ä»¥è·å–new Vue(&#123;å‚æ•°&#125;) ä¼ é€’çš„å‚æ•°</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$options &amp;&amp; <span class="keyword">this</span>.$options.store) &#123;</span><br><span class="line">        <span class="comment">// è¯æ˜è¿™ä¸ªthisæ˜¯æ ¹å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯new Vueäº§ç”Ÿçš„é‚£ä¸ªå®ä¾‹</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$options.store</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent.$store) &#123;</span><br><span class="line">        <span class="comment">// å­ç»„ä»¶è·å–çˆ¶ç»„ä»¶çš„$storeå±æ€§</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$parent.$store</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  Store,</span><br><span class="line">  install,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªé¡¹ç›®çš„æºç åœ°å€ï¼š<a href="https://github.com/Jacky-Summer/mini-vuex" target="_blank" rel="noopener">mini-vuex</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Vue ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>Vue</tag>
        <tag>Vuex</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ç°Vueä¸­EventBusé€šä¿¡æ–¹å¼</title>
    <url>/2020/10/07/%E5%AE%9E%E7%8E%B0Vue%E4%B8%ADEventBus%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p>Vue éçˆ¶å­ç»„ä»¶å¯ä»¥ç”¨ Event Bus é€šä¿¡ï¼Œç”¨èµ·æ¥å¾ˆç®€å•ä½†è¦ä¸åªæ˜¯ä¼šä½¿ç”¨ apiï¼Œè¿˜è¦æ‡‚å¤§è‡´åŸç†ï¼Œäºæ˜¯è‡ªå·±å®ç°äº†ä¸€ä¸‹ã€‚</p><a id="more"></a><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventBus</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>._events = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ³¨å†Œäº‹ä»¶</span></span><br><span class="line">  on(name, fn) &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="keyword">this</span>._events.get(name)</span><br><span class="line">    <span class="keyword">if</span> (!handler) &#123;</span><br><span class="line">      <span class="keyword">this</span>._events.set(name, [])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>._events.get(name).push(fn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="comment">   * å¯ä»¥ç”¨applyä¸callä¸¤ç§æ–¹æ³•,åœ¨å°‘æ•°å‚æ•°æ—¶callçš„æ€§èƒ½æ›´å¥½,å¤šä¸ªå‚æ•°æ—¶applyæ€§èƒ½æ›´å¥½</span></span><br><span class="line"><span class="comment">   * Nodeçš„Eventæ¨¡å—å°±åœ¨ä¸‰ä¸ªå‚æ•°ä»¥ä¸‹ç”¨callå¦åˆ™ç”¨apply.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  emit(name, ...args) &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="keyword">this</span>._events.get(name)</span><br><span class="line">    <span class="keyword">if</span> (!handler) <span class="keyword">return</span></span><br><span class="line">    handler.forEach(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (args.length &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">        cb.apply(<span class="keyword">this</span>, args)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cb.call(<span class="keyword">this</span>, ...args)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åªè¢«è§¦å‘ä¸€æ¬¡çš„äº‹ä»¶</span></span><br><span class="line">  once(name, fn) &#123;</span><br><span class="line">    <span class="keyword">const</span> cb = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (args.length &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">        fn.apply(<span class="keyword">this</span>, args)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fn.call(<span class="keyword">this</span>, ...args)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.off(name, cb)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.on(name, cb)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å–æ¶ˆäº‹ä»¶</span></span><br><span class="line">  off(name, fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">      <span class="comment">// æ²¡æœ‰ä¼ æŒ‡å®šå‡½æ•°å°±ç§»é™¤æ‰€æœ‰åŒåäº‹ä»¶</span></span><br><span class="line">      <span class="keyword">this</span>._events.delete(name)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="keyword">this</span>._events.get(name)</span><br><span class="line">    <span class="keyword">if</span> (!handler) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">let</span> fnIndex = handler.findIndex(<span class="function"><span class="params">cb</span> =&gt;</span> cb === fn)</span><br><span class="line">    handler.splice(fnIndex, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>._events.get(name).length) &#123;</span><br><span class="line">      <span class="keyword">this</span>._events.delete(name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>JavaScript</tag>
        <tag>ç»„ä»¶é€šä¿¡</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™é˜²æŠ–ä¸èŠ‚æµå‡½æ•°</title>
    <url>/2020/09/28/%E6%89%8B%E5%86%99%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<p>å‡½æ•°é˜²æŠ–ä¸èŠ‚æµç®—æ˜¯å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªç»†èŠ‚ç‚¹ï¼Œå¯èƒ½å¼€å‘å¤§å¤šæ•°æ˜¯ç”¨ç€ JS åº“é¡ºå¸¦çš„é˜²æŠ–èŠ‚æµå‡½æ•°ï¼Œä½†æˆ‘ä»¬å¿…é¡»ä¼šè‡ªå·±å†™å› ä¸ºæ²¡æœ‰å¿…è¦å› ä¸ºä¸€ä¸ªå‡½æ•°å¼•å…¥ä¸€ä¸ªåº“ã€‚</p><a id="more"></a><h2 id="é˜²æŠ–ä¸èŠ‚æµæ•ˆæœ"><a href="#é˜²æŠ–ä¸èŠ‚æµæ•ˆæœ" class="headerlink" title="é˜²æŠ–ä¸èŠ‚æµæ•ˆæœ"></a>é˜²æŠ–ä¸èŠ‚æµæ•ˆæœ</h2><p>è¿™æ˜¯åˆ«äººåšçš„ä¸€ä¸ªåŠ¨ç”»ï¼Œå¾ˆå®¹æ˜“å°±èƒ½ç†è§£åŒºåˆ«ï¼š<a href="http://demo.nimius.net/debounce_throttle/" target="_blank" rel="noopener">é˜²æŠ–ä¸èŠ‚æµ</a></p><h2 id="å‡½æ•°é˜²æŠ–-debounce"><a href="#å‡½æ•°é˜²æŠ–-debounce" class="headerlink" title="å‡½æ•°é˜²æŠ–(debounce)"></a>å‡½æ•°é˜²æŠ–(debounce)</h2><blockquote><p>åœ¨äº‹ä»¶è¢«è§¦å‘ n ç§’åå†æ‰§è¡Œå›è°ƒï¼Œå¦‚æœåœ¨è¿™ n ç§’å†…åˆè¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, wait = <span class="number">50</span>, immediate = false</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">debounced</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// thisä¿å­˜ç»™context</span></span><br><span class="line">    <span class="keyword">const</span> context = <span class="keyword">this</span></span><br><span class="line">    <span class="comment">// æ¯æ¬¡è°ƒç”¨debounceå‡½æ•°éƒ½ä¼šå°†å‰ä¸€æ¬¡çš„timeræ¸…ç©ºï¼Œç¡®ä¿åªæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">if</span> (timer) clearTimeout(timer)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// immediate ä¸º true è¡¨ç¤ºç¬¬ä¸€æ¬¡è§¦å‘åæ‰§è¡Œ</span></span><br><span class="line">    <span class="comment">// timer ä¸ºç©ºè¡¨ç¤ºé¦–æ¬¡è§¦å‘</span></span><br><span class="line">    <span class="keyword">if</span> (immediate &amp;&amp; !timer) &#123;</span><br><span class="line">      fn.apply(context, args)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      fn.apply(context, args)</span><br><span class="line">    &#125;, wait)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  debounced.cancel = <span class="function"><span class="keyword">function</span> <span class="title">cancel</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å–æ¶ˆåŠŸèƒ½</span></span><br><span class="line">    clearTimeout(timer)</span><br><span class="line">    timer = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> debounced</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>é€‚åˆå¤šæ¬¡äº‹ä»¶ä¸€æ¬¡å“åº”çš„æƒ…å†µ</p><ul><li>search æœç´¢è”æƒ³ï¼Œç”¨æˆ·åœ¨ä¸æ–­è¾“å…¥å€¼è¿›è¡Œ AJAX éªŒè¯æ—¶æ—¶ï¼Œç”¨é˜²æŠ–æ¥èŠ‚çº¦è¯·æ±‚èµ„æºã€‚</li><li>æŒ‰é’®ç‚¹å‡»äº‹ä»¶/input äº‹ä»¶ï¼Œé˜²æ­¢ç”¨æˆ·å¤šæ¬¡é‡å¤æäº¤</li><li>ç”µè¯å·ç è¾“å…¥çš„éªŒè¯ï¼Œ åªéœ€åœæ­¢è¾“å…¥åè¿›è¡Œä¸€æ¬¡ã€‚</li></ul><h2 id="å‡½æ•°èŠ‚æµ-throttle"><a href="#å‡½æ•°èŠ‚æµ-throttle" class="headerlink" title="å‡½æ•°èŠ‚æµ(throttle)"></a>å‡½æ•°èŠ‚æµ(throttle)</h2><blockquote><p>è§„å®šä¸€ä¸ªå•ä½æ—¶é—´ï¼Œåœ¨è¿™ä¸ªå•ä½æ—¶é—´å†…ï¼Œåªèƒ½æœ‰ä¸€æ¬¡è§¦å‘äº‹ä»¶çš„å›è°ƒå‡½æ•°æ‰§è¡Œï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªå•ä½æ—¶é—´å†…æŸäº‹ä»¶è¢«è§¦å‘å¤šæ¬¡ï¼Œåªæœ‰ä¸€æ¬¡èƒ½ç”Ÿæ•ˆã€‚</p></blockquote><h3 id="å®šæ—¶å™¨ç‰ˆ"><a href="#å®šæ—¶å™¨ç‰ˆ" class="headerlink" title="å®šæ—¶å™¨ç‰ˆ"></a>å®šæ—¶å™¨ç‰ˆ</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">func, wait</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timeout = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">throttled</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">if</span> (!timeout) &#123;</span><br><span class="line">      timeout = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        func.apply(ctx, args)</span><br><span class="line">        timeout = <span class="literal">null</span></span><br><span class="line">      &#125;, wait)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´æˆ³èŠ‚æµ"><a href="#æ—¶é—´æˆ³èŠ‚æµ" class="headerlink" title="æ—¶é—´æˆ³èŠ‚æµ"></a>æ—¶é—´æˆ³èŠ‚æµ</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">func, wait</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> previous = <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">throttled</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">const</span> now = <span class="built_in">Date</span>.now()</span><br><span class="line">    <span class="keyword">const</span> remain = wait - (now - previous)</span><br><span class="line">    <span class="keyword">if</span> (remain &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      func.apply(ctx, args)</span><br><span class="line">      previous = now</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨åœºæ™¯-1"><a href="#åº”ç”¨åœºæ™¯-1" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>é€‚åˆå¤§é‡äº‹ä»¶æŒ‰æ—¶é—´åšå¹³å‡åˆ†é…è§¦å‘ã€‚</p><ul><li>ç›‘å¬æ»šåŠ¨æˆ– resize äº‹ä»¶ï¼Œæ¯”å¦‚æ˜¯å¦æ»‘åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šï¼Œè°ƒæ•´çª—å£å¤§å°ç”¨ throttle æ¥åˆ¤æ–­</li><li>DOM å…ƒç´ æ‹–æ‹½</li><li>è‡ªåŠ¨ä¿å­˜è‰ç¨¿åŠŸèƒ½ï¼Œå½“ç”¨æˆ·åœ¨è¾“å…¥çš„æ—¶å€™(ä¸€ç›´è§¦å‘äº‹ä»¶),å•ä½æ—¶é—´å†…åªä¿å­˜ä¸€æ¬¡è‰ç¨¿</li><li>Canvas ç”»ç¬”åŠŸèƒ½</li><li>æ¸¸æˆä¸­çš„åˆ·æ–°ç‡</li></ul>]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>JavaScript</tag>
        <tag>debounce</tag>
        <tag>throttle</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ‰‹ææ‡‚ HTTP ç¼“å­˜æœºåˆ¶</title>
    <url>/2020/09/27/%E5%8A%A8%E6%89%8B%E6%90%9E%E6%87%82-HTTP-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>HTTP ç¼“å­˜ç­–ç•¥ç›¸ä¿¡å¤§å®¶éƒ½æœ‰ä¸€å®šçš„äº†è§£ï¼Œä½†è‡ªå·±è®²çš„è¯ä¹Ÿæ˜¯å¤§æ¦‚æ¨¡ç³Šçš„ç†è§£ã€‚äºæ˜¯ï¼Œåˆå›åˆ°é‡æ–°å½’çº³çš„ç¯èŠ‚äº†ï¼Œè¿™æ¬¡ï¼Œææ‡‚å®ƒï¼</p>
<a id="more"></a>

<h2 id="æµè§ˆå™¨ç¼“å­˜çš„ä½œç”¨"><a href="#æµè§ˆå™¨ç¼“å­˜çš„ä½œç”¨" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜çš„ä½œç”¨"></a>æµè§ˆå™¨ç¼“å­˜çš„ä½œç”¨</h2><ol>
<li>ç¼“å­˜å¯ä»¥å‡å°‘å†—ä½™çš„æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœäº†ç½‘ç»œå¸¦å®½ï¼Œä»è€Œæ›´å¿«çš„åŠ è½½é¡µé¢ä»¥åŠå‡å°‘ç”¨æˆ·çš„æµé‡æ¶ˆè€—</li>
<li>ç¼“å­˜é™ä½äº†æœåŠ¡å™¨çš„è¦æ±‚ï¼Œä»è€Œè®©æœåŠ¡å™¨æ›´å¿«çš„å“åº”ã€‚</li>
</ol>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æµè§ˆå™¨ç¼“å­˜ç­–ç•¥åˆ†ä¸ºä¸¤ç§ï¼š<strong>å¼ºç¼“å­˜</strong>å’Œ<strong>åå•†ç¼“å­˜</strong>ã€‚ä¸€çœ‹åˆ°å¼ºç¼“å­˜ï¼Œå°±å¯èƒ½è”æƒ³åˆ°â€å¼±ç¼“å­˜â€ï¼Œè¿™ä¸ªâ€å¼ºâ€å®é™…å½¢å®¹å¾—ä¸å¤ªæ°å½“ï¼Œå…¶å®å¼ºç¼“å­˜æŒ‡çš„æ˜¯æ–°é²œçš„å“åº”ï¼Œè€Œåå•†ç¼“å­˜æŒ‡çš„æ˜¯é™ˆæ—§çš„å“åº”ï¼ˆå·²è¿‡æœŸï¼‰ï¼Œè€Œè¦å¤ç”¨é™ˆæ—§çš„å“åº”å°±å¾—ä½¿ç”¨æ¡ä»¶è¯·æ±‚ï¼ˆIf-xxxï¼‰è¿›è¡Œç¼“å­˜éªŒè¯ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼šè®²ã€‚</p>
<h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><ol>
<li>æµè§ˆå™¨åœ¨åŠ è½½èµ„æºæ—¶ï¼Œæ ¹æ®è¯·æ±‚å¤´çš„ Expires å’Œ Cache-Control åˆ¤æ–­æ˜¯å¦å‘½ä¸­å¼ºç¼“å­˜ï¼Œæ˜¯åˆ™ç›´æ¥ä»ç¼“å­˜è¯»å–èµ„æºï¼Œä¸ä¼šå‘è¯·æ±‚åˆ°æœåŠ¡å™¨ã€‚</li>
<li>å¦‚æœæ²¡æœ‰å‘½ä¸­å¼ºç¼“å­˜ï¼Œæµè§ˆå™¨ä¸€å®šä¼šå‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡ Last-Modified å’Œ ETag éªŒè¯èµ„æºæ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­ï¼Œåˆ™è¿”å› 304 è¯»å–ç¼“å­˜èµ„æº</li>
<li>å¦‚æœå‰é¢ä¸¤è€…éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œç›´æ¥ä»æœåŠ¡å™¨è¯·æ±‚åŠ è½½èµ„æº</li>
</ol>
<h2 id="ç¼“å­˜çš„æ–‡ä»¶åˆ°å“ªé‡Œå»"><a href="#ç¼“å­˜çš„æ–‡ä»¶åˆ°å“ªé‡Œå»" class="headerlink" title="ç¼“å­˜çš„æ–‡ä»¶åˆ°å“ªé‡Œå»"></a>ç¼“å­˜çš„æ–‡ä»¶åˆ°å“ªé‡Œå»</h2><p>ä¸€èˆ¬çœ‹åˆ°çš„ä¸¤ç§ï¼šmemory cacheï¼ˆå†…å­˜ç¼“å­˜ï¼‰ å’Œ disk cacheï¼ˆç¡¬ç›˜ç¼“å­˜ï¼‰</p>
<ul>
<li><p><strong>200 from memory cache</strong>ï¼šå®ƒæ˜¯å°†èµ„æºæ–‡ä»¶ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯ç›´æ¥ä»å†…å­˜ä¸­è¯»å–æ•°æ®ã€‚ä½†è¯¥æ–¹å¼é€€å‡ºè¿›ç¨‹æ—¶æ•°æ®ä¼šè¢«æ¸…é™¤ï¼Œå¦‚å…³é—­æµè§ˆå™¨ï¼›ä¸€èˆ¬ä¼šå°†å°†è„šæœ¬ã€å­—ä½“ã€å›¾ç‰‡ä¼šå­˜å‚¨åˆ°å†…å­˜ç¼“å­˜ä¸­ã€‚</p>
</li>
<li><p><strong>200 from disk cache</strong>ï¼šå®ƒæ˜¯å°†èµ„æºæ–‡ä»¶ç¼“å­˜åˆ°ç¡¬ç›˜ä¸­ã€‚å…³é—­æµè§ˆå™¨åï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨ï¼›ä¸€èˆ¬ä¼šå°†éè„šæœ¬çš„å­˜æ”¾åœ¨ç¡¬ç›˜ä¸­ï¼Œæ¯”å¦‚ cssã€‚</p>
</li>
</ul>
<p>ä¼˜å…ˆè®¿é—® memory cacheï¼Œå…¶æ¬¡æ˜¯ disk cacheï¼Œæœ€åæ˜¯è¯·æ±‚ç½‘ç»œèµ„æºï¼›ä¸”å†…å­˜è¯»å–é€Ÿåº¦æ¯”ç¡¬ç›˜è¯»å–é€Ÿåº¦å¿«ï¼Œä½†ä¹Ÿä¸èƒ½æŠŠæ‰€æœ‰æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œå› ä¸ºå†…å­˜ä¹Ÿæ˜¯æœ‰é™çš„ã€‚</p>
<h2 id="é€šè¿‡-express-æ­å»ºæœåŠ¡æ¨¡æ‹Ÿæ¼”ç¤º"><a href="#é€šè¿‡-express-æ­å»ºæœåŠ¡æ¨¡æ‹Ÿæ¼”ç¤º" class="headerlink" title="é€šè¿‡ express æ­å»ºæœåŠ¡æ¨¡æ‹Ÿæ¼”ç¤º"></a>é€šè¿‡ express æ­å»ºæœåŠ¡æ¨¡æ‹Ÿæ¼”ç¤º</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.send(<span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">  &lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">  &lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Init Demo&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">    Hello Init Demo</span></span><br><span class="line"><span class="string">    &lt;script src="/test.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/test.js'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> sourcePath = path.resolve(__dirname, <span class="string">'../public/test.js'</span>)</span><br><span class="line">  <span class="keyword">let</span> result = fs.readFileSync(sourcePath)</span><br><span class="line">  res.end(result)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'listening on 3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šä»£ç ï¼Œå½“è¿›å…¥<code>http://localhost:3000/</code>ï¼Œè¯·æ±‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æµè§ˆå™¨è¯·æ±‚é™æ€èµ„æº <code>test.js</code></li>
<li>æœåŠ¡å™¨è¯»å–ç£ç›˜æ–‡ä»¶ <code>test.js</code>ï¼Œè¿”å›ç»™æµè§ˆå™¨</li>
<li>æµè§ˆå™¨å†æ¬¡è¯·æ±‚ï¼ŒæœåŠ¡å™¨åˆé‡æ–°è¯»å–ç£ç›˜æ–‡ä»¶ <code>test.js</code>ï¼Œè¿”ç»™æµè§ˆå™¨ã€‚</li>
</ul>
<p>å¤šæ¬¡åˆ·æ–°ç½‘é¡µï¼Œé‡æ–°è¿›å…¥ï¼Œå¯ä»¥çœ‹åˆ°æ¯æ¬¡éƒ½é‡æ–°å‘äº†<code>test.js</code>çš„è¯·æ±‚ï¼Œè¿™ç§æ–¹å¼ä¸‹æ²¡æœ‰è¿›è¡Œä»»ä½•ç¼“å­˜ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa0b4111b21043629107fb09c50533d8~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="å¼ºç¼“å­˜"><a href="#å¼ºç¼“å­˜" class="headerlink" title="å¼ºç¼“å­˜"></a>å¼ºç¼“å­˜</h2><p>å¼ºç¼“å­˜é€šè¿‡ Expires å’Œ Cache-Control ä¸¤ç§å“åº”å¤´å®ç°</p>
<p>åŸç†ï¼š</p>
<blockquote>
<p>æµè§ˆå™¨åœ¨åŠ è½½èµ„æºçš„æ—¶å€™ï¼Œä¼šå…ˆæ ¹æ®æœ¬åœ°ç¼“å­˜èµ„æºçš„ header ä¸­çš„ä¿¡æ¯(Expires å’Œ Cache-Control)æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å¼ºåˆ¶ç¼“å­˜ã€‚å¦‚æœå‘½ä¸­çš„è¯ï¼Œåˆ™ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„èµ„æºã€‚å¦åˆ™çš„è¯ï¼Œä¼šç»§ç»­å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</p>
</blockquote>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>Expires æ˜¯ HTTP1.0 çš„è§„èŒƒï¼Œè¡¨ç¤ºè¯¥èµ„æºè¿‡æœŸæ—¶é—´ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´ï¼ˆå€¼ä¸º GMT æ—¶é—´ï¼Œå³æ ¼æ—å°¼æ²»æ—¶é—´ï¼‰ï¼Œç”±æœåŠ¡å™¨è¿”å›ã€‚</p>
<p>å¦‚æœæµè§ˆå™¨ç«¯å½“å‰æ—¶é—´å°äºè¿‡æœŸæ—¶é—´ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">'/test.js'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> sourcePath = path.resolve(__dirname, <span class="string">'../public/test.js'</span>)</span><br><span class="line">  <span class="keyword">let</span> result = fs.readFileSync(sourcePath)</span><br><span class="line">  res.setHeader(</span><br><span class="line">    <span class="string">'Expires'</span>,</span><br><span class="line">    moment().utc().add(<span class="number">1</span>, <span class="string">'m'</span>).format(<span class="string">'ddd, DD MMM YYYY HH:mm:ss'</span>) + <span class="string">' GMT'</span> <span class="comment">// è®¾ç½®1åˆ†é’Ÿåè¿‡æœŸ</span></span><br><span class="line">  )</span><br><span class="line">  res.end(result)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç æˆ‘ä»¬æ·»åŠ äº† Expires å“åº”å¤´ï¼Œç¬¬ä¸€æ¬¡å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚åï¼ŒåŒæ—¶è¿”å›è¿‡æœŸæ—¶é—´å’Œæ–‡ä»¶ï¼›å½“å†æ¬¡åˆ·æ–°æ—¶ï¼Œå°±ä¼šçœ‹åˆ°æ–‡ä»¶æ˜¯ç›´æ¥ä»ç¼“å­˜(memory cache)ä¸­è¯»å–çš„ï¼›å½“ 1 åˆ†é’Ÿè¿‡åè¿‡æœŸäº†ï¼Œåˆä¼šé‡æ–°è¯·æ±‚äº†ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/184fe17b6c1444b58214d8d20e33b1e5~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>è¿™ç§æ–¹å¼å—é™äºæœ¬åœ°æ—¶é—´ï¼ŒæœåŠ¡å™¨çš„æ—¶é—´å’Œå®¢æˆ·ç«¯çš„æ—¶é—´ä¸ä¸€æ ·çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚æµè§ˆå™¨è®¾ç½®äº†å¾ˆåçš„æ—¶é—´ï¼Œåˆ™ä¸€ç›´å¤„äºè¿‡æœŸçŠ¶æ€ï¼‰ï¼Œå¯èƒ½ä¼šé€ æˆç¼“å­˜å¤±æ•ˆã€‚è€Œä¸”è¿‡æœŸåï¼Œä¸ç®¡æ–‡ä»¶æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒæœåŠ¡å™¨éƒ½ä¼šå†æ¬¡è¯»å–æ–‡ä»¶è¿”å›ç»™æµè§ˆå™¨ã€‚</p>
<p>Expires æ˜¯ HTTP 1.0 çš„ä¸œè¥¿ï¼Œç°åœ¨é»˜è®¤æµè§ˆå™¨å¤§éƒ¨åˆ†ä½¿ç”¨ HTTP 1.1ï¼Œå®ƒçš„ä½œç”¨åŸºæœ¬å¿½ç•¥ï¼Œå› ä¸ºä¼šé <code>Cache-Control</code>ä½œä¸ºä¸»è¦åˆ¤æ–­ä¾æ®ã€‚</p>
<h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p>çŸ¥é“äº† <code>Expires</code>çš„ç¼ºç‚¹åï¼Œåœ¨ HTTP 1.1 ç‰ˆå¼€å§‹ï¼Œå°±åŠ å…¥äº†<code>Cache-Control</code>æ¥æ›¿ä»£ï¼Œå®ƒæ˜¯åˆ©ç”¨<code>max-age</code>åˆ¤æ–­ç¼“å­˜æ—¶é—´çš„ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå®ƒçš„ä¼˜å…ˆçº§é«˜äº <code>Expires</code>ï¼Œè¡¨ç¤ºçš„æ˜¯ç›¸å¯¹æ—¶é—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ<code>max-age</code>å’Œ<code>Expires</code>åŒæ—¶å­˜åœ¨ï¼Œåˆ™è¢« Cache-Control çš„ max-age è¦†ç›–ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">'/test.js'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> sourcePath = path.resolve(__dirname, <span class="string">'../public/test.js'</span>)</span><br><span class="line">  <span class="keyword">let</span> result = fs.readFileSync(sourcePath)</span><br><span class="line">  res.setHeader(<span class="string">'Cache-Control'</span>, <span class="string">'max-age=60'</span>) <span class="comment">// è®¾ç½®ç›¸å¯¹æ—¶é—´-60ç§’è¿‡æœŸ</span></span><br><span class="line">  res.end(result)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ç¬¬ä¸€æ¬¡è¯·æ±‚åå†æ¬¡è¯·æ±‚ï¼Œå°±å¯ä»¥çœ‹åˆ°æ˜¯å‘½ä¸­åå•†ç¼“å­˜äº†ã€‚<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60cdeeb8bdd34665975bfe90f0a8cd0a~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>é™¤äº†è¯¥å­—æ®µï¼Œè¿˜æœ‰å…¶ä»–å­—æ®µå¯è®¾ç½®ï¼š</p>
<h4 id="public"><a href="#public" class="headerlink" title="public"></a>public</h4><p>è¡¨ç¤ºå¯ä»¥è¢«æµè§ˆå™¨å’Œä»£ç†æœåŠ¡å™¨ç¼“å­˜ï¼Œä»£ç†æœåŠ¡å™¨ä¸€èˆ¬å¯ç”¨ nginx æ¥åš</p>
<h4 id="private"><a href="#private" class="headerlink" title="private"></a>private</h4><p>åªè®©å®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜è¯¥èµ„æºï¼›ä»£ç†æœåŠ¡å™¨ä¸ç¼“å­˜</p>
<h4 id="no-cache"><a href="#no-cache" class="headerlink" title="no-cache"></a>no-cache</h4><p>è·³è¿‡è®¾ç½®å¼ºç¼“å­˜ï¼Œä½†æ˜¯ä¸å¦¨ç¢è®¾ç½®åå•†ç¼“å­˜ï¼›ä¸€èˆ¬å¦‚æœä½ åšäº†å¼ºç¼“å­˜ï¼Œåªæœ‰åœ¨å¼ºç¼“å­˜å¤±æ•ˆäº†æ‰èµ°åå•†ç¼“å­˜çš„ï¼Œè®¾ç½®äº† no-cache å°±ä¸ä¼šèµ°å¼ºç¼“å­˜äº†ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å›è¯¢é—®æœåŠ¡ç«¯ã€‚</p>
<h4 id="no-store"><a href="#no-store" class="headerlink" title="no-store"></a>no-store</h4><p>ç¦æ­¢ä½¿ç”¨ç¼“å­˜ï¼Œæ¯ä¸€æ¬¡éƒ½è¦é‡æ–°è¯·æ±‚æ•°æ®ã€‚</p>
<p>æ¯”å¦‚æˆ‘è®¾ç½®ç¦æ­¢ç¼“å­˜ï¼Œå†é‡å¤ä¸Šé¢æ“ä½œï¼Œå°±æ¯æ¬¡éƒ½å‘æœåŠ¡å™¨è¯·æ±‚äº†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">res.setHeader(<span class="string">'Cache-Control'</span>, <span class="string">'no-store, max-age=60'</span>) <span class="comment">// ç¦æ­¢ç¼“å­˜</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6b694c980734c649458db32c5966846~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h2><p>å¼ºç¼“å­˜çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡éƒ½æ ¹æ®æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œä½†å¦‚æœåˆ°äº†è¿‡æœŸæ—¶é—´åï¼Œæ–‡ä»¶æ²¡æœ‰æ”¹åŠ¨ï¼Œå†æ¬¡å»è·å–å°±æœ‰ç‚¹æµªè´¹æœåŠ¡å™¨çš„èµ„æºäº†ï¼Œå› æ­¤æœ‰äº†åå•†ç¼“å­˜ã€‚</p>
<p>å½“æµè§ˆå™¨å¯¹æŸä¸ªèµ„æºçš„è¯·æ±‚æ²¡æœ‰å‘½ä¸­å¼ºç¼“å­˜ï¼Œå°±ä¼šå‘ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒéªŒè¯åå•†ç¼“å­˜æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœåå•†ç¼“å­˜å‘½ä¸­ï¼Œè¯·æ±‚å“åº”è¿”å›çš„ http çŠ¶æ€ä¸º 304 å‘Šè¯‰æµè§ˆå™¨è¯»å–æ¢å‡ºï¼Œå¹¶ä¸”ä¼šæ˜¾ç¤ºä¸€ä¸ª Not Modified çš„å­—ç¬¦ä¸²ï¼›å¦‚æœæœªå‘½ä¸­ï¼Œåˆ™è¿”å›è¯·æ±‚çš„èµ„æºã€‚</p>
<p>åå•†ç¼“å­˜æ˜¯åˆ©ç”¨çš„æ˜¯<code>Last-Modified/If-Modified-Since</code>å’Œ<code>ETag/If-None-Match</code>è¿™ä¸¤å¯¹æ ‡è¯†æ¥ç®¡ç†çš„</p>
<p>åŸç†ï¼š</p>
<blockquote>
<p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šæ£€æµ‹æ˜¯å¦æœ‰å¯¹åº”çš„æ ‡è¯†ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„æ ‡è¯†ï¼ŒæœåŠ¡å™¨ç«¯ä¼šè¿”å›ä¸€ä¸ªå¯¹åº”çš„æ ‡è¯†ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼ŒæŠŠè¯¥æ ‡è¯†å¸¦è¿‡å»ï¼Œç„¶åæœåŠ¡å™¨ç«¯ä¼šéªŒè¯è¯¥æ ‡è¯†ï¼Œå¦‚æœéªŒè¯é€šè¿‡äº†ï¼Œåˆ™ä¼šå“åº” 304ï¼Œå‘Šè¯‰æµè§ˆå™¨è¯»å–ç¼“å­˜ã€‚å¦‚æœæ ‡è¯†æ²¡æœ‰é€šè¿‡ï¼Œåˆ™è¿”å›è¯·æ±‚çš„èµ„æºã€‚</p>
</blockquote>
<h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æµè§ˆå™¨è¯·æ±‚èµ„æºï¼ŒæœåŠ¡å™¨æ¯æ¬¡è¿”å›æ–‡ä»¶çš„åŒæ—¶ï¼Œè¿”å›<code>Last-Modified</code>(æœ€åçš„ä¿®æ”¹æ—¶é—´)åˆ° Header ä¸­</li>
<li>å½“æµè§ˆå™¨çš„ç¼“å­˜æ–‡ä»¶è¿‡æœŸåï¼Œæµè§ˆå™¨å¸¦ä¸Šè¯·æ±‚å¤´<code>If-Modified-Since</code>ï¼ˆå€¼ä¸ºä¸Šä¸€æ¬¡çš„<code>Last-Modified</code>ï¼‰è¯·æ±‚æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨æ¯”è¾ƒè¯·æ±‚å¤´çš„<code>If-Modified-Since</code>å’Œæ–‡ä»¶ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´ä¸€æ ·ï¼Œåˆ™å‘½ä¸­ç¼“å­˜è¿”å› 304ï¼›å¦‚æœä¸ä¸€è‡´å°±è¿”å› 200 å“åº”å’Œæ–‡ä»¶çš„å†…å®¹è¿˜æœ‰æ›´æ–°<code>Last-Modified</code>çš„å€¼ï¼Œä»¥æ­¤å¾€å¤ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">'/test.js'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> sourcePath = path.resolve(__dirname, <span class="string">'../public/test.js'</span>)</span><br><span class="line">  <span class="keyword">let</span> result = fs.readFileSync(sourcePath)</span><br><span class="line">  <span class="keyword">let</span> status = fs.statSync(sourcePath)</span><br><span class="line">  <span class="keyword">let</span> lastModified = status.mtime.toUTCString()</span><br><span class="line">  <span class="keyword">if</span> (lastModified === req.headers[<span class="string">'if-modified-since'</span>]) &#123;</span><br><span class="line">    res.writeHead(<span class="number">304</span>, <span class="string">'Not Modified'</span>)</span><br><span class="line">    res.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.setHeader(<span class="string">'Cache-Control'</span>, <span class="string">'max-age=1'</span>) <span class="comment">// è®¾ç½®1ç§’åè¿‡æœŸä»¥æ–¹ä¾¿æˆ‘ä»¬é©¬ä¸Šèƒ½ç”¨Last-Modifiedåˆ¤æ–­</span></span><br><span class="line">    res.setHeader(<span class="string">'Last-Modified'</span>, lastModified)</span><br><span class="line">    res.writeHead(<span class="number">200</span>, <span class="string">'OK'</span>)</span><br><span class="line">    res.end(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡è¯·æ±‚å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/387b188f62744390a631aecb9cb96aa9~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>1 ç§’è¿‡æœŸåï¼Œå†æ¬¡è¿›è¡Œå¤šæ¬¡è¯·æ±‚ï¼Œå‘ç°è¿”å›çš„éƒ½æ˜¯ 304ï¼Œå‘½ä¸­åå•†ç¼“å­˜ï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ae57f2487a241d799dcb136b16854cc~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>åœ¨å½“ä¸­æˆ‘é‡åˆ°äº†ä¸ªå°é—®é¢˜ï¼Œè¿˜æ˜¯æŠ¥çš„ 200 å“åº”ï¼Œè¯·æ±‚å¤´é‡Œæœ‰æ¡è­¦å‘Šä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Provisional headers are shown. Disable cache to see full headers.</span><br></pre></td></tr></table></figure>

<p>å¯èƒ½æ˜¯æ’ä»¶åŸå› å¯¼è‡´ï¼Œäºæ˜¯æˆ‘å¼€äº†æ— ç—•æ¨¡å¼å°±è§£å†³äº†ï¼ˆå¦‚æœå„ä½æœ‰å…¶ä»–åŸå› è§£é‡Šå’Œè§£å†³æ–¹æ³•å¯ä»¥ç•™è¨€å‘Šè¯‰æˆ‘ï¼‰</p>
<h3 id="ETag"><a href="#ETag" class="headerlink" title="ETag"></a>ETag</h3><p><code>Last-Modified</code> ä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ï¼Œæ¯”å¦‚ä¿®æ”¹æ—¶é—´æ˜¯ GMT æ—¶é—´ï¼Œåªèƒ½ç²¾ç¡®åˆ°ç§’ï¼Œå¦‚æœæ–‡ä»¶åœ¨ 1 ç§’å†…æœ‰å¤šæ¬¡æ”¹åŠ¨ï¼ŒæœåŠ¡å™¨å¹¶ä¸çŸ¥é“æ–‡ä»¶æœ‰æ”¹åŠ¨ï¼Œæµè§ˆå™¨æ‹¿ä¸åˆ°æœ€æ–°çš„æ–‡ä»¶ã€‚è€Œä¸”å¦‚æœæ–‡ä»¶è¢«ä¿®æ”¹ååˆæ’¤é”€ä¿®æ”¹äº†ï¼Œå†…å®¹è¿˜æ˜¯ä¿æŒåŸæ ·ï¼Œä½†æ˜¯æœ€åä¿®æ”¹æ—¶é—´å˜äº†ï¼Œä¹Ÿè¦é‡æ–°è¯·æ±‚ã€‚ä¹Ÿæœ‰å¯èƒ½å­˜åœ¨æœåŠ¡å™¨æ²¡æœ‰å‡†ç¡®è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œæˆ–ä¸ä»£ç†æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
<p>ä¸ºäº†è§£å†³æ–‡ä»¶ä¿®æ”¹æ—¶é—´ä¸ç²¾ç¡®å¸¦æ¥çš„é—®é¢˜ï¼ŒæœåŠ¡å™¨å’Œæµè§ˆå™¨å†æ¬¡åå•†ï¼Œè¿™æ¬¡ä¸è¿”å›æ—¶é—´ï¼Œè¿”å›æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†<code>ETag</code>ã€‚åªæœ‰å½“æ–‡ä»¶å†…å®¹æ”¹å˜æ—¶ï¼Œ<code>ETag</code>æ‰æ”¹å˜ã€‚<code>ETag</code>çš„ä¼˜å…ˆçº§é«˜äº<code>Last-Modified</code>ã€‚</p>
<p>è¿‡ç¨‹å¦‚ä¸‹:</p>
<ul>
<li>æµè§ˆå™¨è¯·æ±‚èµ„æºï¼ŒæœåŠ¡å™¨æ¯æ¬¡è¿”å›æ–‡ä»¶çš„åŒæ—¶å¸¦ä¸Šæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯† ETag</li>
<li>å½“æµè§ˆå™¨çš„ç¼“å­˜æ–‡ä»¶è¿‡æœŸåï¼Œæµè§ˆå™¨å¸¦ä¸Šè¯·æ±‚å¤´<code>If-None-Match</code>ï¼ˆå€¼ä¸ºä¸Šä¸€æ¬¡çš„<code>ETag</code>ï¼‰è¯·æ±‚æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨æ¯”è¾ƒè¯·æ±‚å¤´çš„<code>If-None-Match</code>å’Œæ–‡ä»¶çš„ ETag ä¸€æ ·ï¼Œåˆ™å‘½ä¸­ç¼“å­˜è¿”å› 304ï¼›å¦‚æœä¸ä¸€è‡´å°±è¿”å› 200 å“åº”å’Œæ–‡ä»¶çš„å†…å®¹è¿˜æœ‰æ›´æ–°<code>ETag</code>çš„å€¼ï¼Œä»¥æ­¤å¾€å¤ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">'md5'</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/test.js'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> sourcePath = path.resolve(__dirname, <span class="string">'../public/test.js'</span>)</span><br><span class="line">  <span class="keyword">let</span> result = fs.readFileSync(sourcePath)</span><br><span class="line">  <span class="keyword">let</span> etag = md5(result)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (req.headers[<span class="string">'if-none-match'</span>] === etag) &#123;</span><br><span class="line">    res.writeHead(<span class="number">304</span>, <span class="string">'Not Modified'</span>)</span><br><span class="line">    res.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.setHeader(<span class="string">'ETag'</span>, etag)</span><br><span class="line">    res.writeHead(<span class="number">200</span>, <span class="string">'OK'</span>)</span><br><span class="line">    res.end(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06e9be1e391a48a9841242a0fdc3a4e6~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>å†æ¬¡è¯·æ±‚æ—¶ï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8a2199d885748ee88b6023b7c4f8b5b~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<ul>
<li>HTTP ä¸­å¹¶æ²¡æœ‰æŒ‡å®šå¦‚ä½•ç”Ÿæˆ<code>ETag</code>, å®é™…é¡¹ç›®ä¸­ç”Ÿæˆå“ˆå¸Œ(hash)æ˜¯æ¯”è¾ƒå¸¸è§çš„åšæ³•ã€‚</li>
</ul>
<p>ä¸è¿‡<code>ETag</code>æ¯æ¬¡æœåŠ¡ç«¯ç”Ÿæˆéƒ½éœ€è¦è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œ<code>Last-Modified</code>åªéœ€è¦è¯»å–æ“ä½œï¼Œ<code>ETag</code>ç”Ÿæˆè®¡ç®—çš„æ¶ˆè€—æ›´å¤§äº›ã€‚</p>
<h2 id="ç¼“å­˜çš„ä¼˜å…ˆçº§"><a href="#ç¼“å­˜çš„ä¼˜å…ˆçº§" class="headerlink" title="ç¼“å­˜çš„ä¼˜å…ˆçº§"></a>ç¼“å­˜çš„ä¼˜å…ˆçº§</h2><p>é¦–å…ˆæ˜ç¡®çš„æ˜¯å¼ºç¼“å­˜çš„ä¼˜å…ˆçº§é«˜äºåå•†ç¼“å­˜</p>
<p>åœ¨ HTTP1.0 çš„æ—¶å€™è¿˜æœ‰ä¸ª<code>Pragma</code>å­—æ®µï¼Œä¹Ÿå±äºå¼ºç¼“å­˜ï¼Œå½“è¯¥å­—æ®µå€¼ä¸º no-cache çš„æ—¶å€™ï¼Œä¼šå‘Šè¯‰æµè§ˆå™¨ä¸è¦å¯¹è¯¥èµ„æºç¼“å­˜ï¼Œå³æ¯æ¬¡éƒ½å¾—å‘æœåŠ¡å™¨å‘ä¸€æ¬¡è¯·æ±‚æ‰è¡Œï¼Œå®ƒçš„ä¼˜å…ˆçº§é«˜äº<code>Cache-Control</code></p>
<p>ä¸€èˆ¬æˆ‘ä»¬ç°åœ¨å°±ä¸ä¼šç”¨å®ƒäº†ï¼Œå¦‚æœæƒ³è§åˆ°<code>Pragma</code>çš„è¯ï¼Œåœ¨ Chrome çš„ devtools ä¸­å¯ç”¨ disable cache æ—¶æˆ–è€…æŒ‰ <code>Ctrl + F5</code>å¼ºåˆ¶åˆ·æ–°ï¼Œå°±ä¼šåœ¨è¯·æ±‚çš„ Request Header ä¸Šçœ‹åˆ°ã€‚</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78b4c599e5894dcd8b2505cc410de2f5~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>æœ€åä¼˜å…ˆçº§ä¸ºï¼š</p>
<blockquote>
<p>Pragma &gt; Cache-Control &gt; Expires &gt; ETag &gt; Last-Modified</p>
</blockquote>
<h2 id="å¦‚ä½•æ¸…é™¤ç¼“å­˜"><a href="#å¦‚ä½•æ¸…é™¤ç¼“å­˜" class="headerlink" title="å¦‚ä½•æ¸…é™¤ç¼“å­˜"></a>å¦‚ä½•æ¸…é™¤ç¼“å­˜</h2><p>æµè§ˆå™¨é»˜è®¤ä¼šç¼“å­˜å›¾ç‰‡ï¼Œcss å’Œ js ç­‰é™æ€èµ„æºï¼Œæœ‰æ—¶åœ¨å¼€å‘ç¯å¢ƒä¸‹å¯èƒ½ä¼šå› ä¸ºå¼ºç¼“å­˜å¯¼è‡´èµ„æºæ²¡æœ‰åŠæ—¶æ›´æ–°è€Œçœ‹ä¸åˆ°æœ€æ–°çš„æ•ˆæœï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ol>
<li>ç›´æ¥ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°ï¼ˆç›´æ¥ F5 çš„è¯ä¼šè·³è¿‡å¼ºç¼“å­˜è§„åˆ™ï¼Œç›´æ¥èµ°åå•†ç¼“å­˜ï¼‰</li>
<li>è°·æ­Œæµè§ˆå™¨å¯ä»¥åœ¨ Network é‡Œé¢é€‰ä¸­<code>Disable cache</code></li>
<li>ç»™èµ„æºæ–‡ä»¶åŠ ä¸€ä¸ªæ—¶é—´æˆ³</li>
<li>å…¶ä»–æ–¹å¼è®¾ç½®å¦‚ webpack</li>
</ol>
<br>

<p>æ¡ˆä¾‹ github ä»£ç ï¼š<a href="https://github.com/Jacky-Summer/http-cache-demo" target="_blank" rel="noopener">http-cache-demo</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.cnblogs.com/tugenhua0707/p/10807289.html" target="_blank" rel="noopener">ç†è§£ http æµè§ˆå™¨çš„åå•†ç¼“å­˜å’Œå¼ºåˆ¶ç¼“å­˜</a></li>
<li><a href="https://juejin.im/post/6844903655619969038" target="_blank" rel="noopener">å‰ç«¯ä¹Ÿè¦æ‡‚ Http ç¼“å­˜æœºåˆ¶</a></li>
</ul>
<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œé¼“åŠ±æˆ‘ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>HTTPç³»åˆ—</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™call,apply,bindæ–¹æ³•</title>
    <url>/2020/09/26/%E6%89%8B%E5%86%99call-apply-bind%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>è¿™æ˜¯è€ç”Ÿå¸¸è°ˆçš„æ‰‹å†™äº†ï¼Œä»Šå¤©æƒ³è‡ªå·±è¯•ç€å®ç°ä¸€ä¸‹ï¼Œåšä¸ªç¬”è®°ã€‚</p>
<a id="more"></a>

<h2 id="call-æ–¹æ³•"><a href="#call-æ–¹æ³•" class="headerlink" title="call æ–¹æ³•"></a>call æ–¹æ³•</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.myCall = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (context === <span class="literal">undefined</span> || context === <span class="literal">null</span>) &#123;</span><br><span class="line">    context = <span class="built_in">window</span> <span class="comment">// æŒ‡å®šä¸º null å’Œ undefined çš„ this å€¼ä¼šè‡ªåŠ¨æŒ‡å‘å…¨å±€å¯¹è±¡</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    context = <span class="built_in">Object</span>(context) <span class="comment">// å€¼ä¸ºåŸå§‹å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ï¼‰çš„ this ä¼šæŒ‡å‘è¯¥åŸå§‹å€¼çš„å®ä¾‹å¯¹è±¡</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fn = <span class="built_in">Symbol</span>(<span class="string">'uniqueFn'</span>) <span class="comment">// ç”¨ Symbol æ˜¯é˜²æ­¢è·Ÿä¸Šä¸‹æ–‡çš„åŸå±æ€§å†²çª</span></span><br><span class="line">  context[fn] = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">let</span> arg = [...arguments].slice(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> result = context[fn](...arg)</span><br><span class="line">  <span class="keyword">delete</span> context[fn]</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­å‡½æ•°ä¸Šä¸‹æ–‡ç½‘ä¸Šä¹Ÿæœ‰å†™æ³•æ˜¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">context = context ? <span class="built_in">Object</span>(context) : <span class="built_in">window</span></span><br><span class="line">context = context || <span class="built_in">window</span></span><br></pre></td></tr></table></figure>

<p>ä½†ä¸æ˜¯å¾ˆä¸¥è°¨ï¼Œå› ä¸ºé‡åˆ°ç©ºå­—ç¬¦ä¸²ï¼Œ<code>0</code>ï¼Œ<code>false</code>æ—¶ï¼Œ<code>context</code>ä¹Ÿä¼šè¢«åˆ¤æ–­ä¸º<code>window</code>ã€‚</p>
<h2 id="apply-æ–¹æ³•"><a href="#apply-æ–¹æ³•" class="headerlink" title="apply æ–¹æ³•"></a>apply æ–¹æ³•</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.myApply = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (context === <span class="literal">undefined</span> || context === <span class="literal">null</span>) &#123;</span><br><span class="line">    context = <span class="built_in">window</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    context = <span class="built_in">Object</span>(context)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç±»æ•°ç»„å¯¹è±¡</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isArrayLike</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      o &amp;&amp; <span class="comment">// o ä¸æ˜¯nullã€undefinedç­‰</span></span><br><span class="line">      <span class="keyword">typeof</span> o === <span class="string">'object'</span> &amp;&amp; <span class="comment">// oæ˜¯å¯¹è±¡</span></span><br><span class="line">      <span class="built_in">isFinite</span>(o.length) &amp;&amp; <span class="comment">// o.lengthæ˜¯æœ‰é™æ•°å€¼</span></span><br><span class="line">      o.length &gt;= <span class="number">0</span> &amp;&amp; <span class="comment">// o.lengthä¸ºéè´Ÿå€¼</span></span><br><span class="line">      o.length === <span class="built_in">Math</span>.floor(o.length) &amp;&amp; <span class="comment">// o.lengthæ˜¯æ•´æ•°</span></span><br><span class="line">      o.length &lt; <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">32</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> fn = <span class="built_in">Symbol</span>(<span class="string">'uniqueFn'</span>)</span><br><span class="line">  context[fn] = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">let</span> args = <span class="built_in">arguments</span>[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">let</span> result</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(args) &amp;&amp; !isArrayLike(args)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'CreateListFromArrayLike called on non-object'</span>) <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°ä¸ä¸ºæ•°ç»„ä¸”ä¸ä¸ºç±»å¯¹è±¡æ•°ç»„</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    args = <span class="built_in">Array</span>.from(args) <span class="comment">// è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">    result = context[fn](...args)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">delete</span> context[fn]</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="bind-æ–¹æ³•"><a href="#bind-æ–¹æ³•" class="headerlink" title="bind æ–¹æ³•"></a>bind æ–¹æ³•</h2><p>å®ç° bind è¦é¢å¤–è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šæ–¹æ³•ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨ new æ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.myBind = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span> !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected this is a function'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">let</span> args = [...arguments].slice(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params">...innerArg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> isNew = <span class="keyword">this</span> <span class="keyword">instanceof</span> fn <span class="comment">// è¿”å›çš„fnæ˜¯å¦é€šè¿‡newè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> self.apply(isNew ? <span class="keyword">this</span> : <span class="built_in">Object</span>(context), args.concat(innerArg)) <span class="comment">// newè°ƒç”¨å°±ç»‘å®šåˆ°thisä¸Š,å¦åˆ™å°±ç»‘å®šåˆ°ä¼ å…¥çš„contextä¸Š</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¤åˆ¶åŸå‡½æ•°çš„prototypeç»™fnï¼Œä¸€äº›æƒ…å†µä¸‹å‡½æ•°æ²¡æœ‰prototypeï¼Œæ¯”å¦‚ç®­å¤´å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (self.prototype) &#123;</span><br><span class="line">    fn.prototype = <span class="built_in">Object</span>.create(self.prototype)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn <span class="comment">// è¿”å›æ‹·è´çš„å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œä½ çš„é¼“åŠ±æ˜¯æˆ‘åˆ›ä½œçš„åŠ¨åŠ›~</li>
</ul>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹æ‰‹å†™Promise</title>
    <url>/2020/09/21/ES6%E7%B3%BB%E5%88%97%E4%B9%8B%E6%89%8B%E5%86%99Promise/</url>
    <content><![CDATA[<p>Promise åœ¨å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ç”¨åˆ°ï¼Œå®ƒè§£å†³äº†å›è°ƒåœ°ç‹±é—®é¢˜ï¼Œå¯¹é”™è¯¯çš„å¤„ç†ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚æœ¬æ–‡æˆ‘å°†é€šè¿‡ä¸€æ­¥æ­¥å®Œå–„ Promiseï¼Œä»ç®€å•åˆ°å¤æ‚çš„è¿‡ç¨‹æ¥è¯´ã€‚</p><p>æœ¬æ–‡é€‚åˆç†Ÿç»ƒè¿ç”¨ Promise çš„äººé˜…è¯»ã€‚</p><a id="more"></a><h2 id="æç®€ç‰ˆ"><a href="#æç®€ç‰ˆ" class="headerlink" title="æç®€ç‰ˆ"></a>æç®€ç‰ˆ</h2><p>é¦–å…ˆ<code>Promise</code>æ˜¯ä¸€ä¸ªç±»ï¼Œç±»ä¸­çš„æ„é€ å‡½æ•°éœ€è¦æ¥æ”¶ä¸€ä¸ªæ‰§è¡Œå‡½æ•°<code>executor</code>é»˜è®¤å°±ä¼šæ‰§è¡Œï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>resolve</code>å’Œ<code>reject</code>ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯<code>Promise</code>å†…éƒ¨å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ”¹å˜çŠ¶æ€å¹¶æ‰§è¡Œå¯¹åº”å›è°ƒå‡½æ•°ã€‚</p><p>é»˜è®¤åˆ›å»ºä¸€ä¸ª<code>Promise</code>çŠ¶æ€å°±æ˜¯<code>pending</code>ï¼Œ<code>promise</code>åªæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>,<code>fulfilled</code>,<code>rejected</code>ï¼Œè°ƒç”¨æˆåŠŸ<code>resolve</code>å’Œå¤±è´¥<code>reject</code>æ–¹æ³•æ—¶ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªæˆåŠŸçš„åŸå› /å€¼<code>value</code>å’Œå¤±è´¥çš„åŸå› <code>reason</code>ã€‚æ¯ä¸€ä¸ª<code>promise</code>å®ä¾‹éƒ½æœ‰ä¸€ä¸ª then æ–¹æ³•ã€‚</p><p><code>Promise</code>çŠ¶æ€ä¸€ç»æ”¹å˜å°±ä¸èƒ½å†æ”¹å˜ï¼Œæ•…æˆ‘ä»¬é™åˆ¶åªèƒ½åœ¨çŠ¶æ€ä¸º<code>pending</code>æ‰æ”¹å˜ï¼Œè¿™æ ·å°±ä¿è¯çŠ¶æ€åªèƒ½æ”¹å˜ä¸€æ¬¡ã€‚</p><p>å¦‚æœæŠ›å‡ºå¼‚å¸¸æŒ‰ç…§å¤±è´¥æ¥å¤„ç†ã€‚</p><p>æŒ‰ç…§ä»¥ä¸Š<code>Promise</code>çš„åŸºæœ¬è¦æ±‚ï¼Œå°±æœ‰ä¸ªåŸºæœ¬ç»“æ„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const STATUS &#x3D; &#123;</span><br><span class="line">  PENDING: &#39;PENDING&#39;,</span><br><span class="line">  FULFILLED: &#39;FULFILLED&#39;,</span><br><span class="line">  REJECTED: &#39;REJECTED&#39;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Promise &#123;</span><br><span class="line">  constructor(executor) &#123;</span><br><span class="line">    this.status &#x3D; STATUS.PENDING</span><br><span class="line">    this.value &#x3D; undefined &#x2F;&#x2F; æˆåŠŸçš„å€¼</span><br><span class="line">    this.reason &#x3D; undefined &#x2F;&#x2F; å¤±è´¥åŸå› </span><br><span class="line">    this.onResolvedCallbacks &#x3D; [] &#x2F;&#x2F; å­˜æ”¾æˆåŠŸçš„å›è°ƒ</span><br><span class="line">    this.onRejectedCallbacks &#x3D; [] &#x2F;&#x2F; å­˜æ”¾å¤±è´¥çš„å›è°ƒ</span><br><span class="line"></span><br><span class="line">    const resolve &#x3D; val &#x3D;&gt; &#123;</span><br><span class="line">      if (this.status &#x3D;&#x3D;&#x3D; STATUS.PENDING) &#123;</span><br><span class="line">        this.status &#x3D; STATUS.FULFILLED</span><br><span class="line">        this.value &#x3D; val</span><br><span class="line">        this.onResolvedCallbacks.forEach(fn &#x3D;&gt; fn())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const reject &#x3D; reason &#x3D;&gt; &#123;</span><br><span class="line">      if (this.status &#x3D;&#x3D;&#x3D; STATUS.PENDING) &#123;</span><br><span class="line">        this.status &#x3D; STATUS.REJECTED</span><br><span class="line">        this.reason &#x3D; reason</span><br><span class="line">        this.onRejectedCallbacks.forEach(fn &#x3D;&gt; fn())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      executor(resolve, reject)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      console.log(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  then(onFulfilled, onRejected) &#123;</span><br><span class="line">    if (this.status &#x3D;&#x3D;&#x3D; STATUS.FULFILLED) &#123;</span><br><span class="line">      onFulfilled(this.value)</span><br><span class="line">    &#125;</span><br><span class="line">    if (this.status &#x3D;&#x3D;&#x3D; STATUS.REJECTED) &#123;</span><br><span class="line">      onRejected(this.reason)</span><br><span class="line">    &#125;</span><br><span class="line">    if (this.status &#x3D;&#x3D;&#x3D; STATUS.PENDING) &#123;</span><br><span class="line">      this.onResolvedCallbacks.push(() &#x3D;&gt; &#123;</span><br><span class="line">        onFulfilled(this.value)</span><br><span class="line">      &#125;)</span><br><span class="line">      this.onRejectedCallbacks.push(() &#x3D;&gt; &#123;</span><br><span class="line">        onRejected(this.reason)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥æ‰§è¡Œå›è°ƒè¿˜è¦å­˜å‚¨å‘¢ï¼Ÿå› ä¸ºå¦‚æœå½“<code>resolve(3)</code>è¢«å»¶è¿Ÿæ‰§è¡Œæ—¶ï¼Œæ­¤æ—¶å¸¸ç†å†™ä»£ç æ¥è¯´ then æ˜¯ä¼šè¢«æ‰§è¡Œçš„ï¼Œä½†æ­¤æ—¶æ²¡æœ‰<code>resolve</code>ï¼Œæ•…<code>p</code>çš„çŠ¶æ€åº”ä¸º<code>pending</code>ï¼Œä¸åº”ç«‹å³æ‰§è¡ŒæˆåŠŸè°ƒç”¨çš„å‡½æ•°ï¼Œéœ€è¦æŠŠå®ƒå­˜èµ·æ¥ï¼Œç›´åˆ°æ‰§è¡Œ<code>resolve</code>å†æ‰§è¡ŒæˆåŠŸè°ƒç”¨çš„å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">3</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'then1'</span>, res)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="é“¾å¼è°ƒç”¨"><a href="#é“¾å¼è°ƒç”¨" class="headerlink" title="é“¾å¼è°ƒç”¨"></a>é“¾å¼è°ƒç”¨</h2><p>é“¾å¼è°ƒç”¨æƒ³å¿…å¤§å®¶å¤šå°‘æœ‰ç‚¹äº†è§£ï¼Œåœ¨ jQuery é‡Œé¢çš„é“¾å¼è°ƒç”¨åˆ™æ˜¯è¿”å› thisï¼Œè€Œ Promise é‡Œé¢çš„é“¾æ¥è°ƒç”¨åˆ™æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">3</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'then1'</span>, res) <span class="comment">// then1 3</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// é“¾å¼è°ƒç”¨</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'then2'</span>, res) <span class="comment">// then2 2</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>then</code>æ–¹æ³•å’Œå¢åŠ <code>catch</code>æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">then(onFulfilled, onRejected) &#123;</span><br><span class="line">  <span class="keyword">let</span> nextPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === STATUS.FULFILLED) &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> res = onFulfilled(<span class="keyword">this</span>.value)</span><br><span class="line">          resolve(res)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === STATUS.REJECTED) &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> res = onRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">          resolve(res)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === STATUS.PENDING) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onResolvedCallbacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> res = onFulfilled(<span class="keyword">this</span>.value)</span><br><span class="line">            resolve(res)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.onRejectedCallbacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> res = onRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">            resolve(res)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> nextPromise</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="comment">// é»˜è®¤æ²¡æœ‰æˆåŠŸï¼Œåªæœ‰å¤±è´¥</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">undefined</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ¬¡ä¿®æ”¹æˆ‘ä»¬æ˜¯åœ¨æœ€å¤–å±‚åŒ…äº†æ–°çš„<code>Promise</code>ï¼Œç„¶ååŠ äº†ä¸ª setTimeout æ¨¡æ‹Ÿå¾®ä»»åŠ¡ï¼ˆå› ä¸ºè¿™é‡Œç”¨çš„ setTimeout æ¨¡æ‹Ÿå¾®ä»»åŠ¡ï¼Œæ‰€ä»¥ JS äº‹ä»¶å¾ªç¯æ‰§è¡Œé¡ºåºä¸Šå’ŒåŸç”Ÿ Promise æœ‰åŒºåˆ«ï¼‰ï¼ŒæŠŠå›è°ƒæ”¾å…¥ï¼Œç­‰å¾…ç¡®ä¿å¼‚æ­¥æ‰§è¡Œã€‚</p><h2 id="é“¾å¼è°ƒç”¨è¿›é˜¶ç‰ˆ"><a href="#é“¾å¼è°ƒç”¨è¿›é˜¶ç‰ˆ" class="headerlink" title="é“¾å¼è°ƒç”¨è¿›é˜¶ç‰ˆ"></a>é“¾å¼è°ƒç”¨è¿›é˜¶ç‰ˆ</h2><p>ä¸Šé¢çš„<code>Promise</code>ä¾æ—§æ²¡æœ‰è¿‡å…³ï¼Œå› ä¸ºå¦‚æœé“¾å¼è°ƒç”¨ä¸­<code>Promise</code>è¿”å›çš„æ˜¯æ™®é€šå€¼ï¼Œå°±åº”è¯¥æŠŠå€¼åŒ…è£…æˆæ–°çš„<code>Promise</code>å¯¹è±¡</p><ul><li>æ¯ä¸ª then æ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼ˆé‡ç‚¹ï¼‰</li><li>å¦‚æœ then æ–¹æ³•è¿”å›äº†ä¸€ä¸ª Promise å¯¹è±¡ï¼Œåˆ™éœ€è¦æŸ¥çœ‹å®ƒçš„çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€æ˜¯æˆåŠŸï¼Œåˆ™è°ƒç”¨<code>resolve</code>æ–¹æ³•ï¼ŒæŠŠæˆåŠŸçš„çŠ¶æ€ä¼ é€’ç»™å®ƒï¼›å¦‚æœæ˜¯å¤±è´¥çš„ï¼Œåˆ™æŠŠå¤±è´¥çš„çŠ¶æ€ä¼ é€’ç»™ä¸‹ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚</li><li>å¦‚æœ then æ–¹æ³•ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹å€¼ï¼ˆå¦‚ Numberã€String ç­‰ï¼‰å°±ä½¿ç”¨æ­¤å€¼åŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡è¿”å›ã€‚</li><li>å¦‚æœ then æ–¹æ³•ä¸­æ²¡æœ‰ return è¯­å¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªç”¨ undefined åŒ…è£…çš„ Promise å¯¹è±¡</li><li>å¦‚æœ then æ–¹æ³•æ²¡æœ‰ä¼ å…¥ä»»ä½•å›è°ƒï¼Œåˆ™ç»§ç»­å‘ä¸‹ä¼ é€’ï¼ˆå€¼çš„ä¼ é€’ç‰¹æ€§ï¼‰ã€‚</li><li>å¦‚æœæ˜¯å¾ªç¯å¼•ç”¨åˆ™éœ€è¦æŠ›å‡ºé”™è¯¯</li></ul><p>ä¿®æ”¹<code>then</code>æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">then(onFulfilled, onRejected) &#123;</span><br><span class="line">  onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> ? onFulfilled : <span class="function"><span class="params">x</span> =&gt;</span> x</span><br><span class="line">  onRejected =</span><br><span class="line">    <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span></span><br><span class="line">      ? onRejected</span><br><span class="line">      : <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> err</span><br><span class="line">        &#125;</span><br><span class="line">  <span class="keyword">let</span> nextPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === STATUS.FULFILLED) &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> res = onFulfilled(<span class="keyword">this</span>.value)</span><br><span class="line">          resolvePromise(res, nextPromise, resolve, reject)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === STATUS.REJECTED) &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> res = onRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">          resolvePromise(res, nextPromise, resolve, reject)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === STATUS.PENDING) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onResolvedCallbacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> res = onFulfilled(<span class="keyword">this</span>.value)</span><br><span class="line">            resolvePromise(res, nextPromise, resolve, reject)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.onRejectedCallbacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> res = onRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">            resolve(res)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> nextPromise</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡Œé¢å¢åŠ äº†ä¸€ä¸ª<code>resolvePromise</code>å‡½æ•°ï¼Œå¤„ç†è°ƒç”¨<code>then</code>æ–¹æ³•åä¸åŒè¿”å›å€¼çš„æƒ…å†µ ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">x, nextPromise, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x === nextPromise) &#123;</span><br><span class="line">    <span class="comment">// x å’Œ nextPromise æŒ‡å‘åŒä¸€å¯¹è±¡ï¼Œå¾ªç¯å¼•ç”¨æŠ›å‡ºé”™è¯¯</span></span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'å¾ªç¯å¼•ç”¨'</span>))</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">'object'</span> || <span class="keyword">typeof</span> x === <span class="string">'function'</span>)) &#123;</span><br><span class="line">    <span class="comment">// x æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> called = <span class="literal">false</span> <span class="comment">// é¿å…å¤šæ¬¡è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> then = x.then <span class="comment">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰ then æ–¹æ³•</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="comment">// then æ˜¯å‡½æ•°ï¼Œå°±æ–­å®š x æ˜¯ä¸€ä¸ª Promiseï¼ˆæ ¹æ®Promise A+è§„èŒƒï¼‰</span></span><br><span class="line">        then.call(</span><br><span class="line">          x,</span><br><span class="line">          <span class="function"><span class="keyword">function</span> (<span class="params">y</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨è¿”å›çš„promiseï¼Œç”¨å®ƒçš„ç»“æœä½œä¸ºä¸‹ä¸€æ¬¡thençš„ç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">            called = <span class="literal">true</span></span><br><span class="line">            resolvePromise(y, nextPromise, resolve, reject) <span class="comment">// é€’å½’è§£ææˆåŠŸåçš„å€¼ï¼Œç›´åˆ°å®ƒæ˜¯ä¸€ä¸ªæ™®é€šå€¼ä¸ºæ­¢</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">            called = <span class="literal">true</span></span><br><span class="line">            reject(r) <span class="comment">// å–thenæ—¶å‘ç”Ÿé”™è¯¯äº†</span></span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(x) <span class="comment">// æ­¤æ—¶ x å°±æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      reject(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// x æ˜¯åŸå§‹æ•°æ®ç±»å‹ / æ²¡æœ‰è¿”å›å€¼ï¼Œè¿™é‡Œå³æ˜¯undefined</span></span><br><span class="line">    resolve(x)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Promise-resolve-å®ç°"><a href="#Promise-resolve-å®ç°" class="headerlink" title="Promise.resolve() å®ç°"></a>Promise.resolve() å®ç°</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promise</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">static</span> resolve(val) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      resolve(val)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Promise-reject-å®ç°"><a href="#Promise-reject-å®ç°" class="headerlink" title="Promise.reject() å®ç°"></a>Promise.reject() å®ç°</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promise</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">static</span> reject(reason) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      reject(reason)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Promise-prototype-finally-å®ç°"><a href="#Promise-prototype-finally-å®ç°" class="headerlink" title="Promise.prototype.finally å®ç°"></a>Promise.prototype.finally å®ç°</h2><p>è¯¥æ–¹æ³•ä¸»è¦æœ‰ä¸¤å¤§é‡ç‚¹</p><ul><li>æ— è®ºå½“å‰è¿™ä¸ª Promise å¯¹è±¡æœ€ç»ˆçš„çŠ¶æ€æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ ,finally æ–¹æ³•é‡Œçš„å›è°ƒå‡½æ•°éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡</li><li>åœ¨ finally æ–¹æ³•åé¢å¯ä»¥ç»§ç»­é“¾å¼è°ƒç”¨ then æ–¹æ³•ï¼Œæ‹¿åˆ°å½“å‰è¿™ä¸ª Promise å¯¹è±¡æœ€ç»ˆè¿”å›çš„ç»“æœ</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(</span><br><span class="line">    data =&gt; &#123;</span><br><span class="line">      <span class="comment">// è®©å‡½æ•°æ‰§è¡Œï¼Œå†…éƒ¨ä¼šè°ƒç”¨æ–¹æ³•ï¼Œå¦‚æœæ–¹æ³•æ˜¯promiseéœ€è¦ç­‰å¾…å®ƒå®Œæˆ</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(callback()).then(<span class="function"><span class="params">()</span> =&gt;</span> data)</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(callback()).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Promise-all-å®ç°"><a href="#Promise-all-å®ç°" class="headerlink" title="Promise.all() å®ç°"></a>Promise.all() å®ç°</h2><p>Promise.all å¯ä»¥å°†å¤šä¸ª Promise å®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åŒæ—¶ï¼ŒæˆåŠŸå’Œå¤±è´¥çš„è¿”å›å€¼æ˜¯ä¸åŒçš„ï¼ŒæˆåŠŸçš„æ—¶å€™è¿”å›çš„æ˜¯ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œè€Œå¤±è´¥çš„æ—¶å€™åˆ™è¿”å›æœ€å…ˆè¢« reject å¤±è´¥çŠ¶æ€çš„å€¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPromise</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val &amp;&amp; <span class="keyword">typeof</span> val.then === <span class="string">'function'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(promises)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Not a array'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result = []</span><br><span class="line">    <span class="keyword">let</span> times = <span class="number">0</span> <span class="comment">// è®¡æ•°å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params">index, val</span>) </span>&#123;</span><br><span class="line">      result[index] = val</span><br><span class="line">      <span class="keyword">if</span> (++times === promises.length) &#123;</span><br><span class="line">        resolve(result)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.length; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> p = promises[i]</span><br><span class="line">      <span class="keyword">if</span> (isPromise(p)) &#123;</span><br><span class="line">        <span class="comment">// Promiseå¯¹è±¡</span></span><br><span class="line">        p.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">          processData(i, data)</span><br><span class="line">        &#125;, reject)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        processData(i, p) <span class="comment">// æ™®é€šå€¼</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Promise-race-å®ç°"><a href="#Promise-race-å®ç°" class="headerlink" title="Promise.race() å®ç°"></a>Promise.race() å®ç°</h2><p>åœ¨æ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œä¸­ï¼Œåªä¿ç•™å–ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå³æ˜¯å“ªä¸ªç»“æœè·å¾—çš„å¿«ï¼Œå°±è¿”å›é‚£ä¸ªç»“æœï¼Œä¸ç®¡ç»“æœæœ¬èº«æ˜¯æˆåŠŸçŠ¶æ€è¿˜æ˜¯å¤±è´¥çŠ¶æ€ã€‚å…¶ä»–çš„æ–¹æ³•ä»åœ¨æ‰§è¡Œï¼Œä¸è¿‡æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.race = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(promises)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Not a array'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (promises.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> p <span class="keyword">of</span> promises) &#123;</span><br><span class="line">        resolve(p).then(</span><br><span class="line">          value =&gt; &#123;</span><br><span class="line">            resolve(value)</span><br><span class="line">          &#125;,</span><br><span class="line">          reason =&gt; &#123;</span><br><span class="line">            reject(reason)</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼ŒPromise å°±å®ç°å®Œæˆäº†ã€‚</p><p><a href="https://github.com/Jacky-Summer/handwriting-source-code/blob/master/src/Promise/mini-promise.js" target="_blank" rel="noopener">å®Œæ•´æºç åœ°å€</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œé¼“åŠ±æˆ‘ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>Promise</tag>
        <tag>æ‰‹å†™</tag>
      </tags>
  </entry>
  <entry>
    <title>ææ‡‚æµè§ˆå™¨æ¸²æŸ“åŸç†ï¼ˆé‡æ’ä¸é‡ç»˜ï¼‰</title>
    <url>/2020/09/17/%E6%90%9E%E6%87%82%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86%EF%BC%88%E9%87%8D%E6%8E%92%E4%B8%8E%E9%87%8D%E7%BB%98%EF%BC%89/</url>
    <content><![CDATA[<p>å‰ç«¯å·©å›ºåŸºç¡€ï¼Œç»ˆäºå†™åˆ°äº†æµè§ˆå™¨ç¯‡ï¼Œè™½ç„¶æµè§ˆå™¨æ¸²æŸ“åŸç†å¤§æ¦‚ç­”å¾—å‡ºæ¥ï¼Œä½†è¿˜æ˜¯æƒ³æ ¹æ®ä»¥å‰çš„ç¬”è®°æ•´ç†ä¸€ä¸‹ã€‚</p>
<a id="more"></a>

<h2 id="æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹"><a href="#æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹" class="headerlink" title="æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹"></a>æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹</h2><p>æˆ‘ä»¬ä»¥ Webkit æ¸²æŸ“å¼•æ“ä¸ºä¾‹ï¼Œè®²ä¸€ä¸‹æµè§ˆå™¨æ˜¯æ€ä¹ˆæ¸²æŸ“ä¸€ä¸ªç½‘é¡µçš„ï¼š</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32c524d3f8804d1eb02f2a550b69bd94~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<ul>
<li>æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹ï¼š</li>
</ul>
<ol>
<li>è§£æ HTML æ„å»º DOM æ ‘ï¼Œå¹¶è¡Œè¯·æ±‚ css/image/js</li>
<li>CSS æ–‡ä»¶ä¸‹è½½å®Œæˆåè¢« CSS è§£æå™¨è§£ææˆ CSSOM æ ‘</li>
<li>ç»“åˆ DOM å’Œ CSSOM æ ‘ï¼Œç”Ÿæˆä¸€æ£µæ¸²æŸ“æ ‘(Render Tree)</li>
<li>å¸ƒå±€(Layout)ï¼Œè®¡ç®—å‡ºæ¯ä¸ªèŠ‚ç‚¹åœ¨å±å¹•ä¸­çš„ä½ç½®</li>
<li>å°†å¸ƒå±€æ˜¾ç¤º(Painting)åœ¨å±å¹•ä¸Š</li>
</ol>
<p>åœ¨ç”¨æˆ·è®¿é—®é¡µé¢è¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šä¸æ–­é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“é€šå¸¸æ˜¯æŒ‡ç¬¬ 4 æ­¥+ç¬¬ 5 æ­¥ï¼Œæˆ–è€…åªæœ‰ç¬¬ 5 æ­¥ã€‚</p>
<p>åœ¨å…³äºå‰ç«¯æ€§èƒ½ä¼˜åŒ–é‡Œé¢ï¼Œå°±æœ‰ä¸€ç‚¹ï¼š<strong>å‡å°‘é‡æ’ä¸é‡ç»˜</strong>ï¼Œå› ä¸ºé‡æ’å’Œé‡ç»˜æ¬¡æ•°å¤šçš„è¯ï¼Œå¯èƒ½ä¼šå½±å“åˆ°ç½‘é¡µæ˜¾ç¤ºé€Ÿåº¦ï¼Œç»™ç”¨æˆ·å¸¦æ¥ä¸æµç•…ç”šè‡³å¡é¡¿çš„æ•ˆæœã€‚</p>
<h2 id="é‡ç»˜"><a href="#é‡ç»˜" class="headerlink" title="é‡ç»˜"></a>é‡ç»˜</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>é‡ç»˜å³æ˜¯æŒ‡å½“ä¸€ä¸ªå…ƒç´ çš„å¤–è§‚å‘ç”Ÿæ”¹å˜ï¼Œä½†æ²¡æœ‰æ”¹å˜å¸ƒå±€ï¼Œé‡æ–°æŠŠå…ƒç´ å¤–è§‚ç»˜åˆ¶å‡ºæ¥çš„è¿‡ç¨‹ã€‚</p>
<h3 id="è§¦å‘é‡ç»˜çš„å±æ€§"><a href="#è§¦å‘é‡ç»˜çš„å±æ€§" class="headerlink" title="è§¦å‘é‡ç»˜çš„å±æ€§"></a>è§¦å‘é‡ç»˜çš„å±æ€§</h3><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9e68749268c42c19559c32cdc52e344~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="é‡æ’-å›æµ"><a href="#é‡æ’-å›æµ" class="headerlink" title="é‡æ’(å›æµ)"></a>é‡æ’(å›æµ)</h2><h3 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>å½“ DOM çš„å˜åŒ–å½±å“äº†å…ƒç´ çš„å‡ ä½•ä¿¡æ¯(DOM å¯¹è±¡çš„ä½ç½®å’Œå°ºå¯¸å¤§å°)ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å‡ ä½•å±æ€§ï¼Œå°†å…¶å®‰æ”¾åœ¨ç•Œé¢ä¸­çš„æ­£ç¡®ä½ç½®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšé‡æ’ã€‚</p>
<p>å½“ç½‘é¡µé‡æ–°å¸ƒå±€çš„æ—¶å€™ï¼Œä¹Ÿä¼šå°†å…ƒç´ é‡æ–°ç»˜åˆ¶ï¼Œæ¯”å¦‚æ”¹å˜å…ƒç´ çš„å®½åº¦ï¼Œè¿™ä¸ªå…ƒç´ ä¹ƒè‡³å‘¨è¾¹çš„ DOM éƒ½éœ€è¦é‡æ–°ç»˜åˆ¶ã€‚<br>æ‰€ä»¥ï¼Œ<strong>é‡æ’ä¸€å®šä¼šè§¦å‘é‡ç»˜ï¼Œè€Œé‡ç»˜ä¸ä¸€å®šä¼šé‡æ’</strong>ã€‚</p>
<h3 id="è§¦å‘é‡æ’çš„å±æ€§"><a href="#è§¦å‘é‡æ’çš„å±æ€§" class="headerlink" title="è§¦å‘é‡æ’çš„å±æ€§"></a>è§¦å‘é‡æ’çš„å±æ€§</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d780c2f281334431938eb1feb04581be~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>å¤§è‡´å¯åˆ†ä¸ºï¼š</p>
<ul>
<li>ç›’æ¨¡å‹ç›¸å…³çš„å±æ€§ï¼šwidth, height, margin, display, border ç­‰</li>
<li>å®šä½å±æ€§åŠæµ®åŠ¨ç›¸å…³çš„å±æ€§ï¼šposition, top, float ç­‰</li>
<li>æ”¹å˜èŠ‚ç‚¹å†…éƒ¨æ–‡å­—ç»“æ„ï¼štext-align, overflow, font-size, line-height, vertical-align ç­‰</li>
<li>è¿›è¡Œè·å–å¸ƒå±€ä¿¡æ¯çš„æ“ä½œï¼šoffsetWidth, clientHeight, width, scrollTop, getComputedStyle ç­‰</li>
</ul>
<p>è§¦å‘é‡æ’æ—¶ä¼šå¯¹å‘¨å›´ DOM é‡æ–°æ’åˆ—ï¼Œå½±å“çš„èŒƒå›´æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>å…¨å±€èŒƒå›´ï¼šä»æ ¹èŠ‚ç‚¹ html å¼€å§‹å¯¹æ•´ä¸ªæ¸²æŸ“æ ‘è¿›è¡Œé‡æ–°å¸ƒå±€ã€‚</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>å¤§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ p èŠ‚ç‚¹ä¸Šå‘ç”Ÿ reflow æ—¶ï¼Œh1 å’Œ body ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ï¼Œç”šè‡³å½±å“å…¨å±€ã€‚<br>å±€éƒ¨èŒƒå›´é‡æ’</p>
<ul>
<li>å±€éƒ¨èŒƒå›´ï¼šå¯¹æ¸²æŸ“æ ‘çš„æŸéƒ¨åˆ†æˆ–æŸä¸€ä¸ªæ¸²æŸ“å¯¹è±¡è¿›è¡Œé‡æ–°å¸ƒå±€</li>
</ul>
<p>ä¸€ä¸ª dom çš„å®½é«˜ä¹‹ç±»çš„å‡ ä½•ä¿¡æ¯å®šæ­»ï¼Œç„¶ååœ¨ dom å†…éƒ¨è§¦å‘é‡æ’ï¼Œå°±åªä¼šé‡æ–°æ¸²æŸ“è¯¥ dom å†…éƒ¨çš„å…ƒç´ ï¼Œè€Œä¸ä¼šå½±å“åˆ°å¤–ç•Œã€‚</p>
<h2 id="æµè§ˆå™¨çš„æ¸²æŸ“é˜Ÿåˆ—"><a href="#æµè§ˆå™¨çš„æ¸²æŸ“é˜Ÿåˆ—" class="headerlink" title="æµè§ˆå™¨çš„æ¸²æŸ“é˜Ÿåˆ—"></a>æµè§ˆå™¨çš„æ¸²æŸ“é˜Ÿåˆ—</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">div.style.left = <span class="string">'5px'</span></span><br><span class="line">div.style.top = <span class="string">'5px'</span></span><br><span class="line">div.style.width = <span class="string">'5px'</span></span><br><span class="line">div.style.height = <span class="string">'5px'</span></span><br></pre></td></tr></table></figure>

<p>æŒ‰æˆ‘ä»¬ä¸Šé¢è¯´çš„ï¼Œä¸Šé¢çš„ä»£ç ç†è®ºä¸Šåº”è¯¥è§¦å‘ 4 æ¬¡é‡æ’+é‡ç»˜ï¼Œä½†å®é™…æ˜¯åªè§¦å‘äº†ä¸€æ¬¡é‡æ’ï¼Œè¿™å¾—ç›Šäºæµè§ˆå™¨çš„æ¸²æŸ“é˜Ÿåˆ—æœºåˆ¶ï¼šå½“æˆ‘ä»¬ä¿®æ”¹äº†å…ƒç´ çš„å‡ ä½•å±æ€§ï¼Œå¯¼è‡´æµè§ˆå™¨è§¦å‘é‡æ’æˆ–é‡ç»˜æ—¶ã€‚å®ƒä¼šæŠŠè¯¥æ“ä½œæ”¾è¿›æ¸²æŸ“é˜Ÿåˆ—ï¼Œç­‰åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œåˆ°äº†ä¸€å®šçš„æ•°é‡æˆ–è€…åˆ°äº†ä¸€å®šçš„æ—¶é—´é—´éš”æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæ‰¹é‡æ‰§è¡Œè¿™äº›æ“ä½œã€‚</p>
<h2 id="å¼ºåˆ¶åˆ·æ–°é˜Ÿåˆ—"><a href="#å¼ºåˆ¶åˆ·æ–°é˜Ÿåˆ—" class="headerlink" title="å¼ºåˆ¶åˆ·æ–°é˜Ÿåˆ—"></a>å¼ºåˆ¶åˆ·æ–°é˜Ÿåˆ—</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">div.style.top = <span class="string">'5px'</span></span><br><span class="line"><span class="built_in">console</span>.log(div.offsetTop)</span><br><span class="line">div.style.left = <span class="string">'5px'</span></span><br><span class="line"><span class="built_in">console</span>.log(div.offsetLeft)</span><br><span class="line">div.style.width = <span class="string">'5px'</span></span><br><span class="line"><span class="built_in">console</span>.log(div.offsetWidth)</span><br><span class="line">div.style.height = <span class="string">'5px'</span></span><br><span class="line"><span class="built_in">console</span>.log(div.offsetHeight)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¼šè§¦å‘ 4 æ¬¡é‡æ’+é‡ç»˜ï¼Œå› ä¸ºåœ¨ console ä¸­è¯·æ±‚çš„è¿™å‡ ä¸ªæ ·å¼ä¿¡æ¯ï¼Œæ— è®ºä½•æ—¶æµè§ˆå™¨éƒ½ä¼šç«‹å³æ‰§è¡Œæ¸²æŸ“é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³ä½¿è¯¥å€¼ä¸ä½ æ“ä½œä¸­ä¿®æ”¹çš„å€¼æ²¡å…³è”ã€‚</p>
<p>å› ä¸ºé˜Ÿåˆ—ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å½±å“åˆ°è¿™äº›å€¼çš„æ“ä½œï¼Œä¸ºäº†ç»™æˆ‘ä»¬æœ€ç²¾ç¡®çš„å€¼ï¼Œæµè§ˆå™¨ä¼šç«‹å³é‡æ’+é‡ç»˜ã€‚åœ¨å¼€å‘ä¸­åº”è¯¥å°½é‡é¿å…ä¸€è¡Œä»£ç ä¸€ä¸ªé‡æ’ï¼Œå³æ˜¯åšå¥½åˆ†ç¦»è¯»å†™æ“ä½œï¼Œå‡å°‘æ€§èƒ½æŸè€—ã€‚</p>
<ul>
<li>å¼ºåˆ¶åˆ·æ–°é˜Ÿåˆ—çš„ style æ ·å¼è¯·æ±‚ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">offsetTop, offsetLeft, offsetWidth, offsetHeight</span><br><span class="line">scrollTop, scrollLeft, scrollWidth, scrollHeight</span><br><span class="line">clientTop, clientLeft, clientWidth, clientHeight</span><br><span class="line">width, height</span><br><span class="line">getComputedStyle(), æˆ–è€… IEçš„ currentStyle</span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•å‡å°‘é‡ç»˜ä¸é‡æ’"><a href="#å¦‚ä½•å‡å°‘é‡ç»˜ä¸é‡æ’" class="headerlink" title="å¦‚ä½•å‡å°‘é‡ç»˜ä¸é‡æ’"></a>å¦‚ä½•å‡å°‘é‡ç»˜ä¸é‡æ’</h2><h3 id="1-åˆ†ç¦»è¯»å†™æ“ä½œ"><a href="#1-åˆ†ç¦»è¯»å†™æ“ä½œ" class="headerlink" title="1. åˆ†ç¦»è¯»å†™æ“ä½œ"></a>1. åˆ†ç¦»è¯»å†™æ“ä½œ</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">div.style.top = <span class="string">'5px'</span></span><br><span class="line">div.style.left = <span class="string">'5px'</span></span><br><span class="line">div.style.width = <span class="string">'5px'</span></span><br><span class="line">div.style.height = <span class="string">'5px'</span></span><br><span class="line"><span class="built_in">console</span>.log(div.offsetTop)</span><br><span class="line"><span class="built_in">console</span>.log(div.offsetLeft)</span><br><span class="line"><span class="built_in">console</span>.log(div.offsetWidth)</span><br><span class="line"><span class="built_in">console</span>.log(div.offsetHeight)</span><br></pre></td></tr></table></figure>

<p>åƒä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯¹å®ƒè¿›è¡Œåˆ†ç¦»æ“ä½œï¼Œä» 4 æ¬¡é‡æ’å˜æˆ 1 æ¬¡é‡æ’ã€‚</p>
<blockquote>
<p>åœ¨ç¬¬ä¸€ä¸ª console çš„æ—¶å€™ï¼Œæµè§ˆå™¨æŠŠä¹‹å‰ä¸Šé¢å››ä¸ªå†™æ“ä½œçš„æ¸²æŸ“é˜Ÿåˆ—éƒ½ç»™æ¸…ç©ºäº†ã€‚å‰©ä¸‹çš„ consoleï¼Œå› ä¸ºæ¸²æŸ“é˜Ÿåˆ—æœ¬æ¥å°±æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰è§¦å‘é‡æ’ï¼Œä»…ä»…æ‹¿å€¼è€Œå·²ã€‚</p>
</blockquote>
<h3 id="2-å°†æ ·å¼ä¿®æ”¹åˆå¹¶æˆä¸€æ¬¡æ“ä½œ"><a href="#2-å°†æ ·å¼ä¿®æ”¹åˆå¹¶æˆä¸€æ¬¡æ“ä½œ" class="headerlink" title="2. å°†æ ·å¼ä¿®æ”¹åˆå¹¶æˆä¸€æ¬¡æ“ä½œ"></a>2. å°†æ ·å¼ä¿®æ”¹åˆå¹¶æˆä¸€æ¬¡æ“ä½œ</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">div.style.left = <span class="string">'5px'</span></span><br><span class="line">div.style.top = <span class="string">'5px'</span></span><br><span class="line">div.style.width = <span class="string">'5px'</span></span><br><span class="line">div.style.height = <span class="string">'5px'</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½åšäº†æ¸²æŸ“é˜Ÿåˆ—ä¼˜åŒ–ï¼Œä½†ä¸æ’é™¤è€ç‰ˆæœ¬æµè§ˆå™¨æ•ˆç‡ä»ç„¶åœ°ä¸‹ï¼Œæ•…æˆ‘ä»¬æœ€å¥½è¿˜æ˜¯åšæ›´å¥½çš„å¤„ç†ï¼Œæ¯”å¦‚å¯ä»¥æŠŠæ ·å¼é›†ä¸­åˆå¹¶ä¸€æ¬¡ä¿®æ”¹ï¼Œé€šè¿‡ class æˆ–è€… cssText å±æ€§</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> left = <span class="number">5</span></span><br><span class="line"><span class="keyword">let</span> top = <span class="number">5</span></span><br><span class="line">el.style.left = left + <span class="string">'px'</span></span><br><span class="line">el.style.top = top + <span class="string">'px'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">el.className += <span class="string">' the classname'</span></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">el.style.cssText += <span class="string">'; left: '</span> + left + <span class="string">'px; top: '</span> + top + <span class="string">'px;'</span></span><br></pre></td></tr></table></figure>

<h3 id="3-ç¼“å­˜å¸ƒå±€ä¿¡æ¯"><a href="#3-ç¼“å­˜å¸ƒå±€ä¿¡æ¯" class="headerlink" title="3. ç¼“å­˜å¸ƒå±€ä¿¡æ¯"></a>3. ç¼“å­˜å¸ƒå±€ä¿¡æ¯</h3><p>é¿å…å¼ºåˆ¶åˆ·æ–°é˜Ÿåˆ—</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">box.style.width = box.clientWidth + <span class="number">10</span> + <span class="string">'px'</span></span><br><span class="line">box.style.height = box.clientHeight + <span class="number">10</span> + <span class="string">'px'</span></span><br></pre></td></tr></table></figure>

<p>æŒ‰æµè§ˆå™¨æ¸²æŸ“é˜Ÿåˆ—æœºåˆ¶ï¼ŒæŒ‰é“ç†å›æµä¸€æ¬¡ã€‚ä½†é‡åˆ° box.clientWidthï¼Œé‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥å…¨éƒ¨æ˜¯ä¸¤æ¬¡å›æµ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = box.clientWidth</span><br><span class="line"><span class="keyword">let</span> b = box.clientHeight</span><br><span class="line">box.style.width = box.clientWidth + <span class="number">10</span> + <span class="string">'px'</span></span><br><span class="line">box.style.height = box.clientHeight + <span class="number">10</span> + <span class="string">'px'</span></span><br></pre></td></tr></table></figure>

<h3 id="4-ç¦»çº¿æ”¹å˜-DOM"><a href="#4-ç¦»çº¿æ”¹å˜-DOM" class="headerlink" title="4. ç¦»çº¿æ”¹å˜ DOM"></a>4. ç¦»çº¿æ”¹å˜ DOM</h3><ol>
<li>éšè—è¦æ“ä½œçš„ DOM</li>
</ol>
<p>åœ¨è¦æ“ä½œ dom ä¹‹å‰ï¼Œé€šè¿‡ display éšè— domï¼Œç„¶åå°½é‡çš„è¿›è¡Œå¤šæ¬¡ä¿®æ”¹æ“ä½œï¼Œå½“æ“ä½œå®Œæˆä¹‹åï¼Œæ‰å°†å…ƒç´ çš„ display å±æ€§ä¸ºå¯è§ï¼Œå› ä¸ºä¸å¯è§çš„å…ƒç´ ä¸ä¼šè§¦å‘é‡æ’å’Œé‡ç»˜ã€‚</p>
<ol start="2">
<li><p>é€šè¿‡ä½¿ç”¨ DocumentFragment åˆ›å»ºä¸€ä¸ªæ–‡æ¡£ç¢ç‰‡,åœ¨å®ƒä¸Šé¢æ‰¹é‡æ“ä½œ domï¼Œæ“ä½œå®Œæˆä¹‹åï¼Œå†æ·»åŠ åˆ°æ–‡æ¡£ä¸­ï¼Œè¿™æ ·åªä¼šè§¦å‘ä¸€æ¬¡é‡æ’ã€‚</p>
</li>
<li><p>å¤åˆ¶èŠ‚ç‚¹ï¼Œåœ¨å‰¯æœ¬ä¸Šå·¥ä½œï¼Œç„¶åå†æ›¿æ¢åŸæ¥çš„å…ƒç´ </p>
</li>
</ol>
<h3 id="5-ä½¿ç”¨-resize-äº‹ä»¶æ—¶ï¼Œåšé˜²æŠ–å’ŒèŠ‚æµå¤„ç†"><a href="#5-ä½¿ç”¨-resize-äº‹ä»¶æ—¶ï¼Œåšé˜²æŠ–å’ŒèŠ‚æµå¤„ç†" class="headerlink" title="5. ä½¿ç”¨ resize äº‹ä»¶æ—¶ï¼Œåšé˜²æŠ–å’ŒèŠ‚æµå¤„ç†"></a>5. ä½¿ç”¨ resize äº‹ä»¶æ—¶ï¼Œåšé˜²æŠ–å’ŒèŠ‚æµå¤„ç†</h3><h3 id="6-å¯¹åŠ¨ç”»å…ƒç´ ä½¿ç”¨-absolute-fixed-å±æ€§ã€‚"><a href="#6-å¯¹åŠ¨ç”»å…ƒç´ ä½¿ç”¨-absolute-fixed-å±æ€§ã€‚" class="headerlink" title="6. å¯¹åŠ¨ç”»å…ƒç´ ä½¿ç”¨ absolute / fixed å±æ€§ã€‚"></a>6. å¯¹åŠ¨ç”»å…ƒç´ ä½¿ç”¨ absolute / fixed å±æ€§ã€‚</h3><p>position å±æ€§ä¸º absolute æˆ– fixed çš„å…ƒç´ ï¼Œé‡æ’å¼€é”€æ¯”è¾ƒå°ï¼Œä¸ç”¨è€ƒè™‘å®ƒå¯¹å…¶ä»–å…ƒç´ çš„å½±å“</p>
<h3 id="7-CSS3-å±æ€§ä¼˜åŒ–åŠ¨ç”»"><a href="#7-CSS3-å±æ€§ä¼˜åŒ–åŠ¨ç”»" class="headerlink" title="7. CSS3 å±æ€§ä¼˜åŒ–åŠ¨ç”»"></a>7. CSS3 å±æ€§ä¼˜åŒ–åŠ¨ç”»</h3><p>æ¯”å¦‚ä½¿ç”¨ CSS çš„ transform æ¥å®ç°åŠ¨ç”»æ•ˆæœï¼Œé¿å…äº†å›æµè·Ÿé‡ç»˜ï¼Œç›´æ¥åœ¨éä¸»çº¿ç¨‹ä¸­æ‰§è¡ŒåˆæˆåŠ¨ç”»æ“ä½œã€‚è¿™æ ·å­çš„æ•ˆç‡æ›´é«˜ï¼Œæ¯•ç«Ÿè¿™ä¸ªæ˜¯åœ¨éä¸»çº¿ç¨‹ä¸Šåˆæˆçš„ï¼Œæ²¡æœ‰å ç”¨ä¸»çº¿ç¨‹èµ„æºï¼Œå¦å¤–ä¹Ÿé¿å¼€äº†å¸ƒå±€å’Œç»˜åˆ¶ä¸¤ä¸ªå­é˜¶æ®µï¼Œæ‰€ä»¥ç›¸å¯¹äºé‡ç»˜å’Œé‡æ’ï¼Œåˆæˆèƒ½å¤§å¤§æå‡ç»˜åˆ¶æ•ˆç‡ã€‚é‚£ä¸ºä»€ä¹ˆèƒ½é¿å…å‘¢ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒåˆ›å»ºäº†ä¸€ä¸ªæ–°å›¾å±‚ã€‚</p>
<ul>
<li>å›¾å±‚åˆ›å»ºçš„æ¡ä»¶ï¼š<br>Chrome æµè§ˆå™¨æ»¡è¶³ä»¥ä¸‹ä»»æ„æƒ…å†µå°±ä¼šåˆ›å»ºå›¾å±‚ï¼š</li>
</ul>
<ol>
<li>æ‹¥æœ‰å…·æœ‰ 3D å˜æ¢çš„ CSS å±æ€§</li>
<li>ä½¿ç”¨åŠ é€Ÿè§†é¢‘è§£ç çš„<code>&lt;video&gt;</code>èŠ‚ç‚¹</li>
<li><code>&lt;canvas&gt;</code>èŠ‚ç‚¹</li>
<li>CSS3 åŠ¨ç”»çš„èŠ‚ç‚¹</li>
<li>æ‹¥æœ‰ CSS åŠ é€Ÿå±æ€§çš„å…ƒç´ (<code>will-change</code>)</li>
</ol>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥æŠŠæ™®é€šæ–‡æ¡£æµçœ‹æˆä¸€ä¸ªå›¾å±‚ã€‚ç‰¹å®šçš„å±æ€§å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å›¾å±‚ã€‚ä¸åŒçš„å›¾å±‚æ¸²æŸ“äº’ä¸å½±å“ï¼Œæ‰€ä»¥å¯¹äºæŸäº›é¢‘ç¹éœ€è¦æ¸²æŸ“çš„å»ºè®®å•ç‹¬ç”Ÿæˆä¸€ä¸ªæ–°å›¾å±‚ï¼Œæé«˜æ€§èƒ½ï¼Œä½†ä¹Ÿä¸èƒ½ç”Ÿæˆè¿‡å¤šçš„å›¾å±‚ã€‚</p>
<ul>
<li>åˆ©ç”¨åˆæˆçš„å¥½å¤„ï¼š</li>
</ul>
<ol>
<li>åˆæˆå±‚çš„ä½å›¾ï¼Œä¼šäº¤ç”± GPU åˆæˆï¼Œæ¯” CPU å¤„ç†è¦å¿«ã€‚<strong>GPU ç¡¬ä»¶åŠ é€Ÿ</strong>ï¼ˆè§„é¿äº†å›æµï¼‰æ˜¯æŒ‡åº”ç”¨ GPU çš„å›¾å½¢æ€§èƒ½å¯¹æµè§ˆå™¨ä¸­çš„ä¸€äº›å›¾å½¢æ“ä½œäº¤ç»™ GPU æ¥å®Œæˆï¼Œå› ä¸º GPU æ˜¯ä¸“é—¨ä¸ºå¤„ç†å›¾å½¢è€Œè®¾è®¡ï¼Œæ‰€ä»¥å®ƒåœ¨é€Ÿåº¦å’Œèƒ½è€—ä¸Šæ›´æœ‰æ•ˆç‡ã€‚</li>
<li>å½“éœ€è¦ repaint æ—¶ï¼Œåªéœ€è¦ repaint æœ¬èº«ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„å±‚</li>
<li>å¯¹äº transform å’Œ opacity æ•ˆæœï¼Œä¸ä¼šè§¦å‘ layout å’Œ paint</li>
</ol>
<p>å½“ç„¶ä¹Ÿè¦æ³¨æ„ï¼Œå¦‚æœä¸ºå¤ªå¤šå…ƒç´ ä½¿ç”¨ css3 ç¡¬ä»¶åŠ é€Ÿï¼Œä¼šå¯¼è‡´å†…å­˜å ç”¨è¾ƒå¤§ï¼ŒåŒæ ·ä¹Ÿä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* transformä¸º3Dï¼Œåˆ™å¯å¼€å¯GPUåŠ é€Ÿï¼Œæé«˜åŠ¨ç”»æ€§èƒ½ */</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">10px</span>, <span class="number">10px</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul>
<li><a href="https://blog.fundebug.com/2019/01/03/understand-browser-rendering/" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºæµè§ˆå™¨æ¸²æŸ“åŸç†</a></li>
</ul>
<br>

<blockquote>
<p>æ¬¢è¿å…³æ³¨æˆ‘æ˜é‡‘è´¦å·å’Œ Github æŠ€æœ¯åšå®¢ï¼š</p>
<ul>
<li>æ˜é‡‘ï¼š<a href="https://juejin.im/user/1257497033714477" target="_blank" rel="noopener">https://juejin.im/user/1257497033714477</a></li>
<li>Githubï¼š<a href="https://github.com/Jacky-Summer" target="_blank" rel="noopener">https://github.com/Jacky-Summer</a></li>
<li>è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©æˆ–æœ‰å¯å‘çš„è¯æ¬¢è¿ starï¼Œä½ çš„é¼“åŠ±æ˜¯æˆ‘æŒç»­åˆ›ä½œçš„åŠ¨åŠ›~</li>
<li>å¦‚éœ€åœ¨å¾®ä¿¡å…¬ä¼—å·å¹³å°è½¬è½½è¯·è”ç³»ä½œè€…æˆæƒåŒæ„ï¼Œå…¶å®ƒé€”å¾„è½¬è½½è¯·åœ¨æ–‡ç« å¼€å¤´æ³¨æ˜ä½œè€…å’Œæ–‡ç« å‡ºå¤„ã€‚</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹Promiseé¢˜åˆé›†</title>
    <url>/2020/09/10/ES6%E7%B3%BB%E5%88%97%E4%B9%8BPromise%E9%A2%98%E5%90%88%E9%9B%86/</url>
    <content><![CDATA[<p>å…³äº Promise çš„è®²è§£æ–‡ç« å®åœ¨å¤ªå¤šäº†ï¼Œåœ¨æ­¤æˆ‘å°±ä¸å†™è®²è§£äº†ï¼Œç›´æ¥å®æˆ˜æ£€æµ‹è‡ªå·±å¯¹ Promise çš„ç†è§£ï¼Œä¸‹é¢æ˜¯æˆ‘åšè¿‡çš„ä¼—å¤š Promise é¢˜é‡Œé¢æŒ‘å‡ºæ¥çš„ 13 é“é¢˜ï¼Œæˆ‘è§‰å¾—å®¹æ˜“é”™æˆ–è€…å€¼å¾—è€ƒç©¶çŸ¥è¯†ç‚¹çš„é¢˜ï¼Œå¦‚æœä½ æƒ³è€ƒå¯Ÿè‡ªå·±å¯¹ Promise çš„æŒæ¡ç¨‹åº¦ï¼Œå¯ä»¥åšåšçœ‹ã€‚</p>
<a id="more"></a>

<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›® 1"></a>é¢˜ç›® 1</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">  resolve(<span class="string">'resolve1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'1'</span>, promise1)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'2'</span>, promise2)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li>å…ˆé‡åˆ°<code>new Promise</code>ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç è¾“å‡º <code>promise1</code></li>
<li>é‡åˆ°<code>resolve</code>å‡½æ•°, å°†<code>promise1</code>çš„çŠ¶æ€æ”¹å˜ä¸º<code>fulfilled</code>, å¹¶å°†ç»“æœä¿å­˜ä¸‹æ¥</li>
<li>ç¢°åˆ°<code>promise1.then</code>è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œè¿”å›çš„æ˜¯<code>Promise</code>çš„<code>pending</code>çŠ¶æ€ï¼Œå°†å®ƒæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ•…<code>promise2</code>æ˜¯ä¸€ä¸ªæ–°çš„çŠ¶æ€ä¸º<code>pending</code>çš„<code>Promise</code></li>
<li>ç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç è¾“å‡º<code>promise1</code>çš„çŠ¶æ€æ˜¯<code>fulfilled</code>ï¼Œè¾“å‡º<code>promise2</code>çš„çŠ¶æ€æ˜¯<code>pending</code></li>
<li>å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°<code>promise1.then</code>è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º<code>fulfilled</code>ï¼Œæ‰§è¡Œå®ƒã€‚</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">promise1</span><br><span class="line">1 Promise&#123;&lt;fulfilled&gt;: &#39;resolve1&#39;&#125;</span><br><span class="line">2 Promise&#123;&lt;pending&gt;&#125;</span><br><span class="line">resolve1</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-2"><a href="#é¢˜ç›®-2" class="headerlink" title="é¢˜ç›® 2"></a>é¢˜ç›® 2</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timerStart'</span>)</span><br><span class="line">    resolve(<span class="string">'success'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timerEnd'</span>)</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line">promise.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li>æ‰§è¡Œ<code>new Promsise</code>ï¼Œè¾“å‡º<code>1</code>ï¼Œ<code>setTimeout</code>å®ä»»åŠ¡åŠ åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç è¾“å‡º<code>2</code></li>
<li>é‡åˆ°<code>promise.then</code>ï¼Œä½†å…¶çŠ¶æ€è¿˜æ˜¯ pendingï¼Œè¿™é‡Œç†è§£ä¸ºå…ˆä¸æ‰§è¡Œï¼›ç„¶åè¾“å‡ºåŒæ­¥ä»£ç <code>4</code></li>
<li>ä¸€è½®å¾ªç¯è¿‡åï¼Œè¿›å…¥ç¬¬äºŒæ¬¡å®ä»»åŠ¡ï¼Œå‘ç°å»¶è¿Ÿé˜Ÿåˆ—ä¸­æœ‰<code>setTimeout</code>å®šæ—¶å™¨ï¼Œæ‰§è¡Œå®ƒ</li>
<li>è¾“å‡º<code>timerStart</code>ï¼Œé‡åˆ°<code>resolve</code>ï¼Œå°†<code>promise</code>çš„çŠ¶æ€æ”¹ä¸º<code>fulfilled</code>ä¸”ä¿å­˜ç»“æœå¹¶å°†ä¹‹å‰çš„<code>promise.then</code>æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>ç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç <code>timerEnd</code></li>
<li>å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°<code>promise.then</code>è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®ƒã€‚</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">timerStart</span><br><span class="line">timerEnd</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-3"><a href="#é¢˜ç›®-3" class="headerlink" title="é¢˜ç›® 3"></a>é¢˜ç›® 3</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'success'</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error!!!'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'promise1'</span>, promise1)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'promise2'</span>, promise2)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>, promise1)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise2'</span>, promise2)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œç¬¬ä¸€ä¸ª<code>new Promise</code>ä¸­çš„å‡½æ•°ï¼Œç¢°åˆ°<code>setTimeout</code>å°†å®ƒåŠ å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡åˆ—è¡¨</li>
<li>è·³å‡º<code>new Promise</code>ï¼Œç¢°åˆ°<code>promise1.then</code>è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œä½†å…¶çŠ¶æ€è¿˜æ˜¯ä¸º<code>pending</code>ï¼Œè¿™é‡Œç†è§£ä¸ºå…ˆä¸æ‰§è¡Œï¼›æ•…<code>promise2</code>æ˜¯ä¸€ä¸ªæ–°çš„çŠ¶æ€ä¸º<code>pending</code>çš„<code>Promise</code></li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <code>console.log(&#39;promise1&#39;)</code>ï¼Œè¾“å‡º<code>promise1</code>çš„çŠ¶æ€ä¸º<code>pending</code></li>
<li>æ‰§è¡ŒåŒæ­¥ä»£<code>console.log(&#39;promise2&#39;)</code>ï¼Œè¾“å‡º<code>promise2</code>çš„çŠ¶æ€ä¸º<code>pending</code></li>
<li>ç¢°åˆ°ç¬¬äºŒä¸ª<code>setTimeout</code>ï¼Œå°†å…¶æ”¾å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡åˆ—è¡¨</li>
<li>ç¬¬ä¸€è½®å®ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œå¹¶ä¸”æ²¡æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œç¬¬äºŒè½®å®ä»»åŠ¡</li>
<li>å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªå®šæ—¶å™¨é‡Œçš„å†…å®¹ï¼Œå°†<code>promise1</code>çš„çŠ¶æ€æ”¹ä¸º<code>fulfilled</code>ä¸”ä¿å­˜ç»“æœå¹¶å°†ä¹‹å‰çš„<code>promise1.then</code>æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>è¯¥å®šæ—¶å™¨ä¸­æ²¡æœ‰å…¶å®ƒçš„åŒæ­¥ä»£ç å¯æ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œæœ¬è½®çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯<code>promise1.then</code>ï¼Œå®ƒæŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œä¸”å°†<code>promise2</code>çš„çŠ¶æ€è®¾ç½®ä¸ºäº†<code>rejected</code></li>
<li>ç¬¬ä¸€ä¸ªå®šæ—¶å™¨æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ªå®šæ—¶å™¨ä¸­çš„å†…å®¹</li>
<li>æ‰“å°å‡º<code>promise1</code>ï¼Œä¸”æ­¤æ—¶<code>promise1</code>çš„çŠ¶æ€ä¸º<code>fulfilled</code></li>
<li>æ‰“å°å‡º<code>promise2</code>ï¼Œä¸”æ­¤æ—¶<code>promise2</code>çš„çŠ¶æ€ä¸º<code>rejected</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">promise1 <span class="built_in">Promise</span>Â &#123;&lt;pending&gt;&#125;</span><br><span class="line">promise2 <span class="built_in">Promise</span>Â &#123;&lt;pending&gt;&#125;</span><br><span class="line">Uncaught (<span class="keyword">in</span> promise) <span class="built_in">Error</span>: error!!! at &lt;anonymous&gt;:<span class="number">7</span>:<span class="number">9</span></span><br><span class="line">promise1 <span class="built_in">Promise</span>Â &#123;&lt;fulfilled&gt;: <span class="string">"success"</span>&#125;</span><br><span class="line">promise2 <span class="built_in">Promise</span>Â &#123;&lt;rejected&gt;: <span class="built_in">Error</span>: error!!! at &lt;anonymous&gt;:<span class="number">7</span>:<span class="number">9</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-4"><a href="#é¢˜ç›®-4" class="headerlink" title="é¢˜ç›® 4"></a>é¢˜ç›® 4</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="string">'error'</span>)</span><br><span class="line">  resolve(<span class="string">'success2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'then1: '</span>, res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'then2: '</span>, res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'catch: '</span>, err)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'then3: '</span>, res)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><code>catch</code>ä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚æœªæ•æ‰è¿‡çš„é”™è¯¯ã€‚</li>
<li>ç”±äº <code>catch()</code>ä¹Ÿä¼šè¿”å›ä¸€ä¸ª<code>Promise</code>ï¼Œä¸”ç”±äºè¿™ä¸ª<code>Promise</code>æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„æ˜¯<code>undefined</code>ã€‚</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">catch:  error</span><br><span class="line">then3:  undefined</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-5"><a href="#é¢˜ç›®-5" class="headerlink" title="é¢˜ç›® 5"></a>é¢˜ç›® 5</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error!!!'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'then: '</span>, res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'catch: '</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li>åœ¨<code>Promise</code>ä¸­ï¼Œè¿”å›ä»»æ„ä¸€ä¸ªé<code>promise</code>çš„å€¼éƒ½ä¼šè¢«åŒ…è£¹æˆ<code>promise</code>å¯¹è±¡ï¼Œä¾‹å¦‚<code>return new Error(&#39;error!!!&#39;)</code>ä¼šè¢«åŒ…è£…ä¸º<code>return Promise.resolve(new Error(&#39;error!!!&#39;))</code></li>
<li><code>.then</code>æˆ–è€… <code>.catch</code> ä¸­ <code>return</code> ä¸€ä¸ª <code>error</code> å¯¹è±¡å¹¶ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åç»­çš„ <code>.catch</code> æ•è·ã€‚</li>
</ul>
<p>å½“ç„¶å¦‚æœä½ æŠ›å‡ºä¸€ä¸ªé”™è¯¯çš„è¯ï¼Œå¯ä»¥ç”¨ä¸‹é¢ä»»æ„ä¸€ç§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error!!!'</span>))</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error!!!'</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">then:  Error: error!!!</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-6"><a href="#é¢˜ç›®-6" class="headerlink" title="é¢˜ç›® 6"></a>é¢˜ç›® 6</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">&#125;)</span><br><span class="line">promise.catch(<span class="built_in">console</span>.err)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><code>.then</code> æˆ– <code>.catch</code> è¿”å›çš„å€¼ä¸èƒ½æ˜¯ <code>promise</code> æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ã€‚</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PromiseÂ &#123;&lt;rejected&gt;: TypeError: Chaining cycle detected for promise #&lt;Promise&gt;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-7"><a href="#é¢˜ç›®-7" class="headerlink" title="é¢˜ç›® 7"></a>é¢˜ç›® 7</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="number">1</span>).then(<span class="number">2</span>).then(<span class="built_in">Promise</span>.resolve(<span class="number">3</span>)).then(<span class="built_in">console</span>.log)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><code>.then</code> æˆ–è€… <code>.catch</code> çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼é€ä¼ ã€‚</li>
<li>ç¬¬ä¸€ä¸ª<code>then</code>å’Œç¬¬äºŒä¸ª<code>then</code>ä¸­ä¼ å…¥çš„éƒ½ä¸æ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ•°å­—ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡ç±»å‹ï¼Œå› æ­¤å‘ç”Ÿäº†é€ä¼ ï¼Œå°†<code>resolve(1)</code> çš„å€¼ç›´æ¥ä¼ åˆ°æœ€åä¸€ä¸ª<code>then</code>é‡Œã€‚</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-8"><a href="#é¢˜ç›®-8" class="headerlink" title="é¢˜ç›® 8"></a>é¢˜ç›® 8</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.reject(<span class="string">'err!!!'</span>)</span><br><span class="line">  .then(</span><br><span class="line">    res =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'success'</span>, res)</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'error'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'catch'</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><code>.then</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥å¤„ç†<code>Promise</code>æˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯å¤„ç†å¤±è´¥çš„å‡½æ•°ã€‚</li>
<li><code>Promise.resolve(&#39;err!!!&#39;)</code>çš„å€¼ä¼šè¿›å…¥æˆåŠŸçš„å‡½æ•°ï¼Œ<code>Promise.reject(&#39;err!!!&#39;)</code>çš„å€¼ä¼šè¿›å…¥å¤±è´¥çš„å‡½æ•°ã€‚</li>
<li>å¦‚æœå»æ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±ä¼šè¿›å…¥<code>catch()</code>ä¸­</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;error&#39; &#39;error!!!&#39;</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-9"><a href="#é¢˜ç›®-9" class="headerlink" title="é¢˜ç›® 9"></a>é¢˜ç›® 9</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'1'</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'finally'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'2'</span>)</span><br><span class="line">  .finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'finally2'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'æˆ‘æ˜¯finally2è¿”å›çš„å€¼'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'finally2åé¢çš„thenå‡½æ•°'</span>, res)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><code>.finally()</code>æ–¹æ³•ä¸ç®¡<code>Promise</code>å¯¹è±¡æœ€åçš„çŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œ</li>
<li>å®ƒæœ€ç»ˆè¿”å›çš„é»˜è®¤ä¼šæ˜¯ä¸€ä¸ªä¸Šä¸€æ¬¡çš„<code>Promise</code>å¯¹è±¡å€¼ï¼Œä¸è¿‡å¦‚æœæŠ›å‡ºçš„æ˜¯ä¸€ä¸ªå¼‚å¸¸åˆ™è¿”å›å¼‚å¸¸çš„<code>Promise</code>å¯¹è±¡ã€‚</li>
<li>ç¬¬ä¸€è¡Œä»£ç é‡åˆ°<code>Promise.resolve(&#39;1&#39;)</code>,å†æŠŠ<code>.then()</code>åŠ å…¥å¾®ä»»åŠ¡ï¼Œè¿™æ—¶å€™è¦æ³¨æ„ï¼Œä»£ç å¹¶ä¸ä¼šæ¥ç€å¾€é“¾å¼è°ƒç”¨çš„ä¸‹é¢èµ°ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå…ˆå°†<code>.finally</code>åŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œé‚£æ˜¯å› ä¸º<code>.then</code>æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œå®ƒé“¾å¼åé¢çš„å†…å®¹å¿…é¡»å¾—ç­‰å½“å‰è¿™ä¸ªå¾®ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡<code>.finally()</code></li>
<li>æ‰§è¡Œ<code>Promise.resolve(&#39;2&#39;)</code>ï¼ŒæŠŠ<code>.finally</code>åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸”é“¾å¼è°ƒç”¨åé¢çš„å†…å®¹å¾—ç­‰è¯¥ä»»åŠ¡æ‰§è¡Œå®Œåæ‰æ‰§è¡Œ</li>
<li>æœ¬è½®å®ä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ‰§è¡Œå¾®ä»»åŠ¡åˆ—è¡¨ç¬¬ä¸€ä¸ªå¾®ä»»åŠ¡è¾“å‡º<code>1</code>ï¼Œé‡åˆ°<code>.finally()</code>ï¼Œå°†å®ƒåŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨ï¼ˆç¬¬ä¸‰ä¸ªï¼‰å¾…æ‰§è¡Œï¼›å†æ‰§è¡Œç¬¬äºŒä¸ªå¾®ä»»åŠ¡è¾“å‡º<code>finally2</code>ï¼Œé‡åˆ°<code>.then</code>ï¼ŒæŠŠå®ƒåŠ å…¥åˆ°å¾®ä»»åŠ¡ï¼ˆç¬¬å››ä¸ªï¼‰åˆ—è¡¨å¾…æ‰§è¡Œ</li>
<li>æœ¬è½®æ‰§è¡Œå®Œä¸¤ä¸ªå¾®ä»»åŠ¡åï¼Œæ£€ç´¢å¾®ä»»åŠ¡åˆ—è¡¨å‘ç°è¿˜æœ‰ä¸¤ä¸ªå¾®ä»»åŠ¡ï¼Œæ•…æ‰§è¡Œï¼Œè¾“å‡º<code>finally</code>å’Œ<code>finally2åé¢çš„thenå‡½æ•° 2</code></li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">finally2</span><br><span class="line">finally</span><br><span class="line">finally2åé¢çš„thenå‡½æ•° 2</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-10"><a href="#é¢˜ç›®-10" class="headerlink" title="é¢˜ç›® 10"></a>é¢˜ç›® 10</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>)</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async1 success'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'async1 end'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'srcipt start'</span>)</span><br><span class="line">async1().then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'srcipt end'</span>)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li>åœ¨<code>async1</code>ä¸­<code>await</code>åé¢çš„<code>Promise</code>æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„åˆå§‹çŠ¶æ€æ˜¯<code>pending</code>çŠ¶æ€ï¼Œå› æ­¤ç›¸å½“äºä¸€ç›´åœ¨<code>await</code></li>
<li>æ‰€ä»¥åœ¨<code>await</code>ä¹‹åçš„å†…å®¹æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œä¹ŸåŒ…æ‹¬<code>async1</code>åé¢çš„<code>.then</code>ã€‚</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">srcipt start</span><br><span class="line">async1 start</span><br><span class="line">promise1</span><br><span class="line">srcipt end</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-11"><a href="#é¢˜ç›®-11" class="headerlink" title="é¢˜ç›® 11"></a>é¢˜ç›® 11</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> async2()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async1'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'async1 success'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async2'</span>)</span><br><span class="line">    reject(<span class="string">'error'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">async1().then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res))</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><code>await</code>åé¢è·Ÿç€çš„æ˜¯ä¸€ä¸ªçŠ¶æ€ä¸º<code>rejected</code>çš„<code>promise</code>ã€‚</li>
<li>å¦‚æœåœ¨<code>async</code>å‡½æ•°ä¸­æŠ›å‡ºäº†é”™è¯¯ï¼Œåˆ™ç»ˆæ­¢é”™è¯¯ç»“æœï¼Œä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</li>
</ul>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">async2</span><br><span class="line">Uncaught (in promise) error</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-12"><a href="#é¢˜ç›®-12" class="headerlink" title="é¢˜ç›® 12"></a>é¢˜ç›® 12</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  foo.bar()</span><br><span class="line">  resolve(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p1.then(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'p1 then value: '</span> + value)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'p1 then err: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line">).then(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'p1 then then value: '</span> + value)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'p1 then then err: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p2.then(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'p2 then value: '</span> + value)</span><br><span class="line">    foo.bar()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'p2 then err: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'p2 then then value: '</span> + value)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'p2 then then err: '</span> + err)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'p2 then then then value: '</span> + value)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'p2 then then then err: '</span> + err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<p>Promise ä¸­çš„å¼‚å¸¸ç”± then å‚æ•°ä¸­ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ï¼ˆPromise æ‰§è¡Œå¤±è´¥çš„å›è°ƒï¼‰å¤„ç†ï¼Œå¼‚å¸¸ä¿¡æ¯å°†ä½œä¸º Promise çš„å€¼ã€‚å¼‚å¸¸ä¸€æ—¦å¾—åˆ°å¤„ç†ï¼Œthen è¿”å›çš„åç»­ Promise å¯¹è±¡å°†æ¢å¤æ­£å¸¸ï¼Œå¹¶ä¼šè¢« Promise æ‰§è¡ŒæˆåŠŸçš„å›è°ƒå‡½æ•°å¤„ç†ã€‚å¦å¤–ï¼Œéœ€è¦æ³¨æ„ p1ã€p2 å¤šçº§ then çš„å›è°ƒå‡½æ•°æ˜¯äº¤æ›¿æ‰§è¡Œçš„ ï¼Œè¿™æ­£æ˜¯ç”± Promise then å›è°ƒçš„å¼‚æ­¥æ€§å†³å®šçš„ã€‚</p>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p1 then err: ReferenceError: foo is not defined</span><br><span class="line">p2 then value: 2</span><br><span class="line">p1 then then value: undefined</span><br><span class="line">p2 then then err: ReferenceError: foo is not defined</span><br><span class="line">p2 then then then value: 1</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®-13"><a href="#é¢˜ç›®-13" class="headerlink" title="é¢˜ç›® 13"></a>é¢˜ç›® 13</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="built_in">Promise</span>.resolve(<span class="string">'resolve'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="built_in">Promise</span>.reject(<span class="string">'reject'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  reject(<span class="built_in">Promise</span>.resolve(<span class="string">'resolve'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p1.then(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fulfilled</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fulfilled: '</span> + value)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">rejected</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'rejected: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">p2.then(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fulfilled</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fulfilled: '</span> + value)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">rejected</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'rejected: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">p3.then(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fulfilled</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fulfilled: '</span> + value)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">rejected</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'rejected: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<p>Promise å›è°ƒå‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•° resolveï¼Œä¼šå¯¹ Promise æ‰§è¡Œâ€æ‹†ç®±â€åŠ¨ä½œã€‚å³å½“ resolve çš„å‚æ•°æ˜¯ä¸€ä¸ª Promise å¯¹è±¡æ—¶ï¼Œresolve ä¼šâ€æ‹†ç®±â€è·å–è¿™ä¸ª Promise å¯¹è±¡çš„çŠ¶æ€å’Œå€¼ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ã€‚p1â€æ‹†ç®±â€åï¼Œè·å–åˆ° Promise å¯¹è±¡çš„çŠ¶æ€æ˜¯ resolvedï¼Œå› æ­¤ fulfilled å›è°ƒè¢«æ‰§è¡Œï¼›p2â€æ‹†ç®±â€åï¼Œè·å–åˆ° Promise å¯¹è±¡çš„çŠ¶æ€æ˜¯ rejectedï¼Œå› æ­¤ rejected å›è°ƒè¢«æ‰§è¡Œã€‚ä½† Promise å›è°ƒå‡½æ•°ä¸­çš„ç¬¬äºŒä¸ªå‚æ•° reject ä¸å…·å¤‡â€æ‹†ç®±â€œçš„èƒ½åŠ›ï¼Œreject çš„å‚æ•°ä¼šç›´æ¥ä¼ é€’ç»™ then æ–¹æ³•ä¸­çš„ rejected å›è°ƒã€‚å› æ­¤ï¼Œå³ä½¿ p3 reject æ¥æ”¶äº†ä¸€ä¸ª resolved çŠ¶æ€çš„ Promiseï¼Œthen æ–¹æ³•ä¸­è¢«è°ƒç”¨çš„ä¾ç„¶æ˜¯ rejectedï¼Œå¹¶ä¸”å‚æ•°å°±æ˜¯ reject æ¥æ”¶åˆ°çš„ Promise å¯¹è±¡ã€‚</p>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p3 rejected: [object Promise]</span><br><span class="line">p1 fulfilled: resolve</span><br><span class="line">p2 rejected: reject</span><br></pre></td></tr></table></figure>

<h2 id="ç‰¹åˆ«é¸£è°¢"><a href="#ç‰¹åˆ«é¸£è°¢" class="headerlink" title="ç‰¹åˆ«é¸£è°¢"></a>ç‰¹åˆ«é¸£è°¢</h2><p>è¿™äº›é¢˜æ˜¯æˆ‘ä»ä¸‹é¢ä¸¤ä¸ªé“¾æ¥çš„é¢˜ç›®åˆé€‰å‡ºæ¥çš„ï¼Œä»…ä½œä¸ºè‡ªå·±çš„é”™é¢˜é›†/ç¬”è®°é¢˜æ¥è®°å½•ï¼Œæ–¹ä¾¿ä»¥åæˆ‘è‡ªå·±æ£€éªŒå›é¡¾ã€‚å¦‚æœä½ æƒ³æ›´å…¨é¢å­¦ï¼Œå»ºè®®ç›´æ¥å»åšä¸‹é¢ä¸¤ç¯‡çš„é¢˜ã€‚</p>
<ul>
<li><p><a href="https://juejin.im/post/6844904077537574919" target="_blank" rel="noopener">ã€å»ºè®®æ˜Ÿæ˜Ÿã€‘è¦å°±æ¥ 45 é“ Promise é¢è¯•é¢˜ä¸€æ¬¡çˆ½åˆ°åº•(1.1w å­—ç”¨å¿ƒæ•´ç†)</a></p>
</li>
<li><p><a href="https://juejin.im/post/6844903488695042062" target="_blank" rel="noopener">å…«æ®µä»£ç å½»åº•æŒæ¡ Promise</a></p>
</li>
<li><p>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</p>
</li>
</ul>
]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>Promise</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”±é›¶å¼€å§‹ä½¿ç”¨ Webpack æ¥æ­å»º React é¡¹ç›®</title>
    <url>/2020/09/05/%E7%94%B1%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-Webpack-%E6%9D%A5%E6%90%AD%E5%BB%BA-React-%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<p>ä»Šå¤©åŠ¨åŠ¨æ‰‹å›é¡¾ä¸‹ Webpack åŸºæœ¬é…ç½®ï¼Œæ­äº†ä¸ª react é¡¹ç›®è„šæ‰‹æ¶ï¼Œåšä¸‹ç¬”è®°ã€‚</p><p>æœ¬æ–‡é€‚åˆæœ‰äº†è§£è¿‡ webpack åŸºç¡€é…ç½®çš„äººé˜…è¯»ï¼Œå› ä¸ºæœ‰äº›åŸºç¡€é…ç½®å’Œæµç¨‹æˆ‘å°±ä¸åšè¯¦ç»†è§£é‡Šäº†ã€‚</p><a id="more"></a><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>æ–°å»ºæ–‡ä»¶å¤¹<code>react-cli</code>ï¼Œåˆå§‹åŒ–</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><ul><li>å®‰è£… webpack</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add webpack webpack-cli -D</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ webpack ä¸»è¦æ˜¯å¸®æˆ‘ä»¬æ‰“åŒ…æ„å»ºï¼Œæˆ‘ä»¬æ–°å»ºä¸ªæ–‡ä»¶<code>src/index.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello webpack'</span>)</span><br></pre></td></tr></table></figure><ul><li>æ–°å»º webpack.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'app.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†åˆ°<code>package.json</code>è®¾ç½®æ‰“åŒ…å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;build&quot;: &quot;npx webpack --config webpack.config.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘æ²¡æœ‰å…¨å±€å®‰è£… webpackï¼Œè¿™é‡Œä½¿ç”¨ npxï¼ˆnpm5.2 å¼€å§‹è‡ªå¸¦ npx å‘½ä»¤ï¼‰<br>å…³äº npx çš„ä½¿ç”¨å¯ä»¥çœ‹é˜®ä¸€å³°å¤§ç¥è¿™ç¯‡åšå®¢ï¼š<a href="https://www.ruanyifeng.com/blog/2019/02/npx.html" target="_blank" rel="noopener">npx ä½¿ç”¨æ•™ç¨‹</a></p><ul><li>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>å°±ä¼šçœ‹åˆ°ç”Ÿæˆäº†<code>dist</code>æ–‡ä»¶å¤¹å’Œæ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶<code>app.js</code></p><h2 id="å¼•å…¥-Html-æ¨¡æ¿"><a href="#å¼•å…¥-Html-æ¨¡æ¿" class="headerlink" title="å¼•å…¥ Html æ¨¡æ¿"></a>å¼•å…¥ Html æ¨¡æ¿</h2><blockquote><p><code>html-webpack-plugin</code>ç®€åŒ–äº† HTML æ–‡ä»¶çš„åˆ›å»ºï¼Œè¯¥æ’ä»¶å°†ä¸ºä½ ç”Ÿæˆä¸€ä¸ª HTML5 æ–‡ä»¶ï¼Œ å…¶ä¸­åŒ…æ‹¬ä½¿ç”¨ script æ ‡ç­¾çš„ body ä¸­çš„æ‰€æœ‰ webpack åŒ…ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add html-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ¨¡æ¿ HTML æ–‡ä»¶<code>public/index.html</code></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>webpack.config.js</code>é…ç½®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ‰§è¡Œ<code>npm run build</code>ï¼Œä¼šçœ‹åˆ°ç”Ÿæˆäº†ä¸€ä¸ª<code>index.html</code>æ–‡ä»¶ï¼Œæ‰“å¼€å®ƒä¼šå‘ç°<code>app.js</code>ä¹Ÿè¢«å¼•å…¥åˆ°æ–‡ä»¶ä¸”èƒ½æ­£å¸¸è¿è¡Œ</p><h2 id="ç¼–è¯‘-JS-æ–‡ä»¶"><a href="#ç¼–è¯‘-JS-æ–‡ä»¶" class="headerlink" title="ç¼–è¯‘ JS æ–‡ä»¶"></a>ç¼–è¯‘ JS æ–‡ä»¶</h2><p>ES6 æˆ–ä»¥ä¸Šç‰ˆæœ¬çš„è¯­æ³•æœ‰äº›æµè§ˆå™¨è¿˜æ˜¯ä¸è¯†åˆ«è¯­æ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ babel å¯¹å®ƒè¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘æˆ ES5 ä»£ç <br>åœ¨<code>src/index.js</code>å†™ä¸€ä¸ª ES6 çš„ç®­å¤´å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const func &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">  return 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®‰è£… babel æ’ä»¶</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add babel-loader @babel&#x2F;core @babel&#x2F;preset-env -D</span><br></pre></td></tr></table></figure><ul><li><strong>babel-loader</strong>ï¼šä½¿ç”¨ Babel å’Œ webpack æ¥è½¬è¯‘ JavaScript æ–‡ä»¶ã€‚</li><li><strong>@babel/preset-env</strong>ï¼šå°†è¯­æ³•ç¿»è¯‘æˆ es5 è¯­æ³•</li><li><strong>@babel/core</strong>ï¼šbabel çš„æ ¸å¿ƒæ¨¡å—</li></ul><p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º<code>.babelrc</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [&quot;@babel&#x2F;preset-env&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>webpack.config.js</code>ä¸­é…ç½®è§£æ js çš„è§„åˆ™</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">        loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>npm run build</code>ï¼ŒæŸ¥çœ‹<code>app.js</code>å·²ç»æŠŠç®­å¤´å‡½æ•°ç¼–è¯‘æˆ ES5 è¯­æ³•äº†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***/</span> ;(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">eval</span>(</span><br><span class="line">    <span class="string">"console.log('hello webpack');\n\nvar func = function func() &#123;\n  return 100;\n&#125;;\n\n//# sourceURL=webpack:///./src/index.js?"</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="comment">/***/</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="å¤„ç†æµè§ˆå™¨æ²¡æœ‰çš„æ–°ç‰¹æ€§"><a href="#å¤„ç†æµè§ˆå™¨æ²¡æœ‰çš„æ–°ç‰¹æ€§" class="headerlink" title="å¤„ç†æµè§ˆå™¨æ²¡æœ‰çš„æ–°ç‰¹æ€§"></a>å¤„ç†æµè§ˆå™¨æ²¡æœ‰çš„æ–°ç‰¹æ€§</h2><p>æœ‰äº›æµè§ˆå™¨æ²¡æœ‰ Promiseã€Symbolã€Map ç­‰ä¸€äº›æ–°ç‰¹æ€§ï¼Œå°±éœ€è¦ä½¿ç”¨ polyfill æ¥å®ç°ï¼›</p><p>é¦–å…ˆæ¥ç†è§£ä¸‹ babel å’Œ babel polyfill çš„å…³ç³»ï¼š</p><ol><li>babel è§£å†³<strong>è¯­æ³•</strong>å±‚é¢çš„é—®é¢˜ï¼Œæ¯”å¦‚å°† ES6+è¯­æ³•è½¬ä¸º ES5 è¯­æ³•ã€‚</li><li>babel polyfill è§£å†³<strong>API</strong>å±‚é¢çš„é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨å«ç‰‡ï¼Œæ¯”å¦‚ä¸‹é¢ä¸‰ç§ï¼š</li></ol><ul><li><p><strong>@babel/polyfill</strong>ï¼šé€šè¿‡å‘å…¨å±€å¯¹è±¡å’Œå†…ç½®å¯¹è±¡çš„ prototype ä¸Šæ·»åŠ æ–¹æ³•æ¥å®ç°çš„ï¼Œä»è€Œè§£å†³äº†ä½ç‰ˆæœ¬æµè§ˆå™¨æ— æ³•å®ç°çš„ä¸€äº› es6+è¯­æ³•ï¼›ä½†æ±¡æŸ“äº†å…¨å±€ç©ºé—´å’Œå†…ç½®å¯¹è±¡ä¹Ÿæ˜¯ä¸ªç¼ºç‚¹ã€‚</p></li><li><p><strong>@babel/runtime</strong>ï¼šä¸ä¼šæ±¡æŸ“å…¨å±€ç©ºé—´å’Œå†…ç½®å¯¹è±¡åŸå‹ï¼Œä½†å¦‚æœä½¿ç”¨çš„ç‰¹æ€§éå¸¸å¤šï¼Œå°±ä¼šå¯¼è‡´è¿™ç§æŒ‰éœ€å¼•å…¥éå¸¸ç¹çã€‚ç”±äºå®ƒæ˜¯ polyfill çš„åŒ…ï¼Œé€‚åˆåœ¨ç»„ä»¶ï¼Œç±»åº“ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p></li><li><p><strong>@babel/plugin-transform-runtime</strong>ï¼šå°† helper å’Œ polyfill éƒ½æ”¹ä¸ºä»ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹å¼•å…¥ï¼Œè§£å†³äº†å…¨å±€ç©ºé—´å’Œå†…ç½®å¯¹è±¡çš„é—®é¢˜ï¼›éœ€è¦ç”¨åˆ°ä¸¤ä¸ªä¾èµ–åŒ… <code>@babel/runtime</code>å’Œ<code>@babel/runtime-corejs3</code>â€”â€”åŠ è½½ ES6+ æ–°çš„ APIï¼ˆcorejs æ ¹æ®ä½ çš„ç‰ˆæœ¬ï¼‰</p></li><li><p>babel-runtime é€‚åˆåœ¨ç»„ä»¶ï¼Œç±»åº“é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè€Œ babel-polyfill é€‚åˆåœ¨ä¸šåŠ¡é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p></li></ul><p>polyfill ç”¨åˆ°çš„ core-js æ˜¯å¯ä»¥æŒ‡å®šç‰ˆæœ¬çš„ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>core-js@3</code> <code>core-js@2</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add @babel&#x2F;polyfill core-js@3</span><br><span class="line">yarn add @babel&#x2F;plugin-transform-runtime -D</span><br><span class="line">yarn add @babel&#x2F;runtime @babel&#x2F;runtime-corejs3</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæ¯•åï¼Œåœ¨ <code>.babelrc</code>è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    [</span><br><span class="line">      &quot;@babel&#x2F;preset-env&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;useBuiltIns&quot;: &quot;usage&quot;, &#x2F;&#x2F; æŒ‰éœ€å¼•å…¥ï¼Œå®ƒèƒ½è‡ªåŠ¨ç»™æ¯ä¸ªæ–‡ä»¶æ·»åŠ å…¶éœ€è¦çš„polyfill</span><br><span class="line">        &quot;corejs&quot;: 3 &#x2F;&#x2F; æ ¹æ®ä½ çš„ç‰ˆæœ¬æ¥å†™</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    [</span><br><span class="line">      &quot;@babel&#x2F;plugin-transform-runtime&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;corejs&quot;: 3,</span><br><span class="line">        &quot;helpers&quot;: true, &#x2F;&#x2F; å¼€å¯å†…è”çš„babel helpers(å³babelæˆ–è€…ç¯å¢ƒæœ¬æ¥çš„å­˜åœ¨çš„å«ç‰‡æˆ–è€…æŸäº›å¯¹è±¡æ–¹æ³•å‡½æ•°)</span><br><span class="line">        &quot;regenerator&quot;: true, &#x2F;&#x2F; å¼€å¯generatorå‡½æ•°è½¬æ¢æˆä½¿ç”¨regenerator runtimeæ¥é¿å…æ±¡æŸ“å…¨å±€åŸŸ</span><br><span class="line">        &quot;useESModules&quot;: false</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘-React"><a href="#ç¼–è¯‘-React" class="headerlink" title="ç¼–è¯‘ React"></a>ç¼–è¯‘ React</h2><p>å®‰è£… react æœ‰å…³åŒ…å’Œç¼–è¯‘ React çš„ babel æ’ä»¶</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add react react-dom</span><br><span class="line">yarn add @babel&#x2F;preset-react -D</span><br></pre></td></tr></table></figure><p>é‡å†™<code>src/index.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.jsx'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶<code>src/App.jsx</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>App<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>.babelrc</code>æ–‡ä»¶ï¼ˆpresets çš„é¡ºåºä»å³å‘å·¦ï¼‰</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    [</span><br><span class="line">      &quot;@babel&#x2F;preset-env&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;useBuiltIns&quot;: &quot;usage&quot;, &#x2F;&#x2F; æŒ‰éœ€å¼•å…¥ï¼Œå®ƒèƒ½è‡ªåŠ¨ç»™æ¯ä¸ªæ–‡ä»¶æ·»åŠ å…¶éœ€è¦çš„polyfill</span><br><span class="line">        &quot;corejs&quot;: 3 &#x2F;&#x2F; æ ¹æ®ä½ çš„ç‰ˆæœ¬æ¥å†™</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;@babel&#x2F;preset-react&quot;</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒæˆåŠŸç¼–è¯‘</p><h2 id="devServer-é…ç½®"><a href="#devServer-é…ç½®" class="headerlink" title="devServer é…ç½®"></a>devServer é…ç½®</h2><p>å®‰è£… devServerï¼Œåœ¨å¼€å‘ä¸­å®æ—¶æ£€æµ‹æ–‡ä»¶çš„å˜åŒ–</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add webpack-dev-server -D</span><br></pre></td></tr></table></figure><p>åœ¨``package.json`ä¸­è®¾ç½®å¯åŠ¨å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;webpack-dev-server&quot;,</span><br></pre></td></tr></table></figure><p>webpack.config.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    host: <span class="string">'0.0.0.0'</span>,</span><br><span class="line">    compress: <span class="literal">true</span>, <span class="comment">// ä½¿ç”¨gzipå‹ç¼©</span></span><br><span class="line">    port: <span class="number">8080</span>, <span class="comment">// ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    overlay: <span class="literal">true</span>, <span class="comment">// ä»£ç å‡ºé”™å¼¹å‡ºæµ®åŠ¨å±‚</span></span><br><span class="line">    hot: <span class="literal">true</span>, <span class="comment">// å¼€å¯çƒ­æ›´æ–°</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼€å¯æœåŠ¡å™¨<code>yarn dev</code>ï¼Œæ‰“å¼€<code>http://localhost:8080</code>ï¼Œå°±å¯ä»¥ React ç»„ä»¶æ­£å¸¸ç¼–è¯‘è¿è¡Œäº†ã€‚</p><h2 id="å¼€å‘ç¯å¢ƒçƒ­æ›´æ–°"><a href="#å¼€å‘ç¯å¢ƒçƒ­æ›´æ–°" class="headerlink" title="å¼€å‘ç¯å¢ƒçƒ­æ›´æ–°"></a>å¼€å‘ç¯å¢ƒçƒ­æ›´æ–°</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add -D react-hot-loader</span><br></pre></td></tr></table></figure><p>åœ¨<code>webpack.config.js</code>é…ç½®ï¼ŒdevServer ä¸Šé¢å·²ç»å¼€å¯<code>hot:true</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>åœ¨<code>src/index.js</code>ä¸­æ·»åŠ </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span> &amp;&amp; <span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œ<code>yarn dev</code>ï¼Œçƒ­æ›´æ–°ç”Ÿæ•ˆ</p><h2 id="çœç•¥æ–‡ä»¶åç¼€å’Œè®¾ç½®åˆ«å"><a href="#çœç•¥æ–‡ä»¶åç¼€å’Œè®¾ç½®åˆ«å" class="headerlink" title="çœç•¥æ–‡ä»¶åç¼€å’Œè®¾ç½®åˆ«å"></a>çœç•¥æ–‡ä»¶åç¼€å’Œè®¾ç½®åˆ«å</h2><p>ä¸Šé¢å¼•å…¥ App ç»„ä»¶æˆ‘ä»¬æ˜¯<code>import App from &#39;./App.jsx&#39;</code>åŠ äº†åç¼€ï¼Œå¦‚æœçœç•¥çš„è¯ä¼šæŠ¥é”™ï¼›æˆ‘ä»¬å¯ä»¥åœ¨ webpack é…ç½®æ–‡ä»¶çš„<code>resolve</code>è®¾ç½®å¯ä»¥çœç•¥åç¼€ï¼›</p><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé¡¹ç›®è¾ƒå¤§ï¼Œç»„ä»¶å±‚çº§å…³ç³»å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç»™è·¯å¾„è®¾ç½®åˆ«å</p><p>æ–°å»º<code>src/components/Header/index.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Header = <span class="function"><span class="params">()</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header</span><br></pre></td></tr></table></figure><p>åœ¨ webpack.config.js è¿›è¡Œé…ç½®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'app.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">'.jsx'</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'@components'</span>: path.resolve(__dirname, <span class="string">'src/components'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>App.jsx</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'@components/Header'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App</span></span><br></pre></td></tr></table></figure><h2 id="åŠ è½½-Css"><a href="#åŠ è½½-Css" class="headerlink" title="åŠ è½½ Css"></a>åŠ è½½ Css</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add style-loader css-loader -D</span><br></pre></td></tr></table></figure><p>ç»™ Header ç»„ä»¶æ·»åŠ æ ·å¼ï¼Œæ–°å»ºæ–‡ä»¶<code>src/components/Header/index.css</code>ï¼Œå†åˆ° Header ç»„ä»¶ä¸­å¼•å…¥<code>import &#39;./index.css&#39;</code></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>css-loader çš„ä½œç”¨æ˜¯å¤„ç† css æ–‡ä»¶ä¸­ @importï¼Œurl ä¹‹ç±»çš„è¯­å¥ï¼ˆå°† CSS è½¬åŒ–æˆ CommonJS æ¨¡å—ï¼‰</li><li>style-loader åˆ™æ˜¯å°† css æ–‡ä»¶å†…å®¹æ”¾åœ¨ style æ ‡ç­¾å†…å¹¶æ’å…¥ head ä¸­</li></ul><p><code>webpack.config.js</code>é…ç½®ï¼ˆloader æ‰§è¡Œé¡ºåºä»å³åˆ°å·¦ï¼‰</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ”¯æŒ-Sass"><a href="#æ”¯æŒ-Sass" class="headerlink" title="æ”¯æŒ Sass"></a>æ”¯æŒ Sass</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add sass sass-loader -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(sass|scss)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        <span class="string">'style-loader'</span>,</span><br><span class="line">        <span class="string">'css-loader'</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'sass-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            implementation: <span class="built_in">require</span>(<span class="string">'sass'</span>), <span class="comment">// ä½¿ç”¨dart-sassä»£æ›¿node-sass</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>æŠŠ<code>src/components/Header/index.css</code>æ”¹ä¸º<code>.scss</code>æ–‡ä»¶ï¼ŒHeader ç»„ä»¶<code>index.js</code>çš„å¼•å…¥ä¹Ÿä¿®æ”¹ä¸€ä¸‹å¼•å…¥ css æ–‡ä»¶åï¼Œç„¶åæ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒOKã€‚</p><p>less å°±ä¸å†™äº†ï¼Œæ¯•ç«Ÿä¸€ä¸ªé¡¹ç›®é€‰ä¸€ç§å°±è¡Œäº†ã€‚</p><h2 id="é›†æˆ-Postcss"><a href="#é›†æˆ-Postcss" class="headerlink" title="é›†æˆ Postcss"></a>é›†æˆ Postcss</h2><p>postcss-loader ä½œç”¨ï¼š</p><ul><li>æŠŠ css è§£æä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘</li><li>è°ƒç”¨æ’ä»¶å¤„ç†æŠ½è±¡è¯­æ³•æ ‘å¹¶æ·»åŠ åŠŸèƒ½ï¼Œå¦‚å¤„ç† CSS å…¼å®¹æ·»åŠ ä¸€äº›æ–°ç‰¹æ€§çš„å‚å•†å‰ç¼€</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add postcss-loader autoprefixer -D</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º<code>postcss.config.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)(&#123;</span><br><span class="line">      <span class="comment">// è‡ªåŠ¨åœ¨æ ·å¼ä¸­æ·»åŠ æµè§ˆå™¨å‚å•†å‰ç¼€</span></span><br><span class="line">      overrideBrowserslist: [<span class="string">'last 2 versions'</span>, <span class="string">'&gt;1%'</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>webpack.config.js</code>ä¸­é…ç½®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'postcss-loader'</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(sass|scss)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        <span class="string">'style-loader'</span>,</span><br><span class="line">        <span class="string">'css-loader'</span>,</span><br><span class="line">        <span class="string">'postcss-loader'</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'sass-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            implementation: <span class="built_in">require</span>(<span class="string">'sass'</span>), <span class="comment">// ä½¿ç”¨dart-sassä»£æ›¿node-sass</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ ·å¼æ–‡ä»¶æ·»åŠ  CSS3 ä¸€äº›æ–°ç‰¹æ€§ï¼Œå°±èƒ½çœ‹åˆ°è¢«è‡ªåŠ¨æ·»åŠ äº†å…¼å®¹å¤„ç†äº†ã€‚</p><h2 id="åŠ è½½å›¾ç‰‡"><a href="#åŠ è½½å›¾ç‰‡" class="headerlink" title="åŠ è½½å›¾ç‰‡"></a>åŠ è½½å›¾ç‰‡</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add file-loader url-loader -D</span><br></pre></td></tr></table></figure><p>åŠ å…¥ä¸€å¼ å›¾ç‰‡<code>src/components/Header/img/fe-house-qrcode.jpg</code>ï¼Œåœ¨<code>src/components/Header/index.js</code>ä¸­å¼•å…¥</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#39;.&#x2F;img&#x2F;fe-house-qrcode.jpg&#39;</span><br></pre></td></tr></table></figure><p>åœ¨<code>webpack.config.js</code>ä¸­è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(png|jpe?g|gif)$/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          name: <span class="string">'[name]_[hash].[ext]'</span>,</span><br><span class="line">          outputPath: <span class="string">'images/'</span>, <span class="comment">// æ‰“åŒ…å›¾ç‰‡åˆ°distç›®å½•ä¸‹çš„imagesæ–‡ä»¶å¤¹</span></span><br><span class="line">          limit: <span class="number">102400</span>, <span class="comment">// å›¾ç‰‡è¶…è¿‡100KBå°±ä½¿ç”¨file-loaderæ‰“åŒ…ï¼Œå¦åˆ™å›¾ç‰‡ä»¥base64æ ¼å¼å­˜åœ¨</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æå­—ä½“å›¾æ ‡"><a href="#è§£æå­—ä½“å›¾æ ‡" class="headerlink" title="è§£æå­—ä½“å›¾æ ‡"></a>è§£æå­—ä½“å›¾æ ‡</h2><p>è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œç›´æ¥ä¸Šé…ç½®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(eot|ttf|svg|woff|woff2)$/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">'file-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          name: <span class="string">'[name]_[hash].[ext]'</span>,</span><br><span class="line">          outputPath: <span class="string">'fonts/'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒºåˆ†ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒ"><a href="#åŒºåˆ†ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒ" class="headerlink" title="åŒºåˆ†ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒ"></a>åŒºåˆ†ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒ</h2><p>åˆ°è¿™é‡Œï¼Œæœ€åŸºæœ¬é…ç½®å·®ä¸å¤šå¯ä»¥ç”¨äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦åšä¸€äº›ç»†èŠ‚æˆ–ä¼˜åŒ–çš„é…ç½®ã€‚</p><p>å®‰è£…<code>webpack-merge</code>æ•´åˆ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add webpack-merge -D</span><br></pre></td></tr></table></figure><p>æç‚¼å‡ºä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>webpack.common.js å…¬å…±é…ç½®</li><li>webpack.dev.js å¼€å‘ç¯å¢ƒé…ç½®</li><li>webpack.prod.js ç”Ÿäº§ç¯å¢ƒé…ç½®</li></ul><p>å°†<code>webpack.config.js</code>çš„ä¸œè¥¿æç‚¼å‡ºæ¥åˆ†ä¸‰ä¸ªæ–‡ä»¶</p><ul><li>webpack.common.js</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'app.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">'.jsx'</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'@components'</span>: path.resolve(__dirname, <span class="string">'src/components'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">        loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'postcss-loader'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(sass|scss)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          <span class="string">'css-loader'</span>,</span><br><span class="line">          <span class="string">'postcss-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'sass-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              implementation: <span class="built_in">require</span>(<span class="string">'sass'</span>), <span class="comment">// ä½¿ç”¨dart-sassä»£æ›¿node-sass</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpe?g|gif)$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'url-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: <span class="string">'[name]_[hash].[ext]'</span>,</span><br><span class="line">            outputPath: <span class="string">'images/'</span>, <span class="comment">// æ‰“åŒ…å›¾ç‰‡åˆ°distç›®å½•ä¸‹çš„imagesæ–‡ä»¶å¤¹</span></span><br><span class="line">            limit: <span class="number">102400</span>, <span class="comment">// å›¾ç‰‡è¶…è¿‡100KBå°±ä½¿ç”¨file-loaderæ‰“åŒ…ï¼Œå¦åˆ™å›¾ç‰‡ä»¥base64æ ¼å¼å­˜åœ¨</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(eot|ttf|svg|woff|woff2)$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'file-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: <span class="string">'[name]_[hash].[ext]'</span>,</span><br><span class="line">            outputPath: <span class="string">'fonts/'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    host: <span class="string">'0.0.0.0'</span>,</span><br><span class="line">    compress: <span class="literal">true</span>, <span class="comment">// ä½¿ç”¨gzipå‹ç¼©</span></span><br><span class="line">    port: <span class="number">8080</span>, <span class="comment">// ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    overlay: <span class="literal">true</span>, <span class="comment">// ä»£ç å‡ºé”™å¼¹å‡ºæµ®åŠ¨å±‚</span></span><br><span class="line">    hot: <span class="literal">true</span>, <span class="comment">// å¼€å¯çƒ­æ›´æ–°</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>webpack.dev.js</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">'./webpack.common'</span>)</span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  devtool: <span class="string">'cheap-module-eval-source-map'</span>, <span class="comment">// å¸®åŠ©æˆ‘ä»¬å®šä½åˆ°é”™è¯¯ä¿¡æ¯ä½ç½®çš„æºä»£ç æ–‡ä»¶</span></span><br><span class="line">  plugins: [<span class="keyword">new</span> webpack.HotModuleReplacementPlugin()],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    host: <span class="string">'0.0.0.0'</span>,</span><br><span class="line">    compress: <span class="literal">true</span>, <span class="comment">// ä½¿ç”¨gzipå‹ç¼©</span></span><br><span class="line">    port: <span class="number">8080</span>, <span class="comment">// ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    overlay: <span class="literal">true</span>, <span class="comment">// ä»£ç å‡ºé”™å¼¹å‡ºæµ®åŠ¨å±‚</span></span><br><span class="line">    hot: <span class="literal">true</span>, <span class="comment">// å¼€å¯çƒ­æ›´æ–°</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonConfig, devConfig)</span><br></pre></td></tr></table></figure><ul><li>webpack.prod.js</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">'./webpack.common'</span>)</span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  devtool: <span class="string">'none'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonConfig, devConfig)</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>package.json</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;dev&quot;: &quot;webpack-dev-server --config webpack.dev.js&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;npx webpack --config webpack.prod.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆã€‚</p><h2 id="æ‰“åŒ…å‰æ¸…ç†-dist-ç›®å½•"><a href="#æ‰“åŒ…å‰æ¸…ç†-dist-ç›®å½•" class="headerlink" title="æ‰“åŒ…å‰æ¸…ç† dist ç›®å½•"></a>æ‰“åŒ…å‰æ¸…ç† dist ç›®å½•</h2><p>åœ¨ä½ è°ƒè¯•æ‰“åŒ…çš„è¿‡ç¨‹å¯èƒ½ä¼šå¤šå‡ºä¸€äº›é—ç•™æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦æœ€æ–°æ‰“åŒ…ç¼–è¯‘çš„æ–‡ä»¶ï¼Œå°±éœ€è¦å…ˆæ¸…é™¤ dist ç›®å½•</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add clean-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>åŠ åˆ°<code>webpack.common.js</code>æ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> CleanWebpackPlugin()],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¡¹ç›®è§„èŒƒ"><a href="#é¡¹ç›®è§„èŒƒ" class="headerlink" title="é¡¹ç›®è§„èŒƒ"></a>é¡¹ç›®è§„èŒƒ</h2><p>ä½œä¸ºé¡¹ç›®ä»£ç é£æ ¼çš„ç»Ÿä¸€è§„èŒƒï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹å·¥å…·æ¥å¼ºåˆ¶ï¼Œè®©å›¢é˜Ÿæˆå‘˜çš„ä»£ç é£æ ¼æ›´è¶‹äºä¸€è‡´ã€‚</p><h3 id="EditorConfig"><a href="#EditorConfig" class="headerlink" title="EditorConfig"></a>EditorConfig</h3><p><code>.editorconfig</code> æ˜¯è·¨ç¼–è¾‘å™¨ç»´æŠ¤ä¸€è‡´ç¼–ç é£æ ¼çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ VSCode ä¸­éœ€è¦å®‰è£…ç›¸åº”æ’ä»¶<code>EditorConfig for VS Code</code>ï¼Œå®‰è£…å®Œæ¯•ä¹‹åï¼Œ<br>ä½¿ç”¨å¿«æ·é”®<code>ctrl+shift+p</code>æ‰“å¼€å‘½ä»¤å°ï¼Œè¾“å…¥ <code>Generate .editorcofig</code> å³å¯å¿«é€Ÿç”Ÿæˆ <code>.editorconfig</code> æ–‡ä»¶ã€‚</p><p>åœ¨<code>.editorcofig</code>æ–‡ä»¶ï¼Œå°±å¯ä»¥å¤§å®¶æ ¹æ®ä¸åŒæ¥è®¾ç½®æ–‡ä»¶äº†ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root &#x3D; true</span><br><span class="line"></span><br><span class="line">[*]</span><br><span class="line">indent_style &#x3D; space</span><br><span class="line">indent_size &#x3D; 2</span><br><span class="line">charset &#x3D; utf-8</span><br><span class="line">trim_trailing_whitespace &#x3D; true</span><br><span class="line">insert_final_newline &#x3D; true</span><br><span class="line">end_of_line &#x3D; lf</span><br></pre></td></tr></table></figure><h3 id="Prettier"><a href="#Prettier" class="headerlink" title="Prettier"></a>Prettier</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add prettier -D</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿéœ€è¦å®‰è£… VSCode æ’ä»¶<code>Prettier - Code formatter</code></p><p>å®‰è£…å®Œæˆååœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹<code>.vscode</code>ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶<code>settings.json</code>,è¯¥æ–‡ä»¶çš„é…ç½®ä¼˜å…ˆäºä½ è‡ªå·± VSCode å…¨å±€çš„é…ç½®ï¼Œä¸ä¼šå› ä¸ºå›¢é˜Ÿä¸åŒæˆå‘˜çš„ VSCode å…¨å±€é…ç½®ä¸åŒè€Œå¯¼è‡´æ ¼å¼åŒ–ä¸åŒã€‚</p><p>settings.json</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &#x2F;&#x2F; æŒ‡å®šå“ªäº›æ–‡ä»¶ä¸å‚ä¸æœç´¢</span><br><span class="line">  &quot;search.exclude&quot;: &#123;</span><br><span class="line">    &quot;**&#x2F;node_modules&quot;: true,</span><br><span class="line">    &quot;dist&quot;: true,</span><br><span class="line">    &quot;yarn.lock&quot;: true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;editor.formatOnSave&quot;: true,</span><br><span class="line">  &quot;eslint.validate&quot;: [&quot;javascript&quot;, &quot;javascriptreact&quot;],</span><br><span class="line">  &quot;editor.codeActionsOnSave&quot;: &#123;</span><br><span class="line">    &quot;source.fixAll.eslint&quot;: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[javascript]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[javascriptreact]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[json]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[html]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[markdown]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[css]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[less]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;[scss]&quot;: &#123;</span><br><span class="line">    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œåæ–°å»ºæ–‡ä»¶<code>.prettierrc</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;trailingComma&quot;: &quot;all&quot;,</span><br><span class="line">  &quot;tabWidth&quot;: 2,</span><br><span class="line">  &quot;semi&quot;: false,</span><br><span class="line">  &quot;singleQuote&quot;: true,</span><br><span class="line">  &quot;endOfLine&quot;: &quot;lf&quot;,</span><br><span class="line">  &quot;printWidth&quot;: 120,</span><br><span class="line">  &quot;bracketSpacing&quot;: true,</span><br><span class="line">  &quot;arrowParens&quot;: &quot;avoid&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add eslint -D</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œåè¿è¡Œ<code>npx eslint --init</code>ï¼Œè¿è¡Œåæœ‰é€‰é¡¹ï¼Œé€‰æ‹©å¦‚ä¸‹ï¼ˆè‡ªè¡Œæ ¹æ®éœ€è¦ï¼‰ï¼š</p><blockquote></blockquote><ul><li>To check syntax, find problems, and enforce code style</li><li>JavaScript modules (import/export)</li><li>React</li><li>Noï¼ˆè¿™é‡Œæˆ‘ä»¬æ²¡ä½¿ç”¨ TS å°±ä¸å¿…äº†ï¼‰</li><li>Browser Node</li><li>Use a popular style guide</li><li>Airbnb: <a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">https://github.com/airbnb/javascript</a></li><li>JavaScript</li><li>Would you like to install them now with npmï¼ˆYesï¼‰ç›´æ¥å®‰è£…</li></ul><p>å®Œæ¯•åä¼šå‘ç°å·²ç»è‡ªåŠ¨å®‰è£…äº† ESLint ç›¸å…³çš„åŒ…ï¼Œä¹Ÿè‡ªåŠ¨ç”Ÿæˆäº†<code>.eslintrc.js</code>æ–‡ä»¶ï¼Œé‡Œé¢çš„<code>rules</code>é»˜è®¤æ˜¯ç©ºï¼Œè¿™ä¸ªå°±éœ€è¦å›¢é˜Ÿè‡ªå·±çš„é¢å¤–é…ç½®äº†ã€‚æ³¨ï¼šVSCode éœ€è¦å®‰è£…<code>ESLint</code>æ’ä»¶</p><p>æ–°å»ºæ–‡ä»¶<code>.eslintignore</code>ï¼Œå¿½ç•¥ä¸€äº›æ–‡ä»¶çš„æ£€æŸ¥</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;node_modules</span><br><span class="line">&#x2F;public</span><br><span class="line">&#x2F;dist</span><br></pre></td></tr></table></figure><h3 id="StyleLint"><a href="#StyleLint" class="headerlink" title="StyleLint"></a>StyleLint</h3><p>ä¸Šé¢æ˜¯é’ˆå¯¹è§„èŒƒ JS ä»£ç çš„ï¼Œæ¥ä¸‹æ¥è§„èŒƒ CSS ä»£ç ï¼ŒåŒæ ·éœ€è¦å®‰è£… VSCode æ’ä»¶<code>stylelint</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add stylelint stylelint-config-standard -D</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶<code>.stylelintrc.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  extends: [<span class="string">'stylelint-config-standard'</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">'comment-empty-line-before'</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">'declaration-empty-line-before'</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">'function-name-case'</span>: <span class="string">'lower'</span>,</span><br><span class="line">    <span class="string">'no-descending-specificity'</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">'no-invalid-double-slash-comments'</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">'rule-empty-line-before'</span>: <span class="string">'always'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  ignoreFiles: [<span class="string">'node_modules/**/*'</span>, <span class="string">'dist/**/*'</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Prettierã€ESLintã€Stylelint-å†²çªè§£å†³"><a href="#Prettierã€ESLintã€Stylelint-å†²çªè§£å†³" class="headerlink" title="Prettierã€ESLintã€Stylelint å†²çªè§£å†³"></a>Prettierã€ESLintã€Stylelint å†²çªè§£å†³</h3><p>ä¸Šé¢ä¸€é¡¿æ“ä½œåï¼Œå¯èƒ½å‘ç° ESLint ç»™æ–‡ä»¶é£˜çº¢ï¼Œä½†ä¿å­˜åæ ¼å¼å˜äº†åˆå¥½åƒæ¢å¤åŸæ ·ï¼Œè¿™ä¸ªå°±æ˜¯å†²çªé—®é¢˜ï¼Œä¸€èˆ¬è§£å†³å°±æ˜¯åˆ©ç”¨æ’ä»¶ç¦ç”¨ä¸ Prettier èµ·å†²çªçš„è§„åˆ™ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add eslint-config-prettier -D</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>.eslintrc.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="string">'prettier'</span>,</span><br><span class="line">    <span class="string">'prettier/react'</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä»£ç è¿˜å› ä¸º ESLint é£˜çº¢ï¼Œå¯ä»¥çœ‹æƒ…å†µæ·»åŠ å¿½ç•¥çš„è§„åˆ™ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add stylelint-config-prettier -D</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>.stylelintrc.js</code>æ–‡ä»¶ä¸­å¢åŠ ä¸€ä¸ª extend</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">extends: [<span class="string">'stylelint-config-prettier'</span>],</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å†™åˆ°è¿™é‡Œå°±åœäº†ï¼Œå½“ç„¶è¦ç»§ç»­å¾€ä¸‹åšçš„è¯è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ç”¨ husky ä»£ç æäº¤ï¼Œè¿˜æœ‰å¾ˆå¤šåƒ webpack å‹ç¼©åˆ†ç¦» JS å’Œ CSS ç­‰ä¸€äº›ï¼Œè¿™äº›ç•™åˆ°ä»¥åå†™ä¸€ç¯‡ webpack æ€§èƒ½ä¼˜åŒ–å†æ¥ä¸€èµ·æ€»ç»“ã€‚</p><p><a href="https://github.com/Jacky-Summer/react-cli" target="_blank" rel="noopener">react-cli Github åœ°å€</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>Webpack</tag>
        <tag>å·¥ç¨‹åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£ JavaScript ä¹‹äº‹ä»¶å¾ªç¯(Event Loop)</title>
    <url>/2020/09/03/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-JavaScript-%E4%B9%8B%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF-Event-Loop/</url>
    <content><![CDATA[<p>è¿™æ¬¡ç»§ç»­ä¸€æ­¥æ­¥å›é¡¾ JS åŸºç¡€çŸ¥è¯†ç‚¹ï¼Œä»Šå¤©è®²çš„æ˜¯ JS ä¸­çš„äº‹ä»¶å¾ªç¯ã€‚</p>
<a id="more"></a>

<p>æ·±å…¥ç†è§£ JavaScript ç³»åˆ—å·²ç»å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œä¹‹å‰çš„ç³»åˆ—æ–‡ç« å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://juejin.im/post/6844903976765227016" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹å˜é‡æå‡</a></li>
<li><a href="https://juejin.im/post/6844903977511829517" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹ç”±ä¸€é“é¢˜æ¥æ€è€ƒé—­åŒ…</a></li>
<li><a href="https://juejin.im/post/6844904006179913741" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œæ ˆ</a></li>
<li><a href="https://juejin.im/post/6844904006901301255" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå˜é‡å¯¹è±¡</a></li>
<li><a href="https://juejin.im/post/6844904079051718664" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹ä½œç”¨åŸŸé“¾ä¸é—­åŒ…</a></li>
<li><a href="https://juejin.im/post/6844904065785315341" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹åŸå‹ä¸åŸå‹é“¾</a></li>
<li><a href="https://juejin.im/post/6844904070113656839" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹ new åŸç†åŠæ¨¡æ‹Ÿå®ç°</a></li>
<li><a href="https://juejin.im/post/6844903978438754318" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼æ–¹æ³•ï¼ˆthis,applyï¼‰</a></li>
<li><a href="https://juejin.im/post/6844904003277455368" target="_blank" rel="noopener">æ·±å…¥ç†è§£ JavaScript ä¹‹å®ç°ç»§æ‰¿çš„ 7 ç§æ–¹å¼</a></li>
</ul>
<p>æ›´å¤šå‰ç«¯å†…å®¹å¯ä»¥çœ‹æˆ‘ <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a></p>
<h2 id="JavaScript-æ˜¯å•çº¿ç¨‹çš„"><a href="#JavaScript-æ˜¯å•çº¿ç¨‹çš„" class="headerlink" title="JavaScript æ˜¯å•çº¿ç¨‹çš„"></a>JavaScript æ˜¯å•çº¿ç¨‹çš„</h2><p>JS æ˜¯ä¸€é—¨å•çº¿ç¨‹çš„éé˜»å¡çš„è„šæœ¬è¯­è¨€ï¼Œè¿™è¡¨ç¤ºåœ¨åŒä¸€æ—¶åˆ»æœ€å¤šä¹Ÿåªæœ‰ä¸€ä¸ªä»£ç æ®µæ‰§è¡Œã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆ-JavaScript-æ˜¯å•çº¿ç¨‹çš„"><a href="#ä¸ºä»€ä¹ˆ-JavaScript-æ˜¯å•çº¿ç¨‹çš„" class="headerlink" title="ä¸ºä»€ä¹ˆ JavaScript æ˜¯å•çº¿ç¨‹çš„"></a>ä¸ºä»€ä¹ˆ JavaScript æ˜¯å•çº¿ç¨‹çš„</h2><p>å¦‚æœ JS æ˜¯å¤šçº¿ç¨‹çš„ï¼Œå› ä¸º JS æœ‰ DOM API å¯ä»¥æ“ä½œ DOMï¼Œå¦‚æœåŒæ—¶å¼€äº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ DOM çš„è¯ï¼Œä¸€ä¸ªçº¿ç¨‹åˆ é™¤äº†å½“å‰çš„ DOM èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è¦æ“ä½œå½“å‰çš„ DOMï¼Œé‚£ä¹ˆå°±ä¼šæœ‰çŸ›ç›¾åˆ°åº•ä»¥å“ªä¸ªçº¿ç¨‹ä¸ºä¸»ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‡ºç°ï¼ŒJS å°±è¢«è®¾è®¡ä¸ºå•çº¿ç¨‹ï¼Œè€Œä¸”å•çº¿ç¨‹æ‰§è¡Œæ•ˆç‡é«˜ã€‚ç°åœ¨è™½ç„¶ä¹Ÿæœ‰ web worker æ ‡å‡†çš„å‡ºç°ï¼Œä½†å®ƒä¹Ÿæœ‰å¾ˆå¤šé™åˆ¶ï¼Œå—ä¸»çº¿ç¨‹æ§åˆ¶ï¼Œæ˜¯ä¸»çº¿ç¨‹çš„å­çº¿ç¨‹ã€‚</p>
<h2 id="JS-å¦‚ä½•å¤„ç†å¼‚æ­¥ä»»åŠ¡"><a href="#JS-å¦‚ä½•å¤„ç†å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="JS å¦‚ä½•å¤„ç†å¼‚æ­¥ä»»åŠ¡"></a>JS å¦‚ä½•å¤„ç†å¼‚æ­¥ä»»åŠ¡</h2><p>JS æ˜¯å•çº¿ç¨‹ï¼Œé‚£ä¹ˆéé˜»å¡æ€ä¹ˆä½“ç°å‘¢ï¼Ÿå¦‚æœ JS æ˜¯é˜»å¡çš„ï¼Œé‚£ä¹ˆ JS å‘èµ·ä¸€ä¸ªå¼‚æ­¥ IO è¯·æ±‚ï¼Œåœ¨ç­‰å¾…ç»“æœè¿”å›çš„è¿™ä¸ªæ—¶é—´æ®µï¼Œåé¢çš„ä»£ç å°±æ— æ³•æ‰§è¡Œäº†ï¼Œè€Œ JS ä¸»çº¿ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå› æ­¤å¯èƒ½é€ æˆæµè§ˆå™¨å‡æ­»çš„çŠ¶æ€ã€‚äº‹å® JS æ˜¯éé˜»å¡çš„ï¼Œé‚£å®ƒè¦æ€ä¹ˆå®ç°å¼‚æ­¥ä»»åŠ¡å‘¢ï¼Œé çš„å°±æ˜¯äº‹ä»¶å¾ªç¯ã€‚</p>
<h2 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h2><p>äº‹ä»¶å¾ªç¯å°±æ˜¯é€šè¿‡å¼‚æ­¥æ‰§è¡Œä»»åŠ¡çš„æ–¹æ³•æ¥è§£å†³å•çº¿ç¨‹çš„å¼Šç«¯çš„ã€‚</p>
<ol>
<li>ä¸€å¼€å§‹æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œ</li>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­åŒæ­¥ä»£ç ç›´æ¥æ‰§è¡Œï¼Œå®ä»»åŠ¡è¿›å…¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¾®ä»»åŠ¡è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œå‡ºé˜Ÿï¼Œè¯»å–å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œæœ‰åˆ™ä¾æ¬¡æ‰§è¡Œï¼Œç›´åˆ°å…¨éƒ¨æ‰§è¡Œå®Œ</li>
<li>æ‰§è¡Œæµè§ˆå™¨ UI çº¿ç¨‹çš„æ¸²æŸ“å·¥ä½œ</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰ Web Worker ä»»åŠ¡ï¼Œæœ‰åˆ™æ‰§è¡Œ</li>
<li>æ‰§è¡Œå®Œæœ¬è½®çš„å®ä»»åŠ¡ï¼Œå›åˆ°ç¬¬ 2 æ­¥ï¼Œç»§ç»­ä¾æ­¤å¾ªç¯ï¼Œç›´åˆ°å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—éƒ½ä¸ºç©º</li>
</ol>
<h2 id="å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡</h2><p>JS å¼•æ“æŠŠæ‰€æœ‰ä»»åŠ¡åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»å«å®ä»»åŠ¡(macroTask)ï¼Œä¸€ç±»å«å¾®ä»»åŠ¡(microTask)</p>
<h3 id="å®ä»»åŠ¡"><a href="#å®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡"></a>å®ä»»åŠ¡</h3><ul>
<li>script(æ•´ä½“ä»£ç )</li>
<li>setTimeout/setInterval</li>
<li>I/O</li>
<li>UI æ¸²æŸ“</li>
<li>postMessage</li>
<li>MessageChannel</li>
<li>requestAnimationFrame</li>
<li>setImmediate(Node.js ç¯å¢ƒ)</li>
</ul>
<h3 id="å¾®ä»»åŠ¡"><a href="#å¾®ä»»åŠ¡" class="headerlink" title="å¾®ä»»åŠ¡"></a>å¾®ä»»åŠ¡</h3><ul>
<li>new Promise().then()</li>
<li>MutaionObserver</li>
<li>process.nextTick(Node.js ç¯å¢ƒï¼‰</li>
</ul>
<h2 id="ç»å…¸é¢˜ç›®-1"><a href="#ç»å…¸é¢˜ç›®-1" class="headerlink" title="ç»å…¸é¢˜ç›® 1"></a>ç»å…¸é¢˜ç›® 1</h2><p>å…³äºæ›´ç»†èŠ‚çš„æè¿°æˆ‘å°±ä¸å†™äº†ï¼Œå› ä¸ºæœ‰æ›´å¥½çš„æ–‡ç« å¯ä»¥å‚è€ƒå­¦ä¹ ï¼š</p>
<ul>
<li><a href="https://juejin.im/post/6844903512845860872" target="_blank" rel="noopener">è¿™ä¸€æ¬¡ï¼Œå½»åº•å¼„æ‡‚ JavaScript æ‰§è¡Œæœºåˆ¶</a></li>
</ul>
<p>ç®€å•ä»‹ç»åï¼Œæ¥ä¸‹æ¥å°±æ¥çœ‹å‡ é“ç»å…¸é¢˜ç›®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'script start'</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li>æ•´ä½“ script ä½œä¸ºç¬¬ä¸€ä¸ªå®ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹ï¼Œè¾“å‡º<code>script start</code></li>
<li>é‡åˆ° setTimeoutï¼ŒsetTimeout ä¸ºå®ä»»åŠ¡ï¼ŒåŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>é‡åˆ° Promiseï¼Œå…¶ then å›è°ƒå‡½æ•°åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼›ç¬¬äºŒä¸ª then å›è°ƒå‡½æ•°ä¹ŸåŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¾“å‡º<code>script end</code></li>
<li>æ£€æµ‹å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¾“å‡º<code>promise1</code>ã€<code>promise2</code></li>
<li>è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ï¼Œæ‰§è¡Œ setTimeout ä¸­çš„ä»£ç ï¼Œè¾“å‡º<code>setTimeout</code></li>
</ol>
<p>æœ€åæ‰§è¡Œç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">script start</span><br><span class="line">script end</span><br><span class="line">promise1</span><br><span class="line">promise2</span><br><span class="line">setTimeout</span><br></pre></td></tr></table></figure>

<h2 id="ç»å…¸é¢˜ç›®-2"><a href="#ç»å…¸é¢˜ç›®-2" class="headerlink" title="ç»å…¸é¢˜ç›® 2"></a>ç»å…¸é¢˜ç›® 2</h2><p>æ¥çœ‹ä¸€é“é¢è¯•çš„ç»å…¸é¢˜ç›®</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>)</span><br><span class="line">  <span class="keyword">await</span> async2()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async2'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script start'</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line">async1()</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li>æ•´ä½“ script ä½œä¸ºç¬¬ä¸€ä¸ªå®ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹ï¼Œä»£ç è‡ªä¸Šè€Œä¸‹æ‰§è¡Œï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¾“å‡º <code>script start</code></li>
<li>é‡åˆ° setTimeoutï¼ŒåŠ å…¥åˆ°å®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡Œ async1()ï¼Œè¾“å‡º<code>async1 start</code>ï¼›ç„¶åé‡åˆ°<code>await async2()</code>,await å®é™…ä¸Šæ˜¯è®©å‡ºçº¿ç¨‹çš„æ ‡å¿—ï¼Œé¦–å…ˆæ‰§è¡Œ async2()ï¼Œè¾“å‡º<code>async2</code>ï¼›æŠŠ async2() åé¢çš„ä»£ç <code>console.log(&#39;async1 end&#39;)</code>åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè·³å‡ºæ•´ä¸ª async å‡½æ•°ã€‚ï¼ˆasync å’Œ await æœ¬èº«å°±æ˜¯ promise+generator çš„è¯­æ³•ç³–ã€‚æ‰€ä»¥ await åé¢çš„ä»£ç æ˜¯å¾®ä»»åŠ¡ã€‚ï¼‰</li>
<li>ç»§ç»­æ‰§è¡Œï¼Œé‡åˆ° new Promiseï¼Œè¾“å‡º<code>promise1</code>ï¼ŒæŠŠ<code>.then()</code>ä¹‹åçš„ä»£ç åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­</li>
<li>ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¾“å‡º<code>script end</code>ã€‚æ¥ç€è¯»å–å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¾“å‡º<code>async1 end</code>ï¼Œ<code>promise2</code>ï¼Œæ‰§è¡Œå®Œæœ¬è½®çš„å®ä»»åŠ¡ã€‚ç»§ç»­æ‰§è¡Œä¸‹ä¸€è½®å®ä»»åŠ¡çš„ä»£ç ï¼Œè¾“å‡º<code>setTimeout</code></li>
</ol>
<p>æœ€åæ‰§è¡Œç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">script start</span><br><span class="line">async1 start</span><br><span class="line">async2</span><br><span class="line">promise1</span><br><span class="line">script end</span><br><span class="line">async1 end</span><br><span class="line">promise2</span><br><span class="line">setTimeout</span><br></pre></td></tr></table></figure>

<h2 id="ç»å…¸é¢˜ç›®-3"><a href="#ç»å…¸é¢˜ç›®-3" class="headerlink" title="ç»å…¸é¢˜ç›® 3"></a>ç»å…¸é¢˜ç›® 3</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'timer1'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">requestAnimationFrame(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'requestAnimationFrame'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'timer2'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise 1'</span>)</span><br><span class="line">  resolve()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise 2'</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise then'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>æ•´ä½“ script ä»£ç æ‰§è¡Œï¼Œå¼€å±€æ–°å¢ä¸‰ä¸ªå®ä»»åŠ¡ï¼Œä¸¤ä¸ª setTimeout å’Œä¸€ä¸ª requestAnimationFrame</li>
<li>é‡åˆ° Promiseï¼Œå…ˆè¾“å‡º<code>promise1</code>, <code>promise2</code>ï¼ŒåŠ æŠŠ then å›è°ƒåŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
<li>ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¾“å‡º<code>end</code></li>
<li>æ‰§è¡Œ promise çš„ then å›è°ƒï¼Œè¾“å‡º<code>promise then</code></li>
<li>æ¥ä¸‹æ¥å‰©ä¸‰ä¸ªå®ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çš„æ˜¯<code>timer1</code>ä¼šæ¯”<code>timer2</code>å…ˆæ‰§è¡Œï¼Œé‚£ä¹ˆ<code>requestAnimationFrame</code>å‘¢ï¼Ÿ</li>
</ul>
<p>å½“æ¯ä¸€è½®äº‹ä»¶å¾ªç¯çš„å¾®ä»»åŠ¡é˜Ÿåˆ—è¢«æ¸…ç©ºåï¼Œæœ‰å¯èƒ½å‘ç”Ÿ UI æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œä»»åŠ¡çš„è€—æ—¶ä¼šå½±å“è§†å›¾æ¸²æŸ“çš„æ—¶æœºã€‚</p>
<p>é€šå¸¸æµè§ˆå™¨ä»¥æ¯ç§’ 60 å¸§ï¼ˆ60fpsï¼‰çš„é€Ÿç‡åˆ·æ–°é¡µé¢ï¼Œè¿™ä¸ªå¸§ç‡æœ€é€‚åˆäººçœ¼äº¤äº’ï¼Œå¤§æ¦‚ <code>1000ms/60</code> çº¦ç­‰äº 16.7ms æ¸²æŸ“ä¸€å¸§ï¼Œå¦‚æœè¦è®©ç”¨æˆ·çœ‹å¾—é¡ºç•…ï¼Œå•ä¸ªå®ä»»åŠ¡åŠå®ƒç›¸åº”çš„å¾®ä»»åŠ¡æœ€å¥½èƒ½åœ¨ 16.7ms å†…å®Œæˆã€‚</p>
<p>requestAnimationFrame æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>window.requestAnimationFrame() å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚<br>requestAnimationFrame çš„åŸºæœ¬æ€æƒ³æ˜¯ è®©é¡µé¢é‡ç»˜çš„é¢‘ç‡å’Œåˆ·æ–°é¢‘ç‡ä¿æŒåŒæ­¥ï¼Œç›¸æ¯” setTimeout,requestAnimationFrame æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºã€‚</p>
</blockquote>
<p>ä½†è¿™ä¸ªä¹Ÿä¸æ˜¯æ¯è½®äº‹ä»¶å¾ªç¯éƒ½ä¼šæ‰§è¡Œ UI æ¸²æŸ“ï¼Œä¸åŒæµè§ˆå™¨æœ‰è‡ªå·±çš„ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚æŠŠå‡ æ¬¡çš„è§†å›¾æ›´æ–°ç´¯ç§¯åˆ°ä¸€èµ·é‡ç»˜ï¼Œé‡ç»˜ä¹‹å‰ä¼šé€šçŸ¥ requestAnimationFrame æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ requestAnimationFrame å›è°ƒçš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸€æ¬¡æˆ–å¤šæ¬¡äº‹ä»¶å¾ªç¯çš„ UI render é˜¶æ®µã€‚</p>
<p>åœ¨æˆ‘çš„è°·æ­Œæµè§ˆå™¨æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">promise 1</span><br><span class="line">promise 2</span><br><span class="line">end</span><br><span class="line">promise then</span><br><span class="line">requestAnimationFrame</span><br><span class="line">timer1</span><br><span class="line">timer2</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘çš„ç«ç‹æµè§ˆå™¨æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">promise 1</span><br><span class="line">promise 2</span><br><span class="line">end</span><br><span class="line">promise then</span><br><span class="line">timer1</span><br><span class="line">timer2</span><br><span class="line">requestAnimationFrame</span><br></pre></td></tr></table></figure>

<p>è°·æ­Œæµè§ˆå™¨ä¸­çš„ç»“æœ requestAnimationFrame()æ˜¯åœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯åæ‰§è¡Œï¼Œç«ç‹æµè§ˆå™¨ä¸­çš„ç»“æœæ˜¯åœ¨ä¸‰æ¬¡äº‹ä»¶å¾ªç¯ç»“æŸåæ‰§è¡Œã€‚</p>
<p>å¯ä»¥çŸ¥é“ï¼Œæµè§ˆå™¨åªä¿è¯ requestAnimationFrame çš„å›è°ƒåœ¨é‡ç»˜ä¹‹å‰æ‰§è¡Œï¼Œä½†æ²¡æœ‰ç¡®å®šçš„æ—¶é—´ï¼Œä½•æ—¶é‡ç»˜ç”±æµè§ˆå™¨å†³å®šã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul>
<li><a href="https://segmentfault.com/a/1190000022805523" target="_blank" rel="noopener">JavaScript ä¸­çš„ Event Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰æœºåˆ¶</a></li>
</ul>
<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>event</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºSSR/SSGçš„å‰ç«¯SEOä¼˜åŒ–</title>
    <url>/2020/08/27/%E5%9F%BA%E4%BA%8ESSR-SSG%E7%9A%84%E5%89%8D%E7%AB%AFSEO%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<p>å‰æ®µæ—¶é—´å¯¹é¡¹ç›®åšäº† SEO ä¼˜åŒ–ï¼Œåˆ°ç°åœ¨æ‰æ¥å†™æ€»ç»“ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¸¸è§„ç”¨ Vue/React å¼€å‘çš„æ˜¯ SPA åº”ç”¨ï¼Œä½†æ˜¯å¤©ç„¶çš„å•é¡µé¢åº”ç”¨ SEO å°±æ˜¯ä¸å¥½ï¼Œè™½ç„¶è¯´ç°åœ¨ä¹Ÿæœ‰å„ç§æŠ€æœ¯å¯ä»¥æ”¹å–„äº†ï¼Œæ¯”å¦‚ä½¿ç”¨é¢„æ¸²æŸ“ï¼Œä½†ä¹Ÿéƒ½å­˜åœ¨å„ç§ç¼ºç‚¹ã€‚ä½†æ˜¯å³ä½¿è¿™æ ·ï¼Œä¹ŸæŠµä¸ä½ Vue/React è¿™ç±»æ¡†æ¶çš„æ½®æµï¼Œå¾ˆå¤šäº§å“ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–äº®ç‚¹è€Œä¸ä¾èµ– SEO æ™®åŠå¼€ï¼Œä¹Ÿæœ‰éœ€è¦ç™»å½•æ‰èƒ½ç”¨çš„ä½¿ç”¨ SEO ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚</p>
<p>å¦‚æœé¡¹ç›®ä¸­çœŸçš„<strong>å¯¹ SEO å’Œé¦–å±åŠ è½½é€Ÿåº¦æœ‰åˆšæ€§éœ€æ±‚</strong>ï¼Œåˆä½¿ç”¨ Vue/React è¿™ç±»æŠ€æœ¯ï¼Œä¸”æƒ³å°½é‡å‡å°‘ä»£ç å¼€å‘é™„åŠ çš„éš¾åº¦ï¼Œæœ‰ä¸€ç§æ¯”è¾ƒç›´æ¥çš„æ–¹å¼ï¼Œå°±æ˜¯ç›´æ¥ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ¡†æ¶ï¼ŒVue çš„ Nuxt.jsï¼ŒReact çš„ Next.js/Gatsbyã€‚</p>
<a id="more"></a>

<p>ä¸è¿‡ï¼Œå…¶å®å­¦ä¹ ä¸€é—¨æ–°æ¡†æ¶ä¹Ÿæ˜¯ä¸€é¡¹é™„åŠ æˆæœ¬å•Šå“ˆå“ˆï¼Œä½†æ˜¯ SSR æ¸²æŸ“ä¸è¿‡å®é™…å¼€å‘ç”¨ä¸ç”¨ï¼Œèµ·ç éƒ½è¦äº†è§£ä¸€ä¸‹ã€‚æˆ‘å½“å‰ä»¥ React æŠ€æœ¯æ ˆä¸ºä¸»ï¼Œæ‰€ä»¥ç›®å‰åªäº†è§£çš„æ˜¯å…³äº React çš„ SSR æ¸²æŸ“æ¡†æ¶ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸‹æˆ‘è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://juejin.im/post/6863336367309455373" target="_blank" rel="noopener">æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ NextJsï¼ˆv9.5ï¼‰</a></li>
<li><a href="https://juejin.im/post/6850418110885789704" target="_blank" rel="noopener">æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ Gatsby</a></li>
</ul>
<p>æ‰€ä»¥æœ¬æ–‡ä¸è®¨è®ºå•é¡µé¢åº”ç”¨çš„ SEO ä¼˜åŒ–ï¼Œè®²çš„æ˜¯åŸºäºæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰/é™æ€ç”Ÿæˆï¼ˆSSGï¼‰ç½‘ç«™ SEO çš„ä¼˜åŒ–ã€‚</p>
<p>æœ¬æ–‡ä¼šå›é¡¾ä¼ ç»Ÿçš„ SEO çš„ä¼˜åŒ–æ–¹å¼ï¼Œä»¥åŠåŸºäº Gatsby SEO çš„ä¼˜åŒ–ã€‚</p>
<h2 id="æœåŠ¡ç«¯æ¸²æŸ“-SSR-ä¸é™æ€ç½‘ç«™æ¸²æŸ“-SSG"><a href="#æœåŠ¡ç«¯æ¸²æŸ“-SSR-ä¸é™æ€ç½‘ç«™æ¸²æŸ“-SSG" class="headerlink" title="æœåŠ¡ç«¯æ¸²æŸ“ SSR ä¸é™æ€ç½‘ç«™æ¸²æŸ“ SSG"></a>æœåŠ¡ç«¯æ¸²æŸ“ SSR ä¸é™æ€ç½‘ç«™æ¸²æŸ“ SSG</h2><p>æœåŠ¡ç«¯æ˜¯æŒ‡å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç„¶åè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆ html å†…å®¹å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br>é™æ€ç«™ç‚¹çš„è§£ææ˜¯åœ¨æ„å»ºæ—¶æ‰§è¡Œçš„ï¼Œå½“å‘å‡ºè¯·æ±‚æ—¶ï¼Œhtml å°†é™æ€å­˜å‚¨ï¼Œç›´æ¥å‘é€å›å®¢æˆ·ç«¯ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œé™æ€ç«™ç‚¹åœ¨è¿è¡Œæ—¶ä¼šæ›´å¿«ï¼Œå› ä¸ºä¸éœ€è¦æœåŠ¡ç«¯åšå¤„ç†ï¼Œä½†ç¼ºç‚¹æ˜¯å¯¹æ•°æ®çš„ä»»ä½•æ›´æ”¹éƒ½éœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡Œå®Œå…¨é‡å»ºï¼›è€ŒæœåŠ¡ç«¯æ¸²æŸ“åˆ™ä¼šåŠ¨æ€å¤„ç†æ•°æ®ï¼Œä¸éœ€è¦è¿›è¡Œå®Œå…¨é‡å»ºã€‚</p>
<p>å¯¹äº Vue/React æ¥è¯´ï¼Œå¯¹äºå®ƒä»¬çš„ SSR/SSG æ¡†æ¶å‡ºç°çš„åŸå› å°±æ˜¯ä¸»è¦å°±æ˜¯ SEO å’Œé¦–å±åŠ è½½é€Ÿåº¦ã€‚</p>
<h2 id="æœç´¢å¼•æ“çš„å·¥ä½œåŸç†"><a href="#æœç´¢å¼•æ“çš„å·¥ä½œåŸç†" class="headerlink" title="æœç´¢å¼•æ“çš„å·¥ä½œåŸç†"></a>æœç´¢å¼•æ“çš„å·¥ä½œåŸç†</h2><blockquote>
<p>åœ¨æœç´¢å¼•æ“ç½‘ç«™çš„åå°ä¼šæœ‰ä¸€ä¸ªéå¸¸åºå¤§çš„æ•°æ®åº“ï¼Œé‡Œé¢å­˜å‚¨äº†æµ·é‡çš„å…³é”®è¯ï¼Œè€Œæ¯ä¸ªå…³é”®è¯åˆå¯¹åº”ç€å¾ˆå¤šç½‘å€ï¼Œè¿™äº›ç½‘å€æ˜¯è¢«ç§°ä¹‹ä¸ºâ€œæœç´¢å¼•æ“èœ˜è››â€æˆ–â€œç½‘ç»œçˆ¬è™«â€ç¨‹åºä»äº’è”ç½‘ä¸Šæ”¶é›†è€Œæ¥çš„ã€‚</p>
</blockquote>
<p>è¿™äº›â€èœ˜è››â€åœ¨äº’è”ç½‘ä¸Šçˆ¬è¡Œï¼Œä»ä¸€ä¸ªé“¾æ¥åˆ°å¦ä¸€ä¸ªé“¾æ¥ï¼Œå¯¹å†…å®¹è¿›è¡Œåˆ†æï¼Œæç‚¼å…³é”®è¯åŠ å…¥æ•°æ®åº“ä¸­ï¼›å¦‚æœèœ˜è››è®¤ä¸ºæ˜¯åƒåœ¾æˆ–é‡å¤ä¿¡æ¯ï¼Œå°±èˆå¼ƒç»§ç»­çˆ¬è¡Œã€‚å½“ç”¨æˆ·æœç´¢æ—¶ï¼Œå°±èƒ½æ£€ç´¢å‡ºä¸å…³é”®å­—ç›¸å…³çš„ç½‘å€æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚</p>
<p>å½“ç”¨æˆ·åœ¨æœç´¢å¼•æ“æœç´¢æ—¶ï¼Œæ¯”å¦‚æœç´¢â€å‰ç«¯â€ï¼Œåˆ™è·³å‡ºæ¥æ‰€æœ‰å«æœ‰â€å‰ç«¯â€äºŒå­—å…³é”®å­—çš„ç½‘é¡µï¼Œç„¶åæ ¹æ®ç‰¹å®šç®—æ³•ç»™æ¯ä¸ªå«æœ‰â€å‰ç«¯â€äºŒå­—çš„ç½‘é¡µä¸€ä¸ªè¯„åˆ†æ’åè¿”å›æœç´¢ç»“æœã€‚è€Œè¿™äº›åŒ…å«â€å‰ç«¯â€çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯æ–‡ç« æ ‡é¢˜ã€æè¿°ã€å…³é”®å­—ã€å†…å®¹ç”šè‡³å¯ä»¥æ˜¯é“¾æ¥ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å¹¿å‘Šä¼˜å…ˆç½®é¡¶ï¼Œä½ æ‡‚çš„ã€‚</p>
<blockquote>
<p>ä¸€ä¸ªå…³é”®è¯å¯¹ç”¨å¤šä¸ªç½‘å€ï¼Œå› æ­¤å°±å‡ºç°äº†æ’åºçš„é—®é¢˜ï¼Œç›¸åº”çš„å½“ä¸å…³é”®è¯æœ€å»åˆçš„ç½‘å€å°±ä¼šæ’åœ¨å‰é¢äº†ã€‚åœ¨â€œèœ˜è››â€æŠ“å–ç½‘é¡µå†…å®¹ï¼Œæç‚¼å…³é”®è¯çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šâ€œèœ˜è››â€èƒ½å¦çœ‹æ‡‚ã€‚å¦‚æœç½‘ç«™å†…å®¹æ˜¯ flash å’Œ js ç­‰ï¼Œé‚£ä¹ˆå®ƒæ˜¯çœ‹ä¸æ‡‚çš„ï¼Œä¼šçŠ¯è¿·ç³Šï¼Œå³ä½¿å…³é”®å­—å†è´´åˆ‡ä¹Ÿæ²¡ç”¨ã€‚ç›¸åº”çš„ï¼Œå¦‚æœç½‘ç«™å†…å®¹å¯ä»¥è¢«æœç´¢å¼•æ“èƒ½è¯†åˆ«ï¼Œé‚£ä¹ˆæœç´¢å¼•æ“å°±ä¼šæé«˜è¯¥ç½‘ç«™çš„æƒé‡ï¼Œå¢åŠ å¯¹è¯¥ç½‘ç«™çš„å‹å¥½åº¦ã€‚è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸º SEO(Search Engine Optimization)ï¼Œå³æœç´¢å¼•æ“ä¼˜åŒ–ã€‚</p>
</blockquote>
<h2 id="SEO-ç›®çš„"><a href="#SEO-ç›®çš„" class="headerlink" title="SEO ç›®çš„"></a>SEO ç›®çš„</h2><p>è®©ç½‘ç«™æ›´åˆ©äºå„å¤§æœç´¢å¼•æ“æŠ“å–å’Œæ”¶å½•ï¼Œå¢åŠ å¯¹æœç´¢å¼•æ“çš„å‹å¥½åº¦ï¼Œä½¿å¾—ç”¨æˆ·åœ¨æœç´¢å¯¹åº”å…³é”®è¯æ—¶ç½‘ç«™æ—¶èƒ½æ’åœ¨å‰é¢ï¼Œå¢åŠ äº§å“çš„æ›å…‰ç‡å’Œæµé‡ã€‚</p>
<h2 id="SEO-ä¼˜åŒ–æ–¹å¼"><a href="#SEO-ä¼˜åŒ–æ–¹å¼" class="headerlink" title="SEO ä¼˜åŒ–æ–¹å¼"></a>SEO ä¼˜åŒ–æ–¹å¼</h2><p>æˆ‘ä»¬è¿™é‡Œä¸»è¦è®²å‰ç«¯èƒ½å‚ä¸å’Œåšçš„ä¼˜åŒ–æ–¹å¼ã€‚æ¯”å¦‚å¾ˆå¤š SEO ä¼˜åŒ–æ–¹å¼éƒ½æœ‰ä»‹ç»ï¼šæ§åˆ¶é¦–é¡µé“¾æ¥æ•°é‡ï¼Œæ‰å¹³åŒ–ç›®å½•å±‚æ¬¡ï¼Œä¼˜åŒ–ç½‘ç«™ç»“æ„å¸ƒå±€ï¼Œåˆ†é¡µå¯¼èˆªå†™æ³•è¿™äº›ç­‰ï¼Œä½†å®é™…ä¸Šï¼Œæ—¥å¸¸å‰ç«¯å¼€å‘ä¹Ÿå……å½“ä¸äº†ç½‘ç«™æ•´ä½“è®¾è®¡çš„è§’è‰²ï¼Œåªèƒ½æ˜¯åè°ƒï¼Œè¿™äº›å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€å¼€å§‹å°±å®šå¥½çš„ä¸œè¥¿ã€‚</p>
<p>æ¯”å¦‚æ–°é—»åª’ä½“ç±»ç­‰ç½‘ç«™æ¯”è¾ƒé‡è§† SEO çš„ï¼Œé€šå¸¸å…¬å¸è¿˜ä¼šè®¾æœ‰ SEO éƒ¨é—¨æˆ–è€…æ˜¯ SEO ä¼˜åŒ–å·¥ç¨‹å¸ˆå²—ä½ï¼Œåƒä¸Šé¢è¯´çš„ï¼Œè¿˜æœ‰ç½‘é¡µå…³é”®è¯ã€æè¿°çš„å°±äº¤ç»™ä»–ä»¬å‚ä¸å’Œæä¾›ï¼Œæœ‰äº›ä¼˜åŒ–æ–¹å¼æˆ‘ä»¬éš¾ä»¥è§¦åŠçš„å°±ä¸ç»†è°ˆäº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£ã€‚</p>
<h3 id="ç½‘é¡µ-TDK-æ ‡ç­¾"><a href="#ç½‘é¡µ-TDK-æ ‡ç­¾" class="headerlink" title="ç½‘é¡µ TDK æ ‡ç­¾"></a>ç½‘é¡µ TDK æ ‡ç­¾</h3><ul>
<li>titleï¼šå½“å‰é¡µé¢çš„æ ‡é¢˜ï¼ˆå¼ºè°ƒé‡ç‚¹å³å¯ï¼Œæ¯ä¸ªé¡µé¢çš„ title å°½é‡ä¸è¦ç›¸åŒï¼‰</li>
<li>descriptionï¼šå½“å‰é¡µé¢çš„æè¿°ï¼ˆåˆ—ä¸¾å‡ ä¸ªå…³é”®è¯å³å¯ï¼Œä¸è¦è¿‡åˆ†å †ç§¯ï¼‰</li>
<li>keywordsï¼šå½“å‰é¡µé¢çš„å…³é”®è¯ï¼ˆé«˜åº¦æ¦‚æ‹¬ç½‘é¡µå†…å®¹ï¼‰</li>
</ul>
<p>æ¯ä¸ªé¡µé¢çš„ TDK éƒ½ä¸ä¸€æ ·ï¼Œè¿™ä¸ªéœ€è¦æ ¹æ®äº§å“ä¸šåŠ¡æç‚¼å‡ºæ ¸å¿ƒå…³é”®è¯ã€‚</p>
<p>é‚£ä¹ˆé¡µé¢çš„ TDK éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹å®ƒè¿›è¡ŒåŠ¨æ€è®¾ç½®,react çš„è¯æœ‰<a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener">react-helmet</a><br>æ’ä»¶ï¼Œç”¨äºè®¾ç½®å¤´éƒ¨æ ‡ç­¾ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Helmet &#125; <span class="keyword">from</span> <span class="string">'react-helmet'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GoodsDetail = <span class="function">(<span class="params">&#123; title, description, keywords &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">'application'</span>&gt;</span><br><span class="line">      &lt;Helmet&gt;</span><br><span class="line">        &lt;title&gt;&#123;title&#125;&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">        &lt;meta name='description' content=&#123;`$&#123;description&#125;`&#125; /</span>&gt;</span><br><span class="line">        &lt;meta name=<span class="string">'keywords'</span> content=&#123;<span class="string">`<span class="subst">$&#123;keywords&#125;</span>`</span>&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Helmet&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;content...&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æ˜¯æ¼”ç¤ºï¼Œå®é™…é¡¹ç›®åšæ³•è¿˜æ˜¯ä¼šæŠŠ Helmet é‡Œçš„å†…å®¹å•ç‹¬æŠ½ç¦»å‡ºæ¥åšç»„ä»¶ã€‚</p>
<p>åœ¨ Next.js é‡Œé¢ï¼Œæ˜¯è‡ªå¸¦ Head ç»„ä»¶çš„ï¼š<code>import Head from &#39;next/head&#39;</code></p>
<h3 id="è¯­ä¹‰åŒ–æ ‡ç­¾"><a href="#è¯­ä¹‰åŒ–æ ‡ç­¾" class="headerlink" title="è¯­ä¹‰åŒ–æ ‡ç­¾"></a>è¯­ä¹‰åŒ–æ ‡ç­¾</h3><p>æ ¹æ®å†…å®¹çš„ç»“æ„åŒ–ï¼Œé€‰æ‹©åˆé€‚çš„ HTML5 æ ‡ç­¾å°½é‡è®©ä»£ç è¯­ä¹‰åŒ–ï¼Œå¦‚ä½¿ç”¨ headerï¼Œfooterï¼Œsectionï¼Œasideï¼Œarticleï¼Œnav ç­‰ç­‰è¯­ä¹‰åŒ–æ ‡ç­¾å¯ä»¥è®©çˆ¬è™«æ›´å¥½çš„è§£æã€‚</p>
<h3 id="åˆç†ä½¿ç”¨-h1-h6-æ ‡ç­¾"><a href="#åˆç†ä½¿ç”¨-h1-h6-æ ‡ç­¾" class="headerlink" title="åˆç†ä½¿ç”¨ h1~h6 æ ‡ç­¾"></a>åˆç†ä½¿ç”¨ h1~h6 æ ‡ç­¾</h3><p>ä¸€ä¸ªé¡µé¢ä¸­åªèƒ½æœ€å¤šå‡ºç°ä¸€æ¬¡<code>h1</code>æ ‡ç­¾ï¼Œ<code>h2</code>æ ‡ç­¾é€šå¸¸ä½œä¸ºäºŒçº§æ ‡é¢˜æˆ–æ–‡ç« çš„å°æ ‡é¢˜ã€‚å…¶ä½™<code>h3</code>-<code>h6</code>æ ‡ç­¾å¦‚è¦ä½¿ç”¨åº”æŒ‰é¡ºåºå±‚å±‚åµŒå¥—ä¸‹å»ï¼Œä¸å¯ä»¥æ–­å±‚æˆ–ååºã€‚</p>
<p>æ¯”å¦‚é€šå¸¸åœ¨é¦–é¡µçš„ logo ä¸ŠåŠ <code>h1</code>æ ‡ç­¾ï¼Œä½†ç½‘ç«™è®¾è®¡åªå±•ç¤º logo å›¾æ— æ–‡å­—çš„æƒ…å†µä¸‹ï¼Œh1 çš„æ–‡å­—å°±å¯ä»¥è®¾ç½®<code>font-size</code>ä¸ºé›¶æ¥éšè—</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"logo.png"</span> <span class="attr">alt</span>=<span class="string">"jacky"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>jackyçš„ä¸ªäººåšå®¢<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å›¾ç‰‡çš„-alt-å±æ€§"><a href="#å›¾ç‰‡çš„-alt-å±æ€§" class="headerlink" title="å›¾ç‰‡çš„ alt å±æ€§"></a>å›¾ç‰‡çš„ alt å±æ€§</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œé™¤éæ˜¯å›¾ç‰‡ä»…ä»…æ˜¯çº¯å±•ç¤ºç±»æ²¡æœ‰ä»»ä½•å®é™…ä¿¡æ¯çš„è¯ï¼Œ<code>alt</code>å±æ€§å¯ä»¥ä¸ºç©ºã€‚å¦åˆ™ä½¿ç”¨<code>img</code>æ ‡ç­¾éƒ½è¦æ·»åŠ <code>alt</code>å±æ€§ï¼Œä½¿â€èœ˜è››â€å¯ä»¥æŠ“å–åˆ°å›¾ç‰‡çš„ä¿¡æ¯ã€‚<br>å½“ç½‘ç»œåŠ è½½ä¸å‡ºæ¥æˆ–è€…å›¾ç‰‡åœ°å€å¤±æ•ˆæ—¶ï¼Œ<code>alt</code>å±æ€§çš„å†…å®¹æ‰ä¼šä»£æ›¿å›¾ç‰‡å‘ˆç°å‡ºæ¥ï¼Œ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"dog.jpg"</span> <span class="attr">width</span>=<span class="string">"300"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">alt</span>=<span class="string">"å“ˆå£«å¥‡"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="a-æ ‡ç­¾çš„-title"><a href="#a-æ ‡ç­¾çš„-title" class="headerlink" title="a æ ‡ç­¾çš„ title"></a>a æ ‡ç­¾çš„ title</h3><p>åŒç†ï¼Œa æ ‡ç­¾çš„ title å±æ€§å…¶å®å°±æ˜¯æç¤ºæ–‡å­—ä½œç”¨ï¼Œå½“é¼ æ ‡ç§»åŠ¨åˆ°è¯¥è¶…é“¾æ¥ä¸Šæ—¶ï¼Œå°±ä¼šæœ‰æç¤ºæ–‡å­—çš„å‡ºç°ã€‚é€šè¿‡æ·»åŠ è¯¥å±æ€§ä¹Ÿæœ‰å¾®å°çš„ä½œç”¨åˆ©äº SEOã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">"https://github.com/Jacky-Summer/personal-blog"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">title</span>=<span class="string">"äº†è§£æ›´å¤šå…³äºJackyçš„ä¸ªäººåšå®¢"</span></span></span><br><span class="line"><span class="tag">  &gt;</span>äº†è§£æ›´å¤š<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="404-é¡µé¢"><a href="#404-é¡µé¢" class="headerlink" title="404 é¡µé¢"></a>404 é¡µé¢</h3><p>404 é¡µé¢é¦–å…ˆæ˜¯ç”¨æˆ·ä½“éªŒè‰¯å¥½ï¼Œä¸ä¼šè«åæŠ¥ä¸€äº›å…¶ä»–æç¤ºã€‚å…¶æ¬¡å¯¹èœ˜è››ä¹Ÿå‹å¥½ï¼Œä¸ä¼šå› ä¸ºé¡µé¢é”™è¯¯è€Œåœæ­¢æŠ“å–ï¼Œå¯ä»¥è¿”å›æŠ“å–ç½‘ç«™å…¶ä»–é¡µé¢ã€‚</p>
<h3 id="nofollow-å¿½ç•¥è·Ÿè¸ª"><a href="#nofollow-å¿½ç•¥è·Ÿè¸ª" class="headerlink" title="nofollow å¿½ç•¥è·Ÿè¸ª"></a>nofollow å¿½ç•¥è·Ÿè¸ª</h3><ul>
<li>nofollow æœ‰ä¸¤ç§ç”¨æ³•ï¼š</li>
</ul>
<ol>
<li>ç”¨äº meta å…ƒæ ‡ç­¾ï¼Œå‘Šè¯‰çˆ¬è™«è¯¥é¡µé¢ä¸Šæ‰€æœ‰é“¾æ¥éƒ½æ— éœ€è¿½è¸ªã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;meta name&#x3D;&quot;robots&quot; content&#x3D;&quot;nofollow&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç”¨äº a æ ‡ç­¾ï¼Œå‘Šè¯‰çˆ¬è™«è¯¥é¡µé¢æ— éœ€è¿½è¸ªã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;www.xxxx?login&quot; rel&#x3D;&quot;nofollow&quot;&gt;ç™»å½•&#x2F;æ³¨å†Œ&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ç”¨åœ¨ a æ ‡ç­¾æ¯”è¾ƒå¤šï¼Œå®ƒä¸»è¦æœ‰ä¸‰ä¸ªä½œç”¨ï¼š</p>
<ol>
<li>â€œèœ˜è››â€åˆ†é…åˆ°æ¯ä¸ªé¡µé¢çš„æƒé‡æ˜¯ä¸€å®šçš„ï¼Œä¸ºäº†é›†ä¸­ç½‘é¡µæƒé‡å¹¶å°†æƒé‡åˆ†ç»™å…¶ä»–å¿…è¦çš„é“¾æ¥ï¼Œå°±è®¾ç½®<code>rel=&#39;nofollow&#39;</code>å‘Šè¯‰â€èœ˜è››â€ä¸è¦çˆ¬ï¼Œæ¥é¿å…çˆ¬è™«æŠ“å–ä¸€äº›æ— æ„ä¹‰çš„é¡µé¢ï¼Œå½±å“çˆ¬è™«æŠ“å–çš„æ•ˆç‡ï¼›è€Œä¸”ä¸€æ—¦â€èœ˜è››â€çˆ¬äº†å¤–éƒ¨é“¾æ¥ï¼Œå°±ä¸ä¼šå†å›æ¥äº†ã€‚</li>
<li>ä»˜è´¹é“¾æ¥ï¼šä¸ºäº†é˜²æ­¢ä»˜è´¹é“¾æ¥å½±å“ Google çš„æœç´¢ç»“æœæ’åï¼ŒGoogle å»ºè®®ä½¿ç”¨ nofollow å±æ€§ã€‚</li>
<li>é˜²æ­¢ä¸å¯ä¿¡çš„å†…å®¹ï¼Œæœ€å¸¸è§çš„æ˜¯åšå®¢ä¸Šçš„åƒåœ¾ç•™è¨€ä¸è¯„è®ºä¸­ä¸ºäº†è·å–å¤–é“¾çš„åƒåœ¾é“¾æ¥ï¼Œä¸ºäº†é˜²æ­¢é¡µé¢æŒ‡å‘ä¸€äº›æ‹‰åœ¾é¡µé¢å’Œç«™ç‚¹ã€‚</li>
</ol>
<h3 id="å»ºç«‹-robots-txt-æ–‡ä»¶"><a href="#å»ºç«‹-robots-txt-æ–‡ä»¶" class="headerlink" title="å»ºç«‹ robots.txt æ–‡ä»¶"></a>å»ºç«‹ robots.txt æ–‡ä»¶</h3><blockquote>
<p>robots.txt æ–‡ä»¶ç”±ä¸€æ¡æˆ–å¤šæ¡è§„åˆ™ç»„æˆã€‚æ¯æ¡è§„åˆ™å¯ç¦æ­¢ï¼ˆæˆ–å…è®¸ï¼‰ç‰¹å®šæŠ“å–å·¥å…·æŠ“å–ç›¸åº”ç½‘ç«™ä¸­çš„æŒ‡å®šæ–‡ä»¶è·¯å¾„ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:&#x2F;admin&#x2F;</span><br><span class="line">SiteMap: http:&#x2F;&#x2F;www.xxxx.com&#x2F;sitemap.xml</span><br></pre></td></tr></table></figure>

<p>å…³é”®è¯ï¼š</p>
<ol>
<li>User-agent è¡¨ç¤ºç½‘é¡µæŠ“å–å·¥å…·çš„åç§°</li>
<li>Disallow è¡¨ç¤ºä¸åº”æŠ“å–çš„ç›®å½•æˆ–ç½‘é¡µ</li>
<li>Allow åº”æŠ“å–çš„ç›®å½•æˆ–ç½‘é¡µ</li>
<li>Sitemap ç½‘ç«™çš„ç«™ç‚¹åœ°å›¾çš„ä½ç½®</li>
</ol>
<ul>
<li><code>User-agent: *</code>è¡¨ç¤ºå¯¹æ‰€æœ‰çš„æœç´¢å¼•æ“æœ‰æ•ˆ</li>
<li><code>User-agent: Baiduspider</code> è¡¨ç¤ºç™¾åº¦æœç´¢å¼•æ“ï¼Œè¿˜æœ‰è°·æ­Œ Googlebot ç­‰ç­‰æœç´¢å¼•æ“åç§°ï¼Œé€šè¿‡è¿™äº›å¯ä»¥è®¾ç½®ä¸åŒæœç´¢å¼•æ“è®¿é—®çš„å†…å®¹</li>
</ul>
<p>å‚è€ƒä¾‹å­çš„è¯æ¯”å¦‚ç™¾åº¦çš„ <a href="https://www.baidu.com/robots.txt" target="_blank" rel="noopener">robots.txt</a>ï¼Œäº¬ä¸œçš„ <a href="https://www.jd.com/robots.txt" target="_blank" rel="noopener">robots.txt</a></p>
<p>robots æ–‡ä»¶æ˜¯æœç´¢å¼•æ“è®¿é—®ç½‘ç«™æ—¶ç¬¬ä¸€ä¸ªè®¿é—®çš„ï¼Œç„¶åæ ¹æ®æ–‡ä»¶é‡Œé¢è®¾ç½®çš„è§„åˆ™ï¼Œè¿›è¡Œç½‘ç«™å†…å®¹çš„çˆ¬å–ã€‚é€šè¿‡è®¾ç½®<code>Allow</code>å’Œ<code>Disallow</code>è®¿é—®ç›®å½•å’Œæ–‡ä»¶ï¼Œå¼•å¯¼çˆ¬è™«æŠ“å–ç½‘ç«™çš„ä¿¡æ¯ã€‚</p>
<p>å®ƒä¸»è¦ç”¨äºä½¿ä½ çš„ç½‘ç«™é¿å…æ”¶åˆ°è¿‡å¤šè¯·æ±‚ï¼Œå‘Šè¯‰æœç´¢å¼•æ“åº”è¯¥ä¸ä¸åº”æŠ“å–å“ªäº›é¡µé¢ã€‚å¦‚æœä½ ä¸å¸Œæœ›ç½‘ç«™çš„æŸäº›é¡µé¢è¢«æŠ“å–ï¼Œè¿™äº›é¡µé¢å¯èƒ½å¯¹ç”¨æˆ·æ— ç”¨ï¼Œå°±é€šè¿‡<code>Disallow</code>è®¾ç½®ã€‚å®ç°å®šå‘ SEO ä¼˜åŒ–ï¼Œæ›å…‰æœ‰ç”¨çš„é“¾æ¥ç»™çˆ¬è™«ï¼Œå°†æ•æ„Ÿæ— ç”¨çš„æ–‡ä»¶ä¿æŠ¤èµ·æ¥ã€‚</p>
<p>å³ä½¿ç½‘ç«™ä¸Šé¢æ‰€æœ‰å†…å®¹éƒ½å¸Œæœ›è¢«æœç´¢å¼•æ“æŠ“å–åˆ°ï¼Œä¹Ÿè¦è®¾ç½®ä¸€ä¸ªç©ºçš„ robot æ–‡ä»¶ã€‚å› ä¸ºå½“èœ˜è››æŠ“å–ç½‘ç«™å†…å®¹æ—¶ï¼Œç¬¬ä¸€ä¸ªæŠ“å–çš„æ–‡ä»¶ robot æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆèœ˜è››è®¿é—®æ—¶ï¼ŒæœåŠ¡å™¨ä¸Šå°±ä¼šæœ‰ä¸€æ¡ 404 çš„é”™è¯¯æ—¥å¿—ï¼Œå¤šä¸ªæœç´¢å¼•æ“æŠ“å–é¡µé¢ä¿¡æ¯æ—¶ï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ªçš„ 404 é”™è¯¯ï¼Œæ•…ä¸€èˆ¬éƒ½è¦åˆ›å»ºä¸€ä¸ª robots.txt æ–‡ä»¶åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹ã€‚</p>
<p>ç©º robots.txt æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è¦æ›´è¯¦ç»†çš„äº†è§£ robots.txt æ–‡ä»¶ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š</p>
<ul>
<li><a href="https://support.google.com/webmasters/answer/6062608?hl=en&ref_topic=6061961&visit_id=637337520313091593-2508183586&rd=1" target="_blank" rel="noopener">å…³äº robots.txt</a></li>
<li><a href="https://ahrefs.com/blog/zh/robots-txt/" target="_blank" rel="noopener">å…³äº Robots.txt å’Œ SEO: ä½ æ‰€éœ€è¦çŸ¥é“çš„ä¸€åˆ‡</a></li>
</ul>
<p>ä¸€èˆ¬æ¶‰åŠç›®å½•æ¯”è¾ƒå¤šçš„è¯éƒ½ä¼šæ‰¾ç½‘ç«™å·¥å…·åŠ¨æ€ç”Ÿæˆ robots.txtï¼Œæ¯”å¦‚ <a href="https://tool.chinaz.com/robots/" target="_blank" rel="noopener">ç”Ÿæˆ robots.txt</a></p>
<h3 id="å»ºç«‹ç½‘ç«™åœ°å›¾-sitemap"><a href="#å»ºç«‹ç½‘ç«™åœ°å›¾-sitemap" class="headerlink" title="å»ºç«‹ç½‘ç«™åœ°å›¾ sitemap"></a>å»ºç«‹ç½‘ç«™åœ°å›¾ sitemap</h3><p>å½“ç½‘ç«™åˆšåˆšä¸Šçº¿çš„æ—¶å€™ï¼Œè¿å¾€è¯¥ç½‘ç«™çš„å¤–éƒ¨é“¾æ¥å¹¶ä¸å¤šï¼Œçˆ¬è™«å¯èƒ½æ‰¾ä¸åˆ°è¿™äº›ç½‘é¡µï¼›æˆ–è€…è¯¥ç½‘ç«™çš„ç½‘é¡µä¹‹é—´æ²¡æœ‰è¾ƒå¥½çš„è¡”æ¥å…³ç³»ï¼Œçˆ¬è™«å®¹æ˜“æ¼æ‰éƒ¨åˆ†ç½‘é¡µã€‚è¿™ä¸ªæ—¶å€™ï¼Œsitemap å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<p>sitemap æ˜¯ä¸€ä¸ªå°†ç½‘ç«™æ ç›®å’Œè¿æ¥å½’ç±»çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œè®©æœç´¢å¼•æ“å…¨é¢æ”¶å½•ç«™ç‚¹ç½‘é¡µåœ°å€ï¼Œäº†è§£ç«™ç‚¹ç½‘é¡µåœ°å€çš„æƒé‡åˆ†å¸ƒä»¥åŠç«™ç‚¹å†…å®¹æ›´æ–°æƒ…å†µï¼Œæé«˜çˆ¬è™«çš„çˆ¬å–æ•ˆç‡ã€‚Sitemap æ–‡ä»¶åŒ…å«çš„ç½‘å€ä¸å¯ä»¥è¶…è¿‡ 5 ä¸‡ä¸ªï¼Œä¸”æ–‡ä»¶å¤§å°ä¸å¾—è¶…è¿‡ 10MBã€‚</p>
<p>sitemap åœ°å›¾æ–‡ä»¶åŒ…å« html(é’ˆå¯¹ç”¨æˆ·)å’Œ xml(é’ˆå¯¹æœç´¢å¼•æ“)ä¸¤ç§ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ xml æ–‡ä»¶ï¼ŒXML æ ¼å¼çš„ Sitemap ä¸€å…±ç”¨åˆ° 6 ä¸ªæ ‡ç­¾ï¼Œå…¶ä¸­å…³é”®æ ‡ç­¾åŒ…æ‹¬é“¾æ¥åœ°å€(loc)ã€æ›´æ–°æ—¶é—´(lastmod)ã€æ›´æ–°é¢‘ç‡(changefreq)å’Œç´¢å¼•ä¼˜å…ˆæƒ(priority)ã€‚</p>
<p>çˆ¬è™«æ€ä¹ˆçŸ¥é“ç½‘ç«™æœ‰æ²¡æœ‰æä¾› sitemap æ–‡ä»¶å‘¢ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„è·¯å¾„æ”¾åœ¨äº† robots.txt é‡Œé¢ã€‚</p>
<p>å…ˆæ‰¾ç½‘ç«™çš„æ ¹ç›®å½•é‡Œæ‰¾ robots.txtï¼Œæ¯”å¦‚è…¾è®¯ç½‘ä¸‹çš„ robots.txt å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:</span><br><span class="line">Sitemap: http:&#x2F;&#x2F;www.qq.com&#x2F;sitemap_index.xml</span><br></pre></td></tr></table></figure>

<p>å°±æ‰¾åˆ°äº† sitemap è·¯å¾„ï¼ˆåªåˆ—å‡ºä¸€éƒ¨åˆ†ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;sitemapindex xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.sitemaps.org&#x2F;schemas&#x2F;sitemap&#x2F;0.9&quot;&gt;</span><br><span class="line">  &lt;sitemap&gt;</span><br><span class="line">    &lt;loc&gt;http:&#x2F;&#x2F;news.qq.com&#x2F;news_sitemap.xml.gz&lt;&#x2F;loc&gt;</span><br><span class="line">    &lt;lastmod&gt;2011-11-15&lt;&#x2F;lastmod&gt;</span><br><span class="line">  &lt;&#x2F;sitemap&gt;</span><br><span class="line">  &lt;sitemap&gt;</span><br><span class="line">    &lt;loc&gt;http:&#x2F;&#x2F;finance.qq.com&#x2F;news_sitemap.xml.gz&lt;&#x2F;loc&gt;</span><br><span class="line">    &lt;lastmod&gt;2011-11-15&lt;&#x2F;lastmod&gt;</span><br><span class="line">  &lt;&#x2F;sitemap&gt;</span><br><span class="line">  &lt;sitemap&gt;</span><br><span class="line">    &lt;loc&gt;http:&#x2F;&#x2F;sports.qq.com&#x2F;news_sitemap.xml.gz&lt;&#x2F;loc&gt;</span><br><span class="line">    &lt;lastmod&gt;2011-11-15&lt;&#x2F;lastmod&gt;</span><br><span class="line">  &lt;&#x2F;sitemap&gt;</span><br><span class="line">  &lt;sitemap&gt;</span><br><span class="line">&lt;&#x2F;sitemapindex&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>locï¼šé¡µé¢æ°¸ä¹…é“¾æ¥åœ°å€ï¼Œå¯ä»¥æ˜¯é™æ€é¡µé¢ï¼Œä¹Ÿå¯æ˜¯åŠ¨æ€é¡µé¢</li>
<li>lastmodï¼šé¡µé¢çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œéå¿…å¡«é¡¹ã€‚æœç´¢å¼•æ“æ ¹æ®æ­¤é¡¹ä¸ changefreq ç›¸ç»“åˆï¼Œåˆ¤æ–­æ˜¯å¦è¦é‡æ–°æŠ“å– loc æŒ‡å‘çš„å†…å®¹</li>
</ul>
<p>ä¸€èˆ¬ç½‘ç«™å¼€å‘å®Œåï¼Œè¿™ä¸ª sitemap ä¸€èˆ¬éƒ½æ˜¯é è‡ªåŠ¨ç”Ÿæˆï¼Œæ¯”å¦‚ <a href="https://www.xml-sitemaps.com/" target="_blank" rel="noopener">sitemap ç”Ÿæˆå·¥å…·</a></p>
<h3 id="ç»“æ„åŒ–æ•°æ®"><a href="#ç»“æ„åŒ–æ•°æ®" class="headerlink" title="ç»“æ„åŒ–æ•°æ®"></a>ç»“æ„åŒ–æ•°æ®</h3><p>ç»“æ„åŒ–æ•°æ®(Structured data)æ˜¯ä¸€ç§æ ‡å‡†åŒ–æ ¼å¼ï¼Œä½¿ç”¨å®ƒå‘ Google æä¾›æœ‰å…³è¯¥ç½‘é¡µå«ä¹‰çš„æ˜ç¡®çº¿ç´¢ï¼Œä»è€Œå¸®åŠ©ç†è§£è¯¥ç½‘é¡µã€‚ä¸€èˆ¬éƒ½ JSON-LD æ ¼å¼ï¼Œè¿™æ ¼å¼é•¿ä»€ä¹ˆæ ·å‘¢ï¼Œçœ‹è°·æ­Œå®˜æ–¹çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Party Coffee Cake<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"application/ld+json"</span>&gt;</span></span><br><span class="line">      &#123;</span><br><span class="line"><span class="actionscript">        <span class="string">"@context"</span>: <span class="string">"https://schema.org/"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"@type"</span>: <span class="string">"Recipe"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"name"</span>: <span class="string">"Party Coffee Cake"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"author"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="string">"@type"</span>: <span class="string">"Person"</span>,</span></span><br><span class="line"><span class="actionscript">          <span class="string">"name"</span>: <span class="string">"Mary Stone"</span></span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="actionscript">        <span class="string">"nutrition"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="string">"@type"</span>: <span class="string">"NutritionInformation"</span>,</span></span><br><span class="line"><span class="actionscript">          <span class="string">"calories"</span>: <span class="string">"512 calories"</span></span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="actionscript">        <span class="string">"datePublished"</span>: <span class="string">"2018-03-10"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"description"</span>: <span class="string">"This coffee cake is awesome and perfect for parties."</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"prepTime"</span>: <span class="string">"PT20M"</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Party coffee cake recipe<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>This coffee cake is awesome and perfect for parties.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ—æ˜äº†ç½‘é¡µé¡µé¢ç§ç±»å±äºâ€é£Ÿè°±â€ï¼Œä½œè€…å’Œå‘å¸ƒæ—¶é—´ï¼Œæè¿°å’Œçƒ¹é¥ªæ—¶é—´ç­‰ç­‰ã€‚è¿™æ ·è°·æ­Œæœç´¢å‡ºæ¥å°±æœ‰æœºä¼šå«æœ‰è¿™äº›æç¤ºæˆ–è€…ä½ å¸¦ç€å…³é”®ä¿¡æ¯å»æœç´¢æ›´æœ‰åˆ©äºæ‰¾åˆ°ç»“æœã€‚</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ee7e3ae735049b1ba53e28600ed31fa~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>å®˜æ–¹æä¾›äº†å„ç§å­—æ®µç”¨æ¥æè¿°â€é£Ÿè°±â€ï¼Œä½ åªè¦å»æŸ¥é˜…ç›¸å…³å­—æ®µï¼Œå°±å¯ä»¥ç›´æ¥æŒ‰æ ¼å¼æ¥ä½¿ç”¨äº†ã€‚</p>
<p>å› ä¸ºè¯¥ SEO ä¼˜åŒ–é’ˆå¯¹è°·æ­Œæœç´¢å¼•æ“ç‰¹æœ‰çš„ï¼Œæ‰€ä»¥æœ‰è®¾ç½®è¯¥æ–¹å¼çš„ç½‘ç«™é€šå¸¸æ˜¯ç”¨æˆ·æ˜¯ä¸é™äºå›½å†…çš„ï¼Œä¸ä»…æ˜¯ç»“æ„åŒ–æ•°æ®ç‰¹æœ‰ï¼Œè¿˜æœ‰ä¸€ç§ SEO ä¼˜åŒ–æ–¹å¼æ˜¯ <strong>AMP ç½‘é¡µ</strong>ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥äº†è§£çœ‹çœ‹ â€”â€” <a href="https://developers.google.com/search/docs/guides/about-amp" target="_blank" rel="noopener">AMP</a></p>
<p>è°·æ­Œè¿˜æä¾›äº†æµ‹è¯•å·¥å…· <a href="https://search.google.com/structured-data/testing-tool" target="_blank" rel="noopener">Structured Data Testing Tool</a>ï¼Œå¯ä»¥è¾“å…¥æµ‹è¯•ç½‘ç«™ç½‘å€æ¥æŸ¥çœ‹è¯¥ç½‘ç«™æœ‰æ²¡æœ‰ç»“æ„åŒ–æ•°æ®è®¾ç½®ã€‚</p>
<h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><p>æ¯”å¦‚å‡å°‘ http è¯·æ±‚ï¼Œæ§åˆ¶é¡µé¢å¤§å°ï¼Œæ‡’åŠ è½½ï¼Œåˆ©ç”¨ç¼“å­˜ç­‰ç­‰ï¼Œè¿™æ–¹å¼å°±å¾ˆå¤šäº†ï¼Œéƒ½æ˜¯ä¸ºäº†æé«˜ç½‘ç«™çš„åŠ è½½é€Ÿåº¦å’Œè‰¯å¥½ç”¨æˆ·ä½“éªŒï¼Œè¿™ä¸ªä¹Ÿä¸æ˜¯ä¸“æŒ‡ SEO çš„é—®é¢˜ï¼Œæ˜¯å¼€å‘ä¸­éƒ½è¦åšçš„äº‹æƒ…ã€‚</p>
<p>å› ä¸ºå½“ç½‘ç«™é€Ÿåº¦å¾ˆæ…¢æ—¶ï¼Œä¸€æ—¦è¶…æ—¶ï¼Œâ€èœ˜è››â€ä¹Ÿä¼šç¦»å¼€ã€‚</p>
<h2 id="Gatsby-ä¸‹çš„-SEO-ä¼˜åŒ–"><a href="#Gatsby-ä¸‹çš„-SEO-ä¼˜åŒ–" class="headerlink" title="Gatsby ä¸‹çš„ SEO ä¼˜åŒ–"></a>Gatsby ä¸‹çš„ SEO ä¼˜åŒ–</h2><p>æœ¬èº« Gatsby å°±é‡‡å–é™æ€ç”Ÿæˆçš„æ–¹å¼ï¼ŒSEO å·²æ˜¯å¯ä»¥ï¼Œä½†ä¾ç„¶è¿˜æ˜¯è¦åš SEO ä¼˜åŒ–ã€‚</p>
<p>çŸ¥é“äº†ä¸Šè¿°çš„ SEO ä¼˜åŒ–æ–¹å¼åï¼ŒGatsby è¯¥å¦‚ä½•å®æˆ˜ä¼˜åŒ–å‘¢ï¼Ÿè¿™ä¸ªï¼Œç”±äº Gatsby ç¤¾åŒºæ¯”è¾ƒå¼ºå¤§ï¼Œæ’ä»¶å¾ˆå¤šï¼Œæ‰€ä»¥ä¸Šé¢å‡ ä¸ªä¾é æ’ä»¶å°±å¯ä»¥å¿«é€Ÿé…ç½®ç”Ÿæˆã€‚</p>
<h3 id="gatsby-plugin-robots-txt"><a href="#gatsby-plugin-robots-txt" class="headerlink" title="gatsby-plugin-robots-txt"></a>gatsby-plugin-robots-txt</h3><p>åœ¨ gatsby-config.js é‡Œé¢é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  siteMetadata: &#123;</span><br><span class="line">    siteUrl: &#39;https:&#x2F;&#x2F;www.xxxxx.com&#39;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [&#39;gatsby-plugin-robots-txt&#39;]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="gatsby-plugin-sitemap"><a href="#gatsby-plugin-sitemap" class="headerlink" title="gatsby-plugin-sitemap"></a>gatsby-plugin-sitemap</h3><p>åœ¨ gatsby-config.js é‡Œé¢é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  resolve: &#96;gatsby-plugin-sitemap&#96;,</span><br><span class="line">  options: &#123;</span><br><span class="line">    sitemapSize: 5000,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="ç½‘é¡µ-TDK"><a href="#ç½‘é¡µ-TDK" class="headerlink" title="ç½‘é¡µ TDK"></a>ç½‘é¡µ TDK</h3><p>Gatsby æ ‡å‡†è„šæ‰‹æ¶å’Œæœ‰å®˜æ–¹æ–‡æ¡£éƒ½æœ‰ä¸€ä¸ª SEO.js æ–‡ä»¶ï¼Œé‡Œé¢å°±æ˜¯ç»™æˆ‘ä»¬è®¾ç½® TDK æä¾›äº†æ–¹æ³•</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Helmet &#125; <span class="keyword">from</span> <span class="string">'react-helmet'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useStaticQuery, graphql &#125; <span class="keyword">from</span> <span class="string">'gatsby'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SEO</span>(<span class="params">&#123; description, lang, meta, title &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; site &#125; = useStaticQuery(</span><br><span class="line">    graphql<span class="string">`</span></span><br><span class="line"><span class="string">      query &#123;</span></span><br><span class="line"><span class="string">        site &#123;</span></span><br><span class="line"><span class="string">          siteMetadata &#123;</span></span><br><span class="line"><span class="string">            title</span></span><br><span class="line"><span class="string">            description</span></span><br><span class="line"><span class="string">            author</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> metaDescription = description || site.siteMetadata.description</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Helmet</span><br><span class="line">      htmlAttributes=&#123;&#123;</span><br><span class="line">        lang,</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      title=&#123;title&#125;</span><br><span class="line">      meta=&#123;[</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">`description`</span>,</span><br><span class="line">          content: metaDescription,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          property: <span class="string">`og:title`</span>,</span><br><span class="line">          content: title,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          property: <span class="string">`og:description`</span>,</span><br><span class="line">          content: metaDescription,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          property: <span class="string">`og:type`</span>,</span><br><span class="line">          content: <span class="string">`website`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">`twitter:card`</span>,</span><br><span class="line">          content: <span class="string">`summary`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">`twitter:creator`</span>,</span><br><span class="line">          content: site.siteMetadata.author,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">`twitter:title`</span>,</span><br><span class="line">          content: title,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">`twitter:description`</span>,</span><br><span class="line">          content: metaDescription,</span><br><span class="line">        &#125;,</span><br><span class="line">      ].concat(meta)&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SEO.defaultProps = &#123;</span><br><span class="line">  lang: <span class="string">`en`</span>,</span><br><span class="line">  meta: [],</span><br><span class="line">  description: <span class="string">``</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SEO.propTypes = &#123;</span><br><span class="line">  description: PropTypes.string,</span><br><span class="line">  lang: PropTypes.string,</span><br><span class="line">  meta: PropTypes.arrayOf(PropTypes.object),</span><br><span class="line">  title: PropTypes.string.isRequired,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> SEO</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨é¡µé¢æ¨¡æ¿æ–‡ä»¶ä¸­å¼•å…¥ SEO.jsï¼Œå¹¶ä¼ å…¥é¡µé¢çš„å˜é‡å‚æ•°ï¼Œå³å¯è®¾ç½® TDK ç­‰ç­‰å¤´éƒ¨ä¿¡æ¯ã€‚</p>
<h3 id="structured-data"><a href="#structured-data" class="headerlink" title="structured data"></a>structured data</h3><p>æ¯”å¦‚è¯´é¡¹ç›®æ˜¯æ–°é—»æ–‡ç« å±•ç¤ºçš„ï¼Œå¯ä»¥è®¾ç½®ä¸‰ç§ç»“æ„åŒ–æ•°æ®ï¼ˆæ•°æ®ç±»å‹å’Œå­—æ®µä¸æ˜¯å‡­ç©ºæé€ çš„ï¼Œè¿™ä¸ªéœ€è¦å» Google æŸ¥ç¬¦åˆå¯¹åº”åŒ¹é…çš„ï¼‰â€”â€”æ–‡ç« è¯¦æƒ…é¡µï¼Œæ–‡ç« åˆ—è¡¨é¡µï¼Œå†åŠ ä¸ªå…¬å¸çš„ä»‹ç»ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º</p>
<ul>
<li><code>./src/components/Jsonld.js</code><br>å°è£…å¤–éƒ¨åŒ…ä½çš„ script æ ‡ç­¾ä½œä¸ºç»„ä»¶</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React from &#39;react&#39;</span><br><span class="line">import &#123; Helmet &#125; from &#39;react-helmet&#39;</span><br><span class="line"></span><br><span class="line">function JsonLd(&#123; children &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Helmet&gt;</span><br><span class="line">      &lt;script type&#x3D;&quot;application&#x2F;ld+json&quot;&gt;&#123;JSON.stringify(children)&#125;&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;&#x2F;Helmet&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default JsonLd</span><br></pre></td></tr></table></figure>

<ul>
<li><code>./src/utils/json-ld/article.js</code> - æ–‡ç« è¯¦æƒ…ç»“æ„åŒ–æ•°æ®æè¿°</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> articleSchema = (&#123;</span><br><span class="line">  url,</span><br><span class="line">  headline,</span><br><span class="line">  image,</span><br><span class="line">  datePublished,</span><br><span class="line">  dateModified,</span><br><span class="line">  author,</span><br><span class="line">  publisher,</span><br><span class="line">&#125;) =&gt; (&#123;</span><br><span class="line">  <span class="string">'@context'</span>: <span class="string">'http://schema.org'</span>,</span><br><span class="line">  <span class="string">'@type'</span>: <span class="string">'Article'</span>,</span><br><span class="line">  mainEntityOfPage: &#123;</span><br><span class="line">    <span class="string">'@type'</span>: <span class="string">'WebPage'</span>,</span><br><span class="line">    <span class="string">'@id'</span>: url,</span><br><span class="line">  &#125;,</span><br><span class="line">  headline,</span><br><span class="line">  image,</span><br><span class="line">  datePublished,</span><br><span class="line">  dateModified,</span><br><span class="line">  author: &#123;</span><br><span class="line">    <span class="string">'@type'</span>: <span class="string">'Person'</span>,</span><br><span class="line">    name: author,</span><br><span class="line">  &#125;,</span><br><span class="line">  publisher: &#123;</span><br><span class="line">    <span class="string">'@type'</span>: <span class="string">'Organization'</span>,</span><br><span class="line">    name: publisher.name,</span><br><span class="line">    logo: &#123;</span><br><span class="line">      <span class="string">'@type'</span>: <span class="string">'ImageObject'</span>,</span><br><span class="line">      url: publisher.logo,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> articleSchema</span><br></pre></td></tr></table></figure>

<ul>
<li><code>./src/utils/json-ld/item-list.js</code> - æ–‡ç« åˆ—è¡¨ç»“æ„åŒ–æ•°æ®æè¿°</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> itemListSchema = <span class="function">(<span class="params">&#123; itemListElement &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="string">'@context'</span>: <span class="string">'http://schema.org'</span>,</span><br><span class="line">  <span class="string">'@type'</span>: <span class="string">'ItemList'</span>,</span><br><span class="line">  itemListElement: itemListElement.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="string">'@type'</span>: <span class="string">'ListItem'</span>,</span><br><span class="line">    position: index + <span class="number">1</span>,</span><br><span class="line">    ...item,</span><br><span class="line">  &#125;)),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> itemListSchema</span><br></pre></td></tr></table></figure>

<ul>
<li><code>./src/utils/json-ld/organization.js</code> - å…¬å¸ç»„ç»‡ç»“æ„åŒ–æ•°æ®æè¿°</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> organizationSchema = <span class="function">(<span class="params">&#123; name, url &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="string">'@context'</span>: <span class="string">'http://schema.org'</span>,</span><br><span class="line">  <span class="string">'@type'</span>: <span class="string">'Organization'</span>,</span><br><span class="line">  name,</span><br><span class="line">  url,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> organizationSchema</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†åˆ†åˆ«å¼•å…¥é¡µé¢ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æ–‡ç« è¯¦æƒ…é¡µé¢ï¼Œå¼•å…¥å¯¹åº”ç±»å‹æ–‡ä»¶ï¼Œå¤§æ¦‚å°±æ˜¯è¿™ä¹ˆä¸ªç”¨æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> JsonLd <span class="keyword">from</span> <span class="string">'@components/JsonLd'</span></span><br><span class="line"><span class="keyword">import</span> SEO <span class="keyword">from</span> <span class="string">'@components/SEO'</span></span><br><span class="line"><span class="keyword">import</span> articleSchema <span class="keyword">from</span> <span class="string">'@utils/json-ld/article'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DetailPage = <span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å¤„ç† dataï¼Œæ‹†å¼€ç›¸å…³å­—æ®µ</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;SEO</span><br><span class="line">        title=&#123;meta_title || title&#125;</span><br><span class="line">        description=&#123;meta_description&#125;</span><br><span class="line">        keywords=&#123;meta_keywords&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;JsonLd&gt;</span><br><span class="line">        &#123;articleSchema(&#123;</span><br><span class="line">          url,</span><br><span class="line">          headline: title,</span><br><span class="line">          datePublished: first_publication_date,</span><br><span class="line">          dateModified: last_publication_date,</span><br><span class="line">          author: siteMetadata.title,</span><br><span class="line">          publisher: &#123;</span><br><span class="line">            name: siteMetadata.title,</span><br><span class="line">            logo: <span class="string">'xxx'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      &lt;<span class="regexp">/JsonLd&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Container&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;content...&lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/Container&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Layout&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç è¦æ˜¯è¿·è¿·ç³Šç³Šå€’æ˜¯æ­£å¸¸ï¼Œå› ä¸ºæ²¡æœ‰äº†è§£è¿‡ç»“æ„åŒ–æ•°æ®çš„å†…å®¹ï¼Œä½†çœ‹æ–‡æ¡£å°±å¤§æ¦‚å¯ä»¥äº†è§£æ¸…æ¥šäº†ã€‚</p>
<h3 id="Lighthouse-æ€§èƒ½ä¼˜åŒ–å·¥å…·"><a href="#Lighthouse-æ€§èƒ½ä¼˜åŒ–å·¥å…·" class="headerlink" title="Lighthouse æ€§èƒ½ä¼˜åŒ–å·¥å…·"></a>Lighthouse æ€§èƒ½ä¼˜åŒ–å·¥å…·</h3><p>å¯ä»¥å»è°·æ­Œå•†åº—å®‰è£…<code>LightHouse</code>ï¼Œæ‰“å¼€ F12ï¼Œè¿›å…¥ä½ çš„ç½‘ç«™ï¼Œç‚¹å‡»<code>Generate report</code>ï¼Œå°±ä¼šç”Ÿæˆç½‘ç«™å¯¹åº”çš„æŠ¥å‘Š</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f758e6c497674256a516d3a357774826~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<ul>
<li>ç”Ÿæˆçš„ reportï¼š<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d84656f6cce4800ab793feb73141e30~tplv-k3u1fbpfcp-zoom-1.image" alt=""></li>
</ul>
<p>åœ¨å®ƒä¸‹é¢æœ‰ä¸€äº›æç¤ºï¼Œé’ˆå¯¹æ€§èƒ½å’Œ SEO ç­‰ï¼Œä½ å¯ä»¥æ ¹æ®æç¤ºå»æ”¹å–„ä½ çš„ä»£ç ã€‚</p>
<p>æ–‡ç« çš„ä»‹ç»åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›å¯¹å¤§å®¶äº†è§£ SEO æœ‰ä¸€ç‚¹å¸®åŠ©ã€‚SEO çš„æ‘¸ç´¢å¹¶ä¸æ˜¯ä»¥ä¸Šä¸¾ä¾‹å®Œå°±å·®ä¸å¤šæ²¡äº†ï¼Œå…¶å®æœ‰å„ç§å„æ ·çš„æ–¹å¼å¯ä»¥ä¼˜åŒ–ã€‚ä¸Šé¢åˆ—ä¸¾çš„æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘è§‰å¾— SEO ä¼˜åŒ–æ— éæ˜¯æƒ³å¸å¼•æ›´å¤šçš„ç”¨æˆ·ç‚¹å‡»å’Œä½¿ç”¨ç½‘ç«™ï¼Œä½†å¦‚æœç½‘ç«™çš„å†…å®¹ä¼˜è´¨ç”¨æˆ·ä½“éªŒè‰¯å¥½ï¼ŒåŠ æ€§èƒ½å¥½ï¼Œé‚£ä¹ˆæœ‰ç”¨æˆ·ä½¿ç”¨åå°±è‡ªå¸¦æ¨å¹¿æ€§ï¼Œé‚£ä¹ˆæ— ç–‘æ¯” SEO ç®€å•çš„ä¼˜åŒ–å¼ºå¤šäº†ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul>
<li><a href="https://juejin.im/post/6844903824428105735" target="_blank" rel="noopener">å‰ç«¯ SEO ä¼˜åŒ–</a></li>
</ul>
<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>SSR</tag>
        <tag>Gatsby</tag>
        <tag>SEO</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ NextJS</title>
    <url>/2020/08/21/%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-NextJS/</url>
    <content><![CDATA[<p>Next.js ä¹‹å‰ç”¨è¿‡ä¸€æ¬¡ï¼Œè¿™æ¬¡æ˜¯é‡æ–°åšä¸ªå°å›é¡¾ï¼Œç°åœ¨æœ€æ–°ç‰ˆæœ¬å·²ç»åˆ°äº† 9.5.3ï¼Œæœ‰äº› API ä¹ŸåŒä»¥å‰æœ‰ç‚¹ä¸åŒäº†ï¼Œç½‘ä¸Šå¤§éƒ¨åˆ†æ•™ç¨‹ä¹Ÿéƒ½æ˜¯æ—§ç‰ˆæœ¬ v7 çš„æ¯”è¾ƒå¤šï¼Œæ•…æ‰“ç®—å†™ä¸‹ç®€å•çš„æ•™ç¨‹ï¼Œç»å¯¹è¯¦ç»†çš„å¸¦ä½ å…¥ä¸ªå°é—¨ã€‚</p><a id="more"></a><h2 id="åº“ç‰ˆæœ¬"><a href="#åº“ç‰ˆæœ¬" class="headerlink" title="åº“ç‰ˆæœ¬"></a>åº“ç‰ˆæœ¬</h2><p>æœ¬æ–‡æ¡ˆä¾‹ç”¨çš„å…³é”®åº“ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;next&quot;: &quot;^9.5.2&quot;,</span><br><span class="line">&quot;react&quot;: &quot;^16.13.1&quot;,</span><br></pre></td></tr></table></figure><p>node ç‰ˆæœ¬ä¸º 12.18.1ï¼ˆnodejs ç‰ˆæœ¬ &gt;= 10.13 å³å¯ï¼‰</p><h2 id="åˆå§‹åŒ–-Next-js-é¡¹ç›®"><a href="#åˆå§‹åŒ–-Next-js-é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ– Next.js é¡¹ç›®"></a>åˆå§‹åŒ– Next.js é¡¹ç›®</h2><ol><li>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</li></ol><p>å¦‚<code>learn-nextjs-example</code>ï¼Œå…ˆè¿›è¡Œåˆå§‹åŒ–</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i -y</span><br></pre></td></tr></table></figure><ol start="2"><li>å®‰è£…æ‰€éœ€è¦çš„ä¾èµ–åŒ…</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i react react-dom next --save</span><br></pre></td></tr></table></figure><ol start="3"><li>æ·»åŠ  script å‘½ä»¤</li></ol><p>ä¸ºäº†æ˜¯å¼€å‘è¾“å…¥ npm å‘½ä»¤æ›´å¿«æ·ï¼Œæ‰€ä»¥æŠŠå¸¸ç”¨çš„å‘½ä»¤ä½œä¸ºå¿«æ·å‘½ä»¤è®¾ç½®</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;dev&quot;: &quot;next&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;next build&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;next start&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ol start="4"><li>åˆ›å»º pages æ–‡ä»¶å¤¹ï¼Œè¿è¡Œç¬¬ä¸€ä¸ªé¡µé¢</li></ol><blockquote><p>pages æ–‡ä»¶å¤¹æ˜¯æ”¾ç½®é¡µé¢çš„ï¼Œè¿™é‡Œè¾¹çš„æ–‡ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº”è·¯ç”±ã€‚</p></blockquote><ul><li>æ¯”å¦‚åˆ›å»º <code>pages/about.js</code>ï¼Œé‚£ä¹ˆè®¿é—®è¯¥é¡µé¢åœ°å€å°±æ˜¯ <code>http://localhost:3000/about</code>ï¼›</li><li>æ¯”å¦‚åˆ›å»º <code>pages/about/about.js</code>ï¼Œé‚£ä¹ˆè®¿é—®åœ°å€ä¸º<code>http://localhost:3000/about/about</code>ã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬åˆ›å»º <code>pages/index.js</code>ï¼Œindex.js å°±æ˜¯é»˜è®¤ä»£è¡¨æ ¹è·¯å¾„äº†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello Next.js!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm rum dev</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>http://localhost:3000/</code>ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢æˆåŠŸè¿è¡Œäº†ï¼Œä¹Ÿå¯ä»¥çŸ¥é“ Next.js å†…ç½® Reactï¼Œå› æ­¤ä¸ç”¨æˆ‘ä»¬å†å¼•å…¥<br><code>import React from &#39;react&#39;</code>ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ React çš„è¯­æ³•ï¼Œå½“ç„¶ä½ å†™äº†ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä¸è¿‡æ²¡å¿…è¦ã€‚</p><h2 id="è·¯ç”±è·³è½¬"><a href="#è·¯ç”±è·³è½¬" class="headerlink" title="è·¯ç”±è·³è½¬"></a>è·¯ç”±è·³è½¬</h2><p>é¡µé¢è·³è½¬æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯åˆ©ç”¨æ ‡ç­¾<code>Link</code>ï¼Œä¸€ç§æ˜¯ç¼–ç¨‹å¼è·¯ç”±è·³è½¬<code>router.push(&#39;/&#39;)</code>ã€‚è·¯ç”±è·³è½¬æ–¹å¼è¿˜æ˜¯è·Ÿ React å¾ˆåƒçš„ï¼Œåªä¸è¿‡ç”¨çš„æ˜¯ <code>next</code> çš„åŒ…</p><h3 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h3><ol><li>å…ˆåˆ›å»ºä¸¤ä¸ªé¡µé¢</li></ol><p><code>pages/about.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> About = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>About Page<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> About</span><br></pre></td></tr></table></figure><p><code>pages/news.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> News = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>News Page<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> News</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨é¦–é¡µ<code>pages/index.js</code>ç¼–å†™è·¯ç”±è·³è½¬é“¾æ¥</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Hello Next.js!&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Link href='/</span>about<span class="string">'&gt;</span></span><br><span class="line"><span class="string">          &lt;a&gt;å…³äº&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/Link&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;Link href='</span>/news<span class="string">'&gt;</span></span><br><span class="line"><span class="string">          &lt;a&gt;æ–°é—»&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/Link&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default Home</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ a æ ‡ç­¾ä¸ç”¨æ·»åŠ  href å…ƒç´ ï¼Œæ·»åŠ äº†ä¹Ÿä¸èµ·ä½œç”¨ã€‚<br>å¦‚æœ<code>Link</code>é‡Œé¢æ¢æˆå…¶ä»–æ ‡ç­¾å¦‚<code>span</code>ï¼Œä¹Ÿä¾ç„¶èƒ½æˆåŠŸè·³è½¬åˆ°å¯¹åº”é¡µé¢ï¼Œå¯ä»¥çŸ¥é“<code>Link</code>æ˜¯ç»™é‡Œé¢çš„å…ƒç´ æ·»åŠ äº†ç‚¹å‡»ç»‘å®šäº‹ä»¶ï¼Œè€Œä¸æ˜¯åªä¼šç»™ a æ ‡ç­¾æ·»åŠ  href è€Œå·²ã€‚</p><p>æ­¤æ—¶ DOM ç»“æ„ï¼š<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de05d989ca674288856386d286ad3052~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>è¿˜æœ‰è¦æ³¨æ„çš„æ˜¯ï¼š<code>Link</code> é‡Œé¢åªèƒ½æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œè¦ä¸ç„¶å®ƒä¸çŸ¥è¦ç»‘å®šè°ä¼šæŠ¥é”™ã€‚</p><h3 id="ç¼–ç¨‹å¼è·¯ç”±è·³è½¬"><a href="#ç¼–ç¨‹å¼è·¯ç”±è·³è½¬" class="headerlink" title="ç¼–ç¨‹å¼è·¯ç”±è·³è½¬"></a>ç¼–ç¨‹å¼è·¯ç”±è·³è½¬</h3><p>è¿™é‡Œä¸»è¦ç”¨<code>useRouter</code>é’©å­è¿›è¡Œè·³è½¬</p><p>ä¿®æ”¹<code>pages/index.js</code>ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªè·¯ç”±</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">'next/router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> router = useRouter()</span><br><span class="line">  <span class="keyword">const</span> gotoAbout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    router.push(<span class="string">'/news'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Hello Next.js!&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Link href='/</span>about<span class="string">'&gt;</span></span><br><span class="line"><span class="string">          &lt;a&gt;å…³äº&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/Link&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;button onClick=&#123;gotoAbout&#125;&gt;æ–°é—»&lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default Home</span></span><br></pre></td></tr></table></figure><h2 id="è·¯ç”±ä¼ å‚"><a href="#è·¯ç”±ä¼ å‚" class="headerlink" title="è·¯ç”±ä¼ å‚"></a>è·¯ç”±ä¼ å‚</h2><h3 id="query-å½¢å¼ä¼ å‚"><a href="#query-å½¢å¼ä¼ å‚" class="headerlink" title="query å½¢å¼ä¼ å‚"></a>query å½¢å¼ä¼ å‚</h3><p>åœ¨ Next.js ä¸­åªèƒ½é€šè¿‡ queryï¼ˆ?name=jackylinï¼‰æ¥ä¼ é€’å‚æ•°ï¼Œä¸èƒ½é€šè¿‡(path:name)çš„å½¢å¼ä¼ é€’å‚æ•°ã€‚<br>ä¿®æ”¹<code>pages/index.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">'next/router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> router = useRouter()</span><br><span class="line">  <span class="keyword">const</span> gotoAbout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    router.push(<span class="string">'/news'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Hello Next.js!&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Link href='/</span>about?name=jackylin<span class="string">'&gt;</span></span><br><span class="line"><span class="string">          &lt;a&gt;å…³äº&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/Link&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;button onClick=&#123;gotoAbout&#125;&gt;æ–°é—»&lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default Home</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å˜æ¢æˆè¿™ç§æ–¹å¼ä¼ </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Link href&#x3D;&#123;&#123; pathname: &#39;&#x2F;about&#39;, query: &#123; name: &#39;jackylin&#39; &#125; &#125;&#125;&gt;</span><br></pre></td></tr></table></figure><p>ä¼ é€’äº†å‚æ•°<code>name</code>åï¼Œæ¥ä¸‹æ¥æ˜¯æ¥æ”¶å‚æ•°ã€‚</p><p>æ‰“å¼€<code>pages/about.js</code>æ·»åŠ ä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'next/router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = <span class="function">(<span class="params">&#123; router &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;About Page&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;æ¥æ”¶åˆ°å‚æ•°ä¸ºï¼š&#123;router.query.name&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(About)</span></span><br></pre></td></tr></table></figure><p>ç‚¹å‡»<code>å…³äº</code>ï¼Œè·³è½¬åˆ° about é¡µé¢ï¼Œé¡µé¢å†…å®¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">About Page</span><br><span class="line">æ¥æ”¶åˆ°å‚æ•°ä¸ºï¼šjackylin</span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¹Ÿå¯çœ‹åˆ°åœ°å€æ å¸¦æœ‰å‚æ•°ï¼š<code>http://localhost:3000/about?name=jackylin</code></p><h3 id="ç¼–ç¨‹å¼è·¯ç”±è·³è½¬ä¼ é€’å‚æ•°"><a href="#ç¼–ç¨‹å¼è·¯ç”±è·³è½¬ä¼ é€’å‚æ•°" class="headerlink" title="ç¼–ç¨‹å¼è·¯ç”±è·³è½¬ä¼ é€’å‚æ•°"></a>ç¼–ç¨‹å¼è·¯ç”±è·³è½¬ä¼ é€’å‚æ•°</h3><p>ä¿®æ”¹<code>pages/index.js</code>ä¸­çš„ <code>gotoAbout</code>æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> gotoAbout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  router.push(&#123;</span><br><span class="line">    pathname: <span class="string">'/news'</span>,</span><br><span class="line">    query: &#123;</span><br><span class="line">      info: <span class="string">'å­¦ä¹ Next.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pages/news.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'next/router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> News = <span class="function">(<span class="params">&#123; router &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;News Page&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;æ¥æ”¶åˆ°å‚æ•°ä¸ºï¼š&#123;router.query.info&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(News)</span></span><br></pre></td></tr></table></figure><h2 id="è·¯ç”±å˜åŒ–çš„é’©å­"><a href="#è·¯ç”±å˜åŒ–çš„é’©å­" class="headerlink" title="è·¯ç”±å˜åŒ–çš„é’©å­"></a>è·¯ç”±å˜åŒ–çš„é’©å­</h2><p>è¿™é‡Œå°±ä¸ä¸€ä¸ªä¸ªç»†ç»†å±•å¼€äº†ï¼Œç›´æ¥ä»£ç è¯´è¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">'next/router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> router = useRouter()</span><br><span class="line">  <span class="keyword">const</span> gotoAbout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    router.push(&#123;</span><br><span class="line">      pathname: <span class="string">'/news'</span>,</span><br><span class="line">      query: &#123;</span><br><span class="line">        info: <span class="string">'å­¦ä¹ Next.js'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleRouteChangeStart = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'routeChangeStart è·¯ç”±å¼€å§‹å˜åŒ–ï¼Œurl:'</span>, url)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleRouteChangeComplete = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'routeChangeComplete è·¯ç”±ç»“æŸå˜åŒ–ï¼Œurl:'</span>, url)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleBeforeHistoryChange = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'beforeHistoryChange åœ¨æ”¹å˜æµè§ˆå™¨ historyä¹‹å‰è§¦å‘ï¼Œurl:'</span>, url)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleRouteChangeError = <span class="function">(<span class="params">err, url</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`routeChangeError è·³è½¬å‘ç”Ÿé”™è¯¯: <span class="subst">$&#123;err&#125;</span>, url:<span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleHashChangeStart = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'hashChangeStart hashè·¯ç”±æ¨¡å¼è·³è½¬å¼€å§‹æ—¶æ‰§è¡Œï¼Œurl:'</span>, url)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleHashChangeComplete = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'hashChangeComplete hashè·¯ç”±æ¨¡å¼è·³è½¬å®Œæˆæ—¶ï¼Œurl:'</span>, url)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    router.events.on(<span class="string">'routeChangeStart'</span>, handleRouteChangeStart)</span><br><span class="line">    router.events.on(<span class="string">'routeChangeComplete'</span>, handleRouteChangeComplete)</span><br><span class="line">    router.events.on(<span class="string">'beforeHistoryChange'</span>, handleBeforeHistoryChange)</span><br><span class="line">    router.events.on(<span class="string">'routeChangeError'</span>, handleRouteChangeError)</span><br><span class="line">    router.events.on(<span class="string">'hashChangeStart'</span>, handleHashChangeStart)</span><br><span class="line">    router.events.on(<span class="string">'hashChangeComplete'</span>, handleHashChangeComplete)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      router.events.off(<span class="string">'routeChangeStart'</span>, handleRouteChangeStart)</span><br><span class="line">      router.events.off(<span class="string">'routeChangeComplete'</span>, handleRouteChangeComplete)</span><br><span class="line">      router.events.off(<span class="string">'beforeHistoryChange'</span>, handleBeforeHistoryChange)</span><br><span class="line">      router.events.off(<span class="string">'routeChangeError'</span>, handleRouteChangeError)</span><br><span class="line">      router.events.off(<span class="string">'hashChangeStart'</span>, handleHashChangeStart)</span><br><span class="line">      router.events.off(<span class="string">'hashChangeComplete'</span>, handleHashChangeComplete)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Hello Next.js!&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Link href='/</span>about?name=jackylin<span class="string">'&gt;</span></span><br><span class="line"><span class="string">          &lt;a&gt;å…³äº&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/Link&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;button onClick=&#123;gotoAbout&#125;&gt;æ–°é—»&lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default Home</span></span><br></pre></td></tr></table></figure><h2 id="style-jsx-ç¼–å†™é¡µé¢-CSS-æ ·å¼"><a href="#style-jsx-ç¼–å†™é¡µé¢-CSS-æ ·å¼" class="headerlink" title="style-jsx ç¼–å†™é¡µé¢ CSS æ ·å¼"></a>style-jsx ç¼–å†™é¡µé¢ CSS æ ·å¼</h2><p>æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå¤´éƒ¨ç»„ä»¶å†å¼•å…¥<code>pages/index.js</code>ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ–°å»º<code>components/header.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Header = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div className=<span class="string">'header-bar'</span>&gt;Header&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header</span><br></pre></td></tr></table></figure><p><code>pages/index.js</code>å¼•å…¥ Header ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'../components/header'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Header /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€ç»™ Header å†™æ ·å¼ï¼ŒNext.js å†…ç½®æ”¯æŒ style jsx è¯­æ³•ï¼Œè¿™æ˜¯å…¶ä¸­ä¸€ç§ CSS-in-JS çš„è§£å†³æ–¹æ¡ˆ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Header = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div className=<span class="string">'header-bar'</span>&gt;Header&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;style jsx&gt;</span></span><br><span class="line"><span class="regexp">        &#123;`</span></span><br><span class="line"><span class="regexp">          .header-bar &#123;</span></span><br><span class="line"><span class="regexp">            width: 100%;</span></span><br><span class="line"><span class="regexp">            height: 50px;</span></span><br><span class="line"><span class="regexp">            line-height: 50px;</span></span><br><span class="line"><span class="regexp">            background: lightblue;</span></span><br><span class="line"><span class="regexp">            text-align: center;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        `&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>style&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Header</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œæ ·å¼ç”Ÿæ•ˆ<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27bcc345b1bf4fdcb50e582310abc0d7~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>æŸ¥çœ‹ DOM ç»“æ„ï¼Œä¼šå‘ç° Next.js ä¼šè‡ªåŠ¨åŠ å…¥ä¸€ä¸ªéšæœºç±»åï¼ˆjsx-xxxxxxxï¼‰ï¼Œè¿™æ ·å°±èƒ½é˜²æ­¢ CSS çš„å…¨å±€æ±¡æŸ“ã€‚<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2de14d7f46694782a151d440ecb2626f~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h2 id="æ·»åŠ å…¨å±€-CSS-æ–‡ä»¶"><a href="#æ·»åŠ å…¨å±€-CSS-æ–‡ä»¶" class="headerlink" title="æ·»åŠ å…¨å±€ CSS æ–‡ä»¶"></a>æ·»åŠ å…¨å±€ CSS æ–‡ä»¶</h2><p>æ–°å»ºæ–‡ä»¶å¤¹ publicï¼Œç”¨äºæ”¾ç½®é™æ€æ–‡ä»¶å¦‚å›¾ç‰‡å’Œ css æ–‡ä»¶ç­‰ï¼Œæ³¨æ„åªæœ‰åä¸º<code>public</code>çš„ç›®å½•èƒ½å¤Ÿå­˜æ”¾é™æ€èµ„æºå¹¶å¯¹å¤–æä¾›è®¿é—®ã€‚æ–°å»ºæ–‡ä»¶<code>public/static/styles/common.css</code></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è‡ªå®šä¹‰ App</li></ul><p>Next.js ä½¿ç”¨<code>App</code>ç»„ä»¶æ¥åˆå§‹åŒ–é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–<code>App</code>ç»„ä»¶æ¥æ§åˆ¶é¡µé¢çš„åˆå§‹åŒ–ã€‚è¯¥<code>App</code>ä½œç”¨ä¸€èˆ¬å¦‚ä¸‹ï¼š</p><ul><li>åœ¨é¡µé¢åˆ‡æ¢ä¹‹é—´ä¿æŒå¸ƒå±€çš„æŒä¹…åŒ–</li><li>åˆ‡æ¢é¡µé¢æ—¶ä¿æŒçŠ¶æ€</li><li>ä½¿ç”¨ componentDidCatch è‡ªå®šä¹‰é”™è¯¯å¤„ç†</li><li>å‘é¡µé¢æ³¨å…¥é¢å¤–çš„æ•°æ®</li><li>æ·»åŠ å…¨å±€ CSS</li></ul><p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ·»åŠ å…¨å±€ CSS æ ·å¼ï¼Œæ‰€ä»¥éœ€è¦è¦†ç›–åŸæ¥é»˜è®¤çš„<code>App</code>ï¼Œé¦–å…ˆè¦åˆ›å»º<code>pages/_app.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../public/static/styles/common.css'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Component æŒ‡å½“å‰é¡µé¢ï¼Œæ¯æ¬¡è·¯ç”±åˆ‡æ¢æ—¶ï¼ŒComponent éƒ½ä¼šæ›´æ–°</span></span><br><span class="line"><span class="comment"> * pageProps æ˜¯å¸¦æœ‰åˆå§‹å±æ€§çš„å¯¹è±¡ï¼Œè¯¥åˆå§‹å±æ€§ç”±æˆ‘ä»¬çš„æŸä¸ªæ•°æ®è·å–æ–¹æ³•é¢„å…ˆåŠ è½½åˆ°ä½ çš„é¡µé¢ä¸­ï¼Œå¦åˆ™å®ƒå°†æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">MyApp</span>(<span class="params">&#123; Component, pageProps &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...pageProps</span>&#125; /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼Œè¿è¡Œï¼Œå…¨å±€æ ·å¼æ·»åŠ æˆåŠŸã€‚</p><h2 id="é›†æˆ-style-components"><a href="#é›†æˆ-style-components" class="headerlink" title="é›†æˆ style-components"></a>é›†æˆ style-components</h2><p>å¦‚æœæƒ³è¦é¡¹ç›®æ”¯æŒ style-components çš„è¯ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»é…ç½®ã€‚æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰ Document çš„æ–¹å¼æ¥æ”¹å†™ä»£ç ï¼Œå³æ˜¯æŒ‡<code>_document.js</code>æ–‡ä»¶ï¼Œå®ƒåªæœ‰åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™æ‰ä¼šè¢«è°ƒç”¨ï¼Œä¸»è¦ç”¨æ¥ä¿®æ”¹æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ–‡æ¡£å†…å®¹ï¼Œä¸€èˆ¬ç”¨æ¥é…åˆç¬¬ä¸‰æ–¹ css-in-js æ–¹æ¡ˆä½¿ç”¨ã€‚</p><ul><li>å®‰è£…æ‰€éœ€åº“</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i styled-components --save</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ styled-components</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i babel-plugin-styled-components --save-dev</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶<code>.babelrc</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [&quot;next&#x2F;babel&quot;],</span><br><span class="line">  &quot;plugins&quot;: [[&quot;styled-components&quot;, &#123; &quot;ssr&quot;: true &#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»º <code>_document.js</code>ï¼Œæ”¹å†™è¦†ç›–å®ƒåŸæ¥çš„å†™æ³•ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œè¦ä¸€å®šè¦ç»§æ‰¿ <code>Document</code>ï¼Œæ‰æ¥æ”¹å†™</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Document <span class="keyword">from</span> <span class="string">'next/document'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ServerStyleSheet &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDocument</span> <span class="keyword">extends</span> <span class="title">Document</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> getInitialProps(ctx) &#123;</span><br><span class="line">    <span class="keyword">const</span> sheet = <span class="keyword">new</span> ServerStyleSheet()</span><br><span class="line">    <span class="keyword">const</span> originalRenderPage = ctx.renderPage</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ctx.renderPage = <span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">        originalRenderPage(&#123;</span><br><span class="line">          enhanceApp: <span class="function"><span class="params">App</span> =&gt;</span> <span class="function"><span class="params">props</span> =&gt;</span> sheet.collectStyles(<span class="xml"><span class="tag">&lt;<span class="name">App</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>),</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">const</span> initialProps = <span class="keyword">await</span> Document.getInitialProps(ctx)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...initialProps,</span><br><span class="line">        styles: (</span><br><span class="line">          &lt;&gt;</span><br><span class="line">            &#123;initialProps.styles&#125;</span><br><span class="line">            &#123;sheet.getStyleElement()&#125;</span><br><span class="line">          &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">        ),</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125; finally &#123;</span></span><br><span class="line"><span class="regexp">      sheet.seal()</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™å…¶ä¸­è¯¦ç»†é…ç½®æ„æ€å¯ä»¥å»å®˜æ–¹æ–‡æ¡£æ‰¾ç‚¹çº¿ç´¢äº†è§£ï¼š<a href="https://nextjs.org/docs/advanced-features/custom-document" target="_blank" rel="noopener">Next.js</a></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ styled-components çš„æ–¹å¼æ·»åŠ æ ·å¼ï¼Œæ‰“å¼€<code>pages/about.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'next/router'</span></span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Title = styled.h1<span class="string">`</span></span><br><span class="line"><span class="string">  color: green;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = <span class="function">(<span class="params">&#123; router &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Title&gt;About Page&lt;<span class="regexp">/Title&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;æ¥æ”¶åˆ°å‚æ•°ä¸ºï¼š&#123;router.query.name&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(About)</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e914adfd47af4564a3c06b641f514b8e~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h2 id="è·å–æ•°æ®çš„æ–¹å¼"><a href="#è·å–æ•°æ®çš„æ–¹å¼" class="headerlink" title="è·å–æ•°æ®çš„æ–¹å¼"></a>è·å–æ•°æ®çš„æ–¹å¼</h2><p>å››ä¸ª api éƒ½åªèƒ½åœ¨ pages æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ä¸­ä½¿ç”¨</p><h3 id="getStaticProps"><a href="#getStaticProps" class="headerlink" title="getStaticProps"></a>getStaticProps</h3><p><strong>å½“é¡µé¢å†…å®¹å–å†³äºå¤–éƒ¨æ•°æ®</strong></p><p>Next.js æ¨èæˆ‘ä»¬å°½å¯èƒ½ä½¿ç”¨é™æ€ç”Ÿæˆçš„æ–¹å¼ï¼Œå› ä¸ºæ‰€æœ‰é¡µé¢éƒ½å¯ä»¥åªæ„å»ºä¸€æ¬¡å¹¶æ‰˜ç®¡åˆ° CDN ä¸Šï¼Œè¿™æ¯”è®©æœåŠ¡å™¨æ ¹æ®æ¯ä¸ªé¡µé¢è¯·æ±‚æ¥æ¸²æŸ“é¡µé¢å¿«å¾—å¤šã€‚</p><p>æ¯”å¦‚ä¸‹åˆ—ä¸€äº›ç±»å‹çš„é¡µé¢ï¼š</p><ul><li>è¥é”€é¡µé¢</li><li>ä¸ªäººåšå®¢</li><li>äº§å“åˆ—è¡¨</li><li>é™æ€æ–‡æ¡£</li></ul><p>å¦‚æœä¸€ä¸ªé¡µé¢ä½¿ç”¨äº† é™æ€ç”Ÿæˆï¼ˆSSGï¼‰ï¼Œåœ¨æ„å»ºæ—¶å°†ç”Ÿæˆæ­¤é¡µé¢å¯¹åº”çš„ HTML æ–‡ä»¶ ã€‚HTML æ–‡ä»¶å°†åœ¨æ¯ä¸ªé¡µé¢è¯·æ±‚æ—¶è¢«é‡ç”¨ï¼Œè¿˜å¯ä»¥è¢« CDN ç¼“å­˜ã€‚è¿™ä¸ªè·Ÿ hexoï¼ŒGatsby ç±»ä¼¼çš„ï¼Œç”Ÿæˆé™æ€æ–‡ä»¶è¿˜æœ‰ json æ–‡ä»¶ã€‚</p><p>å…³äº Gatsbyï¼Œå®ƒæ˜¯åŸºäº React çš„ä¸Šå±‚æ¡†æ¶ï¼Œå…·ä½“å¯ä»¥çœ‹æˆ‘è¿™ç¯‡åšå®¢äº†è§£ï¼š<a href="https://juejin.im/post/6850418110885789704" target="_blank" rel="noopener">æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ Gatsby</a></p><p>Next.js ä¼šå°½å¯èƒ½åœ°è‡ªåŠ¨ä¼˜åŒ–åº”ç”¨å¹¶è¾“å‡ºé™æ€ HTMLï¼Œå¦‚æœä½ åœ¨ä½ çš„é¡µé¢ç»„ä»¶æ·»åŠ äº†<code>getInitialProps</code>æ–¹æ³•æ‰ä¼šç¦ç”¨è‡ªåŠ¨é™æ€ä¼˜åŒ–ï¼Œ<code>getInitialProps</code>æ–¹æ³•ä¸‹é¢ä¼šè¯´åˆ°ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>æ‰“åŒ…é»˜è®¤æ˜¯ SSG æ¨¡å¼ï¼š</p><p><code>â— (SSG) automatically generated as static HTML + JSON (uses getStaticProps)</code></p><p>ä¼šå‘ç°<code>.next/server/pages/</code>ä¸‹å¤šå‡ºäº†å‡ ä¸ª HTML æ–‡ä»¶ï¼Œè¿™äº›å°±æ˜¯é™æ€æ„å»ºå‡ºçš„ HTML æ–‡ä»¶ã€‚<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06f57ad8a7c046efbcbbbb90032f0396~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>æ–°å»ºæ–‡ä»¶<code>pages/blog.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Blog = <span class="function">(<span class="params">&#123; posts &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>title: &#123;posts.title&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤å‡½æ•°åœ¨æ„å»ºæ—¶è¢«è°ƒç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getStaticProps</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨å¤–éƒ¨ API è·å–å†…å®¹</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">'https://jsonplaceholder.typicode.com/todos/1'</span>)</span><br><span class="line">  <span class="keyword">const</span> posts = <span class="keyword">await</span> res.json()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨æ„å»ºæ—¶å°†æ¥æ”¶åˆ° `posts` å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      posts,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Blog</span><br></pre></td></tr></table></figure><p>è¿›å…¥<code>http://localhost:3000/blog</code>ï¼Œå‘ç°é¡µé¢èƒ½æ­£å¸¸è·å–åˆ°è¯·æ±‚ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">title: delectus aut autem</span><br></pre></td></tr></table></figure><h3 id="getStaticPaths"><a href="#getStaticPaths" class="headerlink" title="getStaticPaths"></a>getStaticPaths</h3><p><strong>å½“é¡µé¢çš„è·¯å¾„å–å†³äºå¤–éƒ¨æ•°æ®</strong></p><p>è¿™ç§æ–¹å¼å’Œä¸Šé¢å°±æœ‰äº›ä¸åŒäº†ï¼Œä¸Šé¢<code>http://localhost:3000/blog</code>è®¿é—®è·¯å¾„æ—¶æˆ‘ä»¬å·²ç»å†™äº†ä¸€ä¸ª js é¡µé¢æ–‡ä»¶ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦æ ¹æ®è·å–çš„æ•°æ®åŠ¨æ€ç”Ÿæˆå¤šç¯‡æ–‡ç« è·¯å¾„çš„è¯ï¼Œé‚£å°±éœ€è¦ç”¨åˆ°è¿™ä¸ª APIï¼Œé€šå¸¸ç”¨è¿™ä¸ª API ä¼šåŒæ—¶é…åˆ<code>getStaticProps</code>ä¸€èµ·ç”¨ã€‚</p><p>æ–°å»ºæ–‡ä»¶<code>pages/posts/[id].js</code>ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œæ–‡ä»¶åå°±æ˜¯<code>[id].js</code></p><p>ç”¨<code>id</code>æ ‡è¯†å•ç¯‡åšæ–‡ï¼Œæ¯”å¦‚ä½ è®¿é—®<code>http://localhost:3000/posts/1</code>å°±å±•ç¤º<code>id</code>ä¸º 1 çš„æ–‡ç« ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Post = <span class="function">(<span class="params">&#123; post &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;æ–‡ç« id: &#123;post.id&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;åšå®¢æ ‡é¢˜: &#123;post.title&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æ„å»ºè·¯ç”±</span></span><br><span class="line"><span class="regexp">export async function getStaticPaths() &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ è°ƒç”¨å¤–éƒ¨ API è·å–åšæ–‡åˆ—è¡¨</span></span><br><span class="line"><span class="regexp">  const res = await fetch('https:/</span><span class="regexp">/jsonplaceholder.typicode.com/</span>todos<span class="string">')</span></span><br><span class="line"><span class="string">  const posts = await res.json()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // æ ¹æ®åšæ–‡åˆ—è¡¨ç”Ÿæˆæ‰€æœ‰éœ€è¦é¢„æ¸²æŸ“çš„è·¯å¾„</span></span><br><span class="line"><span class="string">  const paths = posts.map(post =&gt; `/posts/$&#123;post.id&#125;`)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // fallbackä¸ºfalseï¼Œè¡¨ç¤ºä»»ä½•ä¸åœ¨ getStaticPaths çš„è·¯å¾„çš„ç»“æœå°†æ˜¯ 404 é¡µé¢ã€‚</span></span><br><span class="line"><span class="string">  return &#123; paths, fallback: false &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// è·å–å•ä¸ªé¡µé¢åšæ–‡æ•°æ®</span></span><br><span class="line"><span class="string">export async function getStaticProps(&#123; params &#125;) &#123;</span></span><br><span class="line"><span class="string">  // å¦‚æœè·¯ç”±æ˜¯ /posts/1ï¼Œé‚£ä¹ˆ params.id å°±æ˜¯ 1</span></span><br><span class="line"><span class="string">  const res = await fetch(`https://jsonplaceholder.typicode.com/todos/$&#123;params.id&#125;`)</span></span><br><span class="line"><span class="string">  const post = await res.json()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // é€šè¿‡ props å‚æ•°å‘é¡µé¢ä¼ é€’åšæ–‡çš„æ•°æ®</span></span><br><span class="line"><span class="string">  return &#123; props: &#123; post &#125; &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Post</span></span><br></pre></td></tr></table></figure><p>æ‹‰å–ä¸‹æ¥çš„æ•°æ®å…¨éƒ¨æœ‰ 200 æ¡ï¼Œä¹Ÿå°±æ˜¯è¯´åŠ¨æ€æ„å»ºäº† 200 ä¸ªè·¯ç”±ï¼Œç°åœ¨æˆ‘ä»¬è®¿é—®ç¬¬ 50 ç¯‡åšæ–‡çš„è¯ï¼Œç›´æ¥è¾“å…¥<code>http://localhost:3000/posts/50</code></p><p>é¡µé¢æ˜¾ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–‡ç« id: 50</span><br><span class="line">åšæ–‡æ ‡é¢˜: cupiditate necessitatibus ullam aut quis dolor voluptate</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å†æ¬¡æ‰“åŒ…ï¼Œæ‰§è¡Œ<code>npm run build</code>ï¼ˆå¦‚æœæ‰“åŒ…å‘ç”Ÿé”™è¯¯å¾ˆå¯èƒ½æ˜¯ç½‘ç»œå·®å’Œè¯·æ±‚é“¾æ¥æœ‰å…³ï¼Œå› ä¸ºè¦è¯·æ±‚å¾ˆå¤šé¡µé¢ï¼Œå¦‚æœæ˜¯ç½‘ç»œé—®é¢˜å¤šè¯•å‡ æ¬¡å°±è¡Œï¼‰ï¼Œä½ ä¼šå‘ç°è¿™æ¬¡æ‰“åŒ…æ—¶é—´å˜é•¿äº†ï¼Œå› ä¸ºè¦æ„å»ºçš„é™æ€é¡µé¢å¤šäº†ï¼Œæˆ‘ä»¬è¯·æ±‚è¿”å›æ¥çš„æ•°æ®æœ‰ 200 æ¡ï¼Œæ‰€ä»¥åº”è¯¥ç”Ÿæˆ 200 ä¸ªé™æ€ HTML æ–‡ä»¶å’Œç›¸åº”çš„ json æ•°æ®æ–‡ä»¶ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/088770a941f1479fa15fc96d348f85a4~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>æˆ‘ä»¬æ¥çœ‹ <code>1.json</code> æ–‡ä»¶ï¼Œå°±æ˜¯è¯·æ±‚åçš„æ•°æ®</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;pageProps&quot;:&#123;&quot;post&quot;:&#123;&quot;userId&quot;:1,&quot;id&quot;:1,&quot;title&quot;:&quot;delectus aut autem&quot;,&quot;completed&quot;:false&#125;&#125;,&quot;__N_SSG&quot;:true&#125;</span><br></pre></td></tr></table></figure><h3 id="getServerSideProps"><a href="#getServerSideProps" class="headerlink" title="getServerSideProps"></a>getServerSideProps</h3><p><strong>æ¯æ¬¡é¡µé¢è¯·æ±‚æ—¶é‡æ–°ç”Ÿæˆé¡µé¢çš„ HTML</strong></p><p>å¦‚æœæ— æ³•åœ¨ç”¨æˆ·è¯·æ±‚ä¹‹å‰é¢„æ¸²æŸ“é¡µé¢ï¼Œé‚£ä¸Šé¢çš„â€é™æ€ç”Ÿæˆâ€å°±ä¸å¤ªé€‚ç”¨äº†ï¼Œæˆ–è€…æ˜¯é¡µé¢æ•°æ®éœ€è¦é¢‘ç¹çš„æ›´æ–°ï¼Œå¹¶ä¸”é¡µé¢å†…å®¹ä¼šéšç€æ¯ä¸ªè¯·æ±‚è€Œå˜åŒ–ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li>å°†â€œé™æ€ç”Ÿæˆâ€ä¸ å®¢æˆ·ç«¯æ¸²æŸ“ ä¸€èµ·ä½¿ç”¨ï¼šä½ å¯ä»¥è·³è¿‡é¡µé¢æŸäº›éƒ¨åˆ†çš„é¢„æ¸²æŸ“ï¼Œç„¶åä½¿ç”¨å®¢æˆ·ç«¯ JavaScript æ¥å¡«å……å®ƒä»¬</li><li>ä½¿ç”¨ æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼š Next.js é’ˆå¯¹æ¯ä¸ªé¡µé¢çš„è¯·æ±‚è¿›è¡Œé¢„æ¸²æŸ“ã€‚ç”±äº CDN æ— æ³•ç¼“å­˜è¯¥é¡µé¢ï¼Œå› æ­¤é€Ÿåº¦ä¼šè¾ƒæ…¢ï¼Œä½†æ˜¯é¢„æ¸²æŸ“çš„é¡µé¢å°†å§‹ç»ˆæ˜¯æœ€æ–°çš„ã€‚</li></ul><p>ç”±äºæœåŠ¡å™¨ç«¯æ¸²æŸ“ä¼šå¯¼è‡´æ€§èƒ½æ¯”â€œé™æ€ç”Ÿæˆâ€æ…¢ï¼Œå› æ­¤ä»…åœ¨ç»å¯¹å¿…è¦æ—¶æ‰ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚</p><p>æ–°å»ºæ–‡ä»¶<code>pages/server-blog.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Blog = <span class="function">(<span class="params">&#123; posts &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>title: &#123;posts.title&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ¯æ¬¡é¡µé¢è¯·æ±‚æ—¶éƒ½ä¼šè¿è¡Œï¼Œè€Œåœ¨æ„å»ºæ—¶ä¸è¿è¡Œã€‚</span></span><br><span class="line"><span class="comment">// è¦è®¾ç½®æŸä¸ªé¡µé¢ä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå°±éœ€è¦å¯¼å‡º getServerSideProps å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getServerSideProps</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨å¤–éƒ¨ API è·å–å†…å®¹</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">'https://jsonplaceholder.typicode.com/todos/1'</span>)</span><br><span class="line">  <span class="keyword">const</span> posts = <span class="keyword">await</span> res.json()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨æ„å»ºæ—¶å°†æ¥æ”¶åˆ° `posts` å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      posts,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Blog</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>npm run build</code>ï¼Œå‘ç°è¿™æ¬¡å¹¶æ²¡æœ‰ç”Ÿæˆå¯¹åº”çš„ html æ–‡ä»¶â€”â€”<code>server-blog.html</code>ï¼Œå› ä¸ºæˆ‘ä»¬æŒ‡å®šäº†æœåŠ¡ç«¯æ¸²æŸ“ï¼Œè¯·æ±‚æ„å»ºæ—¶ä¸ä¼šæ‰§è¡Œï¼Œä¸æ˜¯é™æ€ç”Ÿæˆã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2717dff8c6a0485d836091e87f9093c0~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="getInitialProps"><a href="#getInitialProps" class="headerlink" title="getInitialProps"></a>getInitialProps</h3><p>getInitialProps æ˜¯åœ¨æ¸²æŸ“é¡µé¢ä¹‹å‰å°±ä¼šè¿è¡Œçš„ APIã€‚ å¦‚æœè¯¥è·¯å¾„ä¸‹åŒ…å«è¯¥è¯·æ±‚ï¼Œåˆ™æ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¹¶å°†æ‰€éœ€çš„æ•°æ®ä½œä¸º props ä¼ é€’ç»™é¡µé¢ã€‚å½“ç¬¬ä¸€æ¬¡è®¿é—®ç›´æ¥é¡µé¢ï¼ŒgetInitialProps å°±åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œï¼ŒåŠ è½½å®Œæ¯•åé¡µé¢ç»™å®¢æˆ·ç«¯æ‰˜ç®¡ï¼Œä½¿ç”¨å®¢æˆ·ç«¯çš„è·¯ç”±è·³è½¬ï¼Œä¹‹åé¡µé¢çš„ getInitialProps å°±åœ¨å®¢æˆ·ç«¯æ‰§è¡Œäº†ã€‚</p><blockquote><p>æ¨èï¼š getStaticProps æˆ– getServerSidePropsã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Next.js 9.3 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å»ºè®®ä½ ä½¿ç”¨ getStaticProps æˆ– getServerSideProps æ¥æ›¿ä»£ getInitialPropsã€‚è¿™äº›æ–°çš„è·å–æ•°æ®çš„æ–¹æ³•ä½¿ä½ å¯ä»¥åœ¨é™æ€ç”Ÿæˆï¼ˆstatic generationï¼‰å’ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆserver-side renderingï¼‰ä¹‹é—´è¿›è¡Œç²¾ç»†æ§åˆ¶ã€‚</p></blockquote><p>æ–°å»ºæ–‡ä»¶<code>pages/initial-blog.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> InitialBlog = <span class="function">(<span class="params">&#123; post &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;getInitialProps Demo Page&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;è·å–åˆ°çš„title: &#123;post.title&#125;&lt;/</span>div&gt;</span><br><span class="line">      &lt;Link href=<span class="string">'/'</span>&gt;</span><br><span class="line">        &lt;a&gt;è¿”å›é¦–é¡µ&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Link&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">InitialBlog.getInitialProps = async ctx =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const res = await fetch('https:/</span><span class="regexp">/jsonplaceholder.typicode.com/</span>todos/<span class="number">1</span><span class="string">')</span></span><br><span class="line"><span class="string">  const post = await res.json()</span></span><br><span class="line"><span class="string">  return &#123; post &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default InitialBlog</span></span><br></pre></td></tr></table></figure><p>å†ä¿®æ”¹<code>pages/index.js</code>ä»£ç ï¼Œå¢åŠ ä¸€ä¸ª<code>Link</code>æ ‡ç­¾å¯ä»¥è·³è½¬å›è¯¥é¡µé¢</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;Link href=<span class="string">'/initial-blog'</span>&gt;</span><br><span class="line">    &lt;a&gt;è¿›å…¥Initial Blog&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Link&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€ç›´æ¥åœ°å€æ è¾“å…¥<code>http://localhost:3000/initial-blog</code>ï¼Œåœ¨æ¸²æŸ“è¯¥é¡µé¢å†…å®¹å‰ï¼Œå…ˆä¼šæ‰§è¡Œ<code>getInitialProps</code>æ–¹æ³•ï¼Œæ‰§è¡Œå®Œçš„ç»“æœå†ä¼ åˆ°é¡µé¢ç»„ä»¶ï¼Œå¼€å§‹æ¸²æŸ“é¡µé¢ã€‚ç”±äºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢ï¼Œé¦–å±åˆ™ä¸ºæœåŠ¡ç«¯æ¸²æŸ“ã€‚</p><p>é¡µé¢å†…å®¹æ˜¾ç¤ºä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getInitialProps Demo Page</span><br><span class="line">è·å–åˆ°çš„title: delectus aut autem</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨çš„ Network é¢æ¿ï¼Œæ‰¾åˆ° Name å€¼ä¸º<code>initial-blog</code>çš„è¯·æ±‚ï¼Œä¼šçœ‹åˆ°è¯·æ±‚å“åº”å†…å®¹çš„æ­£æ˜¯è¯¥é¡µé¢çš„ HTMLã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4171887a1ccc44e88da72bd43266b35b~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>ç‚¹å‡»<code>è¿”å›é¦–é¡µ</code>ï¼Œå†ä»é¦–é¡µç‚¹å‡»<code>è¿›å…¥Initial Blog</code>ï¼Œé‡æ–°è¿›å…¥è¯¥é¡µé¢ï¼Œæ³¨æ„çš„æ˜¯æ­¤æ—¶å·²ç»ä¸æ˜¯æˆ‘ä»¬æµè§ˆå™¨é€šè¿‡åœ°å€æ è®¿é—®è¯¥é¡µé¢ï¼Œè€Œæ˜¯é€šè¿‡å‰ç«¯è·¯ç”±è¿›å…¥è¯¥é¡µé¢ã€‚</p><p>æŸ¥çœ‹ Network é¢æ¿çš„è¯·æ±‚ï¼Œä¼šçœ‹åˆ°æ­¤æ—¶è¿”å›çš„æ˜¯<code>getInitialProps</code>è¯·æ±‚å›æ¥çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ HTML é¡µé¢å†…å®¹ï¼Œç”±æ­¤å¯çŸ¥æ­¤æ—¶é¡µé¢å·²ç»äº¤ç”±å®¢æˆ·ç«¯æ¸²æŸ“ã€‚è¿™å°±æ˜¯æ‰€è°“ SSR æ¸²æŸ“ï¼Œé¦–å±äº¤ç»™æœåŠ¡ç«¯æ¸²æŸ“è¿”å›ï¼Œè¿”å›åé¡µé¢è·³è½¬å°±æ˜¯å®¢æˆ·ç«¯æ¸²æŸ“äº†ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2da317e74c0482ab58d19ee7bdc51a1~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h2 id="è‡ªå®šä¹‰-Head"><a href="#è‡ªå®šä¹‰-Head" class="headerlink" title="è‡ªå®šä¹‰ Head"></a>è‡ªå®šä¹‰ Head</h2><p>ä¹‹æ‰€ä»¥ä¼šé€‰æ‹© Next.jsï¼Œç›¸ä¿¡ä¸€ä¸ªéå¸¸é‡è¦çš„åŸå› å°±æ˜¯æœ‰åˆ©ç”¨ SEOï¼Œé‚£ä¹ˆåˆ©äºçˆ¬è™«æ£€ç´¢çš„æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯åœ¨é¡µé¢å†™å¥½ TDKï¼ˆtitleã€descriptionã€keywordï¼‰ï¼ŒNext.js å¯ä»¥è‡ªå®šä¹‰<code>Head</code>æ ‡ç­¾</p><p>ä¿®æ”¹<code>components/header.js</code>ï¼Œåœ¨æœ€å¤–å±‚ div æ ¹å…ƒç´ é‡Œå†…æ·»åŠ ä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Head&gt;</span><br><span class="line">  &lt;title&gt;Next.js æ•™ç¨‹ -- JackyLin&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;meta name='viewport' content='initial-scale=1.0, width=device-width' /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/Head&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>http://localhost:3000/</code>ï¼Œå°±ä¼šçœ‹åˆ°é¡µé¢çš„å¤´éƒ¨æ ‡ç­¾ title å·²ç»è¢«æˆ‘ä»¬æ”¹äº†ã€‚</p><h2 id="LazyLoding-å®ç°æ¨¡å—-ç»„ä»¶æ‡’åŠ è½½"><a href="#LazyLoding-å®ç°æ¨¡å—-ç»„ä»¶æ‡’åŠ è½½" class="headerlink" title="LazyLoding å®ç°æ¨¡å—/ç»„ä»¶æ‡’åŠ è½½"></a>LazyLoding å®ç°æ¨¡å—/ç»„ä»¶æ‡’åŠ è½½</h2><p>æ‡’åŠ è½½æ˜¯æŒ‡éœ€è¦ç”¨åˆ°æˆ–è¯¥åŠ è½½åˆ°æŸä¸ªç»„ä»¶/æ¨¡å—çš„æ—¶å€™ï¼Œæ‰åŠ è½½é‚£ä¸ªç»„ä»¶/æ¨¡å—çš„ js æ–‡ä»¶ï¼Œä¹Ÿå«å¼‚æ­¥åŠ è½½ã€‚</p><p>å¦‚æœé¡µé¢æ–‡ä»¶å†…å®¹å¤šè¿‡å¤§ï¼Œé‚£ä¹ˆå¯èƒ½å‡ºç°é¦–æ¬¡æ‰“å¼€é€Ÿåº¦æ…¢ï¼Œè¿™æ—¶å°±éœ€è¦è¿›è¡Œä¼˜åŒ–äº†ï¼Œæ‡’åŠ è½½å°±æ˜¯å…¶ä¸­ä¸€ç§æ–¹å¼ã€‚</p><h3 id="æ‡’åŠ è½½æ¨¡å—"><a href="#æ‡’åŠ è½½æ¨¡å—" class="headerlink" title="æ‡’åŠ è½½æ¨¡å—"></a>æ‡’åŠ è½½æ¨¡å—</h3><p>å…ˆå®‰è£…ä¸€ä¸ªå¤„ç†æ—¥æœŸæ—¶é—´çš„åº“</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i moment --save</span><br></pre></td></tr></table></figure><p>æ–°å»º<code>pages/time.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Time = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> getTime = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setNowTime(moment().format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> [nowTime, setNowTime] = useState(<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;getTime&#125;&gt;è·å–å½“å‰æ—¶é—´&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;å½“å‰æ—¶é—´ï¼š&#123;nowTime&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Time</span></span><br></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬è¿™ä¸ªé¡µé¢å†…å®¹å¾ˆå¤šï¼Œç„¶åä½ è¿›å…¥è¯¥é¡µé¢å¯èƒ½ä¸éœ€è¦ç‚¹å‡»è·å–æ—¶é—´ï¼Œä½†<code>moment</code>æ¨¡å—ä¾ç„¶åŠ è½½äº†ï¼Œè¿™å°±æœ‰ç‚¹èµ„æºæµªè´¹ã€‚<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b24abdbe08d64eb7ae5585dcede06dee~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>äºæ˜¯ï¼Œæˆ‘ä»¬æƒ³å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œå†æ¥åŠ è½½<code>moment</code>æ¨¡å—ï¼Œå³æ˜¯å®ç°å¼‚æ­¥åŠ è½½ï¼Œè€Œä¸æ˜¯é¡µé¢ä¸€è¿›å…¥å°±åŠ è½½ã€‚</p><p>æ­¤æ—¶ç‚¹å‡»æŒ‰é’®è·å–æ—¶é—´ï¼Œå¯çœ‹åˆ° Network é¢æ¿çœ‹åˆ°<code>moment</code>çš„ä»£ç è¢«æ‰“åŒ…æˆäº†ä¸€ä¸ª<code>1.js</code>æ–‡ä»¶ï¼Œè¿™æ ·å°±å®ç°äº†æ‡’åŠ è½½äº†ï¼Œè¿™æ ·å¯ä»¥å‡å°‘äº†ä¸»è¦ JavaScript åŒ…çš„å¤§å°,å¸¦æ¥äº†æ›´å¿«çš„åŠ è½½é€Ÿåº¦ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94d858ae0d074bd4939864f6105d4f3b~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Time = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> getTime = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> moment = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'moment'</span>)</span><br><span class="line">    setNowTime(moment.default().format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>)) <span class="comment">// æ³¨æ„è¿™é‡Œä½¿ç”¨ defaultï¼Œä¸èƒ½ç›´æ¥ç”¨ moment()</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> getTime = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setNowTime(moment().format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> [nowTime, setNowTime] = useState(<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;getTime&#125;&gt;è·å–å½“å‰æ—¶é—´&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;å½“å‰æ—¶é—´ï¼š&#123;nowTime&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Time</span></span><br></pre></td></tr></table></figure><h3 id="æ‡’åŠ è½½ç»„ä»¶"><a href="#æ‡’åŠ è½½ç»„ä»¶" class="headerlink" title="æ‡’åŠ è½½ç»„ä»¶"></a>æ‡’åŠ è½½ç»„ä»¶</h3><p>æ‡’åŠ è½½ç»„ä»¶éœ€è¦å¼•å…¥ <code>next/dynamic</code>æ¨¡å—</p><p>æ–°å»ºç»„ä»¶<code>components/content.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Content = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Content</span><br></pre></td></tr></table></figure><p>å¼•å…¥<code>pages/time.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> dynamic <span class="keyword">from</span> <span class="string">'next/dynamic'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‡’åŠ è½½è‡ªå®šä¹‰ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> Content = dynamic(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../components/content'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Time = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> getTime = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> moment = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'moment'</span>)</span><br><span class="line">    setNowTime(moment.default().format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>)) <span class="comment">// æ³¨æ„è¿™é‡Œä½¿ç”¨ defaultï¼Œä¸èƒ½ç›´æ¥ç”¨ moment()</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> [nowTime, setNowTime] = useState(<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;getTime&#125;&gt;è·å–å½“å‰æ—¶é—´&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;å½“å‰æ—¶é—´ï¼š&#123;nowTime&#125;&lt;/</span>div&gt;</span><br><span class="line">      &lt;Content /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Time</span></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿ Network å¯ä»¥çœ‹åˆ° Content ç»„ä»¶è¢«æ–°å•ç‹¬æ‰“åŒ…æˆä¸€ä¸ª js æ–‡ä»¶</p><h2 id="æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒ"><a href="#æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒ"></a>æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒ</h2><p>æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>æ‰“åŒ…å®Œæˆåï¼Œè¿è¡ŒæœåŠ¡å™¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run start</span><br></pre></td></tr></table></figure><p>ç„¶åæŸ¥çœ‹é¡µé¢ï¼Œæ‰“åŒ…æˆåŠŸï¼</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://medium.com/swlh/server-side-rendering-styled-components-with-nextjs-1db1353e915e" target="_blank" rel="noopener">Server side rendering Styled-Components with NextJS</a></li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>SSR</tag>
        <tag>NextJS</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯è·¨åŸŸè§£å†³æ–¹æ¡ˆå½’çº³æ•´ç†</title>
    <url>/2020/08/16/%E5%89%8D%E7%AB%AF%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%BD%92%E7%BA%B3%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<p>å‰ç«¯è·¨åŸŸçš„å„ç§æ–‡ç« å…¶å®å·²ç»å¾ˆå¤šäº†ï¼Œä½†å¤§éƒ¨åˆ†è¿˜æ˜¯ä¸å¤ªç¬¦åˆæˆ‘èƒƒå£çš„ä»‹ç»è·¨åŸŸã€‚çœ‹æ¥çœ‹å»ï¼Œå¦‚æœè¦è®©è‡ªå·±ç†è§£å°è±¡æ·±åˆ»ï¼Œæœç„¶è¿˜æ˜¯å¾—è‡ªå·±æ•²ä¸€æ•²ï¼Œå¹¶æ€»ç»“å½’çº³æ•´ç†ä¸€ç¯‡åšå®¢å‡ºæ¥ï¼Œä»¥æ­¤è®°å½•ã€‚</p>
<a id="more"></a>

<h2 id="è·¨åŸŸçš„é™åˆ¶"><a href="#è·¨åŸŸçš„é™åˆ¶" class="headerlink" title="è·¨åŸŸçš„é™åˆ¶"></a>è·¨åŸŸçš„é™åˆ¶</h2><p>è·¨åŸŸæ˜¯ä¸ºäº†é˜»æ­¢ç”¨æˆ·è¯»å–åˆ°å¦ä¸€ä¸ªåŸŸåä¸‹çš„å†…å®¹ï¼ŒAjax å¯ä»¥è·å–å“åº”ï¼Œæµè§ˆå™¨è®¤ä¸ºè¿™ä¸å®‰å…¨ï¼Œæ‰€ä»¥æ‹¦æˆªäº†å“åº”ã€‚</p>
<h2 id="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"><a href="#è·¨åŸŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"></a>è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h2><p>é™¤éç‰¹åˆ«è¯´æ˜ï¼Œå¦åˆ™ä¸‹æ–¹æ ‡è®°çš„ html æ–‡ä»¶é»˜è®¤éƒ½è¿è¡Œåœ¨ <a href="http://127.0.0.1:5500" target="_blank" rel="noopener">http://127.0.0.1:5500</a> æœåŠ¡ä¸‹</p>
<h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>CORS å³æ˜¯æŒ‡è·¨åŸŸèµ„æºå…±äº«ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘éåŒæºæœåŠ¡å™¨ï¼Œå‘å‡º Ajax è¯·æ±‚ï¼Œä»è€Œå…‹æœäº† Ajax åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚è¿™ç§æ–¹å¼çš„è·¨åŸŸä¸»è¦æ˜¯åœ¨åç«¯è¿›è¡Œè®¾ç½®ã€‚</p>
<p>è¿™ç§æ–¹å¼çš„å…³é”®æ˜¯åç«¯è¿›è¡Œè®¾ç½®ï¼Œå³æ˜¯åç«¯å¼€å¯ Access-Control-Allow-Origin ä¸º<code>*</code>æˆ–å¯¹åº”çš„ <code>origin</code>å°±å¯ä»¥å®ç°è·¨åŸŸã€‚</p>
<p>æµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ã€‚</p>
<p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚</p>
<ol>
<li>è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹æ˜¯ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š</li>
</ol>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<ol start="2">
<li>HTTP çš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</li>
</ol>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼ application/x-www-form-urlencodedã€multipart/form-dataã€text/plain</li>
</ul>
<p>å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚</p>
<p><strong>ç®€å•è¯·æ±‚</strong></p>
<p>cors.html</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest() xhr.open(<span class="string">'GET'</span>, <span class="string">'http://localhost:8002/request'</span>)</span><br><span class="line">xhr.send(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<p>server.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://127.0.0.1:5500'</span>) <span class="comment">// è®¾ç½®å…è®¸å“ªä¸ªåŸŸè®¿é—®</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.end(<span class="string">'server ok'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8002</span>)</span><br></pre></td></tr></table></figure>

<p><strong>éç®€å•è¯·æ±‚</strong></p>
<p>ä¸Šé¢çš„æ˜¯ç®€å•è¯·æ±‚ï¼Œå¦‚æœæˆ‘ä»¬ç”¨éç®€å•è¯·æ±‚çš„æ–¹å¼ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯ PUTï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®å®ç°è·¨åŸŸã€‚</p>
<p>éç®€å•è¯·æ±‚çš„ CORS è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ã€‚</p>
<p>æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°â€é¢„æ£€â€è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº† Originã€Access-Control-Request-Method å’Œ Access-Control-Request-Headers å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„ XMLHttpRequest è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'PUT'</span>, <span class="string">'http://localhost:8002/request'</span>)</span><br><span class="line">xhr.send(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<p>server.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> whileList = [<span class="string">'http://127.0.0.1:5500'</span>] <span class="comment">// è®¾ç½®ç™½åå•</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> origin = req.headers.origin</span><br><span class="line">  <span class="built_in">console</span>.log(whitList.includes(origin))</span><br><span class="line">  <span class="keyword">if</span> (whitList.includes(origin)) &#123;</span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, origin) <span class="comment">// è®¾ç½®å…è®¸å“ªä¸ªåŸŸè®¿é—®</span></span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Methods'</span>, <span class="string">'PUT'</span>) <span class="comment">// è®¾ç½®å…è®¸å“ªç§è¯·æ±‚æ–¹æ³•è®¿é—®</span></span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.put(<span class="string">'/request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.end(<span class="string">'server ok'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8002</span>)</span><br></pre></td></tr></table></figure>

<p>æ•´ä¸ªè¿‡ç¨‹å‘é€äº†ä¸¤æ¬¡è¯·æ±‚ï¼Œè·¨åŸŸæˆåŠŸã€‚</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/414b7733753342dc84384053835ad883~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>å½“ç„¶ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–å‚æ•°ï¼š</p>
<ul>
<li><strong>Access-Control-Request-Headers</strong></li>
</ul>
<p>è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨ CORS è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µ</p>
<ul>
<li><strong>Access-Control-Allow-Credentials</strong></li>
</ul>
<p>è¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie ä¸åŒ…æ‹¬åœ¨ CORS è¯·æ±‚ä¹‹ä¸­ã€‚</p>
<ul>
<li><strong>Access-Control-Expose-Headers</strong></li>
</ul>
<p>CORS è¯·æ±‚æ—¶ï¼ŒXMLHttpRequest å¯¹è±¡çš„ getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ° 6 ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨ Access-Control-Expose-Headers é‡Œé¢æŒ‡å®šã€‚</p>
<ul>
<li><strong>Access-Control-Max-Age</strong></li>
</ul>
<p>ç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚æœ‰æ•ˆæœŸæ˜¯ 20 å¤©ï¼ˆ1728000 ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº” 1728000 ç§’ï¼ˆå³ 20 å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚</p>
<h3 id="Node-ä¸­é—´ä»¶ä»£ç†"><a href="#Node-ä¸­é—´ä»¶ä»£ç†" class="headerlink" title="Node ä¸­é—´ä»¶ä»£ç†"></a>Node ä¸­é—´ä»¶ä»£ç†</h3><p>å®ç°åŸç†ï¼šåŒæºç­–ç•¥æ˜¯æµè§ˆå™¨éœ€è¦éµå¾ªçš„æ ‡å‡†ï¼Œè€Œå¦‚æœæ˜¯æœåŠ¡å™¨å‘æœåŠ¡å™¨è¯·æ±‚å°±æ²¡æœ‰è·¨åŸŸä¸€è¯´ã€‚</p>
<p>ä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦åšä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ ã€‚</li>
<li>å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨ã€‚</li>
<li>æ‹¿åˆ°æœåŠ¡å™¨å“åº”æ•°æ®ã€‚</li>
<li>å°†å“åº”è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p>è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ express ä¸­é—´ä»¶ http-proxy-middleware æ¥ä»£ç†è·¨åŸŸ, è½¬å‘è¯·æ±‚å’Œå“åº”</p>
<p>æ¡ˆä¾‹ä¸‰ä¸ªæ–‡ä»¶éƒ½åœ¨åŒä¸€çº§ç›®å½•ä¸‹ï¼š</p>
<p>index.html</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/api/request'</span>)</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'è¯·æ±‚æˆåŠŸï¼Œç»“æœæ˜¯ï¼š'</span>, xhr.responseText) <span class="comment">// request success</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.send(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<p>nodeMdServer.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">'http-proxy-middleware'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®é™æ€èµ„æº</span></span><br><span class="line">app.use(express.static(__dirname))</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ä»£ç†</span></span><br><span class="line">app.use(</span><br><span class="line">  <span class="string">'/api'</span>,</span><br><span class="line">  createProxyMiddleware(&#123;</span><br><span class="line">    target: <span class="string">'http://localhost:8002'</span>,</span><br><span class="line">    pathRewrite: &#123;</span><br><span class="line">      <span class="string">'^/api'</span>: <span class="string">''</span>, <span class="comment">// é‡å†™è·¯å¾„</span></span><br><span class="line">    &#125;,</span><br><span class="line">    changeOrigin: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8001</span>)</span><br></pre></td></tr></table></figure>

<p>nodeServer.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.end(<span class="string">'request success'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8002</span>)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ<code>http://localhost:8001/index.html</code>ï¼Œè·¨åŸŸæˆåŠŸ</p>
<p>å¹³å¸¸ vue/react é¡¹ç›®é…ç½® webpack-dev-server çš„æ—¶å€™ä¹Ÿæ˜¯é€šè¿‡ Node proxy ä»£ç†çš„æ–¹å¼æ¥è§£å†³çš„ã€‚</p>
<h3 id="Nginx-åå‘ä»£ç†"><a href="#Nginx-åå‘ä»£ç†" class="headerlink" title="Nginx åå‘ä»£ç†"></a>Nginx åå‘ä»£ç†</h3><p>å®ç°åŸç†ç±»ä¼¼äº Node ä¸­é—´ä»¶ä»£ç†ï¼Œéœ€è¦ä½ æ­å»ºä¸€ä¸ªä¸­è½¬ nginx æœåŠ¡å™¨ï¼Œç”¨äºè½¬å‘è¯·æ±‚ã€‚</p>
<p>è¿™ç§æ–¹å¼åªéœ€ä¿®æ”¹ Nginx çš„é…ç½®å³å¯è§£å†³è·¨åŸŸé—®é¢˜ï¼Œå‰ç«¯é™¤äº†æ¥å£æ¢æˆå¯¹åº”å½¢å¼ï¼Œç„¶åå‰åç«¯ä¸éœ€è¦ä¿®æ”¹ä½œå…¶ä»–ä¿®æ”¹ã€‚</p>
<p>å®ç°æ€è·¯ï¼šé€šè¿‡ nginx é…ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼ˆåŒåŸŸä¸åŒç«¯å£ï¼‰åšè·³æ¿æœºï¼Œåå‘ä»£ç†è¦è·¨åŸŸçš„åŸŸåï¼Œè¿™æ ·å¯ä»¥ä¿®æ”¹ cookie ä¸­ domain ä¿¡æ¯ï¼Œæ–¹ä¾¿å½“å‰åŸŸ cookie å†™å…¥ï¼Œå®ç°è·¨åŸŸç™»å½•ã€‚</p>
<p>nginx ç›®å½•ä¸‹çš„ nginx.conf ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; proxyæœåŠ¡å™¨</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name  www.domain1.com;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass   http:&#x2F;&#x2F;www.domain2.com:8080;  # åå‘ä»£ç†</span><br><span class="line">        proxy_cookie_domain www.domain2.com www.domain1.com; # ä¿®æ”¹cookieé‡ŒåŸŸå</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line"></span><br><span class="line">        # å½“ç”¨webpack-dev-serverç­‰ä¸­é—´ä»¶ä»£ç†æ¥å£è®¿é—®nignxæ—¶ï¼Œæ­¤æ—¶æ— æµè§ˆå™¨å‚ä¸ï¼Œæ•…æ²¡æœ‰åŒæºé™åˆ¶ï¼Œä¸‹é¢çš„è·¨åŸŸé…ç½®å¯ä¸å¯ç”¨</span><br><span class="line">        add_header Access-Control-Allow-Origin http:&#x2F;&#x2F;www.domain1.com;  # å½“å‰ç«¯åªè·¨åŸŸä¸å¸¦cookieæ—¶ï¼Œå¯ä¸º*</span><br><span class="line">        add_header Access-Control-Allow-Credentials true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ Nginx</p>
<p>index.html</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"><span class="comment">// å‰ç«¯å¼€å…³ï¼šæµè§ˆå™¨æ˜¯å¦è¯»å†™cookie</span></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span></span><br><span class="line"><span class="comment">// è®¿é—®nginxä¸­çš„ä»£ç†æœåŠ¡å™¨</span></span><br><span class="line">xhr.open(<span class="string">'get'</span>, <span class="string">'http://www.domain1.com:81/?user=admin'</span>, <span class="literal">true</span>)</span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure>

<p>server.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</span><br><span class="line">server.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> params = qs.parse(req.url.substring(<span class="number">2</span>))</span><br><span class="line">  <span class="comment">// å‘å‰å°å†™cookie</span></span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Set-Cookie'</span>: <span class="string">'l=123456;Path=/;Domain=www.domain2.com;HttpOnly'</span>, <span class="comment">// HttpOnly:è„šæœ¬æ— æ³•è¯»å–</span></span><br><span class="line">  &#125;)</span><br><span class="line">  res.write(<span class="built_in">JSON</span>.stringify(params))</span><br><span class="line">  res.end()</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<h3 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h3><p>åŸç†ï¼šåˆ©ç”¨äº† script æ ‡ç­¾å¯è·¨åŸŸçš„ç‰¹æ€§ï¼Œåœ¨å®¢æˆ·ç«¯å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆ<strong>å…¨å±€å‡½æ•°</strong>ï¼‰ï¼Œè¯·æ±‚æœåŠ¡ç«¯è¿”å›è¯¥å›è°ƒå‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶å°†æœåŠ¡ç«¯çš„æ•°æ®ä»¥è¯¥å›è°ƒå‡½æ•°å‚æ•°çš„å½¢å¼ä¼ é€’è¿‡æ¥ï¼Œç„¶åè¯¥å‡½æ•°å°±è¢«æ‰§è¡Œäº†ã€‚è¯¥æ–¹æ³•éœ€è¦æœåŠ¡ç«¯é…åˆå®Œæˆã€‚</p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<ol>
<li>å£°æ˜ä¸€ä¸ªå…¨å±€å›è°ƒå‡½æ•°ï¼Œå‚æ•°ä¸ºæœåŠ¡ç«¯è¿”å›çš„ dataã€‚</li>
<li>åˆ›å»ºä¸€ä¸ª script æ ‡ç­¾ï¼Œæ‹¼æ¥æ•´ä¸ªè¯·æ±‚ api çš„åœ°å€ï¼ˆè¦ä¼ å…¥å›è°ƒå‡½æ•°åç§°å¦‚ ?callback=getInfo ï¼‰ï¼Œèµ‹å€¼ç»™ script çš„ src å±æ€§</li>
<li>æœåŠ¡ç«¯æ¥å—åˆ°è¯·æ±‚åå¤„ç†æ•°æ®ï¼Œç„¶åå°†å‡½æ•°åå’Œéœ€è¦è¿”å›çš„æ•°æ®æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œæ‹¼è£…å®Œæˆæ˜¯æ‰§è¡Œå‡½æ•°çš„å½¢å¼ã€‚ï¼ˆgetInfo(â€˜server dataâ€™)ï¼‰</li>
<li>æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„è¿”å›ç»“æœï¼Œè°ƒç”¨äº†å£°æ˜çš„å›è°ƒå‡½æ•°ã€‚</li>
</ol>
<p>jsonp.html</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data) <span class="comment">// å‘Šè¯‰ä½ ä¸€å£°ï¼Œ jsonpè·¨åŸŸæˆåŠŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">script.src = <span class="string">'http://localhost:3000?callback=getInfo'</span> <span class="comment">//</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(script)</span><br></pre></td></tr></table></figure>

<p>server.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; callback &#125; = req.query</span><br><span class="line">  res.end(<span class="string">`<span class="subst">$&#123;callback&#125;</span>('å‘Šè¯‰ä½ ä¸€å£°ï¼Œ jsonpè·¨åŸŸæˆåŠŸ')`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p>jQuery çš„ $.ajax() æ–¹æ³•å½“ä¸­é›†æˆäº† JSONP çš„å®ç°ï¼Œåœ¨æ­¤å°±ä¸å†™å‡ºæ¥äº†ã€‚</p>
<p>åœ¨å¼€å‘ä¸­å¯èƒ½ä¼šé‡åˆ°å¤šä¸ª JSONP è¯·æ±‚çš„å›è°ƒå‡½æ•°åæ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”è¿™ç§æ–¹å¼ç”¨èµ·æ¥ä¹Ÿéº»çƒ¦ï¼Œæ•…æˆ‘ä»¬è‡ªå·±å°è£…ä¸€ä¸ª jsonp å‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span>(<span class="params">&#123; url, params, callback &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">    <span class="comment">// å®šä¹‰å…¨å±€å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="built_in">window</span>[callback] = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      resolve(data)</span><br><span class="line">      <span class="built_in">document</span>.body.removeChild(script) <span class="comment">// è°ƒç”¨å®Œæ¯•å³åˆ é™¤</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = &#123; callback, ...params &#125; <span class="comment">// &#123;callback: "getInfo", name: "jacky"&#125;</span></span><br><span class="line">    <span class="keyword">let</span> paramsArr = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">      paramsArr.push(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;params[key]&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    script.src = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;paramsArr.join(<span class="string">'&amp;'</span>)&#125;</span>`</span> <span class="comment">// http://localhost:3000/?callback=getInfo&amp;name=jacky</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jsonp(&#123;</span><br><span class="line">  url: <span class="string">'http://localhost:3000'</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">'jacky'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  callback: <span class="string">'getInfo'</span>,</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res) <span class="comment">// å‘Šè¯‰ä½ ä¸€å£°ï¼Œ jsonpè·¨åŸŸæˆåŠŸ</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯è§£æ„çš„æ—¶å€™å¯ä»¥å–å‡ºå‚æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; callback, name &#125; = req.query</span><br><span class="line">  res.end(<span class="string">`<span class="subst">$&#123;callback&#125;</span>('å‘Šè¯‰ä½ ä¸€å£°ï¼Œ jsonpè·¨åŸŸæˆåŠŸ')`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç‚¹ï¼šå…¼å®¹æ€§å¥½</p>
<p>ç¼ºç‚¹ï¼šç”±äº script æœ¬èº«çš„é™åˆ¶ï¼Œè¯¥è·¨åŸŸæ–¹å¼ä»…æ”¯æŒ get è¯·æ±‚ï¼Œä¸”ä¸å®‰å…¨å¯èƒ½é­å— XSS æ”»å‡»</p>
<h3 id="postMessage"><a href="#postMessage" class="headerlink" title="postMessage"></a>postMessage</h3><p>postMessage æ˜¯ HTML5 XMLHttpRequest Level 2 ä¸­çš„ APIï¼Œä¸”æ˜¯ä¸ºæ•°ä¸å¤šå¯ä»¥è·¨åŸŸæ“ä½œçš„ window å±æ€§ä¹‹ä¸€ï¼Œå®ƒå¯ç”¨äºè§£å†³ä»¥ä¸‹æ–¹é¢çš„é—®é¢˜ï¼š</p>
<ol>
<li>é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’</li>
<li>å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’</li>
<li>é¡µé¢ä¸åµŒå¥—çš„ iframe æ¶ˆæ¯ä¼ é€’</li>
<li>ä¸Šé¢ä¸‰ä¸ªåœºæ™¯çš„è·¨åŸŸæ•°æ®ä¼ é€’</li>
</ol>
<p>æ€»ä¹‹ï¼Œå®ƒå¯ä»¥å…è®¸æ¥è‡ªä¸åŒæºçš„è„šæœ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œæœ‰é™çš„é€šä¿¡ï¼Œå¯ä»¥å®ç°è·¨æ–‡æœ¬æ¡£ã€å¤šçª—å£ã€è·¨åŸŸæ¶ˆæ¯ä¼ é€’ã€‚</p>
<blockquote>
<p>otherWindow.postMessage(message, targetOrigin, [transfer]);</p>
</blockquote>
<ul>
<li>otherWindowï¼šå…¶ä»–çª—å£çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ¯”å¦‚ iframe çš„ contentWindow å±æ€§ã€æ‰§è¡Œ window.open è¿”å›çš„çª—å£å¯¹è±¡ã€æˆ–è€…æ˜¯å‘½åè¿‡æˆ–æ•°å€¼ç´¢å¼•çš„ window.framesã€‚</li>
<li>message: å°†è¦å‘é€åˆ°å…¶ä»– window çš„æ•°æ®ã€‚</li>
<li>targetOrigin:é€šè¿‡çª—å£çš„ origin å±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼Œå…¶å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²â€*â€œï¼ˆè¡¨ç¤ºæ— é™åˆ¶ï¼‰æˆ–è€…ä¸€ä¸ª URIã€‚åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœç›®æ ‡çª—å£çš„åè®®ã€ä¸»æœºåœ°å€æˆ–ç«¯å£è¿™ä¸‰è€…çš„ä»»æ„ä¸€é¡¹ä¸åŒ¹é… targetOrigin æä¾›çš„å€¼ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸ä¼šè¢«å‘é€ï¼›åªæœ‰ä¸‰è€…å®Œå…¨åŒ¹é…ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«å‘é€ã€‚</li>
<li>transfer(å¯é€‰)ï¼šæ˜¯ä¸€ä¸²å’Œ message åŒæ—¶ä¼ é€’çš„ Transferable å¯¹è±¡. è¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€ä¸€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒã€‚</li>
</ul>
<p>è¿™æ¬¡æˆ‘ä»¬æŠŠä¸¤ä¸ª html æ–‡ä»¶æŒ‚åˆ°ä¸¤ä¸ª server ä¸‹ï¼Œé‡‡å– fs è¯»å–çš„æ–¹å¼å¼•å…¥ï¼Œè¿è¡Œä¸¤ä¸ª js æ–‡ä»¶</p>
<p>postMessage1.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://localhost:8002"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">id</span>=<span class="string">"frame"</span> <span class="attr">onLoad</span>=<span class="string">"load()"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> frame = <span class="built_in">document</span>.getElementById(<span class="string">'frame'</span>)</span></span><br><span class="line"><span class="actionscript">      frame.contentWindow.postMessage(<span class="string">'ä½ å¥½ï¼Œæˆ‘æ˜¯postMessage1'</span>, <span class="string">'http://localhost:8002'</span>) <span class="comment">//å‘é€æ•°æ®</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//æ¥å—è¿”å›æ•°æ®</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(e.data) <span class="comment">// ä½ å¥½ï¼Œæˆ‘æ˜¯postMessage2</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>postMsgServer1.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> html = fs.readFileSync(<span class="string">'./postMessage1.html'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">  res.end(html)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8001</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server listening on 8001'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>postMessage2.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e.data) <span class="comment">// ä½ å¥½ï¼Œæˆ‘æ˜¯postMessage1</span></span></span><br><span class="line"><span class="actionscript">      e.source.postMessage(<span class="string">'ä½ å¥½ï¼Œæˆ‘æ˜¯postMessage2'</span>, e.origin)</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>postMsgServer2.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> html = fs.readFileSync(<span class="string">'./postMessage2.html'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">  res.end(html)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8002</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server listening on 8002'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h3><p>WebSocket æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡ï¼ŒåŒæ—¶å…è®¸è·¨åŸŸé€šè®¯ï¼Œé•¿è¿æ¥æ–¹å¼ä¸å—è·¨åŸŸå½±å“ã€‚ç”±äºåŸç”Ÿ WebSocket API ä½¿ç”¨èµ·æ¥ä¸å¤ªæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚ wsã€‚</p>
<p>Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½å¿…é¡»å®ç° WebSockets åè®®æ¥å»ºç«‹å’Œç»´æŠ¤è¿æ¥ã€‚ç”±äº WebSockets è¿æ¥é•¿æœŸå­˜åœ¨ï¼Œä¸å…¸å‹çš„ HTTP è¿æ¥ä¸åŒï¼Œå¯¹æœåŠ¡å™¨æœ‰é‡è¦çš„å½±å“ã€‚</p>
<p>socket.htmlï¼ˆ<code>http://127.0.0.1:5500/socket.html</code>ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:8001'</span>)</span><br><span class="line">socket.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  socket.send(<span class="string">'å‘æœåŠ¡ç«¯å‘é€æ•°æ®'</span>)</span><br><span class="line">&#125;</span><br><span class="line">socket.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data) <span class="comment">// æœåŠ¡ç«¯ä¼ ç»™ä½ çš„æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ<code>nodeServer.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> WebSocket = <span class="built_in">require</span>(<span class="string">'ws'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wsServer = <span class="keyword">new</span> WebSocket.Server(&#123; <span class="attr">port</span>: <span class="number">8001</span> &#125;)</span><br><span class="line">wsServer.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ws</span>) </span>&#123;</span><br><span class="line">  ws.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data) <span class="comment">// å‘æœåŠ¡ç«¯å‘é€æ•°æ®</span></span><br><span class="line">    ws.send(<span class="string">'æœåŠ¡ç«¯ä¼ ç»™ä½ çš„æ•°æ®'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="document-domain-iframe"><a href="#document-domain-iframe" class="headerlink" title="document.domain + iframe"></a>document.domain + iframe</h3><p>è¿™ç§æ–¹å¼åªèƒ½ç”¨äºäºŒçº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ã€‚</p>
<p>æ¯”å¦‚ a.test.com å’Œ b.test.com å°±å±äºäºŒçº§åŸŸåï¼Œå®ƒä»¬éƒ½æ˜¯ test.com çš„å­åŸŸ</p>
<p>åªéœ€è¦ç»™é¡µé¢æ·»åŠ  document.domain =â€™test.comâ€™ è¡¨ç¤ºäºŒçº§åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸã€‚</p>
<p>æ¯”å¦‚ï¼šé¡µé¢ a.test.com:3000/test1.html è·å–é¡µé¢ b.test.com:3000/test2.html ä¸­ a çš„å€¼</p>
<p>test1.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"http://b.test.com:3000/test2.html"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">frameborder</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">onload</span>=<span class="string">"load()"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">id</span>=<span class="string">"iframe"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">'test.com'</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(iframe.contentWindow.a)</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>test2.html</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.domain = <span class="string">'test.com'</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h3 id="window-name-iframe"><a href="#window-name-iframe" class="headerlink" title="window.name + iframe"></a>window.name + iframe</h3><p>æµè§ˆå™¨å…·æœ‰è¿™æ ·ä¸€ä¸ªç‰¹æ€§ï¼šåŒä¸€ä¸ªæ ‡ç­¾é¡µæˆ–è€…åŒä¸€ä¸ª iframe æ¡†æ¶åŠ è½½è¿‡çš„é¡µé¢å…±äº«ç›¸åŒçš„ window.name å±æ€§å€¼ã€‚åœ¨åŒä¸ªæ ‡ç­¾é¡µé‡Œï¼Œname å€¼åœ¨ä¸åŒçš„é¡µé¢åŠ è½½åä¹Ÿä¾æ—§å­˜åœ¨ï¼Œè¿™äº›é¡µé¢ä¸Š window.name å±æ€§å€¼éƒ½æ˜¯ç›¸åŒçš„ã€‚åˆ©ç”¨è¿™äº›ç‰¹æ€§ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªå±æ€§ä½œä¸ºåœ¨ä¸åŒé¡µé¢ä¹‹é—´ä¼ é€’æ•°æ®çš„ä»‹è´¨ã€‚</p>
<blockquote>
<p>ç”±äºå®‰å…¨åŸå› ï¼Œæµè§ˆå™¨å§‹ç»ˆä¼šä¿æŒ window.name æ˜¯ string ç±»å‹ã€‚</p>
</blockquote>
<p>æ‰“å¼€<code>http://localhost:8001/a.html</code></p>
<ul>
<li><a href="http://localhost:8001/a.html" target="_blank" rel="noopener">http://localhost:8001/a.html</a></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"http://localhost:8002/c.html"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">frameborder</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">onload</span>=<span class="string">"load()"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">id</span>=<span class="string">"iframe"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> first = <span class="literal">true</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">      if (first) &#123;</span><br><span class="line"><span class="actionscript">        <span class="comment">// ç¬¬1æ¬¡onload(è·¨åŸŸé¡µ)æˆåŠŸåï¼Œåˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>)</span></span><br><span class="line"><span class="actionscript">        iframe.src = <span class="string">'http://localhost:8001/b.html'</span></span></span><br><span class="line"><span class="actionscript">        first = <span class="literal">false</span></span></span><br><span class="line"><span class="actionscript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// ç¬¬2æ¬¡onload(åŒåŸŸb.htmlé¡µ)æˆåŠŸåï¼Œè¯»å–åŒåŸŸwindow.nameä¸­æ•°æ®</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(iframe.contentWindow.name) <span class="comment">// æˆ‘æ˜¯c.htmlé‡Œçš„æ•°æ®</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><a href="http://localhost:8001/b.htmlï¼ˆä¸éœ€è¦å¾€htmlåŠ å†…å®¹ï¼Œé»˜è®¤htmlç»“æ„æ¨¡æ¿å³å¯ï¼‰" target="_blank" rel="noopener">http://localhost:8001/b.htmlï¼ˆä¸éœ€è¦å¾€htmlåŠ å†…å®¹ï¼Œé»˜è®¤htmlç»“æ„æ¨¡æ¿å³å¯ï¼‰</a></p>
</li>
<li><p><a href="http://localhost:8002/c.html" target="_blank" rel="noopener">http://localhost:8002/c.html</a></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.name = <span class="string">'æˆ‘æ˜¯c.htmlé‡Œçš„æ•°æ®'</span></span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>c é¡µé¢ç»™ window.name è®¾ç½®äº†å€¼, å³ä¾¿ c é¡µé¢é”€æ¯ï¼Œä½† name å€¼ä¸ä¼šè¢«é”€æ¯ï¼›a é¡µé¢ä¾æ—§èƒ½å¤Ÿå¾—åˆ° window.nameã€‚</p>
<h3 id="location-hash-iframe"><a href="#location-hash-iframe" class="headerlink" title="location.hash + iframe"></a>location.hash + iframe</h3><p>å®ç°åŸç†ï¼š a.html æ¬²ä¸ c.html è·¨åŸŸç›¸äº’é€šä¿¡ï¼Œé€šè¿‡ä¸­é—´é¡µ b.html æ¥å®ç°ã€‚ ä¸‰ä¸ªé¡µé¢ï¼Œä¸åŒåŸŸä¹‹é—´åˆ©ç”¨ iframe çš„ location.hash ä¼ å€¼ï¼Œç›¸åŒåŸŸä¹‹é—´ç›´æ¥ js è®¿é—®æ¥é€šä¿¡ã€‚</p>
<p>å…·ä½“å®ç°æ­¥éª¤ï¼šä¸€å¼€å§‹ a.html ç»™ c.html ä¼ ä¸€ä¸ª hash å€¼ï¼Œç„¶å c.html æ”¶åˆ° hash å€¼åï¼Œå†æŠŠ hash å€¼ä¼ é€’ç»™ b.htmlï¼Œæœ€å b.html å°†ç»“æœæ”¾åˆ° a.html çš„ hash å€¼ä¸­ã€‚</p>
<p>åŒæ ·çš„ï¼Œa.html å’Œ b.html æ˜¯åŒåŸŸçš„ï¼Œéƒ½æ˜¯<a href="http://localhost:8001ï¼Œä¹Ÿå°±æ˜¯è¯´">http://localhost:8001ï¼Œä¹Ÿå°±æ˜¯è¯´</a> b çš„ hash å€¼å¯ä»¥ç›´æ¥å¤åˆ¶ç»™ a çš„ hashã€‚c.html ä¸º<a href="http://localhost:8002ä¸‹çš„">http://localhost:8002ä¸‹çš„</a></p>
<p>a.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://localhost:8002/c.html#jackylin"</span> <span class="attr">style</span>=<span class="string">"display: none;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ£€æµ‹hashçš„å˜åŒ–</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="number">456</span>, location.hash) <span class="comment">// #monkey</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>b.html</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.parent.parent.location.hash = location.hash</span><br><span class="line"><span class="comment">// b.htmlå°†ç»“æœæ”¾åˆ°a.htmlçš„hashå€¼ä¸­ï¼Œb.htmlå¯é€šè¿‡parent.parentè®¿é—®a.htmlé¡µé¢</span></span><br></pre></td></tr></table></figure>

<p>c.html</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(location.hash) <span class="comment">//  #jackylin</span></span><br><span class="line"><span class="keyword">let</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line">iframe.src = <span class="string">'http://localhost:8001/b.html#monkey'</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(iframe)</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>CORS æ”¯æŒæ‰€æœ‰çš„ HTTP è¯·æ±‚ï¼Œæ˜¯è·¨åŸŸæœ€ä¸»æµçš„æ–¹æ¡ˆ</li>
<li>æ—¥å¸¸å·¥ä½œä¸­ï¼Œç”¨å¾—æ¯”è¾ƒå¤šçš„è·¨åŸŸæ–¹æ¡ˆæ˜¯ CORS å’Œ Node ä¸­é—´ä»¶åŠ Nginx åå‘ä»£ç†</li>
<li>ä¸ç®¡æ˜¯ Node ä¸­é—´ä»¶ä»£ç†è¿˜æ˜¯ Nginx åå‘ä»£ç†ï¼Œä¸»è¦æ˜¯é€šè¿‡åŒæºç­–ç•¥å¯¹æœåŠ¡å™¨ä¸åŠ é™åˆ¶ã€‚</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</a></li>
<li><a href="https://github.com/ljianshu/Blog/issues/55" target="_blank" rel="noopener">ä¹ç§è·¨åŸŸæ–¹å¼å®ç°åŸç†ï¼ˆå®Œæ•´ç‰ˆï¼‰</a></li>
<li><a href="https://juejin.im/post/6844903992057659400" target="_blank" rel="noopener">å¯èƒ½æ˜¯æœ€å¥½çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆäº†</a></li>
</ul>
<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>è·¨åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³ä½¿ç”¨è¾“å…¥æ³•è¾“å…¥åœ¨ React input æ¡†ä¸­çš„é—®é¢˜</title>
    <url>/2020/08/14/%E8%A7%A3%E5%86%B3%E4%BD%BF%E7%94%A8%E8%BE%93%E5%85%A5%E6%B3%95%E8%BE%93%E5%85%A5%E5%9C%A8-React-input-%E6%A1%86%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨ React ç»‘å®š input è¾“å…¥æ¡†çš„ onChange æ–¹æ³•æ—¶ï¼Œå¦‚æœä½¿ç”¨ä¸­æ–‡è¾“å…¥æ³•ï¼ˆæˆ–è€…å…¶ä»–è¾“å…¥æ³•ï¼‰ï¼Œä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šè¿˜åœ¨è¾“å…¥æ‹¼éŸ³çš„æ—¶å€™ï¼ŒonChange æ–¹æ³•å·²ç»è§¦å‘äº†ï¼Œå¦‚ä¸‹ï¼Œå³è¾“å…¥è¿‡ç¨‹å°±å·²ç»è§¦å‘äº†å¤šæ¬¡ onChange æ–¹æ³•ã€‚å¦‚æœ onChange æ–¹æ³•æœ‰è¾ƒä¸ºå¤æ‚çš„é€»è¾‘ï¼Œå°±å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›ç”¨æˆ·ä½“éªŒæˆ–è€…é€»è¾‘çš„é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡ä»¥æ­¤é—®é¢˜å¼€å§‹ï¼Œé€æ­¥æ¢ç´¢è§£å†³æ–¹æ¡ˆã€‚</p>
<a id="more"></a>

<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26ab509fe10d46bc97f80ee6f8728336~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>åªè¦æœ‰æŒ‰ä¸‹é”®ç›˜çš„åŠ¨ä½œï¼Œå°±ä¼šè§¦å‘ onChange æ–¹æ³•ï¼Œå¦‚æœè¾“å…¥è‹±æ–‡å°±æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†ä½¿ç”¨ä¸­/æ—¥/éŸ©ç­‰è¾“å…¥æ³•çš„è¯ï¼Œæ¯”å¦‚è¾“å…¥ä¸­æ–‡æ‹¼éŸ³å·²ç»å¼€å§‹åœ¨è§¦å‘ onChange äº‹ä»¶äº†ã€‚</p>
<h2 id="éœ€æ±‚åŠè§£å†³æ–¹æ¡ˆ"><a href="#éœ€æ±‚åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="éœ€æ±‚åŠè§£å†³æ–¹æ¡ˆ"></a>éœ€æ±‚åŠè§£å†³æ–¹æ¡ˆ</h2><ul>
<li><p>éœ€æ±‚ï¼šç­‰åˆ°é€‰æ‹©ç¡®è®¤è¾“å…¥ä¸­æ–‡åï¼Œæ‰è®©å®ƒè§¦å‘ onChange æ–¹æ³•çš„åç»­æ“ä½œï¼Œå¦‚æ”¹å˜ value çš„å€¼ã€‚</p>
</li>
<li><p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ compositionEvent äº‹ä»¶æ¥è§£å†³ã€‚</p>
</li>
</ul>
<blockquote>
<p>DOM æ¥å£ CompositionEvent è¡¨ç¤ºç”¨æˆ·é—´æ¥è¾“å…¥æ–‡æœ¬ï¼ˆå¦‚ä½¿ç”¨è¾“å…¥æ³•ï¼‰æ—¶å‘ç”Ÿçš„äº‹ä»¶ã€‚æ­¤æ¥å£çš„å¸¸ç”¨äº‹ä»¶æœ‰ compositionstart, compositionupdate å’Œ compositionend</p>
</blockquote>
<h2 id="CompositionEvent-äº‹ä»¶ä»‹ç»"><a href="#CompositionEvent-äº‹ä»¶ä»‹ç»" class="headerlink" title="CompositionEvent äº‹ä»¶ä»‹ç»"></a>CompositionEvent äº‹ä»¶ä»‹ç»</h2><ul>
<li>compositionstart</li>
</ul>
<p>å½“ç”¨æˆ·ä½¿ç”¨è¾“å…¥æ³•å¦‚æ‹¼éŸ³è¾“å…¥æ±‰å­—æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œå³æ˜¯åœ¨ç”¨æˆ·å¼€å§‹éç›´æ¥è¾“å…¥çš„æ—¶å€™è§¦å‘ï¼Œåœ¨éç›´æ¥è¾“å…¥çš„æ—¶å€™ç»“æŸï¼Œæ•´ä¸ªè¿‡ç¨‹åªè§¦å‘äº†ä¸€æ¬¡ã€‚</p>
<ul>
<li>compositionupdate</li>
</ul>
<p>äº‹ä»¶è§¦å‘äºå­—ç¬¦è¢«è¾“å…¥åˆ°ä¸€æ®µæ–‡å­—çš„æ—¶å€™ï¼Œå¦‚åœ¨ç”¨æˆ·å¼€å§‹è¾“å…¥æ‹¼éŸ³åˆ°ç¡®å®šç»“æŸçš„è¿‡ç¨‹éƒ½ä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚</p>
<ul>
<li>compositionend</li>
</ul>
<p>å½“æ–‡æœ¬æ®µè½çš„ç»„æˆå®Œæˆæˆ–å–æ¶ˆæ—¶, compositionend äº‹ä»¶å°†è¢«è§¦å‘ ã€‚å¦‚ç”¨æˆ·ç‚¹å‡»æ‹¼éŸ³è¾“å…¥æ³•é€‰è¯ç¡®å®šåï¼Œåˆ™è§¦å‘äº†è¯¥äº‹ä»¶ï¼Œæ­¤æ—¶æ˜¯ç›´æ¥è¾“å…¥äº†ï¼Œæ•´ä¸ªè¿‡ç¨‹åªè§¦å‘äº†ä¸€æ¬¡ã€‚</p>
<p>å¯ä»¥çŸ¥é“è¿™ä¸‰ä¸ªäº‹ä»¶å°±æŠŠæˆ‘ä»¬è¾“å…¥ä¸­æ–‡æ‹¼éŸ³çš„ä¸‰ä¸ªè¿‡ç¨‹è¿›è¡Œäº†æ‹†åˆ†ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>æˆ‘ä»¬é€šè¿‡ç›‘å¬è¾“å…¥æ³•å¼€å§‹è¾“å…¥åˆ°ç»“æŸçš„äº‹ä»¶ï¼Œå³æ˜¯å»ç›‘å¬<code>compositionstart</code>å’Œ<code>compositionend</code>æ–¹æ³•ï¼Œé€šè¿‡è®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œåœ¨ä¸¤ä¸ªæ–¹æ³•é‡Œé¢è®¾ç½® true/falseï¼Œæ¥åˆ¤æ–­æ˜¯å¦å¤„åœ¨ä¸­æ–‡è¾“å…¥æ‹¼éŸ³è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸è§¦å‘ onChange åç»­äº‹ä»¶ã€‚</p>
<p>è¿™ä¸ªæœªå¿…æ˜¯ä¼˜åŒ–ã€‚æœç´¢æ¡†æç¤ºçš„ä¸€ä¸ªå¾ˆé‡è¦ç”¨å¤„ï¼Œä¸æ˜¯å¸®åŠ©çœå‡ºæ¥é‚£ä¹ˆä¸€ç‚¹æ‰“å­—çš„æ—¶é—´ï¼Œè€Œæ˜¯ä¸ºäº†æç¤ºæ‰“å­—äººåº”è¯¥å†™ä»€ä¹ˆã€‚å¾ˆå¤šæ—¶å€™æ‰“å­—è€…åªæœ‰ä¸€ä¸ªæ¨¡ç³Šçš„éœ€æ±‚ï¼Œå…¨é æœç´¢æ¡†æç¤ºæ‰èƒ½æ˜ç™½è‡ªå·±çœŸæ­£æƒ³æœä»€ä¹ˆã€‚è€Œè¿™æ—¶å€™å¯¹æ‹¼éŸ³è¿›è¡Œæœç´¢æç¤ºï¼Œä¸è¯´æé†’ç”¨æˆ·è¯¥æ‹¼éŸ³è¯ä¹Ÿå¯ä»¥æœåˆ°ç»“æœï¼Œå•è¯´åœ¨æŸç§å¯èƒ½çš„ç”¨å†µä¸‹ä¼šé¿å…ç”¨æˆ·æœç´¢æ•´ä¸ªè¾“å…¥æ³•å´æ‰¾ä¸åˆ°å¯¹åº”æ±‰å­—ï¼ˆå› ä¸ºè¾“å…¥é”™è¯¯æ‹¼éŸ³ï¼‰è¿™ç‚¹å°±éå¸¸å¥½ç”¨äº†ã€‚</p>
<p>å¦‚ä¸‹ä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®ä¸ªå¯¹ç…§ï¼švalue1 å¯¹åº”çš„ä¸ºæ­£å¸¸ onChange æ“ä½œï¼Œvalue2 å¯¹åº”çš„åˆ™æ˜¯åšäº†è¾“å…¥æ³•å¤„ç†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isComposition = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestComposition</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value1: <span class="string">''</span>,</span><br><span class="line">      value2: <span class="string">''</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.handleChange1 = <span class="keyword">this</span>.handleChange1.bind(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">this</span>.handleChange2 = <span class="keyword">this</span>.handleChange2.bind(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">this</span>.handleComposition = <span class="keyword">this</span>.handleComposition.bind(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleChange1 = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      value1: ev.target.value,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleChange2 = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æœªä½¿ç”¨è¾“å…¥æ³•æˆ–ä½¿ç”¨è¾“å…¥æ³•å®Œæ¯•æ‰èƒ½è§¦å‘</span></span><br><span class="line">    <span class="keyword">if</span> (!isComposition) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        value2: ev.target.value,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleComposition(ev) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.type === <span class="string">'compositionend'</span>) &#123;</span><br><span class="line">      isComposition = <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      isComposition = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=<span class="string">'text'</span> onChange=&#123;<span class="keyword">this</span>.handleChange1&#125; /&gt;</span><br><span class="line">        &lt;span&gt;&#123;<span class="keyword">this</span>.state.value1&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          type='text'</span></span><br><span class="line"><span class="regexp">          onChange=&#123;this.handleChange2&#125;</span></span><br><span class="line"><span class="regexp">          onCompositionStart=&#123;this.handleComposition&#125;</span></span><br><span class="line"><span class="regexp">          onCompositionEnd=&#123;this.handleComposition&#125;</span></span><br><span class="line"><span class="regexp">          placeholder='ä½¿ç”¨äº†compositionçš„inputæ¡†'</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">        &lt;span&gt;&#123;<span class="keyword">this</span>.state.value2&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TestComposition</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè¿™æ ·å°±èƒ½è§£å†³äº†å—ï¼Ÿè¿˜ä¸è¡Œã€‚</p>
<p>å…¶ä»–æµè§ˆå™¨ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†è°·æ­Œæµè§ˆå™¨å´ä¸è¡Œã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯è°·æ­Œæµè§ˆå™¨è·Ÿå…¶ä»–æµè§ˆå™¨çš„æ‰§è¡Œé¡ºåºä¸åŒï¼š</p>
<blockquote>
<p>è°·æ­Œæµè§ˆå™¨ï¼š compositionstart -&gt; onChange -&gt; compositionend</p>
</blockquote>
<blockquote>
<p>å…¶ä»–æµè§ˆå™¨ï¼š compositionstart -&gt; compositionend -&gt; onChange</p>
</blockquote>
<p>æ‰€ä»¥ä¸Šè¿°ä»£ç è¿è¡Œåœ¨è°·æ­Œæµè§ˆå™¨çš„è¯ï¼Œä¸€å¼€å§‹ä¸­æ–‡è¾“å…¥æˆ‘ä»¬å°±å°† isComposition è®¾ç½®ä¸º trueï¼Œæœ€åä¸€æ­¥ compositionend æ–¹æ³•æˆ‘ä»¬æ‰å°† isComposition æ¢å¤ä¸º true,è€Œ onChange å·²ç»æ‰§è¡Œå®Œäº†ï¼Œ æŒ‰è¿™ä¸ªé€»è¾‘ä¸­æ–‡è¾“å…¥æ³•æ‰“å­—éƒ½æ”¹ä¸äº† input çš„ value å€¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!isComposition) &#123;</span><br><span class="line">  <span class="comment">// isCompositionä¸ºfalse æ‰å¯ä»¥æ‰§è¡ŒonChangeåç»­é€»è¾‘</span></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    value2: ev.target.value,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è°·æ­Œæµè§ˆå™¨åšä¸€æ¬¡ç‰¹åˆ«å¤„ç†ï¼š</p>
<ol>
<li>åˆ¤æ–­æ˜¯å¦ä¸ºè°·æ­Œæµè§ˆå™¨</li>
<li>å¦‚æœæ˜¯ï¼Œåˆ™åœ¨ compositionend æ–¹æ³•æœ€åå†æ‰§è¡Œä¸€æ¬¡ onChange æ–¹æ³•</li>
</ol>
<p>æœ€åé™„ä¸Šå®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isComposition = <span class="literal">false</span></span><br><span class="line"><span class="keyword">const</span> isChrome = navigator.userAgent.indexOf(<span class="string">'Chrome'</span>) &gt; <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestComposition</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value1: <span class="string">''</span>,</span><br><span class="line">      value2: <span class="string">''</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.handleChange1 = <span class="keyword">this</span>.handleChange1.bind(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">this</span>.handleChange2 = <span class="keyword">this</span>.handleChange2.bind(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">this</span>.handleComposition = <span class="keyword">this</span>.handleComposition.bind(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleChange1 = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      value1: ev.target.value,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleChange2 = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æœªä½¿ç”¨è¾“å…¥æ³•æˆ–ä½¿ç”¨è¾“å…¥æ³•å®Œæ¯•æ‰èƒ½è§¦å‘</span></span><br><span class="line">    <span class="keyword">if</span> (!isComposition) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        value2: ev.target.value,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleComposition(ev) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.type === <span class="string">'compositionend'</span>) &#123;</span><br><span class="line">      isComposition = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (!isComposition &amp;&amp; isChrome) &#123;</span><br><span class="line">        <span class="keyword">this</span>.handleChange2(ev)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      isComposition = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=<span class="string">'text'</span> onChange=&#123;<span class="keyword">this</span>.handleChange1&#125; /&gt;</span><br><span class="line">        &lt;span&gt;&#123;<span class="keyword">this</span>.state.value1&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          type='text'</span></span><br><span class="line"><span class="regexp">          onChange=&#123;this.handleChange2&#125;</span></span><br><span class="line"><span class="regexp">          onCompositionStart=&#123;this.handleComposition&#125;</span></span><br><span class="line"><span class="regexp">          onCompositionEnd=&#123;this.handleComposition&#125;</span></span><br><span class="line"><span class="regexp">          placeholder='ä½¿ç”¨äº†compositionçš„inputæ¡†'</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">        &lt;span&gt;&#123;<span class="keyword">this</span>.state.value2&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TestComposition</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ac3e7f8896b4d608c1ae46ee22f0866~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>æ³¨ï¼š</p>
<ul>
<li>Vue è‡ªå¸¦è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œv-model æœ‰ç”¨åˆ° compositionEvent äº‹ä»¶</li>
<li>è¯¥åšæ³•è§†ä¹é¡¹ç›®éœ€æ±‚åœºæ™¯ï¼Œå› ä¸ºå¦‚æœæœ‰éœ€è¦è¿›è¡Œæœç´¢ä¸­æ–‡æ‹¼éŸ³è¿‡ç¨‹ä¹Ÿè¦æç¤ºè‹±æ–‡å•è¯çš„æ¥è¯´ï¼Œé‚£å°±æ²¡å¿…è¦äº†</li>
<li>ä¹Ÿå¯ä»¥ä½¿ç”¨ ref çš„æ–¹å¼è¿›è¡Œç»‘å®šï¼Œä¸Šè¿°åªæ˜¯å…¶ä¸­ä¸€ç§è§£å†³æ–¹å¼</li>
</ul>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CompositionEvent" target="_blank" rel="noopener">MDNï¼šCompositionEvent</a></li>
<li><a href="https://www.yukapril.com/2019/11/11/react-input-composition.html" target="_blank" rel="noopener">ä¸­æ–‡è¾“å…¥æ³•åœ¨ React æ–‡æœ¬è¾“å…¥æ¡†çš„ç‰¹æ®Šå¤„ç†</a></li>
</ul>
<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œé¼“åŠ±æˆ‘ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>å¼€å‘æ‚è®°</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>compositionEvent</tag>
      </tags>
  </entry>
  <entry>
    <title>CSSæ°´å¹³å‚ç›´å±…ä¸­å›é¡¾æ€»ç»“</title>
    <url>/2020/08/09/CSS%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD%E5%9B%9E%E9%A1%BE%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>ç”¨äº†ä¸€æ®µæ—¶é—´çš„ material-uiï¼Œéƒ½å¾ˆå°‘è‡ªå·±åŠ¨æ‰‹å†™åŸç”Ÿçš„æ ·å¼äº†ã€‚ä½† html, css, js å§‹ç»ˆæ˜¯å‰ç«¯çš„ä¸‰å¤§åŸºç¡€ï¼Œè¿™å‘¨çªç„¶æƒ³åˆ° CSS æ°´å¹³å±…ä¸­æ–¹æ¡ˆï¼Œå› ä¸ºç”¨å¤šäº† <code>flex</code> å’Œ <code>margin: auto</code>ç­‰è¿™ç±»æ–¹æ¡ˆè§£å†³ï¼Œåœ¨å›é¡¾è¿˜æœ‰è¿˜æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ï¼Œäºæ˜¯æ‰“ç®—æ¸©æ•…çŸ¥æ–°ï¼Œé‡æ–°æ‰“ä¸‹ä»£ç ï¼Œå†™ä¸‹è¯¥æ–‡ä½œä¸ºç¬”è®°ã€‚</p>
<a id="more"></a>

<p>html ä»£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç </p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢ä»£ç åŸºäºä¸Šè¿°ä»£ç å¢åŠ ï¼Œä¸ä¼šå†é‡å¤å†™ã€‚è¦å®ç°çš„æ•ˆæœæ˜¯è®©å­å…ƒç´ åœ¨çˆ¶å…ƒç´ ä¸­æ°´å¹³å‚ç›´å±…ä¸­<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d9ccfcd90a64bd58de3cf3e972c5981~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="ä¸€ã€flex-å¸ƒå±€"><a href="#ä¸€ã€flex-å¸ƒå±€" class="headerlink" title="ä¸€ã€flex å¸ƒå±€"></a>ä¸€ã€flex å¸ƒå±€</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æœ€ç»å…¸çš„ç”¨æ³•äº†ï¼Œä¸è¿‡ï¼Œä¹Ÿå¯ä»¥æœ‰å¦ä¸€ç§å†™æ³•å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.parent &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">&#125;</span><br><span class="line">.child &#123;</span><br><span class="line">    align-self: center;</span><br><span class="line">    margin: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€absolute-è´Ÿ-margin"><a href="#äºŒã€absolute-è´Ÿ-margin" class="headerlink" title="äºŒã€absolute + è´Ÿ margin"></a>äºŒã€absolute + è´Ÿ margin</h2><p>è¯¥æ–¹æ³•é€‚ç”¨äºçŸ¥é“å›ºå®šå®½é«˜çš„æƒ…å†µã€‚</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€absolute-transform"><a href="#ä¸‰ã€absolute-transform" class="headerlink" title="ä¸‰ã€absolute + transform"></a>ä¸‰ã€absolute + transform</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€absolute-margin-auto"><a href="#å››ã€absolute-margin-auto" class="headerlink" title="å››ã€absolute + margin auto"></a>å››ã€absolute + margin auto</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€absolute-calc"><a href="#äº”ã€absolute-calc" class="headerlink" title="äº”ã€absolute + calc"></a>äº”ã€absolute + calc</h2><p>è¯¥æ–¹æ³•é€‚ç”¨äºçŸ¥é“å›ºå®šå®½é«˜çš„æƒ…å†µã€‚</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">50px</span>);</span><br><span class="line">  <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">50px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å…­ã€text-align-vertical-align"><a href="#å…­ã€text-align-vertical-align" class="headerlink" title="å…­ã€text-align + vertical-align"></a>å…­ã€text-align + vertical-align</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">300px</span>; <span class="comment">/* ç­‰äº parent çš„ height */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">line-height</span>: initial; <span class="comment">/* è¿™æ · child å†…çš„æ–‡å­—å°±ä¸ä¼šè¶…å‡ºè·‘åˆ°ä¸‹é¢ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ƒã€table-cell"><a href="#ä¸ƒã€table-cell" class="headerlink" title="ä¸ƒã€table-cell"></a>ä¸ƒã€table-cell</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å…«ã€Grid"><a href="#å…«ã€Grid" class="headerlink" title="å…«ã€Grid"></a>å…«ã€Grid</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">align-self</span>: center;</span><br><span class="line">  <span class="attribute">justify-self</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¹ã€writing-mode"><a href="#ä¹ã€writing-mode" class="headerlink" title="ä¹ã€writing-mode"></a>ä¹ã€writing-mode</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">writing-mode</span>: vertical-lr;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">writing-mode</span>: horizontal-tb;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">50px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±å§~</li>
</ul>
]]></content>
      <categories>
        <category>CSSç³»åˆ—</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>å°è£… axios æ‹¦æˆªå™¨å®ç°ç”¨æˆ·æ— æ„Ÿåˆ·æ–° access_token</title>
    <url>/2020/07/26/%E5%B0%81%E8%A3%85-axios-%E6%8B%A6%E6%88%AA%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E6%97%A0%E6%84%9F%E5%88%B7%E6%96%B0-access-token/</url>
    <content><![CDATA[<p>æœ€è¿‘åšé¡¹ç›®çš„æ—¶å€™ï¼Œæ¶‰åŠåˆ°ä¸€ä¸ªå•ç‚¹ç™»å½•ï¼Œå³æ˜¯é¡¹ç›®çš„ç™»å½•é¡µé¢ï¼Œç”¨çš„æ˜¯å…¬å¸å…±ç”¨çš„ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œåœ¨è¯¥é¡µé¢ç»Ÿä¸€å¤„ç†é€»è¾‘ã€‚æœ€ç»ˆå®ç°ç”¨æˆ·åªéœ€ç™»å½•ä¸€æ¬¡ï¼Œå°±å¯ä»¥ä»¥ç™»å½•çŠ¶æ€è®¿é—®å…¬å¸æ——ä¸‹çš„æ‰€æœ‰ç½‘ç«™ã€‚</p>
<a id="more"></a>

<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote>
<p>å•ç‚¹ç™»å½•( Single Sign On ï¼Œç®€ç§° SSOï¼‰ï¼Œæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œç”¨äºå¤šä¸ªåº”ç”¨ç³»ç»Ÿé—´ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚</p>
</blockquote>
<p>å…¶ä¸­æœ¬æ–‡è®²çš„æ˜¯åœ¨ç™»å½•åå¦‚ä½•ç®¡ç†<code>access_token</code>å’Œ<code>refresh_token</code>ï¼Œä¸»è¦å°±æ˜¯å°è£… axiosæ‹¦æˆªå™¨ï¼Œåœ¨æ­¤è®°å½•ã€‚</p>
<h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><ul>
<li>å‰ç½®åœºæ™¯</li>
</ul>
<ol>
<li><p>è¿›å…¥è¯¥é¡¹ç›®æŸä¸ªé¡µé¢<code>http://xxxx.project.com/profile</code>éœ€è¦ç™»å½•ï¼Œæœªç™»å½•å°±è·³è½¬è‡³SSOç™»å½•å¹³å°ï¼Œæ­¤æ—¶çš„ç™»å½•ç½‘å€ urlä¸º<code>http://xxxxx.com/login?app_id=project_name_id&amp;redirect_url=http://xxxx.project.com/profile</code>ï¼Œå…¶ä¸­<code>app_id</code>æ˜¯åå°é‚£è¾¹çº¦å®šå®šä¹‰å¥½çš„ï¼Œ<code>redirect_url</code>æ˜¯æˆåŠŸæˆæƒåæŒ‡å®šçš„å›è°ƒåœ°å€ã€‚</p>
</li>
<li><p>è¾“å…¥è´¦å·å¯†ç ä¸”æ­£ç¡®åï¼Œå°±ä¼šé‡å®šå‘å›åˆšå¼€å§‹è¿›å…¥çš„é¡µé¢ï¼Œå¹¶åœ¨åœ°å€æ å¸¦ä¸€ä¸ªå‚æ•° <code>?code=XXXXX</code>ï¼Œå³æ˜¯<code>http://xxxx.project.com/profile?code=XXXXXX</code>ï¼Œcodeçš„å€¼æ˜¯ä½¿ç”¨ä¸€æ¬¡åå³æ— æ•ˆï¼Œä¸”10åˆ†é’Ÿå†…è¿‡æœŸ</p>
</li>
<li><p>ç«‹é©¬è·å–è¿™ä¸ªcodeå€¼å†å»è¯·æ±‚ä¸€ä¸ªapi <code>/access_token/authenticate</code>ï¼Œæºå¸¦å‚æ•°<code>{ verify_code: code }</code>ï¼Œå¹¶ä¸”è¯¥apiå·²ç»è‡ªå¸¦<code>app_id</code>å’Œ<code>app_secret</code>ä¸¤ä¸ªå›ºå®šå€¼å‚æ•°ï¼Œé€šè¿‡å®ƒå»è¯·æ±‚æˆæƒçš„apiï¼Œè¯·æ±‚æˆåŠŸåå¾—åˆ°è¿”å›å€¼<code>{ access_token: &quot;xxxxxxx&quot;, refresh_token: &quot;xxxxxxxx&quot;, expires_in: xxxxxxxx }</code>ï¼Œå­˜ä¸‹<code>access_token</code>å’Œ<code>refresh_token</code>åˆ°cookieä¸­ï¼ˆlocalStorageä¹Ÿå¯ä»¥ï¼‰ï¼Œæ­¤æ—¶ç”¨æˆ·å°±ç®—ç™»å½•æˆåŠŸäº†ã€‚</p>
</li>
<li><p><code>access_token</code>ä¸ºæ ‡å‡†JWTæ ¼å¼ï¼Œæ˜¯æˆæƒä»¤ç‰Œï¼Œå¯ä»¥ç†è§£å°±æ˜¯éªŒè¯ç”¨æˆ·èº«ä»½çš„ï¼Œæ˜¯åº”ç”¨åœ¨è°ƒç”¨apiè®¿é—®å’Œä¿®æ”¹ç”¨æˆ·æ•°æ®å¿…é¡»ä¼ å…¥çš„å‚æ•°ï¼ˆæ”¾åœ¨è¯·æ±‚å¤´headersé‡Œï¼‰ï¼Œ2å°æ—¶åè¿‡æœŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåšå®Œå‰ä¸‰æ­¥åï¼Œä½ å¯ä»¥è°ƒç”¨éœ€è¦ç”¨æˆ·ç™»å½•æ‰èƒ½ä½¿ç”¨çš„apiï¼›ä½†æ˜¯å‡å¦‚ä½ ä»€ä¹ˆéƒ½ä¸æ“ä½œï¼Œé™é™è¿‡å»ä¸¤ä¸ªå°æ—¶åï¼Œå†å»è¯·æ±‚è¿™äº›apiï¼Œå°±ä¼šæŠ¥<code>access_token</code>è¿‡æœŸï¼Œè°ƒç”¨å¤±è´¥ã€‚</p>
</li>
<li><p>é‚£ä¹ˆæ€»ä¸èƒ½2å°æ—¶åå°±è®©ç”¨æˆ·é€€å‡ºç™»å½•å§ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯ä¸¤å°æ—¶åæ‹¿ç€è¿‡æœŸçš„<code>access_token</code>å’Œ<code>refresh_token</code>ï¼ˆ<code>refresh_token</code>è¿‡æœŸæ—¶é—´ä¸€èˆ¬é•¿ä¸€äº›ï¼Œæ¯”å¦‚ä¸€ä¸ªæœˆæˆ–æ›´é•¿ï¼‰å»è¯·æ±‚<code>/refresh</code> apiï¼Œè¿”å›ç»“æœä¸º<code>{ access_token: &quot;xxxxx&quot;, expires_in: xxxxx }</code>ï¼Œæ¢å–æ–°çš„<code>access_token</code>ï¼Œæ–°çš„<code>access_token</code>è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯2å°æ—¶ï¼Œå¹¶é‡æ–°å­˜åˆ°cookieï¼Œå¾ªç¯å¾€å¤ç»§ç»­ä¿æŒç™»å½•è°ƒç”¨ç”¨æˆ·apiäº†ã€‚<code>refresh_token</code>åœ¨é™å®šè¿‡æœŸæ—¶é—´å†…ï¼ˆæ¯”å¦‚ä¸€å‘¨æˆ–ä¸€ä¸ªæœˆç­‰ï¼‰ï¼Œä¸‹æ¬¡å°±å¯ä»¥ç»§ç»­æ¢å–æ–°çš„<code>access_token</code>ï¼Œä½†è¿‡äº†é™å®šæ—¶é—´ï¼Œå°±ç®—çœŸæ­£æ„ä¹‰è¿‡æœŸäº†ï¼Œä¹Ÿå°±è¦é‡æ–°è¾“å…¥è´¦å·å¯†ç æ¥ç™»å½•äº†ã€‚</p>
</li>
</ol>
<p>å…¬å¸ç½‘ç«™ç™»å½•è¿‡æœŸæ—¶é—´éƒ½åªæœ‰ä¸¤å°æ—¶ï¼ˆtokenè¿‡æœŸæ—¶é—´ï¼‰ï¼Œä½†åˆæƒ³è®©ä¸€ä¸ªæœˆå†…ç»å¸¸æ´»è·ƒçš„ç”¨æˆ·ä¸å†æ¬¡ç™»å½•ï¼Œäºæ˜¯æ‰æœ‰è¿™æ ·éœ€æ±‚ï¼Œé¿å…äº†ç”¨æˆ·å†æ¬¡è¾“å…¥è´¦å·å¯†ç ç™»å½•ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä¸“é—¨ç”¨ä¸€ä¸ª <code>refresh_token</code> å»æ›´æ–° <code>access_token</code> å‘¢ï¼Ÿé¦–å…ˆ<code>access_token</code>ä¼šå…³è”ä¸€å®šçš„ç”¨æˆ·æƒé™ï¼Œå¦‚æœç”¨æˆ·æˆæƒæ›´æ”¹äº†ï¼Œè¿™ä¸ª<code>access_token</code>ä¹Ÿæ˜¯éœ€è¦è¢«åˆ·æ–°ä»¥å…³è”æ–°çš„æƒé™çš„ï¼Œå¦‚æœæ²¡æœ‰ <code>refresh_token</code>ï¼Œä¹Ÿå¯ä»¥åˆ·æ–° <code>access_token</code>ï¼Œä½†æ¯æ¬¡åˆ·æ–°éƒ½è¦ç”¨æˆ·è¾“å…¥ç™»å½•ç”¨æˆ·åä¸å¯†ç ï¼Œå¤šéº»çƒ¦ã€‚æœ‰äº† <code>refresh_ token</code>ï¼Œå¯ä»¥å‡å°‘è¿™ä¸ªéº»çƒ¦ï¼Œå®¢æˆ·ç«¯ç›´æ¥ç”¨ <code>refresh_token</code> å»æ›´æ–° <code>access_token</code>ï¼Œæ— éœ€ç”¨æˆ·è¿›è¡Œé¢å¤–çš„æ“ä½œã€‚</p>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ–è®¸æœ‰äººä¼šåæ§½ï¼Œä¸€ä¸ªç™»å½•ç”¨<code>access_token</code>å°±è¡Œäº†è¿˜è¦åŠ ä¸ª<code>refresh_token</code>æå¾—è¿™ä¹ˆéº»çƒ¦ï¼Œæˆ–è€…æœ‰çš„å…¬å¸<code>refresh_token</code>æ˜¯åå°åŒ…åŠçš„å¹¶ä¸éœ€è¦å‰ç«¯å¤„ç†ã€‚ä½†æ˜¯ï¼Œå‰ç½®åœºæ™¯åœ¨é‚£äº†ï¼Œéœ€æ±‚éƒ½æ˜¯åŸºäºè¯¥åœºæ™¯ä¸‹çš„ã€‚</p>
<ul>
<li>éœ€æ±‚</li>
</ul>
<ol>
<li><p>å½“<code>access_token</code>è¿‡æœŸçš„æ—¶å€™ï¼Œè¦ç”¨<code>refresh_token</code>å»è¯·æ±‚è·å–æ–°çš„<code>access_token</code>ï¼Œå‰ç«¯éœ€è¦åšåˆ°ç”¨æˆ·æ— æ„ŸçŸ¥çš„åˆ·æ–°<code>access_token</code>ã€‚æ¯”å¦‚ç”¨æˆ·å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå¦‚æœåˆ¤æ–­<code>access_token</code>å·²ç»è¿‡æœŸï¼Œé‚£ä¹ˆå°±å…ˆè¦å»è°ƒç”¨åˆ·æ–°tokenæ¥å£æ‹¿åˆ°æ–°çš„<code>access_token</code>ï¼Œå†é‡æ–°å‘èµ·ç”¨æˆ·è¯·æ±‚ã€‚</p>
</li>
<li><p>å¦‚æœåŒæ—¶å‘èµ·å¤šä¸ªç”¨æˆ·è¯·æ±‚ï¼Œç¬¬ä¸€ä¸ªç”¨æˆ·è¯·æ±‚å»è°ƒç”¨åˆ·æ–°tokenæ¥å£ï¼Œå½“æ¥å£è¿˜æ²¡è¿”å›æ—¶ï¼Œå…¶ä½™çš„ç”¨æˆ·è¯·æ±‚ä¹Ÿä¾æ—§å‘èµ·äº†åˆ·æ–°tokenæ¥å£è¯·æ±‚ï¼Œå°±ä¼šå¯¼è‡´å¤šä¸ªè¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å¦‚ä½•å¤„ç†ï¼Œå°±æ˜¯æˆ‘ä»¬æœ¬æ–‡çš„å†…å®¹äº†ã€‚</p>
</li>
</ol>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><h3 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h3><p>å†™åœ¨è¯·æ±‚æ‹¦æˆªå™¨é‡Œï¼Œåœ¨è¯·æ±‚å‰ï¼Œå…ˆåˆ©ç”¨æœ€åˆè¯·æ±‚è¿”å›çš„å­—æ®µ<code>expires_in</code>å­—æ®µæ¥åˆ¤æ–­<code>access_token</code>æ˜¯å¦å·²ç»è¿‡æœŸï¼Œè‹¥å·²è¿‡æœŸï¼Œåˆ™å°†è¯·æ±‚æŒ‚èµ·ï¼Œå…ˆåˆ·æ–°<code>access_token</code>åå†ç»§ç»­è¯·æ±‚ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š èƒ½èŠ‚çœhttpè¯·æ±‚</li>
<li>ç¼ºç‚¹ï¼š å› ä¸ºä½¿ç”¨äº†æœ¬åœ°æ—¶é—´åˆ¤æ–­ï¼Œè‹¥æœ¬åœ°æ—¶é—´è¢«ç¯¡æ”¹ï¼Œæœ‰æ ¡éªŒå¤±è´¥çš„é£é™©</li>
</ul>
<h3 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h3><p>å†™åœ¨å“åº”æ‹¦æˆªå™¨é‡Œï¼Œæ‹¦æˆªè¿”å›åçš„æ•°æ®ã€‚å…ˆå‘èµ·ç”¨æˆ·è¯·æ±‚ï¼Œå¦‚æœæ¥å£è¿”å›<code>access_token</code>è¿‡æœŸï¼Œå…ˆåˆ·æ–°<code>access_token</code>ï¼Œå†è¿›è¡Œä¸€æ¬¡é‡è¯•ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ— éœ€åˆ¤æ–­æ—¶é—´</li>
<li>ç¼ºç‚¹ï¼š ä¼šæ¶ˆè€—å¤šä¸€æ¬¡httpè¯·æ±‚</li>
</ul>
<p>åœ¨æ­¤æˆ‘é€‰æ‹©çš„æ˜¯æ–¹æ¡ˆäºŒã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>è¿™é‡Œä½¿ç”¨axiosï¼Œå…¶ä¸­åšçš„æ˜¯è¯·æ±‚åæ‹¦æˆªï¼Œæ‰€ä»¥ç”¨åˆ°çš„æ˜¯axiosçš„å“åº”æ‹¦æˆªå™¨<code>axios.interceptors.response.use()</code>æ–¹æ³•</p>
<h3 id="æ–¹æ³•ä»‹ç»"><a href="#æ–¹æ³•ä»‹ç»" class="headerlink" title="æ–¹æ³•ä»‹ç»"></a>æ–¹æ³•ä»‹ç»</h3><ul>
<li><p>@utils/auth.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">'js-cookie'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TOKEN_KEY = <span class="string">'access_token'</span></span><br><span class="line"><span class="keyword">const</span> REGRESH_TOKEN_KEY = <span class="string">'refresh_token'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getToken = <span class="function"><span class="params">()</span> =&gt;</span> Cookies.get(TOKEN_KEY)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setToken = <span class="function">(<span class="params">token, params = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  Cookies.set(TOKEN_KEY, token, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setRefreshToken = <span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">  Cookies.set(REGRESH_TOKEN_KEY, token)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>request.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken, setToken, getRefreshToken &#125; <span class="keyword">from</span> <span class="string">'@utils/auth'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ·æ–° access_token çš„æ¥å£</span></span><br><span class="line"><span class="keyword">const</span> refreshToken = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> instance.post(<span class="string">'/auth/refresh'</span>, &#123; <span class="attr">refresh_token</span>: getRefreshToken() &#125;, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º axios å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">  baseURL:  process.env.GATSBY_API_URL,</span><br><span class="line">  timeout: <span class="number">30000</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">instance.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// token è¿‡æœŸæˆ–æ— æ•ˆï¼Œè¿”å› 401 çŠ¶æ€ç ï¼Œåœ¨æ­¤å¤„ç†é€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™è¯·æ±‚å¤´æ·»åŠ  access_token</span></span><br><span class="line"><span class="keyword">const</span> setHeaderToken = <span class="function">(<span class="params">isNeedToken</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> accessToken = isNeedToken ? getToken() : <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span> (isNeedToken) &#123; <span class="comment">// api è¯·æ±‚éœ€è¦æºå¸¦ access_token </span></span><br><span class="line">    <span class="keyword">if</span> (!accessToken) &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ä¸å­˜åœ¨ access_token åˆ™è·³è½¬å›ç™»å½•é¡µ'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    instance.defaults.headers.common.Authorization = <span class="string">`Bearer <span class="subst">$&#123;accessToken&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰äº› api å¹¶ä¸éœ€è¦ç”¨æˆ·æˆæƒä½¿ç”¨ï¼Œåˆ™ä¸æºå¸¦ access_tokenï¼›é»˜è®¤ä¸æºå¸¦ï¼Œéœ€è¦ä¼ åˆ™è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º true</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">get</span> = (url, params = &#123;&#125;, isNeedToken = <span class="literal">false</span>) =&gt; &#123;</span><br><span class="line">  setHeaderToken(isNeedToken)</span><br><span class="line">  <span class="keyword">return</span> instance(&#123;</span><br><span class="line">    method: <span class="string">'get'</span>,</span><br><span class="line">    url,</span><br><span class="line">    params,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> post = <span class="function">(<span class="params">url, params = &#123;&#125;, isNeedToken = <span class="literal">false</span></span>) =&gt;</span> &#123;</span><br><span class="line">  setHeaderToken(isNeedToken)</span><br><span class="line">  <span class="keyword">return</span> instance(&#123;</span><br><span class="line">    method: <span class="string">'post'</span>,</span><br><span class="line">    url,</span><br><span class="line">    data: params,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>æ¥ä¸‹æ¥æ”¹é€  request.jsä¸­axiosçš„å“åº”æ‹¦æˆªå™¨</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">instance.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; config &#125; = error</span><br><span class="line">        <span class="keyword">return</span> refreshToken().then(<span class="function"><span class="params">res</span>=&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; access_token &#125; = res.data</span><br><span class="line">            setToken(access_token)</span><br><span class="line">            config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;access_token&#125;</span>`</span></span><br><span class="line">            <span class="keyword">return</span> instance(config)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'æŠ±æ­‰ï¼Œæ‚¨çš„ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•ï¼'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>çº¦å®šè¿”å›401çŠ¶æ€ç è¡¨ç¤º<code>access_token</code>è¿‡æœŸæˆ–è€…æ— æ•ˆï¼Œå¦‚æœç”¨æˆ·å‘èµ·ä¸€ä¸ªè¯·æ±‚åè¿”å›ç»“æœæ˜¯<code>access_token</code>è¿‡æœŸï¼Œåˆ™è¯·æ±‚åˆ·æ–°<code>access_token</code>çš„æ¥å£ã€‚è¯·æ±‚æˆåŠŸåˆ™è¿›å…¥<code>then</code>é‡Œé¢ï¼Œé‡ç½®é…ç½®ï¼Œå¹¶åˆ·æ–°<code>access_token</code>å¹¶é‡æ–°å‘èµ·åŸæ¥çš„è¯·æ±‚ã€‚</p>
<p>ä½†å¦‚æœ<code>refresh_token</code>ä¹Ÿè¿‡æœŸäº†ï¼Œåˆ™è¯·æ±‚ä¹Ÿæ˜¯è¿”å›401ã€‚æ­¤æ—¶è°ƒè¯•ä¼šå‘ç°å‡½æ•°è¿›ä¸åˆ°<code>refreshToken()</code>çš„<code>catch</code>é‡Œé¢ï¼Œé‚£æ˜¯å› ä¸º<code>refreshToken()</code>æ–¹æ³•å†…éƒ¨æ˜¯ä¹Ÿæ˜¯ç”¨äº†åŒä¸ª<code>instance</code>å®ä¾‹ï¼Œé‡å¤å“åº”æ‹¦æˆªå™¨401çš„å¤„ç†é€»è¾‘ï¼Œä½†è¯¥å‡½æ•°æœ¬èº«å°±æ˜¯åˆ·æ–°<code>access_token</code>ï¼Œæ•…éœ€è¦æŠŠè¯¥æ¥å£æ’é™¤æ‰ï¼Œå³ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (error.response.status === <span class="number">401</span> &amp;&amp; !error.config.url.includes(<span class="string">'/auth/refresh'</span>)) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç å°±å·²ç»å®ç°äº†æ— æ„Ÿåˆ·æ–°<code>access_token</code>äº†ï¼Œå½“<code>access_token</code>æ²¡è¿‡æœŸï¼Œæ­£å¸¸è¿”å›ï¼›è¿‡æœŸæ—¶ï¼Œåˆ™axioså†…éƒ¨è¿›è¡Œäº†ä¸€æ¬¡åˆ·æ–°tokençš„æ“ä½œï¼Œå†é‡æ–°å‘èµ·åŸæ¥çš„è¯·æ±‚ã€‚</p>
<h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><h3 id="é˜²æ­¢å¤šæ¬¡åˆ·æ–°-token"><a href="#é˜²æ­¢å¤šæ¬¡åˆ·æ–°-token" class="headerlink" title="é˜²æ­¢å¤šæ¬¡åˆ·æ–° token"></a>é˜²æ­¢å¤šæ¬¡åˆ·æ–° token</h3><p>å¦‚æœtokenæ˜¯è¿‡æœŸçš„ï¼Œé‚£è¯·æ±‚åˆ·æ–°<code>access_token</code>çš„æ¥å£è¿”å›ä¹Ÿæ˜¯æœ‰ä¸€å®šæ—¶é—´é—´éš”ï¼Œå¦‚æœæ­¤æ—¶è¿˜æœ‰å…¶ä»–è¯·æ±‚å‘è¿‡æ¥ï¼Œå°±ä¼šå†æ‰§è¡Œä¸€æ¬¡åˆ·æ–°<code>access_token</code>çš„æ¥å£ï¼Œå°±ä¼šå¯¼è‡´å¤šæ¬¡åˆ·æ–°<code>access_token</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ä¸ªåˆ¤æ–­ï¼Œå®šä¹‰ä¸€ä¸ªæ ‡è®°åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºåˆ·æ–°<code>access_token</code>çš„çŠ¶æ€ï¼Œå¦‚æœå¤„åœ¨åˆ·æ–°çŠ¶æ€åˆ™ä¸å†å…è®¸å…¶ä»–è¯·æ±‚è°ƒç”¨è¯¥æ¥å£ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isRefreshing = <span class="literal">false</span> <span class="comment">// æ ‡è®°æ˜¯å¦æ­£åœ¨åˆ·æ–° token</span></span><br><span class="line">instance.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span> &amp;&amp; !error.config.url.includes(<span class="string">'/auth/refresh'</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; config &#125; = error</span><br><span class="line">        <span class="keyword">if</span> (!isRefreshing) &#123;</span><br><span class="line">            isRefreshing = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">return</span> refreshToken().then(<span class="function"><span class="params">res</span>=&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; access_token &#125; = res.data</span><br><span class="line">                setToken(access_token)</span><br><span class="line">                config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;access_token&#125;</span>`</span></span><br><span class="line">                <span class="keyword">return</span> instance(config)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'æŠ±æ­‰ï¼Œæ‚¨çš„ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•ï¼'</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">            &#125;).finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                isRefreshing = <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚çš„å¤„ç†"><a href="#åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚çš„å¤„ç†" class="headerlink" title="åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚çš„å¤„ç†"></a>åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚çš„å¤„ç†</h3><p>ä¸Šé¢åšæ³•è¿˜ä¸å¤Ÿï¼Œå› ä¸ºå¦‚æœåŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œåœ¨tokenè¿‡æœŸçš„æƒ…å†µï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚è¿›å…¥åˆ·æ–°tokenæ–¹æ³•ï¼Œåˆ™å…¶ä»–è¯·æ±‚è¿›å»æ²¡æœ‰åšä»»ä½•é€»è¾‘å¤„ç†ï¼Œå•çº¯è¿”å›å¤±è´¥ï¼Œæœ€ç»ˆåªæ‰§è¡Œäº†ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ã€‚</p>
<p>æ¯”å¦‚åŒæ—¶å‘èµ·ä¸‰ä¸ªè¯·æ±‚ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚è¿›å…¥åˆ·æ–°tokençš„æµç¨‹ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªè¯·æ±‚éœ€è¦å­˜èµ·æ¥ï¼Œç­‰åˆ°tokenæ›´æ–°åå†é‡æ–°å‘èµ·è¯·æ±‚ã€‚</p>
<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•°ç»„<code>requests</code>ï¼Œç”¨æ¥ä¿å­˜å¤„äºç­‰å¾…çš„è¯·æ±‚ï¼Œä¹‹åè¿”å›ä¸€ä¸ª<code>Promise</code>ï¼Œåªè¦ä¸è°ƒç”¨<code>resolve</code>æ–¹æ³•ï¼Œè¯¥è¯·æ±‚å°±ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œåˆ™å¯ä»¥çŸ¥é“å…¶å®æ•°ç»„å­˜çš„æ˜¯å‡½æ•°ï¼›ç­‰åˆ°tokenæ›´æ–°å®Œæ¯•ï¼Œåˆ™é€šè¿‡æ•°ç»„å¾ªç¯æ‰§è¡Œå‡½æ•°ï¼Œå³é€ä¸ªæ‰§è¡Œresolveé‡å‘è¯·æ±‚ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isRefreshing = <span class="literal">false</span> <span class="comment">// æ ‡è®°æ˜¯å¦æ­£åœ¨åˆ·æ–° token</span></span><br><span class="line"><span class="keyword">let</span> requests = [] <span class="comment">// å­˜å‚¨å¾…é‡å‘è¯·æ±‚çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">instance.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span> &amp;&amp; !error.config.url.includes(<span class="string">'/auth/refresh'</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; config &#125; = error</span><br><span class="line">        <span class="keyword">if</span> (!isRefreshing) &#123;</span><br><span class="line">            isRefreshing = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">return</span> refreshToken().then(<span class="function"><span class="params">res</span>=&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; access_token &#125; = res.data</span><br><span class="line">                setToken(access_token)</span><br><span class="line">                config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;access_token&#125;</span>`</span></span><br><span class="line">                <span class="comment">// token åˆ·æ–°åå°†æ•°ç»„çš„æ–¹æ³•é‡æ–°æ‰§è¡Œ</span></span><br><span class="line">                requests.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(access_token))</span><br><span class="line">                requests = [] <span class="comment">// é‡æ–°è¯·æ±‚å®Œæ¸…ç©º</span></span><br><span class="line">                <span class="keyword">return</span> instance(config)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'æŠ±æ­‰ï¼Œæ‚¨çš„ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•ï¼'</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">            &#125;).finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                isRefreshing = <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è¿”å›æœªæ‰§è¡Œ resolve çš„ Promise</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// ç”¨å‡½æ•°å½¢å¼å°† resolve å­˜å…¥ï¼Œç­‰å¾…åˆ·æ–°åå†æ‰§è¡Œ</span></span><br><span class="line">                requests.push(<span class="function"><span class="params">token</span> =&gt;</span> &#123;</span><br><span class="line">                    config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">                    resolve(instance(config))</span><br><span class="line">                &#125;)  </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆ request.js ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken, setToken, getRefreshToken &#125; <span class="keyword">from</span> <span class="string">'@utils/auth'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ·æ–° access_token çš„æ¥å£</span></span><br><span class="line"><span class="keyword">const</span> refreshToken = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> instance.post(<span class="string">'/auth/refresh'</span>, &#123; <span class="attr">refresh_token</span>: getRefreshToken() &#125;, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º axios å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">  baseURL:  process.env.GATSBY_API_URL,</span><br><span class="line">  timeout: <span class="number">30000</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isRefreshing = <span class="literal">false</span> <span class="comment">// æ ‡è®°æ˜¯å¦æ­£åœ¨åˆ·æ–° token</span></span><br><span class="line"><span class="keyword">let</span> requests = [] <span class="comment">// å­˜å‚¨å¾…é‡å‘è¯·æ±‚çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">instance.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span> &amp;&amp; !error.config.url.includes(<span class="string">'/auth/refresh'</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; config &#125; = error</span><br><span class="line">        <span class="keyword">if</span> (!isRefreshing) &#123;</span><br><span class="line">            isRefreshing = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">return</span> refreshToken().then(<span class="function"><span class="params">res</span>=&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; access_token &#125; = res.data</span><br><span class="line">                setToken(access_token)</span><br><span class="line">                config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;access_token&#125;</span>`</span></span><br><span class="line">                <span class="comment">// token åˆ·æ–°åå°†æ•°ç»„çš„æ–¹æ³•é‡æ–°æ‰§è¡Œ</span></span><br><span class="line">                requests.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(access_token))</span><br><span class="line">                requests = [] <span class="comment">// é‡æ–°è¯·æ±‚å®Œæ¸…ç©º</span></span><br><span class="line">                <span class="keyword">return</span> instance(config)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'æŠ±æ­‰ï¼Œæ‚¨çš„ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•ï¼'</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">            &#125;).finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                isRefreshing = <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è¿”å›æœªæ‰§è¡Œ resolve çš„ Promise</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// ç”¨å‡½æ•°å½¢å¼å°† resolve å­˜å…¥ï¼Œç­‰å¾…åˆ·æ–°åå†æ‰§è¡Œ</span></span><br><span class="line">                requests.push(<span class="function"><span class="params">token</span> =&gt;</span> &#123;</span><br><span class="line">                    config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">                    resolve(instance(config))</span><br><span class="line">                &#125;)  </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™è¯·æ±‚å¤´æ·»åŠ  access_token</span></span><br><span class="line"><span class="keyword">const</span> setHeaderToken = <span class="function">(<span class="params">isNeedToken</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> accessToken = isNeedToken ? getToken() : <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span> (isNeedToken) &#123; <span class="comment">// api è¯·æ±‚éœ€è¦æºå¸¦ access_token </span></span><br><span class="line">    <span class="keyword">if</span> (!accessToken) &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ä¸å­˜åœ¨ access_token åˆ™è·³è½¬å›ç™»å½•é¡µ'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    instance.defaults.headers.common.Authorization = <span class="string">`Bearer <span class="subst">$&#123;accessToken&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰äº› api å¹¶ä¸éœ€è¦ç”¨æˆ·æˆæƒä½¿ç”¨ï¼Œåˆ™æ— éœ€æºå¸¦ access_tokenï¼›é»˜è®¤ä¸æºå¸¦ï¼Œéœ€è¦ä¼ åˆ™è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º true</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">get</span> = (url, params = &#123;&#125;, isNeedToken = <span class="literal">false</span>) =&gt; &#123;</span><br><span class="line">  setHeaderToken(isNeedToken)</span><br><span class="line">  <span class="keyword">return</span> instance(&#123;</span><br><span class="line">    method: <span class="string">'get'</span>,</span><br><span class="line">    url,</span><br><span class="line">    params,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> post = <span class="function">(<span class="params">url, params = &#123;&#125;, isNeedToken = <span class="literal">false</span></span>) =&gt;</span> &#123;</span><br><span class="line">  setHeaderToken(isNeedToken)</span><br><span class="line">  <span class="keyword">return</span> instance(&#123;</span><br><span class="line">    method: <span class="string">'post'</span>,</span><br><span class="line">    url,</span><br><span class="line">    data: params,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åƒè€ƒæ–‡ç« </li>
</ul>
<p><a href="https://juejin.im/post/5d5ccdd75188255625591357" target="_blank" rel="noopener">https://juejin.im/post/5d5ccdd75188255625591357</a></p>
<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>axios</tag>
        <tag>token</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨Gatsby</title>
    <url>/2020/07/12/%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8Gatsby/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨å­¦ä¹  Gatsbyï¼Œå®ƒä¸»è¦æœ‰ SEO å¥½ï¼Œè€Œä¸”é¦–é¡µæ¸²æŸ“å¿«ç­‰ä¼˜ç‚¹ï¼Œåœ¨å›½å¤–å¾ˆæµè¡Œçš„ä¸€ä¸ªæ¡†æ¶ï¼Œè¿™ç¯‡é•¿æ–‡å¸¦ä½ å…¥ä¸ªé—¨ã€‚Gatsby æ˜¯ä¸€ä¸ªé™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼ŒGatsby ä¸»è¦çš„åº”ç”¨çš„æŠ€æœ¯æ˜¯ React å’Œ GraphQLâ€¦</p><a id="more"></a><h2 id="Gatsby-ä»‹ç»"><a href="#Gatsby-ä»‹ç»" class="headerlink" title="Gatsby ä»‹ç»"></a>Gatsby ä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯-Gatsby"><a href="#ä»€ä¹ˆæ˜¯-Gatsby" class="headerlink" title="ä»€ä¹ˆæ˜¯ Gatsby"></a>ä»€ä¹ˆæ˜¯ Gatsby</h3><p>Gatsby æ˜¯ä¸€ä¸ªåŸºäº React ï¼Œç”¨äºæ­å»ºé™æ€ç«™ç‚¹çš„å¼€æºæ¡†æ¶ï¼Œç”¨äºå¸®åŠ©å¼€å‘è€…æ„å»ºè¿è¡Œé€Ÿåº¦æå¿«çš„ç½‘ç«™ã€‚å¯ä»¥è¯´å®ƒæ˜¯ä¸€ä¸ªé™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼ŒGatsby ä¸»è¦çš„åº”ç”¨çš„æŠ€æœ¯æ˜¯ React å’Œ GraphQLã€‚</p><p>å®˜ç½‘ï¼š<a href="https://www.gatsbyjs.org/" target="_blank" rel="noopener">https://www.gatsbyjs.org/</a></p><h3 id="ä¸ºä»€ä¹ˆé€‰-Gatsby"><a href="#ä¸ºä»€ä¹ˆé€‰-Gatsby" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰ Gatsby"></a>ä¸ºä»€ä¹ˆé€‰ Gatsby</h3><p>Gatsby èƒ½å¿«é€Ÿä½¿ç”¨ React ç”Ÿæ€ç³»ç»Ÿæ¥ç”Ÿæˆé™æ€ç½‘ç«™ï¼Œå®ƒå…·å¤‡æ›´é«˜çš„æ€§èƒ½ï¼Œè€Œä¸” Gatsby çš„ç”Ÿæ€ä¹Ÿå¾ˆå¼ºå¤§ã€‚</p><p>å½“ä½ æƒ³è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸ªäººåšå®¢æ—¶ï¼Œè€ƒè™‘çš„æ˜¯ SEO è¦å¥½ï¼Œè€Œä¸”ä½ ä¸ç”¨ç†ä¼šæ•°æ®åº“å’ŒæœåŠ¡å™¨ç­‰å¤æ‚çš„éƒ¨ç½²è®¾ç½®ï¼ŒGatsby æ„å»ºçš„ç½‘ç«™ä¸ºé™æ€ç«™ç‚¹ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾çš„å°†ç½‘ç«™éƒ¨ç½²åœ¨å¾ˆå¤šæœåŠ¡ä¸Šã€‚Gatsby ä¸éœ€è¦ç­‰å¾…è¯·æ±‚æ—¶ç”Ÿæˆé¡µé¢ï¼Œè€Œæ˜¯é¢„å…ˆç”Ÿæˆé¡µé¢ï¼Œå› æ­¤ç½‘ç«™çš„é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚</p><p>Gatsby ä¸­è¿ç”¨äº† React, react-router, Webpack ä»¥åŠ GraphQL ç­‰æ–°æŠ€æœ¯ï¼Œä¹Ÿè·Ÿéšäº†æŠ€æœ¯æ½®æµã€‚</p><h2 id="GraphQL-ä»‹ç»"><a href="#GraphQL-ä»‹ç»" class="headerlink" title="GraphQL ä»‹ç»"></a>GraphQL ä»‹ç»</h2><p>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº† GraphQLï¼Œæ²¡äº†è§£çš„åŒå­¦å¯èƒ½ä¸å¤ªæ¸…æ¥šã€‚</p><blockquote><p>GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ Restful API çš„æ›¿ä»£å“ã€‚</p></blockquote><p>è‡³äºæ›¿ä»£ Restful API ä¸€è¯´ï¼Œä¸ªäººè§‰å¾—ç°åœ¨ Restful API å æ®ç»å¯¹çš„ä¸»å¯¼åœ°ä½ï¼Œå½“å‰è¿˜æ˜¯å¾ˆéš¾è¢«æ’¼åŠ¨çš„ã€‚å› ä¸ºç›®å‰æ¥çœ‹ï¼ŒGraphQL ä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ã€‚</p><p>çœ‹åˆ°è¿™é‡Œæ²¡å­¦è¿‡ GraphQL ä¹Ÿä¸ç”¨æ€•ï¼Œå› ä¸ºç”¨åˆ°çš„ä¸å¤šè€Œä¸” Gatsby å†…ç½®ä¸€ä¸ªç•Œé¢æ–¹ä¾¿æˆ‘ä»¬æ“ä½œã€‚GraphQL ç›®å‰å›½å¤–æ¯”è¾ƒç«ï¼Œå®ƒä½œä¸ºä¸€é—¨æ–°æŠ€æœ¯ï¼Œå³ä½¿ä¸æ·±å…¥æˆ‘ä»¬ä¹Ÿå¯ä»¥äº†è§£ä¸€ä¸‹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å½“ç„¶è¦å¹æ§å®ƒçš„ä¼˜ç‚¹ï¼Œä¸Šé¢çš„å®šä¹‰ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼ŒAPI ä¸å°±æ˜¯åç«¯å†™å¥½çš„æ¥å£å—ï¼Œæ€ä¹ˆè¿˜èƒ½æŸ¥è¯¢ï¼Ÿ</p><p>GraphQL æˆ‘ä»¬æŠŠè¿™ä¸ªå•è¯æ‹†å¼€çš„è¯æ˜¯ï¼š Graph(å›¾å½¢æˆ–å›¾è¡¨) + QLï¼ˆQuery Languageï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§å›¾å½¢åŒ–çš„æŸ¥è¯¢è¯­è¨€ï¼Œæè¿°å®¢æˆ·ç«¯å¦‚ä½•åƒæœåŠ¡ç«¯è¯·æ±‚æ•°æ®çš„è¯­æ³•è§„èŒƒã€‚å¬èµ·æ¥æ¨¡æ¨¡ç³Šç³Šï¼Œé‚£å®ƒç›¸å¯¹ Restful API åˆè§£å†³äº†ä»€ä¹ˆç—›ç‚¹å‘¢ï¼Ÿ</p><ol><li>è¯·æ±‚ä½ æ‰€è¦çš„æ•°æ®ä¸å¤šä¸å°‘</li></ol><p>ç›¸ä¿¡å¤šæ•°äººè‚¯å®šé‡åˆ°è¿‡çš„åœºæ™¯ï¼Œæ¯”å¦‚é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œè¿›å…¥æŸé¡µé¢å±•ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸Šåªéœ€å±•ç¤ºæ ‡é¢˜ï¼Œä½†ä½ è¯·æ±‚è¿”å›çš„æ•°æ®å´å¤šäº†å…¶ä»–ä¿¡æ¯ï¼Œæ¯”å¦‚åˆ›å»ºè€…ã€åˆ›å»ºæ—¶é—´ç­‰ã€‚è¿™äº›ä¿¡æ¯åœ¨è¿™é‡Œæ˜¯å¤šä½™çš„ï¼Œä½†å®ƒå¯èƒ½æœ‰å®ƒè‡ªå·±å­˜åœ¨çš„ç†ç”±ï¼Œæˆ–è®¸æ˜¯å…¶ä»–åœºæ™¯éœ€è¦è¿”å›è¿™äº›ä¿¡æ¯ï¼Œå› æ­¤è¯¥æ¥å£å°±ç›´æ¥åŒ…å«äº†æ‰€æœ‰æ•°æ®ã€‚</p><p>è¿™ä¸€ç‚¹ï¼ŒGraphQL èƒ½å‡†ç¡®è·å–ä½ æƒ³è¦çš„æ•°æ®ï¼Œä¸å¤šä¸å°‘ï¼Œæƒ³è¦è¿”å›æŒ‡å®šçš„ä»€ä¹ˆæ•°æ®ï¼Œå°±è¿”å›ä»€ä¹ˆæ•°æ®ã€‚æ•°æ®ç”±åº”ç”¨æ¥æ§åˆ¶ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨ã€‚</p><ol start="2"><li>è·å–å¤šä¸ªèµ„æºåªéœ€è¦ä¸€ä¸ªè¯·æ±‚</li></ol><p>GraphQL æŸ¥è¯¢ä¸ä»…èƒ½å¤Ÿè·å¾—èµ„æºçš„å±æ€§ï¼Œè¿˜èƒ½æ²¿ç€èµ„æºé—´å¼•ç”¨è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚å…¸å‹çš„ REST API è¯·æ±‚å¤šä¸ªèµ„æºæ—¶å¾—è½½å…¥å¤šä¸ª URLï¼Œè€Œ GraphQL å¯ä»¥é€šè¿‡ä¸€æ¬¡è¯·æ±‚å°±è·å–ä½ åº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ˜¯æ¯”è¾ƒæ…¢çš„ç§»åŠ¨ç½‘ç»œè¿æ¥ä¸‹ï¼Œä½¿ç”¨ GraphQL çš„åº”ç”¨ä¹Ÿèƒ½è¡¨ç°å¾—è¶³å¤Ÿè¿…é€Ÿã€‚</p><ol start="3"><li>æè¿°æ‰€æœ‰çš„å¯èƒ½ç±»å‹ç³»ç»Ÿ</li></ol><p>GraphQL API åŸºäºç±»å‹å’Œå­—æ®µçš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼Œè€Œéå…¥å£ç«¯ç‚¹ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªå•ä¸€å…¥å£ç«¯ç‚¹å¾—åˆ°ä½ æ‰€æœ‰çš„æ•°æ®èƒ½åŠ›ã€‚GraphQL ä½¿ç”¨ç±»å‹æ¥ä¿è¯åº”ç”¨åªè¯·æ±‚å¯èƒ½çš„æ•°æ®ï¼Œè¿˜æä¾›äº†æ¸…æ™°çš„è¾…åŠ©æ€§é”™è¯¯ä¿¡æ¯ã€‚åº”ç”¨å¯ä»¥ä½¿ç”¨ç±»å‹ï¼Œè€Œé¿å…ç¼–å†™æ‰‹åŠ¨è§£æä»£ç ã€‚</p><p>Gatsby ä½¿ç”¨äº† GraphQLï¼Œä½œä¸ºåœ¨æœ¬åœ°ç®¡ç†èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚</p><h2 id="æ­å»ºé¡¹ç›®"><a href="#æ­å»ºé¡¹ç›®" class="headerlink" title="æ­å»ºé¡¹ç›®"></a>æ­å»ºé¡¹ç›®</h2><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><ul><li>å®‰è£… Gatsby è„šæ‰‹æ¶</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g gatsby-cli</span><br></pre></td></tr></table></figure><ul><li>æ–°å»ºé¡¹ç›®</li></ul><blockquote><p>gatsby new [projectName][starter]ï¼šæ ¹æ® starter åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gatsby new gatsby-blog-demo https:&#x2F;&#x2F;github.com&#x2F;gatsbyjs&#x2F;gatsby-starter-hello-world</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨å®˜æ–¹æœ€ç®€å•ç‰ˆæœ¬çš„ hello-world æ¨¡æ¿è¿›è¡Œå¼€å‘ï¼Œå¦‚æœä½ ç›´æ¥ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gatsby new gatsby-blog-demo</span><br></pre></td></tr></table></figure><p>é»˜è®¤ä¼šä½¿ç”¨ <a href="https://github.com/gatsbyjs/gatsby-starter-default" target="_blank" rel="noopener">gatsby-starter-default</a> æ¥æ–°å»ºé¡¹ç›®</p><ul><li>è¿è¡Œé¡¹ç›®</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd gatsby-blog-demo</span><br><span class="line">gatsby develop</span><br></pre></td></tr></table></figure><p>æ‰“å¼€ <code>localhost:8000</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†ä¸€å¥<code>Hello world!</code></p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>è¿™é‡Œä»‹ç» Gatsby çš„å‡ ä¸ªå¸¸ç”¨å‘½ä»¤ï¼š</p><ul><li>gastby developï¼šå¼€å¯çƒ­åŠ è½½å¼€å‘ç¯å¢ƒ</li><li>gastby buildï¼šæ‰“åŒ…åˆ° public ä¸‹ï¼Œæ„å»ºç”Ÿäº§ç¯å¢ƒç”¨çš„ä¼˜åŒ–è¿‡çš„é™æ€ç½‘ç«™æ‰€éœ€çš„ä¸€åˆ‡é™æ€èµ„æºã€é™æ€é¡µé¢ä¸ js ä»£ç </li><li>gatsby serveï¼šåœ¨æ‰“åŒ…ä¹‹åï¼Œå¯åŠ¨ä¸€ä¸ªæœ¬åœ°çš„æœåŠ¡ï¼Œä¾›ä½ æµ‹è¯•åˆšæ‰â€gatsby buildâ€ç”Ÿæˆçš„é™æ€ç½‘é¡µ</li></ul><h3 id="GraphiQL"><a href="#GraphiQL" class="headerlink" title="GraphiQL"></a>GraphiQL</h3><p>æ‰“å¼€<code>http://localhost:8000/__graphql</code>ï¼Œå°±ä¼šçœ‹åˆ° GraphQL çš„è°ƒè¯•ç•Œé¢ï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®ã€ä»¥åŠè°ƒè¯• query è¯­å¥æ˜¯å¦è¿”å›ç›¸åº”çš„æ•°æ®ã€‚å¯ä»¥ç›´æ¥åœ¨å·¦ä¾§ç‚¹å‡»é€‰ä¸­ï¼Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ query è¯­å¥ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d4b8f913506df?w=1922&h=538&f=png&s=78717" alt=""></p><h3 id="å¯èƒ½å‡ºç°çš„è­¦å‘Š"><a href="#å¯èƒ½å‡ºç°çš„è­¦å‘Š" class="headerlink" title="å¯èƒ½å‡ºç°çš„è­¦å‘Š"></a>å¯èƒ½å‡ºç°çš„è­¦å‘Š</h3><p>å¦‚æœè¿è¡Œåä½ çš„æ§åˆ¶å°å‡ºç°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">React-Hot-Loader: react-ğŸ”¥-dom patch is not detected. React 16.6+ features may not work.</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¿™æ ·è§£å†³:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install @hot-loader&#x2F;react-dom</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º<code>gatsby-node.js</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exports.onCreateWebpackConfig &#x3D; (&#123; getConfig, stage &#125;) &#x3D;&gt; &#123;</span><br><span class="line">  const config &#x3D; getConfig()</span><br><span class="line">  if (stage.startsWith(&#39;develop&#39;) &amp;&amp; config.resolve) &#123;</span><br><span class="line">    config.resolve.alias &#x3D; &#123;</span><br><span class="line">      ...config.resolve.alias,</span><br><span class="line">      &#39;react-dom&#39;: &#39;@hot-loader&#x2F;react-dom&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†é‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œå°±å¯ä»¥æ¶ˆé™¤è¿™ä¸ªè­¦å‘Š</p><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ .cache</span><br><span class="line">â”œâ”€â”€ public</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">|  â””â”€â”€ pages            &#x2F;&#x2F; è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ä¼šè¢«æ˜ å°„ä¸ºè·¯ç”±</span><br><span class="line">|     â””â”€â”€ index.js</span><br><span class="line">â”œâ”€â”€ static              &#x2F;&#x2F; é™æ€èµ„æº</span><br><span class="line">â”œâ”€â”€ .prettierignore</span><br><span class="line">â”œâ”€â”€ .prettierrc</span><br><span class="line">â”œâ”€â”€ gatsby-config.js    &#x2F;&#x2F; åŸºæœ¬é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â””â”€â”€ yarn.lock</span><br></pre></td></tr></table></figure><h2 id="Gatsby-é…ç½®æ–‡ä»¶"><a href="#Gatsby-é…ç½®æ–‡ä»¶" class="headerlink" title="Gatsby é…ç½®æ–‡ä»¶"></a>Gatsby é…ç½®æ–‡ä»¶</h2><p>è¿™é‡Œæœ€åˆå§‹çš„æ¨¡æ¿åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬é¡¹ç›®ä¸­éƒ½ä¼šæœ‰ 4 ä¸ªé…ç½®æ–‡ä»¶</p><h3 id="gatsby-config-js"><a href="#gatsby-config-js" class="headerlink" title="gatsby-config.js"></a>gatsby-config.js</h3><p>åŸºæœ¬é…ç½®æ–‡ä»¶ã€‚æ•´ä¸ª Gatsby ç«™ç‚¹çš„é…ç½®æ–‡ä»¶ã€‚å¯ä»¥åœ¨é‡Œé¢é…ç½®ç½‘ç«™çš„ç›¸å…³åŸºæœ¬ä¿¡æ¯ã€‚</p><h3 id="gatsby-node-js"><a href="#gatsby-node-js" class="headerlink" title="gatsby-node.js"></a>gatsby-node.js</h3><p>node ç›¸å…³é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åªä¼šåœ¨ build æœŸé—´è¿è¡Œä¸€æ¬¡ï¼Œæ¯”å¦‚åŠ¨æ€åˆ›å»ºä¸€äº›é¡µé¢ã€‚</p><h3 id="gatsby-browser-js"><a href="#gatsby-browser-js" class="headerlink" title="gatsby-browser.js"></a>gatsby-browser.js</h3><p>å®¢æˆ·ç«¯ç›¸å…³é…ç½®ã€‚ä¸€äº›æµè§ˆå™¨ç›¸å…³çš„ API é€šè¿‡åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå»å®ç°ï¼Œæ¯”å¦‚ä¸€äº›ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œæ³¨å†Œ serviceWorker ç­‰ç­‰ã€‚</p><h3 id="gatsby-ssr-js"><a href="#gatsby-ssr-js" class="headerlink" title="gatsby-ssr.js"></a>gatsby-ssr.js</h3><p>æœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ Gatsby çš„æœåŠ¡ç«¯æ¸²æŸ“ API è‡ªå®šä¹‰å½±å“æœåŠ¡ç«¯æ¸²æŸ“çš„é»˜è®¤è®¾ç½®ã€‚</p><h2 id="åˆ›å»ºé¡µé¢"><a href="#åˆ›å»ºé¡µé¢" class="headerlink" title="åˆ›å»ºé¡µé¢"></a>åˆ›å»ºé¡µé¢</h2><h3 id="è·¯ç”±é¡µ"><a href="#è·¯ç”±é¡µ" class="headerlink" title="è·¯ç”±é¡µ"></a>è·¯ç”±é¡µ</h3><p>æˆ‘ä»¬åœ¨ <code>pages</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code>about.js</code>ï¼Œåˆ™å¯¹åº”çš„è·¯ç”±è·¯å¾„ä¸º<code>/about</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>about me<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> About</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>http://localhost:8000/about</code>ï¼Œæ˜¾ç¤ºçš„æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„é¡µé¢</p><h3 id="404-é¡µé¢"><a href="#404-é¡µé¢" class="headerlink" title="404 é¡µé¢"></a>404 é¡µé¢</h3><p><code>pages</code>ç›®å½•ä¸‹çš„æ–‡ä»¶åå³æ˜¯è·¯ç”±è·¯å¾„ï¼Œä½†æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œå½“åŒ¹é…ä¸åˆ°è·¯å¾„æ—¶ï¼ŒGatsby ä¼šè·³è½¬åˆ° 404 é¡µé¢ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ pages ä¸‹åˆ›å»ºæ–‡ä»¶å<code>404.js</code>ï¼Œä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢ã€‚å½“å‰æˆ‘ä»¬éšä¾¿è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢è·¯å¾„ï¼š<code>http://localhost:8000/test</code>ï¼Œé¡µé¢å°±ä¼šæŠ¥é”™ã€‚</p><p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ 404.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>404 é¡µé¢ä¸å­˜åœ¨<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> About</span><br></pre></td></tr></table></figure><p>å†éšä¾¿è¾“å…¥ä¸€ä¸ªè·¯å¾„ï¼Œæ˜¾ç¤ºå‡ºè¯¥é¡µé¢ï¼š<br><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d52ba499ad501?w=1223&h=404&f=png&s=37041" alt=""></p><p>Gatsby ä¼šç¡®ä¿å°† 404 é¡µé¢æ„å»ºä¸º 404.htmlï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºæ­¤é¡µé¢ï¼Œåœ¨è¯¥é¡µé¢ä¹Ÿåˆ—å‡ºäº†ç½‘ç«™ä¸Šçš„æ‰€æœ‰é¡µé¢è·¯ç”±é“¾æ¥,æˆ‘ä»¬å¯ä»¥é€šè¿‡å•å‡»<code>Preview custom 404 page</code>çœ‹æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ 404 é¡µé¢ã€‚</p><p>é‚£æˆ‘ä»¬æƒ³ç›´æ¥è·³è½¬åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢å•Šï¼Œè¿˜è¦æˆ‘ä»¬ç‚¹å‡»æ‰è·³è½¬ã€‚åŸå› æ˜¯å¤„äºå¼€å‘ç¯å¢ƒï¼Œå³å½“ä½¿ç”¨ <code>gatsby develop</code>æ—¶ï¼ŒGatsby ä½¿ç”¨é»˜è®¤çš„ 404 é¡µé¢è¦†ç›–æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢ï¼Œä½†å®é™…ä¸Šæ˜¯å·²ç»ç”Ÿæ•ˆäº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ‰“åŒ…ï¼Œå¯åŠ¨ä¸€ä¸ªæœ¬åœ°çš„æœåŠ¡ï¼Œæ¨¡æ‹Ÿå¤„äºçº¿ä¸Šç¯å¢ƒæ¥çœ‹ï¼Œè¿™ä¸ªæ—¶å€™æ‰æ˜¯ç›´æ¥æ˜¾ç¤ºæˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gatsby build</span><br><span class="line">gatsby serve</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€<code>http://localhost:9000/test</code>ï¼ˆä»»æ„è·¯å¾„ï¼‰ï¼Œå°±èƒ½è·³è½¬åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢äº†</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d5e52ae8fcd52?w=334&h=102&f=png&s=3896" alt=""></p><h3 id="åˆ›å»ºå¸ƒå±€ç»„ä»¶"><a href="#åˆ›å»ºå¸ƒå±€ç»„ä»¶" class="headerlink" title="åˆ›å»ºå¸ƒå±€ç»„ä»¶"></a>åˆ›å»ºå¸ƒå±€ç»„ä»¶</h3><ol><li><p>åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• <code>src/components</code>ã€‚</p></li><li><p>åœ¨ä¸Šé¢çš„ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªå¸ƒå±€ç»„ä»¶æ–‡ä»¶ src/components/layout.jsï¼š</p></li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123; children &#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">margin:</span> `<span class="attr">3rem</span> <span class="attr">auto</span>`, <span class="attr">maxWidth:</span> <span class="attr">650</span>, <span class="attr">padding:</span> `<span class="attr">0</span> <span class="attr">1rem</span>` &#125;&#125;&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol start="3"><li>åœ¨<code>src/pages/index.js</code>ä¸­ï¼ŒåŠ å…¥ Layout ç»„ä»¶ï¼Œ</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è®©æ•´ä½“é¡µé¢å±…ä¸­äº†ï¼Œè¿™é‡Œéƒ½æ˜¯ React çš„åŸºæœ¬æ“ä½œ</p><h2 id="è®¾ç½®-CSS-æ ·å¼"><a href="#è®¾ç½®-CSS-æ ·å¼" class="headerlink" title="è®¾ç½® CSS æ ·å¼"></a>è®¾ç½® CSS æ ·å¼</h2><p>Gatsby ä¸­æ ·å¼å¯ä»¥ä½¿ç”¨å¤šç§å½¢å¼ï¼Œæ™®é€šçš„ <code>import &#39;./xxx.css</code>æˆ‘ä»¬å°±ä¸è¯´äº†ã€‚</p><h3 id="ä½¿ç”¨å…¨å±€æ ·å¼"><a href="#ä½¿ç”¨å…¨å±€æ ·å¼" class="headerlink" title="ä½¿ç”¨å…¨å±€æ ·å¼"></a>ä½¿ç”¨å…¨å±€æ ·å¼</h3><p>æˆ‘ä»¬å‘ç½‘ç«™æ·»åŠ å…¨å±€æ ·å¼çš„æœ€ç›´æ¥çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨å…¨å±€ .css æ ·å¼è¡¨ã€‚</p><p>åœ¨ src ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹<code>styles</code>ï¼Œæ·»åŠ ä¸€ä¸ª global.css æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">html &#123;</span><br><span class="line">  background-color: #f5f5f5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ç›®å½•ä¸‹åˆ›å»º gatsby-browser.js ä¸­ï¼Œå°†æ ·å¼æ–‡ä»¶å¯¼å…¥</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &quot;.&#x2F;src&#x2F;styles&#x2F;global.css&quot;</span><br></pre></td></tr></table></figure><p>é‡å¯æœ¬åœ°æœåŠ¡ï¼Œå°±å‘ç°é¡µé¢èƒŒæ™¯å˜ä¸ºæµ…ç°è‰²äº†ã€‚</p><h3 id="ä½¿ç”¨-CSS-Module-ä¸ºç»„ä»¶è®¾ç½®æ ·å¼"><a href="#ä½¿ç”¨-CSS-Module-ä¸ºç»„ä»¶è®¾ç½®æ ·å¼" class="headerlink" title="ä½¿ç”¨ CSS Module ä¸ºç»„ä»¶è®¾ç½®æ ·å¼"></a>ä½¿ç”¨ CSS Module ä¸ºç»„ä»¶è®¾ç½®æ ·å¼</h3><p>CSS Module å¯ä»¥å‡å°‘å…¨å±€æ±¡æŸ“ã€é˜²æ­¢å‘½åå†²çªå’Œæ ·å¼çš„è¦†ç›–ã€‚</p><blockquote><p>CSS Module å®ç°åŸç†æ˜¯ï¼šå°†æ‰€æœ‰æ¨¡å—åŒ–çš„ç±»åï¼Œä¿®æ”¹ä¸ºæˆå”¯ä¸€çš„åç§°ï¼Œå³æ·»åŠ ä¸€äº›ä¸é‡å¤çš„å‰ç¼€æˆ–åç¼€ã€‚è¿™æ ·ä½¿å¾—é¡¹ç›®ä¸­ï¼Œä¸åŒäººå‘˜ç¼–å†™çš„æ ·å¼ä¸ä¼šå‡ºç°è¦†ç›–å’Œå†²çªã€‚</p></blockquote><ol><li>åˆ›å»º CSS æ–‡ä»¶ <code>src/styles/index.module.css</code></li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.title &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line">.text &#123;</span><br><span class="line">  color: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æ³•å¦‚ä¸‹ï¼š<code>src/pages/index.js</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React from &quot;react&quot;</span><br><span class="line">import Layout from &quot;..&#x2F;components&#x2F;layout&quot;</span><br><span class="line">import styles from &quot;..&#x2F;styles&#x2F;index.module.css&quot;</span><br><span class="line"></span><br><span class="line">export default function Home() &#123;</span><br><span class="line">  console.log(styles)</span><br><span class="line">  return (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;h1 className&#x3D;&#123;styles.title&#125;&gt;Hello World&lt;&#x2F;h1&gt;</span><br><span class="line">      &lt;div className&#x3D;&#123;styles.text&#125;&gt;Test&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;Layout&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d61d3f95cadf0?w=718&h=174&f=png&s=5935" alt=""></p><p>è¾“å‡º <code>styles</code>,å¯ä»¥çœ‹åˆ°è¢«å¯¼å…¥å¤„ç†çš„ç»“æœ:</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d61cc37846a59?w=514&h=68&f=png&s=6441" alt=""><br>å¦‚æœå°†å…¶ä¸ CSS æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œä½ ä¼šå‘ç°æ¯ä¸ªæ ¼å¼ç°åœ¨éƒ½æ˜¯å¯¼å…¥å¯¹è±¡ä¸­æŒ‡å‘é•¿å­—ç¬¦ä¸²çš„é”®ï¼ˆkeyï¼‰ï¼Œä¾‹å¦‚ <code>title</code> æŒ‡å‘ <code>index-module--title--1i-Wh</code>ã€‚ è¿™äº›æ ·å¼åç§°æ˜¯ CSS æ¨¡å—ç”Ÿæˆçš„ã€‚ ä¿è¯å®ƒä»¬åœ¨ä½ çš„ç½‘ç«™ä¸Šæ˜¯å”¯ä¸€çš„ã€‚ è€Œä¸”ç”±äºå¿…é¡»å¯¼å…¥å®ƒä»¬æ‰èƒ½ä½¿ç”¨è¿™äº›ç±»ï¼Œæ‰€ä»¥å¯¹äºåœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº› CSS æ ·å¼éƒ½æ²¡é—®é¢˜ã€‚</p><h3 id="å…¶ä»–å¤„ç†-CSS-çš„æ–¹å¼"><a href="#å…¶ä»–å¤„ç†-CSS-çš„æ–¹å¼" class="headerlink" title="å…¶ä»–å¤„ç† CSS çš„æ–¹å¼"></a>å…¶ä»–å¤„ç† CSS çš„æ–¹å¼</h3><p>ä½¿ç”¨ css æ ·å¼å°±ç‚¹åˆ°ä¸ºæ­¢äº†ï¼Œå…¶ä»–çš„æ¯”å¦‚ Sass ç­‰ï¼›è¿˜æœ‰ CSS in JS çš„æ–¹å¼ï¼Œæ¯”å¦‚ Emotion, Styled Componentã€‚å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹ç›¸åº”æ”¯æŒçš„ Gatsby æ’ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p><h2 id="è·å–-Gatsby-ä¸­çš„æ•°æ®"><a href="#è·å–-Gatsby-ä¸­çš„æ•°æ®" class="headerlink" title="è·å– Gatsby ä¸­çš„æ•°æ®"></a>è·å– Gatsby ä¸­çš„æ•°æ®</h2><p>å»ºç«‹ç½‘ç«™æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦é‡ç”¨ä¸€äº›å¸¸ç”¨çš„æ•°æ®â€”â€”æ¯”å¦‚å…¬ç”¨çš„ç½‘ç«™æ ‡é¢˜ã€ä½œè€…ä¿¡æ¯ç­‰ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åœ¨æ¯ä¸ªé¡µé¢éƒ½åŠ ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæ ‡é¢˜å­˜å‚¨åœ¨ä¸€ä¸ªä½ç½®ï¼Œç„¶åä»å…¶ä»–æ–‡ä»¶å¼•ç”¨è¯¥ä½ç½®å°±è¡Œäº†ï¼Œæ›´æ”¹çš„æ—¶å€™ä¹Ÿåªèƒ½æ›´æ”¹è¿™ä¸€å¤„åœ°æ–¹ã€‚</p><p>è¿™äº›å¸¸ç”¨æ•°æ®çš„å­˜æ”¾ä½ç½®å°±æ˜¯ <code>gatsby-config.js</code> æ–‡ä»¶ä¸­çš„ <code>siteMetadata</code> å¯¹è±¡ã€‚æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå†™å…¥ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  &#x2F;* Your site config here *&#x2F;</span><br><span class="line">  siteMetadata: &#123;</span><br><span class="line">    title: &#96;Title from siteMetadata&#96;,</span><br><span class="line">    author: &#39;jacky&#39;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><h3 id="ä½¿ç”¨é¡µé¢æŸ¥è¯¢"><a href="#ä½¿ç”¨é¡µé¢æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨é¡µé¢æŸ¥è¯¢"></a>ä½¿ç”¨é¡µé¢æŸ¥è¯¢</h3><p>ç¼–è¾‘ <code>src/pages/about.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'gatsby'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GraphQL è·å–çš„æ•°æ®ï¼Œä¼šå½“åšå‚æ•°ä¼ é€’åˆ°é¡µé¢ç»„ä»¶ä¸­</span></span><br><span class="line"><span class="comment">// æ•°æ®çš„å½¢å¼æ˜¯ &#123; errors, data &#125;ï¼Œæ²¡æœ‰é”™è¯¯åˆ™ä¸ä¼šæœ‰ errors</span></span><br><span class="line"><span class="keyword">const</span> About = <span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data.site.siteMetadata.title)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Title: &#123;data.site.siteMetadata.title&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;author: &#123;data.site.siteMetadata.author&#125;&lt;/</span>p&gt;</span><br><span class="line">      &lt;div&gt;about me&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> About</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> query = graphql<span class="string">`</span></span><br><span class="line"><span class="string">  query &#123;</span></span><br><span class="line"><span class="string">    site &#123;</span></span><br><span class="line"><span class="string">      siteMetadata &#123;</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">        author</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ‹‰å‡ºæ•°æ®äº†</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d63bec7bccdeb?w=576&h=188&f=png&s=10256" alt=""></p><p>å…¶ä¸­ï¼ŒGraphQL æŸ¥è¯¢è¯­å¥æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  site &#123;</span><br><span class="line">    siteMetadata &#123;</span><br><span class="line">      title,</span><br><span class="line">      author</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šæ‡µé€¼ï¼Œ site æ˜¯å“ªé‡Œæ¥çš„ï¼Œè¿™æ•°æ®æ ¼å¼æ€ä¹ˆæ˜¯è¿™æ ·ï¼Œè¿™å°±æ˜¯ GraphQL æŸ¥è¯¢è¯­å¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ Gatsby å†…ç½®çš„ GraphQL è°ƒè¯•ç•Œé¢ <code>http://localhost:8000/__graphql</code>ã€‚</p><p>è¿™é‡Œçš„<code>site</code>å³ä¸ºæˆ‘ä»¬<code>gatsby-config.js</code>å†™çš„ç«™ç‚¹é…ç½®ã€‚</p><p>ä¾æ¬¡ç‚¹å‡»å·¦è¾¹çš„<code>site</code>ã€<code>siteMetadata</code>ï¼Œç„¶åæœ‰æˆ‘ä»¬åˆšæ‰å†™çš„<code>title</code>,<code>author</code>å­—æ®µ ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œåœ¨ç‚¹å‡»çš„åŒæ—¶ï¼Œä¸­é—´çš„æ¡†ä¼šç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œæœ€åç‚¹å‡»è¿è¡ŒæŒ‰é’®ï¼Œä¼šè¾“å‡ºæŸ¥è¯¢ç»“æœã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d660d32ae1825?w=1442&h=642&f=png&s=61514" alt=""></p><p>å½“ä½ åé¢éœ€è¦è·å–æ›´å¤šå¤æ‚åµŒå¥—æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªç•Œé¢æ‰¾å’Œç‚¹å‡»ï¼Œè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢è¯­å¥å°±è¡Œäº†ã€‚</p><p>ç”±æˆ‘ä»¬è‡ªå·±å†™çš„æŸ¥è¯¢è¯­å¥ä¹ŸçŸ¥é“ï¼Œä¸Šé¢æˆ‘ä»¬ä»‹ç» GraphQL çš„æ—¶å€™è¯´çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œè·å–æ•°æ®ä¸å¤šä¸å°‘ï¼Œå³æˆ‘ä»¬å¯ä»¥é€‰æ‹©æƒ³è¦çš„æ•°æ®ï¼Œæ¯”å¦‚æˆ‘å°±æƒ³è·å–æ ‡é¢˜ä¸æƒ³è·å–ä½œè€…</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export const query &#x3D; graphql&#96;</span><br><span class="line">  query &#123;</span><br><span class="line">    site &#123;</span><br><span class="line">      siteMetadata &#123;</span><br><span class="line">        title</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#96;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨éé¡µé¢ç»„ä»¶æŸ¥è¯¢ï¼ˆé™æ€æŸ¥è¯¢ï¼‰"><a href="#ä½¿ç”¨éé¡µé¢ç»„ä»¶æŸ¥è¯¢ï¼ˆé™æ€æŸ¥è¯¢ï¼‰" class="headerlink" title="ä½¿ç”¨éé¡µé¢ç»„ä»¶æŸ¥è¯¢ï¼ˆé™æ€æŸ¥è¯¢ï¼‰"></a>ä½¿ç”¨éé¡µé¢ç»„ä»¶æŸ¥è¯¢ï¼ˆé™æ€æŸ¥è¯¢ï¼‰</h3><p>è¿™é‡Œæ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†ä¸¤ç§æ–¹å¼çš„æŸ¥è¯¢ï¼Œä¸Šé¢çš„ä¾‹å­çš„æŸ¥è¯¢æ–¹å¼ï¼Œåªé€‚ç”¨äºé¡µé¢æŸ¥è¯¢ï¼Œå³æ˜¯åœ¨<code>src/pages</code>ä¸‹çš„è·¯ç”±ç•Œé¢ï¼Œå¦‚æœåœ¨éé¡µé¢ç»„ä»¶ä¸‹è¿›è¡Œ GraphQL æŸ¥è¯¢ï¼Œåˆ™ä¸èƒ½ç”¨ä¸Šé¢çš„æ–¹å¼ï¼Œåº”è¯¥ä½¿ç”¨ <code>StaticQuery</code> ç»„ä»¶æˆ–è€… <code>useStaticQuery hook</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; é¡µé¢æŸ¥è¯¢</span><br><span class="line">export const query &#x3D; graphql&#96;</span><br><span class="line">    query&#123; ... &#125;</span><br><span class="line">&#96;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»„ä»¶<code>src/components/header.js</code></p><ul><li>StaticQuery</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; graphql, StaticQuery &#125; <span class="keyword">from</span> <span class="string">'gatsby'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Header = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;StaticQuery</span><br><span class="line">    query=&#123;graphql<span class="string">`</span></span><br><span class="line"><span class="string">      query &#123;</span></span><br><span class="line"><span class="string">        site &#123;</span></span><br><span class="line"><span class="string">          siteMetadata &#123;</span></span><br><span class="line"><span class="string">            author</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span>&#125;</span><br><span class="line">    render=&#123;data =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        site: &#123; siteMetadata &#125;,</span><br><span class="line">      &#125; = data</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>è¿™æ˜¯Headerç»„ä»¶ï¼Œä½œè€…æ˜¯ï¼š&#123;siteMetadata.author&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨ useStaticQuery æ–¹å¼</p><ul><li>useStaticQuery</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React from &quot;react&quot;</span><br><span class="line">import &#123; useStaticQuery, graphql &#125; from &quot;gatsby&quot;</span><br><span class="line"></span><br><span class="line">const Header &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">  const data &#x3D; useStaticQuery(</span><br><span class="line">    graphql&#96;</span><br><span class="line">      query &#123;</span><br><span class="line">        site &#123;</span><br><span class="line">          siteMetadata &#123;</span><br><span class="line">            author</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#96;</span><br><span class="line">  )</span><br><span class="line">  return &lt;div&gt;è¿™æ˜¯Headerç»„ä»¶ï¼Œä½œè€…æ˜¯ï¼š&#123;data.site.siteMetadata.author&#125;&lt;&#x2F;div&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Header</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>src/pages/index.js</code>ä¸­å¼•å…¥ Header ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'../components/header'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'../styles/index.module.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;Header /&gt;</span><br><span class="line">      &lt;h1 className=&#123;styles.title&#125;&gt;Hello World&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div className=&#123;styles.text&#125;&gt;Test&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d6d9b2afff80c?w=705&h=203&f=png&s=8464" alt=""></p><h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><h3 id="gatsby-source-filesystem"><a href="#gatsby-source-filesystem" class="headerlink" title="gatsby-source-filesystem"></a>gatsby-source-filesystem</h3><p>è¿™ä¸ªæ˜¯ Gatsby çš„æ•°æ®æºæ’ä»¶ï¼Œå³é€šè¿‡è¯¥æ’ä»¶å°†å„æ–¹é¢çš„æ•°æ®è½¬æ¢ä¸ºæœ¬åœ°èƒ½å¤Ÿé€šè¿‡ GraphQL æå–çš„å†…å®¹ï¼Œç”¨äºè®¾ç½®é¡¹ç›®çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><ul><li>å®‰è£…æ’ä»¶</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save gatsby-source-filesystem</span><br></pre></td></tr></table></figure><ul><li>åœ¨ gatsby-config.js æ–‡ä»¶é…ç½®</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  siteMetadata: &#123;</span><br><span class="line">    title: <span class="string">`Title from siteMetadata`</span>,</span><br><span class="line">    author: <span class="string">'jacky'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      resolve: <span class="string">`gatsby-source-filesystem`</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        name: <span class="string">`src`</span>, <span class="comment">// åç§°ï¼Œå¯ä»¥ç”¨æ¥è¿‡æ»¤</span></span><br><span class="line">        path: <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/src/`</span>, <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><p>æ‰“å¼€<code>http://localhost:8000/__graphql</code>ï¼Œå…³æ³¨<code>allFile</code>å’Œ<code>file</code>ä¸¤ä¸ªå¯é€‰é¡¹ã€‚</p><p>æˆ‘ä»¬ç‚¹å‡» <code>allFile</code>è¿™ä¸ªå¯é€‰é¡¹ï¼Œä¾æ¬¡é€‰æ‹©å¦‚ä¸‹å›¾</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d74ca7b60229d?w=1542&h=928&f=png&s=113095" alt=""></p><p>è¿™é‡Œæˆ‘ä»¬è¦çŸ¥é“ï¼Œæˆ‘ä»¬è¦æŸ¥è¯¢çš„æ•°æ®åŸºæœ¬åœ¨<code>edges.node</code>ä¸‹ï¼ŒèŠ‚ç‚¹ <code>node</code>æ˜¯å›¾ï¼ˆgraphï¼‰ä¸­ä¸€ä¸ªå¯¹è±¡çš„ç‰¹æ®Šç§°å‘¼ï¼Œæ¯ä¸ª File èŠ‚ç‚¹éƒ½åŒ…å«äº†ä½ è¦æŸ¥è¯¢çš„å­—æ®µã€‚</p><p>æˆ‘ä»¬é€‰æ‹©çš„<code>id</code>,<code>relativePath</code>,<code>name</code>å­—æ®µéƒ½å¯¹åº”æˆ‘ä»¬ <code>src</code>ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶, è¿˜æœ‰å¾ˆå¤šå…¶ä»–å­—æ®µå¯é€‰æ‹©ï¼Œç”±æ­¤å¯çŸ¥æˆ‘ä»¬åˆ›å»ºçš„ 7 ä¸ªæ–‡ä»¶çš„å„ç§ä¿¡æ¯ã€‚</p><p>æ—¢ç„¶è¿™é‡Œèƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œè¯´æ˜æˆ‘ä»¬ç»„ä»¶é‡Œé¢ä¹Ÿèƒ½æŸ¥å‡ºæ¥ç„¶åä½¿ç”¨æ•°æ®ï¼Œæ¯”å¦‚ä½ å¯ä»¥ä»ç»„ä»¶ä¸­æŸ¥è¯¢å‡ºæ¥åšä¸ªæ–‡ä»¶åˆ—è¡¨ã€‚</p><p>è¿™ä¸ªç›¸æ¯”ä¼ ç»Ÿçš„ React é¡¹ç›®å°±æŒºå‰å®³äº†ï¼Œä¸ç”¨åšä»€ä¹ˆå¤æ‚çš„å·¥ä½œï¼Œå°±èƒ½è½»æ¾æ‹¿ä¸‹è¿™äº›æ•°æ®ã€‚Gatsby æ¯”è¾ƒå¼ºå¤§çš„å°±æ˜¯å®ƒçš„ç”Ÿæ€äº†ï¼Œå¾ˆå¤šæ’ä»¶éƒ½é…å¥½äº†ï¼Œæ›´å¤šæ’ä»¶å¯ä»¥çœ‹å®˜ç½‘çš„æ’ä»¶åº“ä»‹ç»ï¼š<a href="https://www.gatsbyjs.org/plugins/" target="_blank" rel="noopener">https://www.gatsbyjs.org/plugins/</a></p><h3 id="gatsby-transformer-remark"><a href="#gatsby-transformer-remark" class="headerlink" title="gatsby-transformer-remark"></a>gatsby-transformer-remark</h3><p>è¿™ä¸ªæ˜¯æ•°æ®è½¬æ¢æ’ä»¶ï¼Œæˆ‘ä»¬ç”¨ Gatsby åšä¸ªäººåšå®¢çš„è¯ï¼Œå®ƒå¯å¿…ä¸å¯å°‘ã€‚ç°åœ¨æˆ‘ä»¬ç¨‹åºå‘˜å†™åšå®¢åŸºæœ¬æ˜¯ç”¨ markdown è¯­æ³•äº†ï¼Œåšä¸€ä¸ªåšå®¢çš„è¯ï¼Œä¸å¯ç¼ºå°‘çš„å°±æ˜¯å¯¹ markdown è¯­æ³•çš„è§£æã€‚</p><ul><li>å®‰è£…æ’ä»¶</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save gatsby-transformer-remark</span><br></pre></td></tr></table></figure><ul><li>åœ¨ gatsby-config.js æ–‡ä»¶é…ç½®</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/* Your site config here */</span></span><br><span class="line">  siteMetadata: &#123;</span><br><span class="line">    title: <span class="string">`Title from siteMetadata`</span>,</span><br><span class="line">    author: <span class="string">'jacky'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      resolve: <span class="string">`gatsby-source-filesystem`</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        name: <span class="string">`src`</span>, <span class="comment">// åç§°ï¼Œå¯ä»¥ç”¨æ¥è¿‡æ»¤</span></span><br><span class="line">        path: <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/src/`</span>, <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">`gatsby-transformer-remark`</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><p>è¿™ä¸ªæ’ä»¶æ·»åŠ äº† allMarkdownRemark å’Œ markdownRemark ä¸¤ä¸ªæ•°æ®å­—æ®µ</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d7761605cba2b?w=205&h=243&f=png&s=7538" alt=""></p><ul><li>æ–°å»º md æ–‡ä»¶</li></ul><p>åœ¨<code>src</code>ä¸‹åˆ›å»º<code>_posts</code>ç›®å½•ï¼Œæ·»åŠ ä¸€ä¸ª<code>first-blog.md</code>æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: &quot;æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢&quot;</span><br><span class="line">date: &quot;2020-06-21&quot;</span><br><span class="line">tags: &quot;React&quot;</span><br><span class="line">categories: &quot;Reactç³»åˆ—&quot;</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## è¿™æ˜¯ç¬¬ä¸€ç¯‡åšå®¢çš„æ ‡é¢˜</span><br><span class="line"></span><br><span class="line">first blog çš„å†…å®¹ 1</span><br></pre></td></tr></table></figure><p>å¦‚æœåšå®¢ä¸æ˜¯è‡ªå·±æ­å»ºçš„ï¼Œè€Œæ˜¯ç›´æ¥ä¸ŠæŸå¹³å°å†™çš„è¯ï¼Œå¯¹ä¸Šé¢è¿™æ®µè¯­æ³•å°±å¯èƒ½ä¸å¤ªäº†è§£ï¼Œåœ¨ md æ–‡ä»¶å¼€å¤´çš„ <code>---</code> åŒ…è£¹çš„æ˜¯ frontmatterï¼ˆå‰è¨€ï¼‰ï¼Œç„¶ååœ¨é‡Œé¢å¯ä»¥æ·»åŠ æ–‡ç« çš„å„ç§å…³é”®è¯ä¿¡æ¯ã€‚</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>http://localhost:8000/__graphql</code>æŸ¥è¯¢åˆ°æˆ‘ä»¬å†™çš„ md æ–‡ä»¶çš„è¯¦æƒ…ä¿¡æ¯äº†</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d7823d4e7db7f?w=1703&h=499&f=png&s=61510" alt=""></p><p>æˆ‘ä»¬ç¨å¾®å†æ”¹åŠ¨ï¼Œåˆ›å»ºå¤šä¸¤ä¸ª md æ–‡ä»¶</p><p><code>second-blog.md</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: &quot;æˆ‘çš„ç¬¬äºŒç¯‡åšå®¢&quot;</span><br><span class="line">date: &quot;2020-06-22&quot;</span><br><span class="line">tags: &quot;Vue&quot;</span><br><span class="line">categories: &quot;Vueç³»åˆ—&quot;</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## è¿™æ˜¯ç¬¬äºŒç¯‡åšå®¢çš„æ ‡é¢˜</span><br><span class="line"></span><br><span class="line">second blog çš„å†…å®¹ 2</span><br></pre></td></tr></table></figure><p><code>third-blog.md</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: &quot;æˆ‘çš„ç¬¬ä¸‰ç¯‡åšå®¢&quot;</span><br><span class="line">date: &quot;2020-06-23&quot;</span><br><span class="line">tags: &quot;React&quot;</span><br><span class="line">categories: &quot;Reactç³»åˆ—&quot;</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## è¿™æ˜¯ç¬¬ä¸‰ç¯‡åšå®¢çš„æ ‡é¢˜</span><br><span class="line"></span><br><span class="line">third blog çš„å†…å®¹ 3</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥è¯¢æ•°æ®ï¼ŒæŠŠæˆ‘ä»¬åˆšåˆšæ·»åŠ çš„æ–‡ç« æ•°æ®éƒ½æ‹¿ä¸‹æ¥äº†</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/21/172d78dc41c94349?w=599&h=687&f=png&s=41548" alt=""></p><p>æ—¢ç„¶ GraphQL èƒ½æ‹¿åˆ°æ•°æ®ï¼Œè¯´æ˜æˆ‘ä»¬ä¹Ÿèƒ½æŠŠå®ƒæ”¾åˆ°é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚</p><p>æ–°å»ºæ–‡ä»¶<code>src/pages/blog.js</code>,æˆ‘ä»¬åšä¸€ä¸ªåšå®¢ç›®å½•æ±‡æ€»ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span></span><br><span class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'gatsby'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Blog = <span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;h1&gt;åšå®¢ç›®å½•&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &#123;data.allMarkdownRemark.edges.map((&#123; node &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return (</span></span><br><span class="line"><span class="regexp">            &lt;div</span></span><br><span class="line"><span class="regexp">              key=&#123;node.id&#125;</span></span><br><span class="line"><span class="regexp">              style=&#123;&#123;</span></span><br><span class="line"><span class="regexp">                border: '1px solid #000',</span></span><br><span class="line"><span class="regexp">                margin: '10px',</span></span><br><span class="line"><span class="regexp">                padding: '10px',</span></span><br><span class="line"><span class="regexp">              &#125;&#125;</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              &lt;h2&gt;&#123;node.frontmatter.title&#125;&lt;/</span>h2&gt;</span><br><span class="line">              &lt;div&gt;åˆ†ç±»&#123;node.frontmatter.categories&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              &lt;div&gt;æ ‡ç­¾ï¼š&#123;node.frontmatter.tags&#125;&lt;/</span>div&gt;</span><br><span class="line">              &lt;div&gt;å‘å¸ƒæ—¶é—´ï¼š&#123;node.frontmatter.date&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Layout&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Blog</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> query = graphql<span class="string">`</span></span><br><span class="line"><span class="string">  query &#123;</span></span><br><span class="line"><span class="string">    allMarkdownRemark &#123;</span></span><br><span class="line"><span class="string">      edges &#123;</span></span><br><span class="line"><span class="string">        node &#123;</span></span><br><span class="line"><span class="string">          id</span></span><br><span class="line"><span class="string">          frontmatter &#123;</span></span><br><span class="line"><span class="string">            tags</span></span><br><span class="line"><span class="string">            title</span></span><br><span class="line"><span class="string">            date</span></span><br><span class="line"><span class="string">            categories</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>http://localhost:8000/blog</code>ï¼Œåšå®¢ç›®å½•å°±å±•ç¤ºå‡ºæ¥äº†ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/23/172e1b12d01e3ba3?w=722&h=601&f=png&s=36586" alt=""></p><p>ä½†æœ‰ä¸ªé—®é¢˜ï¼Œæ¯ç¯‡åšå®¢çš„ä¿¡æ¯ç¡®å®èƒ½æ‹¿å‡ºæ¥ï¼Œä½†æ˜¯æˆ‘ä»¬è¦é“¾æ¥å•Šï¼Œå³æ˜¯ç‚¹å‡»åšå®¢æ ‡é¢˜ï¼Œè¿›å…¥åšå®¢è¯¦æƒ…é¡µé¢ï¼Œå³æ˜¯æ–‡ç« è·¯å¾„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºé¡µé¢ã€‚</p><h2 id="åˆ©ç”¨æ•°æ®åˆ›å»ºé¡µé¢"><a href="#åˆ©ç”¨æ•°æ®åˆ›å»ºé¡µé¢" class="headerlink" title="åˆ©ç”¨æ•°æ®åˆ›å»ºé¡µé¢"></a>åˆ©ç”¨æ•°æ®åˆ›å»ºé¡µé¢</h2><h3 id="gatsby-node-js-1"><a href="#gatsby-node-js-1" class="headerlink" title="gatsby-node.js"></a>gatsby-node.js</h3><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦å»ºç«‹<code>gatsby-node.js</code>æ–‡ä»¶äº†ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢çš„ä»£ç æ˜¯ node å±‚ç›¸å…³çš„ã€‚</p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ <code>src/pages</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šå…¨éƒ¨æ¸²æŸ“æˆè·¯ç”±ï¼Œä½†å¦‚æœæˆ‘ä»¬åšå®¢æ–‡ç« ä¸€ç¯‡ç¯‡çš„è¯¦æƒ…é¡µè¦æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ª js æ–‡ä»¶ï¼Œè¿™è‚¯å®šä¸åˆç†äº†ã€‚</p><p>æˆ‘ä»¬ä¼šç”¨åˆ°ä¸¤ä¸ª APIï¼š</p><h4 id="onCreateNode"><a href="#onCreateNode" class="headerlink" title="onCreateNode"></a>onCreateNode</h4><p>æ¯å½“åˆ›å»ºæ–°èŠ‚ç‚¹ï¼ˆæˆ–æ›´æ–°ï¼‰æ—¶ï¼ŒGatsby éƒ½ä¼šè°ƒç”¨ onCreateNode å‡½æ•°ã€‚</p><p>å‘<code>gatsby-node.js</code>å†™å…¥ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">exports.onCreateNode = <span class="function">(<span class="params">&#123; node &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(node.internal.type)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹ç»ˆç«¯ï¼Œä½ ä¼šå‘ç°æ‰“å°å‡ºå¾ˆå¤šåˆ›å»ºçš„èŠ‚ç‚¹ï¼š<code>SitePage</code>, <code>SitePlugin</code>, <code>Site</code>, <code>SiteBuildMetadata</code>, <code>Directory</code>, <code>File</code>, <code>MarkdownRemark</code>,æˆ‘ä»¬å…³æ³¨çš„åªæœ‰<code>MarkdownRemark</code>ï¼Œäºæ˜¯ä¿®æ”¹å‡½æ•°ä½¿å…¶ä»…ä»…è®°å½• MarkdownRemark èŠ‚ç‚¹ï¼›æˆ‘ä»¬ä½¿ç”¨æ¯ä¸€ä¸ª md æ–‡ä»¶çš„åç§°æ¥ä½œä¸ºè·¯å¾„ï¼Œå¦‚è¦è·å–æ–‡ä»¶åç§°ï¼Œä½ éœ€è¦éå†ä¸€éå®ƒçš„çˆ¶èŠ‚ç‚¹ <code>File</code>ï¼Œ<code>File</code>èŠ‚ç‚¹åŒ…å«äº†æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ•°æ®ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">exports.onCreateNode = <span class="function">(<span class="params">&#123; node, getNode &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (node.internal.type === <span class="string">`MarkdownRemark`</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> fileNode = getNode(node.parent)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`\n`</span>, fileNode.relativePath)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹ç»ˆç«¯ï¼Œæ‰“å°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_posts&#x2F;first-blog.md</span><br><span class="line"></span><br><span class="line">_posts&#x2F;second-blog.md</span><br><span class="line"></span><br><span class="line">_posts&#x2F;third-blog.md</span><br></pre></td></tr></table></figure><p>ç›¸å¯¹è·¯å¾„å‡ºæ¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦åˆ›å»ºè·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨<code>gatsby-source-filesystem</code>æ’ä»¶å¸¦çš„åˆ›å»ºè·¯å¾„çš„å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createFilePath &#125; = <span class="built_in">require</span>(<span class="string">`gatsby-source-filesystem`</span>)</span><br><span class="line"></span><br><span class="line">exports.onCreateNode = <span class="function">(<span class="params">&#123; node, getNode &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (node.internal.type === <span class="string">`MarkdownRemark`</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(createFilePath(&#123; node, getNode, <span class="attr">basePath</span>: <span class="string">`pages`</span> &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;_posts&#x2F;first-blog&#x2F;</span><br><span class="line">&#x2F;_posts&#x2F;second-blog&#x2F;</span><br><span class="line">&#x2F;_posts&#x2F;third-blog&#x2F;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå‘ API ä¼ é€’ä¸€ä¸ªå‡½æ•°<code>createNodeField</code>ï¼Œè¯¥å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨å…¶ä»–æ’ä»¶åˆ›å»ºçš„èŠ‚ç‚¹é‡Œåˆ›å»ºå…¶ä»–å­—æ®µã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">exports.onCreateNode = <span class="function">(<span class="params">&#123; node, getNode, actions &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; createNodeField &#125; = actions</span><br><span class="line">  <span class="keyword">if</span> (node.internal.type === <span class="string">`MarkdownRemark`</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> slug = createFilePath(&#123; node, getNode, <span class="attr">basePath</span>: <span class="string">`pages`</span> &#125;)</span><br><span class="line">    createNodeField(&#123;</span><br><span class="line">      node,</span><br><span class="line">      name: <span class="string">`slug`</span>,</span><br><span class="line">      value: slug, <span class="comment">// é€šå¸¸ç”¨ slug ä¸€è¯ä»£è¡¨è·¯å¾„</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼Œæ‰“å¼€<code>http://localhost:8000/__graphql</code>ï¼Œå°±èƒ½æŸ¥è¯¢åˆ°è·¯å¾„äº†</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/23/172e1ce4c0a61cae?w=1097&h=448&f=png&s=28484" alt=""></p><h4 id="createPages"><a href="#createPages" class="headerlink" title="createPages"></a>createPages</h4><p>createPages è¿™ä¸ª API ç”¨äºæ·»åŠ é¡µé¢ã€‚åœ¨åˆ›å»ºé¡µé¢ä¹‹å‰ï¼Œé¦–å…ˆè¦æœ‰é¡µé¢æ¨¡æ¿ï¼Œè¿™æ ·åˆ›å»ºé¡µé¢å°±èƒ½æŒ‡å®šæ‰€ä½¿ç”¨çš„æ¨¡æ¿äº†ã€‚</p><p>æ–°å»ºæ–‡ä»¶<code>src/templates/blog-post.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;div&gt;Hello blog post&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Layout&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ›´æ”¹ <code>gatsby-node.js</code>çš„<code>createPages</code>å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">`path`</span>)</span><br><span class="line"></span><br><span class="line">exports.createPages = <span class="keyword">async</span> (&#123; graphql, actions &#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> graphql(<span class="string">`</span></span><br><span class="line"><span class="string">    query &#123;</span></span><br><span class="line"><span class="string">      allMarkdownRemark &#123;</span></span><br><span class="line"><span class="string">        edges &#123;</span></span><br><span class="line"><span class="string">          node &#123;</span></span><br><span class="line"><span class="string">            fields &#123;</span></span><br><span class="line"><span class="string">              slug</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span>)</span><br><span class="line">  result.data.allMarkdownRemark.edges.forEach(<span class="function">(<span class="params">&#123; node &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    createPage(&#123;</span><br><span class="line">      path: node.fields.slug,</span><br><span class="line">      component: path.resolve(<span class="string">`./src/templates/blog-post.js`</span>),</span><br><span class="line">      context: &#123;</span><br><span class="line">        slug: node.fields.slug,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªè·¯å¾„ï¼Œè·³è½¬åˆ°é»˜è®¤çš„ 404 é¡µé¢ï¼Œå°±ä¼šçœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆä¸‰ç¯‡åšå®¢çš„è·¯å¾„äº†ï¼Œç‚¹å‡»ä»»ä¸€ç¯‡ï¼Œè·³è½¬çš„æ˜¯æˆ‘ä»¬åˆšåˆ›å»ºçš„ <code>blog-post.js</code>ç»„ä»¶ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/24/172e3bb13a244d4c?w=1230&h=548&f=png&s=51476" alt=""></p><p>æˆ‘ä»¬è¦çš„æ˜¯æ˜¾ç¤ºåšå®¢å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æ¨¡æ¿æ–‡ä»¶å†è¿›è¡Œæ”¹é€ ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'gatsby'</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123; data &#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> post = data.markdownRemark</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;post.frontmatter.title&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div dangerouslySetInnerHTML=&#123;&#123; __html: post.html &#125;&#125; /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Layout&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> query = graphql<span class="string">`</span></span><br><span class="line"><span class="string">  query($slug: String!) &#123;</span></span><br><span class="line"><span class="string">    markdownRemark(fields: &#123; slug: &#123; eq: $slug &#125; &#125;) &#123;</span></span><br><span class="line"><span class="string">      html</span></span><br><span class="line"><span class="string">      frontmatter &#123;</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯åŠ¨æ€å˜é‡æŸ¥è¯¢çš„å†™æ³•ï¼ŒGraphQL çš„è¯­æ³•ï¼Œå¯ä»¥çœ‹çœ‹ (<a href="https://graphql.org/learn/queries/#variables" target="_blank" rel="noopener">https://graphql.org/learn/queries/#variables</a>)</p><p>å®Œæˆä¹‹åï¼Œæ¯”å¦‚æˆ‘ç‚¹å‡»ç¬¬äºŒç¯‡åšå®¢ï¼Œå°±å¯ä»¥æ­£ç¡®è¿›å…¥é¡µé¢å¹¶æ˜¾ç¤ºå†…å®¹äº†</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/24/172e3c8f759609dd?w=757&h=255&f=png&s=18207" alt=""></p><p>ä¸ºäº†æ›´å®Œå–„ï¼Œæˆ‘ä»¬ç»™ blog ç›®å½•é¡µé¢æ·»åŠ å¯è·³è½¬çš„é“¾æ¥ï¼ŒåŠ å…¥ <code>slug</code>æŸ¥è¯¢å­—æ®µ, å¢åŠ  <code>Link</code>è·³è½¬ï¼Œè¿™ä¸ªç”¨æ³•ä¸ React è·¯ç”±çš„ <code>Link</code>å·®ä¸å¤šä¸€è‡´ï¼Œæ¶‰åŠä¸æ·±çš„æƒ…å†µä¸‹æš‚ä¸”å½“æˆç›¸åŒç”¨æ³•ã€‚</p><p><code>src/pages/blog.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span></span><br><span class="line"><span class="keyword">import</span> &#123; graphql, Link &#125; <span class="keyword">from</span> <span class="string">'gatsby'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Blog = <span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;h1&gt;åšå®¢ç›®å½•&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &#123;data.allMarkdownRemark.edges.map((&#123; node &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return (</span></span><br><span class="line"><span class="regexp">            &lt;Link to=&#123;node.fields.slug&#125; key=&#123;node.id&#125;&gt;</span></span><br><span class="line"><span class="regexp">              &lt;div</span></span><br><span class="line"><span class="regexp">                style=&#123;&#123;</span></span><br><span class="line"><span class="regexp">                  border: '1px solid #000',</span></span><br><span class="line"><span class="regexp">                  margin: '10px',</span></span><br><span class="line"><span class="regexp">                  padding: '10px',</span></span><br><span class="line"><span class="regexp">                &#125;&#125;</span></span><br><span class="line"><span class="regexp">              &gt;</span></span><br><span class="line"><span class="regexp">                &lt;h2&gt;&#123;node.frontmatter.title&#125;&lt;/</span>h2&gt;</span><br><span class="line">                &lt;div&gt;åˆ†ç±»&#123;node.frontmatter.categories&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div&gt;æ ‡ç­¾ï¼š&#123;node.frontmatter.tags&#125;&lt;/</span>div&gt;</span><br><span class="line">                &lt;div&gt;å‘å¸ƒæ—¶é—´ï¼š&#123;node.frontmatter.date&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>div&gt;</span><br><span class="line">            &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">          )</span></span><br><span class="line"><span class="regexp">        &#125;)&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Blog</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export const query = graphql`</span></span><br><span class="line"><span class="regexp">  query &#123;</span></span><br><span class="line"><span class="regexp">    allMarkdownRemark &#123;</span></span><br><span class="line"><span class="regexp">      edges &#123;</span></span><br><span class="line"><span class="regexp">        node &#123;</span></span><br><span class="line"><span class="regexp">          id</span></span><br><span class="line"><span class="regexp">          frontmatter &#123;</span></span><br><span class="line"><span class="regexp">            tags</span></span><br><span class="line"><span class="regexp">            title</span></span><br><span class="line"><span class="regexp">            date</span></span><br><span class="line"><span class="regexp">            categories</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">          fields &#123;</span></span><br><span class="line"><span class="regexp">            slug</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">`</span></span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2020/6/24/172e3ce7be50852c?w=722&h=596&f=png&s=36793" alt=""></p><p>ç°åœ¨ç‚¹å‡»åšå®¢ï¼Œå°±èƒ½è·³è½¬åˆ°å¯¹åº”é¡µé¢äº†ï¼Œè™½ç„¶æ²¡åšæ ·å¼é¡µé¢æ¯”è¾ƒä¸‘ï¼Œä½†åªè¦åœ¨<code>src/_posts</code>ç›®å½•æ–°å»º md æ–‡ä»¶ï¼Œç„¶åè¿™é‡Œå°±èƒ½è·Ÿç€è‡ªåŠ¨åˆ·æ–°ï¼Œç®—æ˜¯ä¸€ä¸ªè¶…ç®€æ˜“çš„åšå®¢äº†ã€‚</p><h2 id="æ‰“åŒ…ä¸Šçº¿"><a href="#æ‰“åŒ…ä¸Šçº¿" class="headerlink" title="æ‰“åŒ…ä¸Šçº¿"></a>æ‰“åŒ…ä¸Šçº¿</h2><p>åœæ­¢å¼€å‘æœåŠ¡ï¼Œæ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼ŒæŠŠé™æ€æ–‡ä»¶è¾“å‡ºåˆ° public ç›®å½•ä¸­</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gatsby build</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬åœ°æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬ï¼Œè¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gatsby serve</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥åœ¨<code>localhost:9000</code>è®¿é—®æˆ‘ä»¬åˆšæ‰åšçš„ç½‘ç«™äº†</p><p>æœ¬é¡¹ç›®çš„ <a href="https://github.com/Jacky-Summer/gatsby-blog-demo" target="_blank" rel="noopener">github åœ°å€</a></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ•™ç¨‹å°±ä»‹ç»åˆ°è¿™é‡Œäº†ã€‚</p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>SSR</tag>
        <tag>Gatsby</tag>
        <tag>GraphQL</tag>
      </tags>
  </entry>
  <entry>
    <title>å®Œå…¨ææ‡‚ BFC</title>
    <url>/2020/07/05/%E5%AE%8C%E5%85%A8%E6%90%9E%E6%87%82-BFC/</url>
    <content><![CDATA[<p>BFC æ˜¯ CSS ä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼Œä¹Ÿæ˜¯é¢è¯•ç»å¸¸è€ƒæŸ¥çš„ç‚¹â€¦</p>
<a id="more"></a>

<h2 id="ä»€ä¹ˆæ˜¯-BFC"><a href="#ä»€ä¹ˆæ˜¯-BFC" class="headerlink" title="ä»€ä¹ˆæ˜¯ BFC"></a>ä»€ä¹ˆæ˜¯ BFC</h2><p>BFC å…¨ç§°æ˜¯ Block Formatting Contextï¼Œå³å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚</p>
<p>é™¤äº† BFCï¼Œè¿˜æœ‰ï¼š</p>
<ul>
<li>IFCï¼ˆè¡Œçº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰- inline å†…è”</li>
<li>GFCï¼ˆç½‘æ ¼å¸ƒå±€æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰- <code>display: grid</code></li>
<li>FFCï¼ˆè‡ªé€‚åº”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰- <code>display: flex</code>æˆ–<code>display: inline-flex</code></li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šåŒä¸€ä¸ªå…ƒç´ ä¸èƒ½åŒæ—¶å­˜åœ¨äºä¸¤ä¸ª BFC ä¸­</p>
</blockquote>
<p>å®ƒæ˜¯ Web é¡µé¢çš„å¯è§† CSS æ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å—ç›’å­çš„å¸ƒå±€è¿‡ç¨‹å‘ç”Ÿçš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–å…ƒç´ äº¤äº’çš„åŒºåŸŸã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿå®é™…å°±æ˜¯è¯´ BFC æ˜¯ä¸€ä¸ªæ¸²æŸ“åŒºåŸŸï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„ä¸€å¥—æ¸²æŸ“è§„åˆ™ï¼Œä½¿å…¶å†…éƒ¨å¸ƒå±€çš„å…ƒç´ å…·æœ‰ä¸€äº›ç‰¹æ€§ã€‚</p>
<p><strong>BFC æä¾›ä¸€ä¸ªç‹¬ç«‹çš„å¸ƒå±€ç¯å¢ƒï¼ŒBFC å†…éƒ¨çš„å…ƒç´ å¸ƒå±€ä¸å¤–éƒ¨äº’ä¸å½±å“ã€‚</strong></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/17318faf333483aa?w=798&h=317&f=png&s=23237" alt=""></p>
<h2 id="å—çº§å…ƒç´ "><a href="#å—çº§å…ƒç´ " class="headerlink" title="å—çº§å…ƒç´ "></a>å—çº§å…ƒç´ </h2><p>CSS å±æ€§å€¼ display ä¸º blockï¼Œlist-itemï¼Œtable çš„å…ƒç´ ã€‚</p>
<p>å—çº§ç›’å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>CSS å±æ€§å€¼ display ä¸º blockï¼Œlist-itemï¼Œtable æ—¶ï¼Œå®ƒå°±æ˜¯å—çº§å…ƒç´ </li>
<li>å¸ƒå±€ä¸Šï¼Œå—çº§ç›’å‘ˆç°ä¸ºç«–ç›´æ’åˆ—çš„å—</li>
<li>æ¯ä¸ªå—çº§ç›’éƒ½ä¼šå‚ä¸ BFC çš„åˆ›å»º</li>
<li>æ¯ä¸ªå—çº§å…ƒç´ éƒ½ä¼šè‡³å°‘ç”Ÿæˆä¸€ä¸ªå—çº§ç›’ï¼Œç§°ä¸ºä¸»å—çº§ç›’ï¼›ä¸€äº›å…ƒç´ å¯èƒ½ä¼šç”Ÿæˆé¢å¤–çš„å—çº§ç›’ï¼Œæ¯”å¦‚ <code>&lt;li&gt;</code>ï¼Œç”¨æ¥å­˜æ”¾é¡¹ç›®ç¬¦å·</li>
</ul>
<h2 id="åˆ›å»º-BFC"><a href="#åˆ›å»º-BFC" class="headerlink" title="åˆ›å»º BFC"></a>åˆ›å»º BFC</h2><p>ä»¥ä¸‹å…ƒç´ ä¼šåˆ›å»º BFC</p>
<ul>
<li>æ ¹å…ƒç´ ï¼ˆ<code>&lt;html&gt;</code>ï¼‰</li>
<li>æµ®åŠ¨å…ƒç´ ï¼ˆ<code>float</code>ä¸ä¸º<code>none</code>ï¼‰</li>
<li>ç»å¯¹å®šä½å…ƒç´ ï¼ˆ<code>position</code>ä¸º<code>absolute</code>æˆ–<code>fixed</code>ï¼‰</li>
<li>è¡¨æ ¼çš„æ ‡é¢˜å’Œå•å…ƒæ ¼ï¼ˆ<code>display</code> ä¸º <code>table-caption</code>ï¼Œ<code>table-cell</code>ï¼‰</li>
<li>åŒ¿åè¡¨æ ¼å•å…ƒæ ¼å…ƒç´ ï¼ˆ<code>display</code> ä¸º <code>table</code> æˆ– <code>inline-table</code>ï¼‰</li>
<li>è¡Œå†…å—å…ƒç´ ï¼ˆ<code>display</code> ä¸º <code>inline-block</code>ï¼‰</li>
<li><code>overflow</code> çš„å€¼ä¸ä¸º <code>visible</code> çš„å…ƒç´ </li>
<li>å¼¹æ€§å…ƒç´ ï¼ˆ<code>display</code> ä¸º <code>flex</code> æˆ– <code>inline-flex</code> çš„å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰</li>
<li>ç½‘æ ¼å…ƒç´ ï¼ˆ<code>display</code> ä¸º <code>grid</code> æˆ– <code>inline-grid</code> çš„å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰</li>
</ul>
<p>ä»¥ä¸Šæ˜¯ CSS2.1 è§„èŒƒå®šä¹‰çš„ BFC è§¦å‘æ–¹å¼ï¼Œåœ¨æœ€æ–°çš„ CSS3 è§„èŒƒä¸­ï¼Œå¼¹æ€§å…ƒç´ å’Œç½‘æ ¼å…ƒç´ ä¼šåˆ›å»º F(Flex)FC å’Œ G(Grid)FCã€‚</p>
<h2 id="BFC-çš„ç‰¹æ€§"><a href="#BFC-çš„ç‰¹æ€§" class="headerlink" title="BFC çš„ç‰¹æ€§"></a>BFC çš„ç‰¹æ€§</h2><ul>
<li>BFC æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å­å…ƒç´ ä¸ä¼šå½±å“å¤–é¢çš„å…ƒç´ ã€‚</li>
<li>BFC å†…éƒ¨çš„å—çº§ç›’ä¼šåœ¨å‚ç›´æ–¹å‘ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªæ’åˆ—</li>
<li>åŒä¸€ BFC ä¸‹çš„ç›¸é‚»å—çº§å…ƒç´ å¯èƒ½å‘ç”Ÿå¤–è¾¹è·æŠ˜å ï¼Œåˆ›å»ºæ–°çš„ BFC å¯ä»¥é¿å…å¤–è¾¹è·æŠ˜å </li>
<li>æ¯ä¸ªå…ƒç´ çš„å¤–è¾¹è·ç›’ï¼ˆmargin boxï¼‰çš„å·¦è¾¹ä¸åŒ…å«å—è¾¹æ¡†ç›’ï¼ˆborder boxï¼‰çš„å·¦è¾¹ç›¸æ¥è§¦ï¼ˆä»å³å‘å·¦çš„æ ¼å¼çš„è¯ï¼Œåˆ™ç›¸åï¼‰ï¼Œå³ä½¿å­˜åœ¨æµ®åŠ¨</li>
<li>æµ®åŠ¨ç›’çš„åŒºåŸŸä¸ä¼šå’Œ BFC é‡å </li>
<li>è®¡ç®— BFC çš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å…ƒç´ ä¹Ÿä¼šå‚ä¸è®¡ç®—</li>
</ul>
<p>å¦‚æœä¸å¤ªç†è§£çš„ï¼Œåœ¨ä¸‹é¢ BFC çš„åº”ç”¨æˆ‘ä¼šæåŠã€‚</p>
<h2 id="BFC-çš„åº”ç”¨"><a href="#BFC-çš„åº”ç”¨" class="headerlink" title="BFC çš„åº”ç”¨"></a>BFC çš„åº”ç”¨</h2><h3 id="è‡ªé€‚åº”ä¸¤åˆ—å¸ƒå±€"><a href="#è‡ªé€‚åº”ä¸¤åˆ—å¸ƒå±€" class="headerlink" title="è‡ªé€‚åº”ä¸¤åˆ—å¸ƒå±€"></a>è‡ªé€‚åº”ä¸¤åˆ—å¸ƒå±€</h3><p>å·¦åˆ—æµ®åŠ¨ï¼ˆå®šå®½æˆ–ä¸å®šå®½éƒ½å¯ä»¥ï¼‰ï¼Œç»™å³åˆ—å¼€å¯ BFCã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* html ä»£ç  *&#x2F;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;left&quot;&gt;æµ®åŠ¨å…ƒç´ ï¼Œæ— å›ºå®šå®½åº¦&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;right&quot;&gt;è‡ªé€‚åº”&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;* css ä»£ç  *&#x2F;</span><br><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br><span class="line">.left &#123;</span><br><span class="line">    float: left;</span><br><span class="line">    height: 200px;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">    background-color: red;</span><br><span class="line">&#125;</span><br><span class="line">.right &#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    height: 200px;</span><br><span class="line">    background-color: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/1731a0544fd4461f?w=1919&h=234&f=png&s=13127" alt=""></p>
<ol>
<li>å°†å·¦åˆ—è®¾ä¸ºå·¦æµ®åŠ¨ï¼Œå°†è‡ªèº«é«˜åº¦å¡Œé™·ï¼Œä½¿å¾—å…¶å®ƒå—çº§å…ƒç´ å¯ä»¥å’Œå®ƒå æ®åŒä¸€è¡Œçš„ä½ç½®ã€‚</li>
<li>å³åˆ—ä¸º div å—çº§å…ƒç´ ï¼Œåˆ©ç”¨å…¶è‡ªèº«çš„æµç‰¹æ€§å æ»¡æ•´è¡Œã€‚</li>
<li>å³åˆ—è®¾ç½®<code>overflow: hidden</code>,è§¦å‘ BFC ç‰¹æ€§ï¼Œä½¿å…¶è‡ªèº«ä¸å·¦åˆ—çš„æµ®åŠ¨å…ƒç´ éš”ç¦»å¼€ï¼Œä¸å æ»¡æ•´è¡Œã€‚</li>
</ol>
<p>è¿™å³æ˜¯ä¸Šé¢è¯´çš„ BFC çš„ç‰¹æ€§ä¹‹ä¸€ï¼š<strong>æµ®åŠ¨ç›’çš„åŒºåŸŸä¸ä¼šå’Œ BFC é‡å </strong></p>
<h3 id="é˜²æ­¢å¤–è¾¹è·ï¼ˆmarginï¼‰é‡å "><a href="#é˜²æ­¢å¤–è¾¹è·ï¼ˆmarginï¼‰é‡å " class="headerlink" title="é˜²æ­¢å¤–è¾¹è·ï¼ˆmarginï¼‰é‡å "></a>é˜²æ­¢å¤–è¾¹è·ï¼ˆmarginï¼‰é‡å </h3><h4 id="å…„å¼Ÿå…ƒç´ ä¹‹é—´çš„å¤–è¾¹è·é‡å "><a href="#å…„å¼Ÿå…ƒç´ ä¹‹é—´çš„å¤–è¾¹è·é‡å " class="headerlink" title="å…„å¼Ÿå…ƒç´ ä¹‹é—´çš„å¤–è¾¹è·é‡å "></a>å…„å¼Ÿå…ƒç´ ä¹‹é—´çš„å¤–è¾¹è·é‡å </h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* html ä»£ç  *&#x2F;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;child1&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;child2&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;* css ä»£ç  *&#x2F;</span><br><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br><span class="line">.child1 &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    margin-bottom: 10px;</span><br><span class="line">    background-color: red;</span><br><span class="line">&#125;</span><br><span class="line">.child2 &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">    background-color: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/17318cb5761f328e?w=183&h=220&f=png&s=2328" alt=""></p>
<p>ä¸¤ä¸ªå—çº§å…ƒç´ ï¼Œçº¢è‰² div è·ç¦»åº•éƒ¨ 10pxï¼Œç»¿è‰² div è·ç¦»é¡¶éƒ¨ 20pxï¼ŒæŒ‰é“ç†åº”è¯¥ä¸¤ä¸ªå—çº§å…ƒç´ ç›¸è· 30px æ‰å¯¹ï¼Œä½†å®é™…å´æ˜¯å–è·ç¦»è¾ƒå¤§çš„ä¸€ä¸ªï¼Œå³ 20pxã€‚</p>
<blockquote>
<p>å—çº§å…ƒç´ çš„ä¸Šå¤–è¾¹è·å’Œä¸‹å¤–è¾¹è·æœ‰æ—¶ä¼šåˆå¹¶ï¼ˆæˆ–æŠ˜å ï¼‰ä¸ºä¸€ä¸ªå¤–è¾¹è·ï¼Œå…¶å¤§å°å–å…¶ä¸­çš„è¾ƒå¤§è€…ï¼Œè¿™ç§è¡Œä¸ºç§°ä¸ºå¤–è¾¹è·æŠ˜å ï¼ˆé‡å ï¼‰ï¼Œæ³¨æ„è¿™ä¸ªæ˜¯å‘ç”Ÿåœ¨å±äºåŒä¸€ BFC ä¸‹çš„å—çº§å…ƒç´ ä¹‹é—´</p>
</blockquote>
<p>æ ¹æ® BFC ç‰¹æ€§ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ BFC å°±ä¸ä¼šå‘ç”Ÿ margin æŠ˜å äº†ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä»–ä»¬ä¸¤ä¸ª div å¤–å±‚å†åŒ…è£¹ä¸€å±‚å®¹å™¨ï¼ŒåŠ å±æ€§<code>overflow: hidden</code>ï¼Œè§¦å‘ BFCï¼Œé‚£ä¹ˆä¸¤ä¸ª div å°±ä¸å±äºåŒä¸ª BFC äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* html ä»£ç  *&#x2F;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;child1&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;child2&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;* css ä»£ç  *&#x2F;</span><br><span class="line">.parent &#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;* ... *&#x2F;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå…³äºå…„å¼Ÿå…ƒç´ å¤–è¾¹è·å åŠ çš„é—®é¢˜ï¼Œé™¤äº†è§¦å‘ BFC ä¹Ÿæœ‰å…¶ä»–æ–¹æ¡ˆï¼Œæ¯”å¦‚ä½ ç»Ÿä¸€åªç”¨ä¸Šè¾¹è·æˆ–ä¸‹è¾¹è·ï¼Œå°±ä¸ä¼šæœ‰ä¸Šé¢çš„é—®é¢˜ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/17318dc6636f418f?w=209&h=231&f=png&s=2376" alt=""></p>
<h4 id="çˆ¶å­å…ƒç´ çš„å¤–è¾¹è·é‡å "><a href="#çˆ¶å­å…ƒç´ çš„å¤–è¾¹è·é‡å " class="headerlink" title="çˆ¶å­å…ƒç´ çš„å¤–è¾¹è·é‡å "></a>çˆ¶å­å…ƒç´ çš„å¤–è¾¹è·é‡å </h4><p>è¿™ç§æƒ…å†µå­˜åœ¨çˆ¶å…ƒç´ ä¸å…¶ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå­å…ƒç´ ä¹‹é—´ï¼ˆåµŒå¥—å…ƒç´ ï¼‰ã€‚<br>å¦‚æœåœ¨çˆ¶å…ƒç´ ä¸å…¶ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªå­å…ƒç´ ä¹‹é—´ä¸å­˜åœ¨è¾¹æ¡†ã€å†…è¾¹è·ã€è¡Œå†…å†…å®¹ï¼Œä¹Ÿæ²¡æœ‰åˆ›å»ºå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€æˆ–è€…æ¸…é™¤æµ®åŠ¨å°†ä¸¤è€…çš„å¤–è¾¹è· åˆ†å¼€ï¼Œæ­¤æ—¶å­å…ƒç´ çš„å¤–è¾¹è·ä¼šâ€œæº¢å‡ºâ€åˆ°çˆ¶å…ƒç´ çš„å¤–é¢ã€‚</p>
<p>å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* HTML ä»£ç  *&#x2F;</span><br><span class="line">&lt;div id&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;child&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;* CSS ä»£ç  *&#x2F;</span><br><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br><span class="line">#parent &#123;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    background-color: green;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">#child &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background-color: red;</span><br><span class="line">    margin-top: 30px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/1731a48a81bc27d9?w=376&h=236&f=png&s=6696" alt=""></p>
<p>å¦‚ä¸Šå›¾ï¼Œçº¢è‰²çš„ div åœ¨ç»¿è‰²çš„ div å†…éƒ¨ï¼Œä¸”è®¾ç½®äº†<code>margin-top</code>ä¸º 30pxï¼Œä½†æˆ‘ä»¬å‘ç°çº¢è‰² div çš„é¡¶éƒ¨ä¸ç»¿è‰² div é¡¶éƒ¨é‡åˆï¼Œå¹¶æ²¡æœ‰è·ç¦»é¡¶éƒ¨ 30pxï¼Œè€Œæ˜¯æº¢å‡ºåˆ°çˆ¶å…ƒç´ çš„å¤–é¢è®¡ç®—ã€‚å³æœ¬æ¥çˆ¶å…ƒç´ è·ç¦»é¡¶éƒ¨åªæœ‰ 20pxï¼Œè¢«å­å…ƒç´ æº¢å‡ºå½±å“ï¼Œå¤–è¾¹è·é‡å ï¼Œå–è¾ƒå¤§çš„å€¼ï¼Œåˆ™è·ç¦»é¡¶éƒ¨ 30pxã€‚</p>
<p>è§£å†³åŠæ³•ï¼š</p>
<ol>
<li>ç»™çˆ¶å…ƒç´ è§¦å‘ BFCï¼ˆå¦‚æ·»åŠ <code>overflow: hidden</code>ï¼‰</li>
<li>ç»™çˆ¶å…ƒç´ æ·»åŠ  border</li>
<li>ç»™çˆ¶å…ƒç´ æ·»åŠ  padding</li>
</ol>
<p>è¿™æ ·å°±èƒ½å®ç°æˆ‘ä»¬æœŸæœ›çš„æ•ˆæœäº†ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/1731a50faed50d4d?w=249&h=221&f=png&s=2040" alt=""></p>
<h3 id="æ¸…é™¤æµ®åŠ¨è§£å†³ä»¤çˆ¶å…ƒç´ é«˜åº¦åå¡Œçš„é—®é¢˜"><a href="#æ¸…é™¤æµ®åŠ¨è§£å†³ä»¤çˆ¶å…ƒç´ é«˜åº¦åå¡Œçš„é—®é¢˜" class="headerlink" title="æ¸…é™¤æµ®åŠ¨è§£å†³ä»¤çˆ¶å…ƒç´ é«˜åº¦åå¡Œçš„é—®é¢˜"></a>æ¸…é™¤æµ®åŠ¨è§£å†³ä»¤çˆ¶å…ƒç´ é«˜åº¦åå¡Œçš„é—®é¢˜</h3><p>å½“å®¹å™¨å†…å­å…ƒç´ è®¾ç½®æµ®åŠ¨æ—¶ï¼Œè„±ç¦»äº†æ–‡æ¡£æµï¼Œå®¹å™¨ä¸­æ€»çˆ¶å…ƒç´ é«˜åº¦åªæœ‰è¾¹æ¡†éƒ¨åˆ†é«˜åº¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* html ä»£ç  *&#x2F;</span><br><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;* css ä»£ç  *&#x2F;</span><br><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br><span class="line">.parent &#123;</span><br><span class="line">    border: 4px solid red;</span><br><span class="line">&#125;</span><br><span class="line">.child &#123;</span><br><span class="line">    float: left;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    background-color: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/1731a132272ea410?w=1927&h=209&f=png&s=16771" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/1731a249e4c9c33f?w=338&h=679&f=png&s=38121" alt=""></p>
<p>è§£å†³åŠæ³•ï¼šç»™çˆ¶å…ƒç´ è§¦å‘ BFCï¼Œä½¿å…¶æœ‰ BFC ç‰¹æ€§ï¼š<strong>è®¡ç®— BFC çš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å…ƒç´ ä¹Ÿä¼šå‚ä¸è®¡ç®—</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.parent &#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    border: 4px solid red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-gold-cdn.xitu.io/2020/7/4/1731a1fd01267b9d?w=1920&h=237&f=png&s=10195" alt=""></p>
<p>ä¸Šé¢æˆ‘ä»¬éƒ½æ˜¯ç”¨çš„<code>overflow: hidden</code>è§¦å‘ BFCï¼Œå› ä¸ºç¡®å®å¸¸ç”¨å˜›ï¼Œä½†æ˜¯è§¦å‘ BFC ä¹Ÿä¸æ­¢æ˜¯åªæœ‰è¿™ä¸€ç§æ–¹æ³•ï¼Œå¦‚ä¸Šé¢å†™çš„æ‰€ç¤ºã€‚</p>
<p>æ¯”å¦‚å¯ä»¥è®¾ç½®<code>float: left</code>; <code>float: right</code>; <code>display: inline-block</code>; <code>overflow: auto</code>; <code>display: flex</code>; <code>display:&quot; table</code>; <code>position</code>ä¸º<code>absolute</code>æˆ–<code>fixed</code>ç­‰ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥è§¦å‘ï¼Œä¸è¿‡çˆ¶å…ƒç´ å®½åº¦è¡¨ç°ä¸ä¸€å®šç›¸åŒï¼Œä½†çˆ¶å…ƒç´ é«˜åº¦éƒ½è¢«æ’‘å‡ºæ¥äº†ã€‚å½“ç„¶å®é™…è¿ç”¨å¯ä¸æ˜¯éšä¾¿æŒ‘ä¸€ä¸ªèµ°ï¼Œè¿˜æ˜¯æ ¹æ®åœºæ™¯é€‰æ‹©ã€‚</p>
<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œé¼“åŠ±æˆ‘ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>CSSç³»åˆ—</category>
      </categories>
  </entry>
  <entry>
    <title>ä¸€æ–‡æ±‡æ€» CSS ä¸¤åˆ—å¸ƒå±€å’Œä¸‰åˆ—å¸ƒå±€</title>
    <url>/2020/06/27/%E4%B8%80%E6%96%87%E6%B1%87%E6%80%BB-CSS-%E4%B8%A4%E5%88%97%E5%B8%83%E5%B1%80%E5%92%8C%E4%B8%89%E5%88%97%E5%B8%83%E5%B1%80/</url>
    <content><![CDATA[<p>éšç€å¤§å‰ç«¯çš„å‘å±•ï¼ŒUI æ¡†æ¶å±‚å‡ºä¸ç©·ï¼Œè®©æˆ‘ä»¬å‰ç«¯å¼€å‘å¯¹ CSS çš„èƒ½åŠ›è¦æ±‚å˜å¾—æ²¡é‚£ä¹ˆé«˜æˆ–è€…æ²¡é‚£ä¹ˆä¸¥è‹›ï¼Œèµ·ç é‡è¦æ€§æ˜¯æ¯”ä¸ä¸Š JS ç¼–ç¨‹çš„ã€‚ä½†æ˜¯ï¼ŒåŸºç¡€çš„ CSS ä¾ç„¶éœ€è¦æˆ‘ä»¬ç†Ÿç»ƒæŒæ¡ï¼Œä»Šå¤©å°±æ¥æ€»ç»“å†™ä¸‹ CSS å¸ƒå±€çš„æ–¹å¼ã€‚</p>
<a id="more"></a>

<h2 id="ä¸¤åˆ—å¸ƒå±€"><a href="#ä¸¤åˆ—å¸ƒå±€" class="headerlink" title="ä¸¤åˆ—å¸ƒå±€"></a>ä¸¤åˆ—å¸ƒå±€</h2><h3 id="å·¦åˆ—å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”"><a href="#å·¦åˆ—å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”" class="headerlink" title="å·¦åˆ—å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”"></a>å·¦åˆ—å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”</h3><p><img src="https://user-gold-cdn.xitu.io/2020/6/25/172ebffbad247324?w=1918&h=427&f=png&s=21351" alt=""></p>
<h4 id="float-margin-å¸ƒå±€"><a href="#float-margin-å¸ƒå±€" class="headerlink" title="float + margin å¸ƒå±€"></a>float + margin å¸ƒå±€</h4><p>html ä»£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">200px</span>; <span class="comment">/* å¤§äºæˆ–ç­‰äºå·¦åˆ—çš„å®½åº¦ */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="float-overflow-å¸ƒå±€"><a href="#float-overflow-å¸ƒå±€" class="headerlink" title="float + overflow å¸ƒå±€"></a>float + overflow å¸ƒå±€</h4><p>html ä»£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç </p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç»å¯¹å®šä½å¸ƒå±€"><a href="#ç»å¯¹å®šä½å¸ƒå±€" class="headerlink" title="ç»å¯¹å®šä½å¸ƒå±€"></a>ç»å¯¹å®šä½å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="table-å¸ƒå±€"><a href="#table-å¸ƒå±€" class="headerlink" title="table å¸ƒå±€"></a>table å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span>,</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="flex-å¸ƒå±€"><a href="#flex-å¸ƒå±€" class="headerlink" title="flex å¸ƒå±€"></a>flex å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="grid-ç½‘æ ¼å¸ƒå±€"><a href="#grid-ç½‘æ ¼å¸ƒå±€" class="headerlink" title="grid ç½‘æ ¼å¸ƒå±€"></a>grid ç½‘æ ¼å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å·¦åˆ—ä¸å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”"><a href="#å·¦åˆ—ä¸å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”" class="headerlink" title="å·¦åˆ—ä¸å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”"></a>å·¦åˆ—ä¸å®šå®½ï¼Œå³åˆ—è‡ªé€‚åº”</h3><p>å·¦åˆ—ç›’å­å®½åº¦éšç€å†…å®¹å¢åŠ æˆ–å‡å°‘å‘ç”Ÿå˜åŒ–ï¼Œå³åˆ—ç›’å­è‡ªé€‚åº”</p>
<h4 id="float-overflow-å¸ƒå±€-1"><a href="#float-overflow-å¸ƒå±€-1" class="headerlink" title="float + overflow å¸ƒå±€"></a>float + overflow å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—ä¸å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="flex-å¸ƒå±€-1"><a href="#flex-å¸ƒå±€-1" class="headerlink" title="flex å¸ƒå±€"></a>flex å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—ä¸å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="grid-å¸ƒå±€"><a href="#grid-å¸ƒå±€" class="headerlink" title="grid å¸ƒå±€"></a>grid å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—ä¸å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: auto <span class="number">1</span>fr;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰åˆ—å¸ƒå±€"><a href="#ä¸‰åˆ—å¸ƒå±€" class="headerlink" title="ä¸‰åˆ—å¸ƒå±€"></a>ä¸‰åˆ—å¸ƒå±€</h2><h3 id="ä¸¤åˆ—å®šå®½ï¼Œä¸€åˆ—è‡ªé€‚åº”"><a href="#ä¸¤åˆ—å®šå®½ï¼Œä¸€åˆ—è‡ªé€‚åº”" class="headerlink" title="ä¸¤åˆ—å®šå®½ï¼Œä¸€åˆ—è‡ªé€‚åº”"></a>ä¸¤åˆ—å®šå®½ï¼Œä¸€åˆ—è‡ªé€‚åº”</h3><p><img src="https://user-gold-cdn.xitu.io/2020/6/26/172ee126919a5ecb?w=1916&h=408&f=png&s=21184" alt=""></p>
<h4 id="float-margin-å¸ƒå±€-1"><a href="#float-margin-å¸ƒå±€-1" class="headerlink" title="float + margin å¸ƒå±€"></a>float + margin å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span>ä¸­é—´åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">300px</span>; <span class="comment">/* å·¦åˆ—çš„å®½åº¦ + ä¸­é—´åˆ—çš„å®½åº¦ */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="float-overflow-å¸ƒå±€-2"><a href="#float-overflow-å¸ƒå±€-2" class="headerlink" title="float + overflow å¸ƒå±€"></a>float + overflow å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span>ä¸­é—´åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="table-å¸ƒå±€-1"><a href="#table-å¸ƒå±€-1" class="headerlink" title="table å¸ƒå±€"></a>table å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span>ä¸­é—´åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="flex-å¸ƒå±€-2"><a href="#flex-å¸ƒå±€-2" class="headerlink" title="flex å¸ƒå±€"></a>flex å¸ƒå±€</h4><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span>ä¸­é—´åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="grid-å¸ƒå±€-1"><a href="#grid-å¸ƒå±€-1" class="headerlink" title="grid å¸ƒå±€"></a>grid å¸ƒå±€</h4><p>html ä»£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span>ä¸­é—´åˆ—å®šå®½<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—è‡ªé€‚åº”<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç </p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> <span class="number">200px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å·¦å³å®šå®½ï¼Œä¸­é—´è‡ªé€‚åº”"><a href="#å·¦å³å®šå®½ï¼Œä¸­é—´è‡ªé€‚åº”" class="headerlink" title="å·¦å³å®šå®½ï¼Œä¸­é—´è‡ªé€‚åº”"></a>å·¦å³å®šå®½ï¼Œä¸­é—´è‡ªé€‚åº”</h3><p><img src="https://user-gold-cdn.xitu.io/2020/6/27/172f36b76f3065b5?w=1914&h=409&f=png&s=21663" alt=""></p>
<p>åœ£æ¯å¸ƒå±€å’ŒåŒé£ç¿¼å¸ƒå±€ç›®çš„éƒ½æ˜¯å¸Œæœ›å…ˆåŠ è½½çš„æ˜¯ä¸­é—´çš„éƒ¨åˆ†ï¼Œç„¶åå†å¼€å§‹åŠ è½½ left å’Œ right ä¸¤éƒ¨åˆ†ç›¸å¯¹æ¥è¯´ä¸æ˜¯å¾ˆé‡è¦çš„ä¸œè¥¿ã€‚</p>
<h4 id="åœ£æ¯å¸ƒå±€"><a href="#åœ£æ¯å¸ƒå±€" class="headerlink" title="åœ£æ¯å¸ƒå±€"></a>åœ£æ¯å¸ƒå±€</h4><p>åœ£æ¯å¸ƒå±€ï¼šä¸ºäº†è®©ä¸­é—´çš„å†…å®¹ä¸è¢«é®æŒ¡ï¼Œå°†ä¸­é—´ divï¼ˆæˆ–æœ€å¤–å±‚çˆ¶ divï¼‰è®¾ç½® padding-left å’Œ padding-right ï¼ˆå€¼ç­‰äº left å’Œ right çš„å®½åº¦ï¼‰ï¼Œå°†å·¦å³ä¸¤ä¸ª div ç”¨ç›¸å¯¹å¸ƒå±€ position: relative å¹¶åˆ†åˆ«é…åˆ left å’Œ right å±æ€§ï¼Œä»¥ä¾¿å·¦å³ä¸¤æ  div ç§»åŠ¨åä¸é®æŒ¡ä¸­é—´ divã€‚</p>
<p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span>ä¸­é—´åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span>,</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>; <span class="comment">/* ä½¿ #left ä¸Šå»ä¸€è¡Œ */</span></span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">right</span>: -<span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">200px</span>; <span class="comment">/* ä½¿ #right ä¸Šå»ä¸€è¡Œ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åŒé£ç¿¼å¸ƒå±€"><a href="#åŒé£ç¿¼å¸ƒå±€" class="headerlink" title="åŒé£ç¿¼å¸ƒå±€"></a>åŒé£ç¿¼å¸ƒå±€</h4><p>åŒé£ç¿¼å¸ƒå±€ï¼Œä¸ºäº†ä¸­é—´ div å†…å®¹ä¸è¢«é®æŒ¡ï¼Œç›´æ¥åœ¨ä¸­é—´ div å†…éƒ¨åˆ›å»ºå­ div ç”¨äºæ”¾ç½®å†…å®¹ï¼Œåœ¨è¯¥å­ div é‡Œç”¨ margin-left å’Œ margin-right ä¸ºå·¦å³ä¸¤æ  div ç•™å‡ºä½ç½®ã€‚</p>
<p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center-inside"</span>&gt;</span>ä¸­é—´åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#left</span>,</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>; <span class="comment">/* ä½¿ #left ä¸Šå»ä¸€è¡Œ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">200px</span>; <span class="comment">/* ä½¿ #right ä¸Šå»ä¸€è¡Œ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center-inside</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="flex-å®ç°"><a href="#flex-å®ç°" class="headerlink" title="flex å®ç°"></a>flex å®ç°</h3><p>html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"center"</span>&gt;</span>ä¸­é—´åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>å·¦åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>å³åˆ—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span>,</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">order</span>: -<span class="number">1</span>; <span class="comment">/* è®© #left å±…äºå·¦ä¾§ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CSSç³»åˆ—</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>CSSä¼ªå…ƒç´ å®ç°ä¸­é—´æ–‡å­—ï¼Œä¸¤è¾¹æ¨ªçº¿çš„æ•ˆæœ</title>
    <url>/2020/06/16/CSS%E4%BC%AA%E5%85%83%E7%B4%A0%E5%AE%9E%E7%8E%B0%E4%B8%AD%E9%97%B4%E6%96%87%E5%AD%97%EF%BC%8C%E4%B8%A4%E8%BE%B9%E6%A8%AA%E7%BA%BF%E7%9A%84%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<p>ä»Šå¤©åšé¡¹ç›®çš„æ—¶å€™ï¼Œè¦å®ç°æ•ˆæœï¼šä¸­é—´æ˜¯æ–‡å­—ï¼Œä¸¤è¾¹æ˜¯æ¨ªçº¿å›´ç€ï¼Œå…¶ä¸­æœ‰é—´è·ã€‚äº†è§£äº†å‡ ç§åšæ³•ã€‚ä¼ªå…ƒç´ è¿™ä¸ªåˆšå¼€å§‹æ²¡æƒ³åˆ°ï¼Œå›æ¥åˆè‡ªå·±æ•²äº†ä¸€éï¼Œä»¥åšè®°å½•â€¦</p>
<a id="more"></a>

<p>æ•ˆæœï¼š</p>
<p><img src="/images/css-pseudo.png" alt="image.png"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CSSä¼ªå…ƒç´ å®ç°ä¸­é—´æ–‡å­—, ä¸¤è¾¹æ¨ªçº¿æ•ˆæœ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.container</span> &#123;</span></span><br><span class="line">        position: relative;</span><br><span class="line">        width: 640px;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line">        text-align: center;</span><br><span class="line">        width: 100%;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.wrapper</span> <span class="selector-class">.word</span><span class="selector-pseudo">:before</span>,</span></span><br><span class="line"><span class="css">      <span class="selector-class">.wrapper</span> <span class="selector-class">.word</span><span class="selector-pseudo">:after</span> &#123;</span></span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 50%;</span><br><span class="line">        width: 40%;</span><br><span class="line">        height: 1px;</span><br><span class="line">        background: blue;</span><br><span class="line">        content: '';</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="comment">/* è°ƒæ•´èƒŒæ™¯æ¨ªçº¿çš„å·¦å³è·ç¦» */</span></span></span><br><span class="line"><span class="css">      <span class="selector-class">.wrapper</span> <span class="selector-class">.word</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">        left: 0;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.wrapper</span> <span class="selector-class">.word</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line">        right: 0;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"word"</span>&gt;</span>ä¸­é—´çš„å­—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ‚è®°</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Formik +Yup å¤„ç† React è¡¨å•éªŒè¯</title>
    <url>/2020/06/13/%E4%BD%BF%E7%94%A8-Formik-Yup-%E5%A4%84%E7%90%86-React-%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81/</url>
    <content><![CDATA[<p>React æ“ä½œè¡¨å•ä¸€ç›´éƒ½æ˜¯æ¯”è¾ƒç¹ççš„æ“ä½œï¼Œåœ¨ä»¥å‰ç”¨çš„æ˜¯ redux-formï¼Œ ä½†ç°åœ¨ formik è¿™ä¸ªåº“è®¾è®¡å¾—æ›´åŠ ä¼˜é›…ï¼ŒGithub çš„ star æ•°ç›®å·²ç»è¿œè¿œè¶…è¿‡ redux-form äº†ã€‚åšè¡¨å•å°±æ˜¯ä¸ºäº†æ”¶é›†ä¸€äº›æ•°æ®ï¼Œç„¶åè¿›è¡Œæäº¤ã€‚è€Œ redux-form ç†å¿µæ˜¯æŠŠè¿™äº›æ•°æ®å­˜æ”¾åˆ° reducer ä¸­å»ï¼Œå½“æˆ‘ä»¬è¡¨å•å¤šçš„æ—¶å€™ï¼Œæ˜¾ç„¶å¯¹æ•´ä¸ª store çš„æ•°æ®ç®¡ç†ä¸å¤ªå‹å¥½ï¼Œå› ä¸ºå¤šäº†å¾ˆå¤šè¡¨å•æ•°æ®ã€‚è€Œ formik è§£å†³çš„å…¶ä¸­ä¸€ä¸ªç—›ç‚¹å°±æ˜¯è¿™ä¸ªï¼Œå®ƒå¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨å¤„ç†è¿™äº›è¡¨å•é¡¹è€Œç®€å•æ˜“ç”¨ã€‚</p>
<p>Formik æ—¨åœ¨è½»æ¾ç®¡ç†å…·æœ‰å¤æ‚éªŒè¯çš„è¡¨å•, Formik æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥è¡¨å•çº§å’Œå­—æ®µçº§éªŒè¯ã€‚</p>
<a id="more"></a>

<p><code>ä¾‹å­çš„ Formik ä¸º 2.1.4 ç‰ˆ</code></p>
<p>å…ˆæ¥çœ‹ä¸ªåŸºæœ¬çš„ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useFormik &#125; <span class="keyword">from</span> <span class="string">'formik'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./FormDemo.css'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥è¡¨å•å­—æ®µ</span></span><br><span class="line"><span class="keyword">const</span> validate = <span class="function"><span class="params">values</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> errors = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (!values.name) &#123;</span><br><span class="line">    errors.name = <span class="string">'ä¸èƒ½ä¸ºç©º'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (values.name.length &gt; <span class="number">20</span>) &#123;</span><br><span class="line">    errors.name = <span class="string">'åå­—å¤ªé•¿ï¼Œè¾“å…¥æœ‰è¯¯'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!values.email) &#123;</span><br><span class="line">    errors.email = <span class="string">'ä¸èƒ½ä¸ºç©º'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="regexp">/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]&#123;2,4&#125;$/i</span>.test(values.email)) &#123;</span><br><span class="line">    errors.email = <span class="string">'é‚®ç®±æ ¼å¼é”™è¯¯'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> errors</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FormDemo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> formik = useFormik(&#123;</span><br><span class="line">    initialValues: &#123;</span><br><span class="line">      name: <span class="string">''</span>,</span><br><span class="line">      email: <span class="string">''</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    validate,</span><br><span class="line">    onSubmit: <span class="function"><span class="params">values</span> =&gt;</span> &#123;</span><br><span class="line">      alert(<span class="built_in">JSON</span>.stringify(values, <span class="literal">null</span>, <span class="number">2</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;formik.handleSubmit&#125; className=<span class="string">'form-wrap'</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">'form-group'</span>&gt;</span><br><span class="line">        &lt;label&gt;åå­—&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          name='name'</span></span><br><span class="line"><span class="regexp">          onChange=&#123;formik.handleChange&#125;</span></span><br><span class="line"><span class="regexp">          onBlur=&#123;formik.handleBlur&#125;</span></span><br><span class="line"><span class="regexp">          value=&#123;formik.values.name&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">        &#123;formik.touched.name &amp;&amp; formik.errors.name ? (</span><br><span class="line">          &lt;div className=<span class="string">'error-tip'</span>&gt;&#123;formik.errors.name&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        ) : null&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      &lt;div className=<span class="string">'form-group'</span>&gt;</span><br><span class="line">        &lt;label&gt;é‚®ç®±&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          name='email'</span></span><br><span class="line"><span class="regexp">          onChange=&#123;formik.handleChange&#125;</span></span><br><span class="line"><span class="regexp">          onBlur=&#123;formik.handleBlur&#125;</span></span><br><span class="line"><span class="regexp">          value=&#123;formik.values.email&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">        &#123;formik.touched.email &amp;&amp; formik.errors.email ? (</span><br><span class="line">          &lt;div className=<span class="string">'error-tip'</span>&gt;&#123;formik.errors.email&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        ) : null&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;button type=<span class="string">'submit'</span>&gt;Submit&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>form&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> FormDemo</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„è¡¨å•ï¼Œè¾“å…¥åå­—ä¸é‚®ç®±ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/6/13/172acf9ec35b272f?w=433&h=232&f=gif&s=31469" alt=""></p>
<p>ä¸Šé¢ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ useFormik è¿™ç§ç”¨æ³•ï¼Œè¿˜æœ‰ä½¿ç”¨ <code>&lt;Formik /&gt;</code> å’Œ <code>withFormik</code> çš„ç”¨æ³•ã€‚</p>
<p>ä½†æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå½“æ­£åœ¨è¾“å…¥åå­—çš„æ—¶å€™ï¼Œé‚®ç®±å·²ç»ç«‹é©¬æ˜¾ç¤ºä¸èƒ½ä¸ºç©ºäº†ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯å½“ç‚¹å‡»çš„æ—¶å€™æ‰åšå…¶ä»–è¡¨å•å…ƒç´ çš„åˆ¤æ–­è€Œä¸æ˜¯ä¸€æ¬¡æ€§åˆ¤æ–­å®Œã€‚å¯¹è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å†åŠ ä¸€ä¸ªåˆ¤æ–­<code>touched</code>, è¿™ä¸ªä»£è¡¨è¡¨å•ä¸­çš„æŸä¸ªå­—æ®µæ˜¯å¦è¢«ç‚¹å‡»è¿‡ï¼Œç›´è¯‘çš„è¯å°±æ˜¯â€è§¦ç¢°è¿‡â€æˆ–â€åŠ¨è¿‡â€ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°ä¸Šé¢çš„é—®é¢˜äº†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  formik.touched.name &amp;&amp; formik.errors.name ? (</span><br><span class="line">    &lt;div className=<span class="string">'error-tip'</span>&gt;&#123;formik.errors.name&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  ) : null</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä½†å‘ç°ä¸Šé¢çš„ä»£ç è¿˜æ˜¯æŒºå¤š, onChange, onBlur, value ç­‰å±æ€§è¿˜æ˜¯æŒºé‡å¤çš„ï¼Œæ¯ä¸ªè¡¨å•å…ƒç´ å†™ä¸€æ®µï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æ›´ç²¾ç®€ï¼Œä½¿ç”¨ formik é‡Œé¢çš„<code>getFieldProps</code>æ–¹æ³•</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">"&#123;formik.handleSubmit&#125;"</span> <span class="attr">className</span>=<span class="string">"form-wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>åå­—<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">'name'</span> &#123;<span class="attr">...formik.getFieldProps</span>('<span class="attr">name</span>')&#125; /&gt;</span> &#123;formik.touched.name &amp;&amp;</span><br><span class="line">    formik.errors.name ? (</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"error-tip"</span>&gt;</span>&#123;formik.errors.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    ) : null&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>é‚®ç®±<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">'email'</span> &#123;<span class="attr">...formik.getFieldProps</span>('<span class="attr">email</span>')&#125; /&gt;</span> &#123;formik.touched.email &amp;&amp;</span><br><span class="line">    formik.errors.email ? (</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"error-tip"</span>&gt;</span>&#123;formik.errors.email&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    ) : null&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè¡¨å•å­—æ®µçš„éªŒè¯èƒ½ä¸èƒ½ç®€åŒ–å‘¢ï¼Ÿformik è¡¨å•éªŒè¯å¤§å¤šæ•°æˆ‘ä»¬ä¼šé€‰æ‹©å’Œ yup åº“è¿›è¡Œæ­é…ï¼Œyup çš„ä¸“é•¿å°±æ˜¯ä½œè§„åˆ™æ ¡éªŒçš„ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> formik = useFormik(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  validationSchema: Yup.object(&#123;</span><br><span class="line">    name: Yup.string().max(<span class="number">20</span>, <span class="string">'åå­—å¤ªé•¿ï¼Œè¾“å…¥æœ‰è¯¯'</span>).required(<span class="string">'ä¸èƒ½ä¸ºç©º'</span>),</span><br><span class="line">    email: Yup.string().email(<span class="string">'é‚®ç®±æ ¼å¼é”™è¯¯'</span>).required(<span class="string">'ä¸èƒ½ä¸ºç©º'</span>),</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ validationSchema ä¸º Formik ä¸“é—¨ä¸º yup ç•™å‡ºçš„æ¥å£ï¼Œæ‰€ä»¥ formik æ˜¯å¾ˆå¥½æ”¯æŒ yup æ­é…ä½¿ç”¨çš„ã€‚</p>
<p>æœ€åé™„ä¸Šå®˜ç½‘ï¼š<a href="https://jaredpalmer.com/formik/" target="_blank" rel="noopener">https://jaredpalmer.com/formik/</a><br><br></p>
<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>å¼€å‘æ‚è®°</category>
      </categories>
      <tags>
        <tag>Formik</tag>
        <tag>Yup</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€React åŸç†ï¼ˆä¸€ï¼‰ã€‘å®ç° createElement å’Œ render æ–¹æ³•</title>
    <url>/2020/06/06/%E3%80%90React-%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%91%E5%AE%9E%E7%8E%B0-createElement-%E5%92%8C-render-%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>åœ¨ React ä¸­ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å¯ä»¥å†™ jsx ä»£ç ä¼šè¢«ç¼–è¯‘æˆçœŸæ­£çš„ DOM æ’å…¥åˆ°è¦æ˜¾ç¤ºçš„é¡µé¢ä¸Šã€‚è¿™å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä»Šå¤©æˆ‘ä»¬å°±è‡ªå·±åŠ¨æ‰‹åšä¸€ä¸‹ã€‚</p><a id="more"></a><h2 id="å®ç°-createElement-æ–¹æ³•"><a href="#å®ç°-createElement-æ–¹æ³•" class="headerlink" title="å®ç° createElement æ–¹æ³•"></a>å®ç° createElement æ–¹æ³•</h2><p>è¿™ä¸ªæ–¹æ³•å¹³æ—¶å¼€å‘æˆ‘ä»¬å¹¶ä¸ä¼šç”¨åˆ°ï¼Œå› ä¸ºå®ƒæ˜¯ç» babel ç¼–è¯‘åçš„ä»£ç ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª React é¡¹ç›®ï¼Œindex.js æœ€ç®€å•çš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">'title'</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°± jsx ä¼šå˜ç¼–è¯‘æˆçœŸæ­£çš„ DOM ï¼ŒæŠŠ html ä»£ç æ‹¿åˆ° babel å®˜ç½‘ç¼–è¯‘</p><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/6/6/17287948badb8312?w=1162&h=182&f=png&s=14232" alt=""></p><p>äºæ˜¯æˆ‘ä»¬å°±çœ‹åˆ°äº† React.createElement() æ–¹æ³•ï¼Œä½†è¿™åªæ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒå…·ä½“åšäº†ä»€ä¹ˆè¿”å›ä»€ä¹ˆæˆ‘ä»¬è¿˜ä¸çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°è¿™ä¸ªå‡½æ•°è¿è¡Œçš„ç»“æœï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  React.createElement(</span><br><span class="line">    <span class="string">'h1'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      className: <span class="string">'title'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'Hello React'</span></span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/6/6/1728796fcf7d2054?w=567&h=181&f=png&s=12796" alt=""><br>è¿”å›çš„è¿™ä¸ªå¯¹è±¡å°±æ˜¯è™šæ‹Ÿ DOM äº†ã€‚</p><p>æˆ‘ä»¬æ¥åˆ†æå®ƒè¿”å›çš„å¯¹è±¡å‚æ•°ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªæ˜¯</p><ul><li><code>$$typeof: REACT_ELEMENT_TYPE</code></li></ul><p>è¿™ä¸ªæ˜¯ React å…ƒç´ å¯¹è±¡çš„æ ‡è¯†å±æ€§</p><p>REACT_ELEMENT_TYPE çš„å€¼æ˜¯ä¸€ä¸ª Symbol ç±»å‹ï¼Œä»£è¡¨äº†ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ã€‚å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ Symbol ç±»å‹ï¼Œå€¼å°±æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å€¼ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆæ˜¯ Symbolï¼Ÿä¸»è¦é˜²æ­¢ XSS æ”»å‡»ä¼ªé€ ä¸€ä¸ªå‡çš„ React ç»„ä»¶ã€‚å› ä¸º JSON ä¸­æ˜¯ä¸ä¼šå­˜åœ¨ Symbol ç±»å‹çš„ã€‚</p></blockquote><ul><li>keyï¼šè¿™ä¸ªæ¯”å¦‚å¾ªç¯ä¸­ä¼šç”¨åˆ°è¿™ä¸ª key å€¼</li><li>propsï¼šä¼ å…¥çš„å±æ€§å€¼ï¼Œæ¯”å¦‚ id, className, style, children ç­‰</li><li>refï¼š DOM çš„å¼•ç”¨</li><li>å‰©ä¸‹çš„æ˜¯ç§æœ‰å±æ€§ï¼ˆæœ¬ç¯‡ä¸å±•å¼€è®¨è®ºï¼‰</li></ul><p>åœ¨æœ¬ç¯‡æˆ‘ä»¬ä¼šç”¨è‡ªå·±ç®€å•çš„æ–¹å¼å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯æ ¹æ®æºç ï¼Œæ‰€ä»¥å®ç°ä¸Šçš„æ–¹æ³•åªè¦èƒ½å®ç°å®ƒçš„åŸºæœ¬åŠŸèƒ½å³å¯ï¼›æœ‰ä¸ªåŸºæœ¬æ¦‚å¿µåœ¨ï¼Œä»¥åå†å¾ªåºæ¸è¿›å­¦ä¹ æºç ã€‚</p><p>è€Œ createElement ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ›´ç¡®åˆ‡è¯´æ˜¯ n ä¸ªå‚æ•°ï¼š</p><ul><li>typeï¼šè¡¨ç¤ºè¦æ¸²æŸ“çš„å…ƒç´ ç±»å‹ã€‚è¿™é‡Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªå…ƒç´  Tag åç§°ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªç»„ä»¶ï¼ˆå¦‚ div span ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æ˜¯å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ï¼‰</li><li>propsï¼šåˆ›å»º React å…ƒç´ æ‰€éœ€è¦çš„ propsã€‚</li><li>childrensï¼ˆå¯é€‰å‚æ•°ï¼‰ï¼šè¦æ¸²æŸ“å…ƒç´ çš„å­å…ƒç´ ï¼Œè¿™é‡Œå¯ä»¥å‘åä¼ å…¥ n ä¸ªå‚æ•°ã€‚å¯ä»¥ä¸ºæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•°ç»„</li></ul><p>åˆæ­¥ createElement æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º JSX å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">type, props, ...childrens</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type,</span><br><span class="line">        props: &#123;</span><br><span class="line">          ...props,</span><br><span class="line">          children: childrens.length &lt;= <span class="number">1</span> ? childrens[<span class="number">0</span>] || <span class="string">''</span> : childrens,</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚æ•°ä¸­ props å’Œ childrens æ˜¯å¹¶åˆ—å…³ç³»ï¼Œç„¶åè¿”å›çš„ props å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº† childrenï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å† props é‡Œé¢æ·»åŠ  children å‚æ•°ï¼Œç„¶åæ ¹æ® children å‚æ•°ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªçš„å¯èƒ½åœ¨è¿›è¡Œå–å€¼å¤„ç†ã€‚</p><p>è°ƒç”¨è¯¥æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  createElement(</span><br><span class="line">    <span class="string">'h1'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      className: <span class="string">'title'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'Hello React'</span></span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/6/6/17287aecec9a3e91?w=237&h=116&f=png&s=4860" alt=""><br>é™¤å»å…¶å®ƒæœ¬ç¯‡æˆ‘ä»¬ä¸è®¨è®ºçš„å±æ€§ï¼Œç›®å‰ç®—æ˜¯å®ç°äº†ä¸€åŠï¼›æˆ‘ä»¬è§‚å¯ŸåŸæ¥ React è‡ªèº«æ–¹æ³•è¾“å‡ºçš„ç»“æœæœ‰ key, refï¼Œ åŒè¾“å‡ºçš„ props ä¹Ÿæ˜¯å¹¶åˆ—å…³ç³»ï¼Œäºæ˜¯æˆ‘ä»¬è¿›ä¸€æ­¥ä½œå‡ºå¤„ç†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">type, props, ...childrens</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ref, key</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'ref'</span> <span class="keyword">in</span> props) &#123;</span><br><span class="line">    ref = props[<span class="string">'ref'</span>]</span><br><span class="line">    props[<span class="string">'ref'</span>] = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'key'</span> <span class="keyword">in</span> props) &#123;</span><br><span class="line">    key = props[<span class="string">'key'</span>]</span><br><span class="line">    props[<span class="string">'key'</span>] = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    props: &#123;</span><br><span class="line">      ...props,</span><br><span class="line">      children: childrens.length &lt;= <span class="number">1</span> ? childrens[<span class="number">0</span>] || <span class="string">''</span> : childrens,</span><br><span class="line">    &#125;,</span><br><span class="line">    ref,</span><br><span class="line">    key,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„æ–¹å¼è°ƒç”¨ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/6/6/17287b33de749a06?w=453&h=145&f=png&s=8494" alt=""><br>å¦‚æœæ·»åŠ å¤šä¸€äº›å±æ€§ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ç»“æœ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  createElement(</span><br><span class="line">    <span class="string">'div'</span>,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'box'</span>, <span class="attr">className</span>: <span class="string">'box'</span>, <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">'red'</span> &#125;, <span class="attr">key</span>: <span class="string">'20'</span> &#125;,</span><br><span class="line">    <span class="string">'this is text'</span>,</span><br><span class="line">    createElement(<span class="string">'h2'</span>, &#123; <span class="attr">className</span>: <span class="string">'title'</span> &#125;, <span class="string">'hello'</span>),</span><br><span class="line">    createElement(<span class="string">'div'</span>, &#123; <span class="attr">className</span>: <span class="string">'content'</span> &#125;, <span class="string">'Hi'</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/6/6/17287c9de8368ddd?w=467&h=280&f=png&s=17373" alt=""><br>ç”¨äº†è¿™ç§æ¯”è¾ƒç²—é²çš„æ–¹å¼æ·»åŠ ï¼Œè®¾ç½®ä¸º undefined åœ¨å®ç° render æ–¹æ³•çš„æ—¶å€™æˆ‘ä»¬ä¼šæ ¹æ®è¿™ä¸ªå¿½ç•¥ props å†…éƒ¨çš„ key å’Œ props å±æ€§ï¼Œè¿™é‡Œå°±å®ç°äº†æœ€åŸºæœ¬çš„ createElement æ–¹æ³•äº†ã€‚</p><h2 id="å®ç°-render-æ–¹æ³•"><a href="#å®ç°-render-æ–¹æ³•" class="headerlink" title="å®ç° render æ–¹æ³•"></a>å®ç° render æ–¹æ³•</h2><p>render æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ¥æ”¶çš„æ˜¯ createElement è¿”å›çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿ DOMï¼›<br>ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯æŒ‚è½½çš„ç›®æ ‡ DOMã€‚åŒæ ·çš„åšæ³•ï¼Œæˆ‘ä»¬ç”¨ babel ç¼–è¯‘æ¥çœ‹ï¼š</p><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/6/6/17287ca773a9b742?w=1259&h=362&f=png&s=43471" alt=""><br>æ‰§è¡Œåï¼Œå°±è¢«æŒ‚åœ¨åˆ°é¡µé¢äº†</p><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/6/6/17287cc414f3731c?w=343&h=122&f=png&s=6145" alt=""></p><p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½ï¼šæŠŠåˆ›å»ºçš„å¯¹è±¡ç”Ÿæˆå¯¹åº”çš„DOMå…ƒç´ ï¼Œæœ€åæ’å…¥åˆ°é¡µé¢ä¸­</span></span><br><span class="line"><span class="comment"> * objJSXï¼š createElement è¿”å›çš„ JSX å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * containerï¼šæŒ‚è½½çš„å®¹å™¨ï¼Œå¦‚ document.getElementById('root')</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">objJSX, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; type, props &#125; = objJSX</span><br><span class="line">  <span class="keyword">let</span> newElement = <span class="built_in">document</span>.createElement(type)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> props) &#123;</span><br><span class="line">    <span class="comment">// éå†ä¼ å…¥çš„ props å±æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (!props.hasOwnProperty(attr)) <span class="keyword">break</span> <span class="comment">// ä¸æ˜¯ç§æœ‰çš„ç›´æ¥ç»“æŸéå†</span></span><br><span class="line">    <span class="keyword">let</span> value = props[attr] <span class="comment">// &gt;å¦‚æœå½“å‰å±æ€§æ²¡æœ‰å€¼,ç›´æ¥ä¸å¤„ç†å³å¯</span></span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">undefined</span>) <span class="keyword">continue</span> <span class="comment">// NULL OR UNDEFINED</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹å‡ ä¸ªç‰¹æ®Šå±æ€§å•ç‹¬è®¾ç½®</span></span><br><span class="line">    <span class="keyword">switch</span> (attr.toUpperCase()) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'ID'</span>:</span><br><span class="line">        newElement.setAttribute(<span class="string">'id'</span>, value)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'CLASSNAME'</span>:</span><br><span class="line">        newElement.setAttribute(<span class="string">'class'</span>, value)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'STYLE'</span>: <span class="comment">// ä¼ å…¥çš„è¡Œå†…æ ·å¼ style æ˜¯ä¸ªå¯¹è±¡ï¼Œæ•…éœ€éå†èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> styleAttr <span class="keyword">in</span> value) &#123;</span><br><span class="line">          <span class="keyword">if</span> (value.hasOwnProperty(styleAttr)) &#123;</span><br><span class="line">            newElement[<span class="string">'style'</span>][styleAttr] = value[styleAttr]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'CHILDREN'</span>:</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å¯èƒ½æ˜¯ä¸€ä¸ªå€¼ï¼šå¯èƒ½æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªJSXå¯¹è±¡</span></span><br><span class="line"><span class="comment">         * å¯èƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼šæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹å¯èƒ½æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½æ˜¯JSXå¯¹è±¡</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// é¦–å…ˆæŠŠä¸€ä¸ªå€¼ä¹Ÿå˜ä¸ºæ•°ç»„ï¼Œè¿™æ ·åæœŸç»Ÿä¸€æ“ä½œæ•°ç»„å³å¯</span></span><br><span class="line">        !(value <span class="keyword">instanceof</span> <span class="built_in">Array</span>) ? (value = [value]) : <span class="literal">null</span></span><br><span class="line">        value.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// éªŒè¯ITEMæ˜¯ä»€ä¹ˆç±»å‹çš„ï¼šå¦‚æœæ˜¯å­—ç¬¦ä¸²å°±æ˜¯åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡æ‰§è¡ŒRENDERæ–¹æ³•ï¼ŒæŠŠåˆ›å»ºçš„å…ƒç´ æ”¾åˆ°æœ€å¼€å§‹åˆ›å»ºçš„å¤§ç›’å­ä¸­</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> item === <span class="string">'string'</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> text = <span class="built_in">document</span>.createTextNode(item)</span><br><span class="line">            newElement.appendChild(text)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            render(item, newElement)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        newElement.setAttribute(attr, value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  container.appendChild(newElement)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><ul><li>psï¼š <a href="https://images.weserv.nl/?url=https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œé¼“åŠ±æˆ‘ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title>ç†è§£ redux-thunk æºç </title>
    <url>/2020/05/30/%E7%90%86%E8%A7%A3-redux-thunk-%E6%BA%90%E7%A0%81/</url>
    <content><![CDATA[<p>å‰é¢å‡ ç¯‡æˆ‘ä»¬å°± Redux å±•å¼€äº†å‡ ç¯‡æ–‡ç« ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥å®ç° react-thunkï¼Œå°±ä¸æ˜¯å«å®ç° redux-thunk äº†ï¼Œç›´æ¥ä¸Šæºç ï¼Œå› ä¸ºæºç å°± 11 è¡Œã€‚å¦‚æœå¯¹ Redux ä¸­é—´ä»¶è¿˜ä¸ç†è§£çš„ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„ Redux æ–‡ç« ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li><a href="https://jacky-summer.github.io/2020/04/22/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BF%B7%E4%BD%A0Redux%EF%BC%88%E5%9F%BA%E7%A1%80%E7%89%88%EF%BC%89/#more">å®ç°ä¸€ä¸ªè¿·ä½  Reduxï¼ˆåŸºç¡€ç‰ˆï¼‰</a></li><li><a href="https://jacky-summer.github.io/2020/05/14/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AARedux%EF%BC%88%E5%AE%8C%E5%96%84%E7%89%88%EF%BC%89/#more">å®ç°ä¸€ä¸ª Reduxï¼ˆå®Œå–„ç‰ˆï¼‰</a></li><li><a href="https://jacky-summer.github.io/2020/04/28/%E6%B5%85%E8%B0%88React%E7%9A%84Context-API/#more">æµ…è°ˆ React çš„ Context API</a></li><li><a href="https://jacky-summer.github.io/2020/05/24/%E5%B8%A6%E4%BD%A0%E5%AE%9E%E7%8E%B0-react-redux/">å¸¦ä½ å®ç° react-redux</a></li></ul><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨-redux-thunk"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-redux-thunk" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ redux-thunk"></a>ä¸ºä»€ä¹ˆè¦ç”¨ redux-thunk</h2><p>åœ¨ä½¿ç”¨ Redux è¿‡ç¨‹ï¼Œé€šè¿‡ dispatch æ–¹æ³•æ´¾å‘ä¸€ä¸ª action å¯¹è±¡ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ redux-thunk åï¼Œå¯ä»¥ dispatch ä¸€ä¸ª functionã€‚redux-thunk ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ª functionï¼Œå¹¶ä¸”ä¼ é€’ dispatch, getState æ–¹æ³•ä½œä¸ºå‚æ•°ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨è¿™ä¸ª function é‡Œé¢å¤„ç†å¼‚æ­¥é€»è¾‘ï¼Œå¤„ç†å¤æ‚é€»è¾‘ï¼Œè¿™æ˜¯åŸæ¥ Redux åšä¸åˆ°çš„ï¼Œå› ä¸ºåŸæ¥å°±åªèƒ½ dispatch ä¸€ä¸ªç®€å•å¯¹è±¡ã€‚</p><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p>redux-thunk ä½œä¸º redux çš„ä¸­é—´ä»¶ï¼Œä¸»è¦ç”¨æ¥å¤„ç†å¼‚æ­¥è¯·æ±‚ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch, getState</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// to do ...</span></span><br><span class="line">    axios.get(<span class="string">'https://jsonplaceholder.typicode.com/todos/1'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="redux-thunk-æºç "><a href="#redux-thunk-æºç " class="headerlink" title="redux-thunk æºç "></a>redux-thunk æºç </h2><p>redux-thunk çš„æºç æ¯”è¾ƒç®€æ´ï¼Œå®é™…å°± 11 è¡Œã€‚å‰å‡ ç¯‡æˆ‘ä»¬è¯´åˆ° redux çš„ä¸­é—´ä»¶å½¢å¼ï¼Œ<br>æœ¬è´¨ä¸Šæ˜¯å¯¹ store.dispatch æ–¹æ³•è¿›è¡Œäº†å¢å¼ºæ”¹é€ ï¼ŒåŸºæœ¬æ˜¯ç±»ä¼¼è¿™ç§å½¢å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const middleware &#x3D; (store) &#x3D;&gt; next &#x3D;&gt; action &#x3D;&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šäº†ï¼Œå¯ä»¥çœ‹ <a href="https://juejin.im/post/5ebb9375f265da7bfe0bf16a" target="_blank" rel="noopener">å®ç°ä¸€ä¸ª Reduxï¼ˆå®Œå–„ç‰ˆï¼‰</a></p><p>å…ˆç»™ä¸ªç¼©æ°´ç‰ˆçš„å®ç°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> thunk = <span class="function">(<span class="params">&#123; getState, dispatch &#125;</span>) =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action(dispatch, getState)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> next(action)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> thunk</span><br></pre></td></tr></table></figure><ul><li>åŸç†ï¼šå³å½“ action ä¸º function çš„æ—¶å€™ï¼Œå°±è°ƒç”¨è¿™ä¸ª function (ä¼ å…¥ dispatch, getState)å¹¶è¿”å›ï¼›å¦‚æœä¸æ˜¯ï¼Œå°±ç›´æ¥ä¼ ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</li></ul><p>å®Œæ•´æºç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createThunkMiddleware</span>(<span class="params">extraArgument</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">&#123; dispatch, getState &#125;</span>) =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœactionæ˜¯ä¸€ä¸ªfunctionï¼Œå°±è¿”å›action(dispatch, getState, extraArgument)ï¼Œå¦åˆ™è¿”å›next(action)ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> action(dispatch, getState, extraArgument)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// nextä¸ºä¹‹å‰ä¼ å…¥çš„store.dispatchï¼Œå³æ”¹å†™å‰çš„dispatch</span></span><br><span class="line">    <span class="keyword">return</span> next(action)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> thunk = createThunkMiddleware()</span><br><span class="line"><span class="comment">// ç»™thunkè®¾ç½®ä¸€ä¸ªå˜é‡withExtraArgumentï¼Œå¹¶ä¸”å°†createThunkMiddlewareæ•´ä¸ªå‡½æ•°èµ‹ç»™å®ƒ</span></span><br><span class="line">thunk.withExtraArgument = createThunkMiddleware</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> thunk</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°å…¶å®è¿˜å¤šäº† extraArgument ä¼ å…¥ï¼Œè¿™ä¸ªæ˜¯è‡ªå®šä¹‰å‚æ•°ï¼Œå¦‚ä¸‹ç”¨æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> api = <span class="string">'https://jsonplaceholder.typicode.com/todos/1'</span></span><br><span class="line"><span class="keyword">const</span> whatever = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, applyMiddleware(thunk.withExtraArgument(&#123; api, whatever &#125;)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// later</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch, getState, &#123; api, whatever &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// you can use api and something else here</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åŒ redux-thunk éå¸¸æµè¡Œçš„åº“ redux-saga ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨ redux ä¸­åšå¼‚æ­¥è¯·æ±‚ç­‰å‰¯ä½œç”¨ã€‚Redux ç›¸å…³çš„ç³»åˆ—æ–‡ç« å°±æš‚æ—¶å†™åˆ°è¿™éƒ¨åˆ†ä¸ºæ­¢ï¼Œä¸‹æ¬¡ä¼šå†™å…¶ä»–ç³»åˆ—ã€‚</p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>react-thunk</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¦ä½ å®ç°-react-redux</title>
    <url>/2020/05/24/%E5%B8%A6%E4%BD%A0%E5%AE%9E%E7%8E%B0-react-redux/</url>
    <content><![CDATA[<p>ä¹‹å‰æˆ‘ä»¬å®ç°äº† redux çš„åŠŸèƒ½ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹é…åˆ redux å¼€å‘ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„ä¸€ä¸ªåº“â€”â€” react-reduxã€‚æœ¬æ–‡ä¸ä¼šè¯¦ç»†ä»‹ç» react-redux çš„ä½¿ç”¨ï¼Œå¦å¤–éœ€è¦äº†è§£ Context APIï¼Œ å†çœ‹æ­¤æ–‡å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰å†™çš„å‡ ç¯‡æ–‡ç« </p><ul><li><a href="https://jacky-summer.github.io/2020/04/22/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BF%B7%E4%BD%A0Redux%EF%BC%88%E5%9F%BA%E7%A1%80%E7%89%88%EF%BC%89/#more">å®ç°ä¸€ä¸ªè¿·ä½  Reduxï¼ˆåŸºç¡€ç‰ˆï¼‰</a></li><li><a href="https://jacky-summer.github.io/2020/05/14/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AARedux%EF%BC%88%E5%AE%8C%E5%96%84%E7%89%88%EF%BC%89/#more">å®ç°ä¸€ä¸ª Reduxï¼ˆå®Œå–„ç‰ˆï¼‰</a></li><li><a href="https://jacky-summer.github.io/2020/04/28/%E6%B5%85%E8%B0%88React%E7%9A%84Context-API/#more">æµ…è°ˆ React çš„ Context API</a></li></ul><h2 id="react-redux-åŸºæœ¬ä½¿ç”¨"><a href="#react-redux-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="react-redux åŸºæœ¬ä½¿ç”¨"></a>react-redux åŸºæœ¬ä½¿ç”¨</h2><p>ç”¨ä¸ªç®€å•çš„åŠ å‡æ•°å­—ä½œä¾‹å­, æŠŠä»£ç è´´å‡ºæ¥ï¼š</p><ul><li>redux.js</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// actions</span></span><br><span class="line"><span class="keyword">const</span> ADD_NUM = <span class="string">'ADD_NUM'</span></span><br><span class="line"><span class="keyword">const</span> DESC_NUM = <span class="string">'DESC_NUM'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// action creators</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addNumAction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: ADD_NUM,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reduceNumAction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: DESC_NUM,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">  num: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reducer</span></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = defaultState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ADD_NUM:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">num</span>: state.num + <span class="number">1</span> &#125;</span><br><span class="line">    <span class="keyword">case</span> DESC_NUM:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">num</span>: state.num - <span class="number">1</span> &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><p>index.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> Demo <span class="keyword">from</span> <span class="string">'./Demo'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./redux.js'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;Demo /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root')</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><p>Demo.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; addNumAction, reduceNumAction &#125; <span class="keyword">from</span> <span class="string">'./redux.js'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;<span class="keyword">this</span>.props.num&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;this.props.addNum&#125;&gt;å¢åŠ 1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.props.reduceNum&#125;&gt;å‡å°‘<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    num: state.num,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    addNum() &#123;</span><br><span class="line">      <span class="keyword">const</span> action = addNumAction()</span><br><span class="line">      dispatch(action)</span><br><span class="line">    &#125;,</span><br><span class="line">    reduceNum() &#123;</span><br><span class="line">      <span class="keyword">const</span> action = reduceNumAction()</span><br><span class="line">      dispatch(action)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Demo)</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å®ç° num çš„å¢å‡ï¼š</p><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/5/24/172443ab8612774b?w=143&h=82&f=png&s=1764" alt=""><br>å…¶å®ä¸€ä¸ªç®€å•çš„ react-reduxï¼Œ ä¸»è¦ä¹Ÿå°±æ˜¯å®ç° connect å’Œ Provider çš„åŸºæœ¬åŠŸèƒ½</p><ul><li><strong>connect</strong>ï¼šå¯ä»¥æŠŠ state å’Œ dispatch ç»‘å®šåˆ° react ç»„ä»¶ï¼Œä½¿å¾—ç»„ä»¶å¯ä»¥è®¿é—®åˆ° redux çš„æ•°æ®</li><li><strong>Provider</strong>ï¼šæä¾›çš„æ˜¯ä¸€ä¸ªé¡¶å±‚å®¹å™¨çš„ä½œç”¨ï¼Œå®ç° store çš„ä¸Šä¸‹æ–‡ä¼ é€’</li></ul><h2 id="ä½¿ç”¨æ—§ç‰ˆ-Context-API-å®ç°"><a href="#ä½¿ç”¨æ—§ç‰ˆ-Context-API-å®ç°" class="headerlink" title="ä½¿ç”¨æ—§ç‰ˆ Context API å®ç°"></a>ä½¿ç”¨æ—§ç‰ˆ Context API å®ç°</h2><h3 id="å®ç°-Provider"><a href="#å®ç°-Provider" class="headerlink" title="å®ç° Provider"></a>å®ç° Provider</h3><p>é¦–å…ˆæˆ‘ä»¬çœ‹å®ƒçš„ç”¨æ³•ï¼Œå°±çŸ¥é“å®ƒä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªç»„ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Provider store&#x3D;&#123;store&#125;&gt;</span><br><span class="line">    &lt;Demo &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;Provider&gt;</span><br></pre></td></tr></table></figure><p>React çš„ Context API æä¾›äº†ä¸€ç§é€šè¿‡ç»„ä»¶æ ‘ä¼ é€’æ•°æ®çš„æ–¹æ³•ï¼Œæ— éœ€åœ¨æ¯ä¸ªçº§åˆ«æ‰‹åŠ¨ä¼ é€’ props å±æ€§ã€‚</p><p>Provider çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œæ ¸å¿ƒå°±æ˜¯<strong>æŠŠ store æ”¾åˆ° context é‡Œé¢ï¼Œæ‰€æœ‰çš„å­å…ƒç´ å¯ä»¥ç›´æ¥å–åˆ° store</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">    store: PropTypes.object,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.store = props.store <span class="comment">// ä¹Ÿå°±æ˜¯ Provider ç»„ä»¶ä»å¤–éƒ¨ä¼ å…¥çš„ store</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">store</span>: <span class="keyword">this</span>.store &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children <span class="comment">// ä¸­é—´åŒ…çš„ç»„ä»¶ä¼ å…¥äº† contextï¼Œå…¶ä½™åŸå°ä¸åŠ¨è¿”å›ç»„ä»¶</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸ªåœ°æ–¹å¤§å®¶çŸ¥é“å°±å¥½ï¼Œä¸¤ç§å†™æ³•ä¸€æ ·çš„ï¼Œå¯¹ context type çš„çº¦æŸ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸ç”¨ static æ¥å£°æ˜...</span></span><br><span class="line">&#125;</span><br><span class="line">Provider.childContextTypes = &#123;</span><br><span class="line">  store: PropTypes.object,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°-connect"><a href="#å®ç°-connect" class="headerlink" title="å®ç° connect"></a>å®ç° connect</h3><p>connect ç”¨æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Demo)</span><br></pre></td></tr></table></figure><p>connect æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå°±æ˜¯ä»¥ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç»„ä»¶ã€‚</p><p><strong>connect è´Ÿè´£è¿æ¥ç»„ä»¶ï¼Œç»™åˆ° redux çš„æ•°æ®æ”¾åˆ°ç»„ä»¶çš„å±æ€§é‡Œ</strong></p><ol><li>è´Ÿè´£æ¥æ”¶ä¸€ä¸ªç»„ä»¶ï¼ŒæŠŠ state çš„ä¸€äº›æ•°æ®æ”¾è¿›å»ï¼Œè¿”å›ä¸€ä¸ªç»„ä»¶</li><li>æ•°æ®å˜åŒ–çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé€šçŸ¥ç»„ä»¶ï¼ˆéœ€è¦è¿›è¡Œç›‘å¬ï¼‰</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">mapStateToProps, mapDispatchToProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">WrapComponent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">      <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        store: PropTypes.object,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">          props: &#123;&#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</span><br><span class="line">        store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.update()) <span class="comment">// ç›‘å¬æ›´æ–°äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">this</span>.update()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      update() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</span><br><span class="line">        <span class="keyword">let</span> stateToProps = mapStateToProps(store.getState()) <span class="comment">// ä¼ å…¥ redux çš„ state</span></span><br><span class="line">        <span class="keyword">let</span> dispatchToProps = mapDispatchToProps(store.dispatch) <span class="comment">// ä¼ å…¥ redux çš„ dispatch</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          props: &#123;</span><br><span class="line">            ...this.state.props,</span><br><span class="line">            ...stateToProps,</span><br><span class="line">            ...dispatchToProps,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrapComponent</span> &#123;<span class="attr">...this.state.props</span>&#125; /&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ · connect å°±å®ç°äº†ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåƒä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ç›´æ¥ä¼ å…¥ action creatorsï¼Œ è€Œä¸ç”¨è‡ªå·±å®šä¹‰å‡½æ•°ä¼ å…¥ dispatch</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export default connect(mapStateToProps, &#123; addNumAction, reduceNumAction &#125;)(Demo)</span><br></pre></td></tr></table></figure><p>è°ƒç”¨çš„æ—¶å€™ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button onClick&#x3D;&#123;this.props.addNumAction&#125;&gt;å¢åŠ 1&lt;&#x2F;button&gt;</span><br><span class="line">&lt;button onClick&#x3D;&#123;this.props.reduceNumAction&#125;&gt;å‡å°‘1&lt;&#x2F;button&gt;</span><br></pre></td></tr></table></figure><p>é‚£å®ƒçš„ dispatch å“ªé‡Œæ¥çš„ï¼Œå…¶å®æ˜¯ç”¨äº† redux çš„ bindActionCreators å‡½æ•°ï¼Œåœ¨æˆ‘ä»‹ç» redux çš„æ–‡ç« æœ‰æåˆ°ï¼Œå®ƒä½œç”¨æ˜¯å°† actionCreator è½¬åŒ–æˆ dispatch å½¢å¼ï¼Œå³</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123; addNumAction &#125;  &#x3D;&gt;  (...args) &#x3D;&gt; dispatch(addNumAction(args))</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†æ›´æ”¹ connect å‡½æ•°ï¼ŒåŒæ—¶ï¼Œè¿™æ¬¡æˆ‘ä»¬ç”¨ç®­å¤´å‡½æ•°çš„å½¢å¼ç®€åŒ–ä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> connect = <span class="function">(<span class="params">mapStateToProps, mapDispatchToProps</span>) =&gt;</span> <span class="function"><span class="params">WrapComponent</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">      store: PropTypes.object,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">      <span class="keyword">super</span>(props)</span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        props: &#123;&#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</span><br><span class="line">      store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.update())</span><br><span class="line">      <span class="keyword">this</span>.update()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    update() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</span><br><span class="line">      <span class="keyword">let</span> stateToProps = mapStateToProps(store.getState())</span><br><span class="line">      <span class="keyword">let</span> dispatchToProps</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> mapDispatchToProps === <span class="string">'function'</span>) &#123;</span><br><span class="line">        dispatchToProps = mapDispatchToProps(store.dispatch)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ é€’äº†ä¸€ä¸ª actionCreator å¯¹è±¡è¿‡æ¥</span></span><br><span class="line">        dispatchToProps = bindActionCreators(mapDispatchToProps, store.dispatch)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        props: &#123;</span><br><span class="line">          ...this.state.props,</span><br><span class="line">          ...stateToProps,</span><br><span class="line">          ...dispatchToProps,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrapComponent</span> &#123;<span class="attr">...this.state.props</span>&#125; /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šï¼Œæˆ‘ä»¬å®ç°äº†æœ€åŸºæœ¬ç‰ˆçš„ react-reduxï¼Œç„¶åæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨æ–°ç‰ˆçš„ Context API å†å†™ä¸€æ¬¡</p><h2 id="ä½¿ç”¨æ–°ç‰ˆ-Context-API-å®ç°"><a href="#ä½¿ç”¨æ–°ç‰ˆ-Context-API-å®ç°" class="headerlink" title="ä½¿ç”¨æ–°ç‰ˆ Context API å®ç°"></a>ä½¿ç”¨æ–°ç‰ˆ Context API å®ç°</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> StoreContext = React.createContext(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ¬¡ Provider é‡‡å–æ›´ç®€æ´çš„å½¢å¼å†™</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">StoreContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.props.store&#125;</span>&gt;</span>&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">StoreContext.Provider</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">mapStateToProps, mapDispatchToProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">WrapComponent</span>) </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ConnectComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">      <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">          props: &#123;&#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props</span><br><span class="line">        store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.update())</span><br><span class="line">        <span class="keyword">this</span>.update()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      update() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props</span><br><span class="line">        <span class="keyword">let</span> stateToProps = mapStateToProps(store.getState())</span><br><span class="line">        <span class="keyword">let</span> dispatchToProps</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> mapDispatchToProps === <span class="string">'function'</span>) &#123;</span><br><span class="line">          dispatchToProps = mapDispatchToProps(store.dispatch)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// ä¼ é€’äº†ä¸€ä¸ª actionCreator å¯¹è±¡è¿‡æ¥</span></span><br><span class="line">          dispatchToProps = bindActionCreators(mapDispatchToProps, store.dispatch)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          props: &#123;</span><br><span class="line">            ...this.state.props,</span><br><span class="line">            ...stateToProps,</span><br><span class="line">            ...dispatchToProps,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrapComponent</span> &#123;<span class="attr">...this.state.props</span>&#125; /&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">StoreContext.Consumer</span>&gt;</span>&#123;value =&gt; <span class="tag">&lt;<span class="name">ConnectComponent</span> <span class="attr">store</span>=<span class="string">&#123;value&#125;</span> /&gt;</span>&#125;<span class="tag">&lt;/<span class="name">StoreContext.Consumer</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>React</tag>
        <tag>react-redux</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ç°ä¸€ä¸ªReduxï¼ˆå®Œå–„ç‰ˆï¼‰</title>
    <url>/2020/05/14/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AARedux%EF%BC%88%E5%AE%8C%E5%96%84%E7%89%88%EF%BC%89/</url>
    <content><![CDATA[<p>ä¸Šç¯‡å†™äº†å®ç°ä¸€ä¸ªè¿·ä½  Reduxï¼ˆåŸºç¡€ç‰ˆï¼‰ï¼Œæœ¬ç¯‡å°†ç»§ç»­å®Œå–„ Redux</p><a id="more"></a><p>é˜…è¯»æœ¬æ–‡å‰å…ˆçœ‹ï¼š<a href="https://jacky-summer.github.io/2020/04/22/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BF%B7%E4%BD%A0Redux%EF%BC%88%E5%9F%BA%E7%A1%80%E7%89%88%EF%BC%89/">å®ç°ä¸€ä¸ªè¿·ä½  Reduxï¼ˆåŸºç¡€ç‰ˆï¼‰</a></p><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><p>Redux æœ‰ä¸ª API æ˜¯ applyMiddlewareï¼Œ ä¸“é—¨ç”¨æ¥ä½¿ç”¨ä¸­é—´ä»¶çš„ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“ï¼Œå®ƒç”¨æ¥å¹²å˜›çš„ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä¼šéœ€è¦ä¸­é—´ä»¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šéœ€è¦ä¸­é—´ä»¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šéœ€è¦ä¸­é—´ä»¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šéœ€è¦ä¸­é—´ä»¶ï¼Ÿ</h3><p>å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦è®°å½•æ¯æ¬¡çš„ dispatch å‰å state çš„è®°å½•ï¼Œ é‚£è¦æ€ä¹ˆåšå‘¢ï¼Ÿäºæ˜¯ï¼Œç®€å•ç²—æš´çš„åœ¨ç¬¬ä¸€ä¸ª dispatch æ–¹æ³•å‰ååŠ ä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'prev state'</span>, store.getState())</span><br><span class="line"><span class="built_in">console</span>.log(action)</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†è¿è¡Œç»“æœï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">prev state &#123;<span class="attr">value</span>: <span class="number">10</span>&#125;</span><br><span class="line">&#123;<span class="attr">type</span>: <span class="string">"INCREMENT"</span>&#125;</span><br><span class="line">å½“å‰æ•°å­—ä¸ºï¼š<span class="number">11</span></span><br><span class="line">next state &#123;<span class="attr">value</span>: <span class="number">11</span>&#125;</span><br></pre></td></tr></table></figure><p>ä½†åŠ å®Œå‘ç°æƒ…å†µä¸å¯¹ï¼Œé¡µé¢æœ‰å¤šä¸ª dispatch çš„è¯ï¼Œè¦è¿™æ ·å†™å¾ˆå¤šæ¬¡ï¼Œä¼šäº§ç”Ÿå¤§é‡é‡å¤ä»£ç ã€‚çªç„¶ï¼Œåˆè¦åŠ éœ€æ±‚äº†ï¼Œéœ€è¦è®°å½•æ¯æ¬¡å‡ºé”™çš„åŸå› ,å•ç‹¬çš„åŠŸèƒ½è¦æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  store.dispatch(action)</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¸¤ä¸ªéœ€æ±‚éƒ½è¦ï¼Œé‚£å°±å‡‘åˆä¸¤ä¸ªï¼Œä½†å ä¸€èµ·çœ‹æ›´ä¹±äº†ã€‚</p><h3 id="ä¸­é—´ä»¶çš„æ¦‚å¿µ"><a href="#ä¸­é—´ä»¶çš„æ¦‚å¿µ" class="headerlink" title="ä¸­é—´ä»¶çš„æ¦‚å¿µ"></a>ä¸­é—´ä»¶çš„æ¦‚å¿µ</h3><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡è¿™ç§æ–¹å¼æ¥åšã€‚æ¯”è¾ƒç†æƒ³çš„æ–¹æ¡ˆæ˜¯ Redux æœ¬èº«æä¾›ä¸€ä¸ªåŠŸèƒ½å…¥å£ï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨å¤–é¢æ·»åŠ åŠŸèƒ½è¿›å»ï¼Œè¿™æ ·ä»£ç å°±ä¸ä¼šå¤æ‚ã€‚</p><p>ä½†å¦‚æœç»™æˆ‘ä»¬ç°æœ‰å®ç°çš„ Redux æ·»åŠ åŠŸèƒ½ï¼Œåœ¨å“ªä¸ªç¯èŠ‚æ·»åŠ æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿ</p><ul><li>Reducerï¼š çº¯å‡½æ•°ï¼Œåªæ‰¿æ‹…è®¡ç®— State çš„åŠŸèƒ½ï¼Œä¸åˆé€‚æ‰¿æ‹…å…¶ä»–åŠŸèƒ½ï¼Œä¹Ÿæ‰¿æ‹…ä¸äº†ï¼Œå› ä¸ºç†è®ºä¸Šï¼Œçº¯å‡½æ•°ä¸èƒ½è¿›è¡Œè¯»å†™æ“ä½œã€‚</li><li>Viewï¼šä¸ State ä¸€ä¸€å¯¹åº”ï¼Œå¯ä»¥çœ‹ä½œ State çš„è§†è§‰å±‚ï¼Œä¹Ÿä¸åˆé€‚æ‰¿æ‹…å…¶ä»–åŠŸèƒ½ã€‚</li><li>Actionï¼šå­˜æ”¾æ•°æ®çš„å¯¹è±¡ï¼Œå³æ¶ˆæ¯çš„è½½ä½“ï¼Œåªèƒ½è¢«åˆ«äººæ“ä½œï¼Œè‡ªå·±ä¸èƒ½è¿›è¡Œä»»ä½•æ“ä½œã€‚</li></ul><p>æˆ‘ä»¬å‘ç°ï¼Œä»¥ä¸Šéœ€æ±‚éƒ½æ˜¯å’Œ dispatch ç›¸å…³ï¼Œåªæœ‰å‘é€ action çš„è¿™ä¸ªæ­¥éª¤ï¼Œå³ store.dispatch() æ–¹æ³•ï¼Œå¯ä»¥æ·»åŠ åŠŸèƒ½ã€‚æ¯”å¦‚æ·»åŠ æ—¥å¿—åŠŸèƒ½ï¼Œæˆ‘ä»¬åªè¦æŠŠæ—¥å¿—æ”¾è¿› dispatch å‡½æ•°é‡Œï¼Œä¸å°±å¥½äº†å—ï¼Œæˆ‘ä»¬åªéœ€è¦æ”¹é€  dispatch å‡½æ•°ï¼ŒæŠŠ dispatch è¿›è¡Œä¸€å±‚å°è£…ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(counter)</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch</span><br><span class="line">store.dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'prev state'</span>, store.getState())</span><br><span class="line">    <span class="built_in">console</span>.log(action)</span><br><span class="line">    next(action)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ï¼Œå¯¹ store.dispatch è¿›è¡Œäº†é‡æ–°å®šä¹‰ï¼Œè¿™å°±æ˜¯ä¸­é—´ä»¶çš„é›å½¢ã€‚</p><p>æ‰€ä»¥è¯´ Redux çš„ä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ˜¯å¯¹ dispatch æ–¹æ³•çš„æ‰©å±•ï¼Œå¢å¼º dispatch çš„åŠŸèƒ½ã€‚</p><h3 id="å®ç°ä¸­é—´ä»¶"><a href="#å®ç°ä¸­é—´ä»¶" class="headerlink" title="å®ç°ä¸­é—´ä»¶"></a>å®ç°ä¸­é—´ä»¶</h3><p>å¯¹äºä¸Šè¿° dispatch çš„å°è£…ï¼Œå®é™…ä¸Šæ˜¯ç¼ºé™·å¾ˆå¤§çš„ã€‚ä¸‡ä¸€åˆæ¥ n å¤šä¸ªéœ€æ±‚æ€ä¹ˆåŠ? é‚£ dispatch å‡½æ•°å°±æ··ä¹±åˆ°æ— æ³•ç»´æŠ¤äº†ï¼Œæ•…éœ€è¦æ‰©å±•æ€§å¼ºçš„å¤šä¸­é—´ä»¶åˆä½œæ¨¡å¼ã€‚</p><ol><li>æˆ‘ä»¬æŠŠ loggerMiddleware æå–å‡ºæ¥</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(counter)</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'prev state'</span>, store.getState())</span><br><span class="line">  <span class="built_in">console</span>.log(action)</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    loggerMiddleware(action)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>æŠŠ exceptionMiddleware æå–å‡ºæ¥</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    loggerMiddleware(action)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.dispatch = exceptionMiddleware</span><br></pre></td></tr></table></figure><ol start="3"><li>ç°åœ¨ä»£ç æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ exceptionMiddleware ä¸­é—´ä»¶å†™æ­» loggerMiddlewareï¼Œä½†ä»¥ååˆä¸‡ä¸€ä¸è¦è®°å½•åŠŸèƒ½å‘¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®© next(action) å˜æˆåŠ¨æ€çš„ï¼Œå³æ¢å“ªä¸ªä¸­é—´ä»¶éƒ½å¯ä»¥</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// loggerMiddleware(action)</span></span><br><span class="line">    next(action)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå†™æ³•å¯èƒ½åˆšå¼€å§‹çœ‹ä¸å¤ªé€‚åº”ï¼Œå®é™…å°±æ˜¯å‡½æ•°é‡Œé¢ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå³ç­‰æ•ˆäº</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function"><span class="keyword">function</span> (<span class="params">next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// loggerMiddleware(action)</span></span><br><span class="line">      next(action)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ å‚æ•°çš„æ—¶å€™å³æ˜¯ exceptionMiddleware(next)(action)</p><ol start="4"><li>åŒç†ï¼Œæˆ‘ä»¬è®© loggerMiddleware é‡Œé¢æ— æ³•æ‰©å±•åˆ«çš„ä¸­é—´ä»¶äº†ï¼æˆ‘ä»¬ä¹ŸæŠŠ next å†™æˆåŠ¨æ€çš„</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'prev state'</span>, store.getState())</span><br><span class="line">  <span class="built_in">console</span>.log(action)</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰ä¸ºæ­¢ï¼Œæ•´ä¸ªä¸­é—´ä»¶è®¾è®¡æ”¹é€ å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(counter)</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'prev state'</span>, store.getState())</span><br><span class="line">  <span class="built_in">console</span>.log(action)</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    next(action)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.dispatch = exceptionMiddleware(loggerMiddleware(next))</span><br></pre></td></tr></table></figure><ol start="5"><li>ç°åœ¨åˆæœ‰ä¸€ä¸ªæ–°é—®é¢˜ï¼Œæƒ³æƒ³å¹³æ—¶ä½¿ç”¨ä¸­é—´ä»¶æ˜¯ä»å¤–éƒ¨å¼•å…¥çš„ï¼Œé‚£å¤–éƒ¨ä¸­é—´ä»¶é‡Œé¢æ€ä¹ˆä¼šæœ‰ store.getState() è¿™ä¸ªæ–¹æ³•ï¼Œäºæ˜¯æˆ‘ä»¬æŠŠ store ä¹Ÿç»™ç‹¬ç«‹å‡ºå»ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(counter)</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'prev state'</span>, store.getState())</span><br><span class="line">  <span class="built_in">console</span>.log(action)</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    next(action)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯ä¿¡æ¯: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger = loggerMiddleware(store)</span><br><span class="line"><span class="keyword">const</span> exception = exceptionMiddleware(store)</span><br><span class="line">store.dispatch = exception(logger(next))</span><br></pre></td></tr></table></figure><ol start="6"><li>å¦‚æœåˆæœ‰ä¸€ä¸ªæ–°éœ€æ±‚ï¼Œéœ€è¦åœ¨æ‰“å°æ—¥å¿—å‰è¾“å‡ºå½“å‰æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬åˆéœ€è¦æ„é€ ä¸€ä¸ªä¸­é—´ä»¶</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> timeMiddleware = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'time'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>().getTime())</span><br><span class="line">  next(action)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger = loggerMiddleware(store)</span><br><span class="line"><span class="keyword">const</span> exception = exceptionMiddleware(store)</span><br><span class="line"><span class="keyword">const</span> time = timeMiddleware(store)</span><br><span class="line">store.dispatch = exception(time(logger(next)))</span><br></pre></td></tr></table></figure><h3 id="ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–"><a href="#ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–" class="headerlink" title="ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–"></a>ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–</h3><p>ä¸Šé¢çš„å†™æ³•å¯çŸ¥ï¼Œä¸­é—´ä»¶çš„ä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç¹çï¼Œæ•…æˆ‘ä»¬éœ€è¦æŠŠç»†èŠ‚å°è£…èµ·æ¥ï¼Œé€šè¿‡æ‰©å±• createStore æ¥å®ç°ã€‚<br>å…ˆæ¥çœ‹çœ‹æœŸæœ›çš„ç”¨æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* æ¥æ”¶æ—§çš„ createStoreï¼Œè¿”å›æ–°çš„ createStore */</span></span><br><span class="line"><span class="keyword">const</span> newCreateStore = applyMiddleware(exceptionMiddleware, timeMiddleware, loggerMiddleware)(createStore)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿”å›äº†ä¸€ä¸ª dispatch è¢«é‡å†™è¿‡çš„ store */</span></span><br><span class="line"><span class="keyword">const</span> store = newCreateStore(reducer)</span><br></pre></td></tr></table></figure><h3 id="å®ç°-applyMiddleware"><a href="#å®ç°-applyMiddleware" class="headerlink" title="å®ç° applyMiddleware"></a>å®ç° applyMiddleware</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> applyMiddleware = <span class="function"><span class="keyword">function</span> (<span class="params">...middlewares</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* è¿”å›ä¸€ä¸ªé‡å†™createStoreçš„æ–¹æ³• */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">rewriteCreateStoreFunc</span>(<span class="params">oldCreateStore</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* è¿”å›é‡å†™åæ–°çš„ createStore */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">newCreateStore</span>(<span class="params">reducer, preloadedState</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ç”Ÿæˆ store</span></span><br><span class="line">      <span class="keyword">const</span> store = oldCreateStore(reducer, preloadedState)</span><br><span class="line">      <span class="keyword">let</span> dispatch = store.dispatch</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åªæš´éœ² store éƒ¨åˆ†ç»™ä¸­é—´ä»¶ç”¨çš„APIï¼Œè€Œä¸ä¼ å…¥æ•´ä¸ªstore</span></span><br><span class="line">      <span class="keyword">const</span> middlewareAPI = &#123;</span><br><span class="line">        getState: store.getState,</span><br><span class="line">        dispatch: <span class="function"><span class="params">action</span> =&gt;</span> store.dispatch(action),</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ç»™æ¯ä¸ªä¸­é—´ä»¶ä¼ å…¥API</span></span><br><span class="line">      <span class="comment">// ç›¸å½“äº const logger = loggerMiddleware(store)ï¼Œå³ const logger = loggerMiddleware(&#123; getState, dispatch &#125;)</span></span><br><span class="line">      <span class="comment">// const chain = [exception, time, logger]</span></span><br><span class="line">      <span class="keyword">const</span> chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI))</span><br><span class="line">      <span class="comment">// å®ç° exception(time((logger(dispatch))))</span></span><br><span class="line">      chain.reverse().map(<span class="function"><span class="params">middleware</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch = middleware(dispatch)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// é‡å†™dispatch</span></span><br><span class="line">      store.dispatch = dispatch</span><br><span class="line">      <span class="keyword">return</span> store</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹è¿™ä¸€å¤„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">chain.reverse().map(<span class="function"><span class="params">middleware</span> =&gt;</span> &#123;</span><br><span class="line">  dispatch = middleware(dispatch)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„ä¸€ç‚¹ï¼Œä¸­é—´ä»¶æ˜¯é¡ºåºæ‰§è¡Œï¼Œä½†æ˜¯ dispatch å´æ˜¯ååºç”Ÿæˆçš„ã€‚æ‰€ä»¥åœ¨è¿™æ­¥ä¼šæŠŠæ•°ç»„é¡ºåºç»™ååºï¼ˆæ¯”å¦‚ applyMiddleware(A, B, C)ï¼Œå› ä¸º A åœ¨è°ƒç”¨æ—¶éœ€è¦çŸ¥é“ B çš„ dispatchï¼ŒB åœ¨æ‰§è¡Œæ—¶éœ€è¦çŸ¥é“ C çš„ dispatchï¼Œé‚£ä¹ˆéœ€è¦å…ˆçŸ¥é“ C çš„ dispatchã€‚ï¼‰</p><p>å®˜æ–¹ Redux æºç ï¼Œé‡‡ç”¨äº† compose å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿè¯•è¯•è¿™ç§æ–¹å¼æ¥å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> applyMiddleware = <span class="function">(<span class="params">...middlewares</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">createStore</span> =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    dispatch = compose(...chain)(store.dispatch)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// compose(fn1, fn2, fn3)</span></span><br><span class="line"><span class="comment">// fn1(fn2(fn3))</span></span><br><span class="line"><span class="comment">// ä»å³åˆ°å·¦æ¥ç»„åˆå¤šä¸ªå‡½æ•°: ä»å³åˆ°å·¦æŠŠæ¥æ”¶åˆ°çš„å‡½æ•°åˆæˆåçš„æœ€ç»ˆå‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> compose = <span class="function">(<span class="params">...funcs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">ret, item</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> ret(item(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å¯¹ä»£ç ç²¾ç®€ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> applyMiddleware = <span class="function">(<span class="params">...middlewares</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">createStore</span> =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> store = createStore(...args)</span><br><span class="line">    <span class="keyword">let</span> dispatch = store.dispatch</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> middlewareAPI = &#123;</span><br><span class="line">      getState: store.getState,</span><br><span class="line">      dispatch: <span class="function"><span class="params">action</span> =&gt;</span> dispatch(action),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI))</span><br><span class="line">    dispatch = compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> compose = <span class="function">(<span class="params">...funcs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">ret, item</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> ret(item(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="createStore-çš„å¤„ç†"><a href="#createStore-çš„å¤„ç†" class="headerlink" title="createStore çš„å¤„ç†"></a>createStore çš„å¤„ç†</h3><p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œæœ‰ä¸¤ä¸ª createStore äº†ï¼Œè¿™æ€ä¹ˆåŒºåˆ†ï¼Œä¸Šç¯‡æˆ‘ä»¬å…¶å®å·²ç»å…ˆå‘ŠçŸ¥äº†å¯¹ä¸­é—´ä»¶ä»£ç å¤„ç†ï¼Œä½†å…·ä½“æ€ä¹ˆæ¨å‡ºçš„ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ²¡æœ‰ä¸­é—´ä»¶çš„ createStore</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(counter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰ä¸­é—´ä»¶çš„ createStore</span></span><br><span class="line"><span class="keyword">const</span> rewriteCreateStoreFunc = applyMiddleware(exceptionMiddleware, timeMiddleware, loggerMiddleware)</span><br><span class="line"><span class="keyword">const</span> newCreateStore = rewriteCreateStoreFunc(createStore)</span><br><span class="line"><span class="keyword">const</span> store = newCreateStore(counter, preloadedState)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©ç”¨æˆ·ç”¨èµ·æ¥ç»Ÿä¸€ä¸€äº›ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ä½¿ä»–ä»¬çš„ä½¿ç”¨æ–¹å¼ä¸€è‡´ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹ createStore æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = <span class="function">(<span class="params">reducer, preloadedState, rewriteCreateStoreFunc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæœ‰ rewriteCreateStoreFuncï¼Œé‚£å°±é‡‡ç”¨æ–°çš„ createStore</span></span><br><span class="line">  <span class="keyword">if</span> (rewriteCreateStoreFunc) &#123;</span><br><span class="line">    <span class="keyword">const</span> newCreateStore = rewriteCreateStoreFunc(createStore)</span><br><span class="line">    <span class="keyword">return</span> newCreateStore(reducer, preloadedState)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ Redux æºç  rewriteCreateStoreFunc æ¢äº†ä¸ªåå­—ï¼Œè¿˜åŠ äº†åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šç¯‡çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸­é—´ä»¶çš„ç”¨æ³•ä¸º</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(counter, <span class="comment">/* preloadedStateå¯é€‰ */</span> applyMiddleware(logger))</span><br></pre></td></tr></table></figure><h2 id="combineReducers"><a href="#combineReducers" class="headerlink" title="combineReducers"></a>combineReducers</h2><p>å¦‚æœæˆ‘ä»¬åšçš„é¡¹ç›®å¾ˆå¤§ï¼Œæœ‰å¤§é‡ stateï¼Œé‚£ä¹ˆç»´æŠ¤èµ·æ¥å¾ˆéº»çƒ¦ã€‚Redux æä¾›äº† combineReducers è¿™ä¸ªæ–¹æ³•ï¼Œä½œç”¨æ˜¯æŠŠå¤šä¸ª reducer åˆå¹¶æˆä¸€ä¸ª reducerï¼Œ æ¯ä¸ª reducer è´Ÿè´£ç‹¬ç«‹çš„æ¨¡å—ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°ä¾‹å­æ¥ä¸¾ä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initCounterState = &#123;</span><br><span class="line">  value: <span class="number">10</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initInfoState = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">  info: infoReducer,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// counter reducerå¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">counterReducer</span>(<span class="params">state = initCounterState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        value: state.value + <span class="number">1</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        value: state.value - <span class="number">1</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">infoReducer</span>(<span class="params">state = initInfoState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'FULL_NAME'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        name: state.name + <span class="string">' lin'</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> init = store.getState()</span><br><span class="line"><span class="comment">// ä¸€å¼€å§‹counterä¸ºï¼š10ï¼Œinfoä¸º jacky</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`ä¸€å¼€å§‹counterä¸ºï¼š<span class="subst">$&#123;init.counter.value&#125;</span>ï¼Œinfoä¸º <span class="subst">$&#123;init.info.name&#125;</span>`</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listener</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  store.getState()</span><br><span class="line">&#125;</span><br><span class="line">store.subscribe(listener) <span class="comment">// ç›‘å¬stateçš„æ”¹å˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// counterReducer</span></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;)</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;)</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'DECREMENT'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// infoReducer</span></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'FULL_NAME'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå®Œcounterä¸ºï¼š11ï¼Œinfoä¸ºjacky lin</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`æ‰§è¡Œå®Œcounterä¸ºï¼š<span class="subst">$&#123;store.getState().counter.value&#125;</span>ï¼Œinfoä¸º<span class="subst">$&#123;store.getState().info.name&#125;</span>`</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥å°è¯•ä¸‹å¦‚ä½•å®ç°è¿™ä¸ª APIï¼Œ</p><p>é¦–å…ˆè¦æŠŠä¸€ä¸ªå‡½æ•°é‡Œçš„æ‰€æœ‰ reducers å¾ªç¯æ‰§è¡Œä¸€éï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°è¦éµå¾ª(state, action) =&gt; newState æ ¼å¼ã€‚è¿˜éœ€è¦æŠŠæ¯ä¸ª reducer çš„ initState åˆå¹¶æˆä¸€ä¸ª rootStateã€‚<br>å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// reducerKeys = ['counter', 'info']</span></span><br><span class="line">  <span class="keyword">const</span> reducerKeys = <span class="built_in">Object</span>.keys(reducers)</span><br><span class="line">  <span class="comment">// è¿”å›åˆå¹¶åçš„æ–°çš„reducerå‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆçš„æ–°çš„state</span></span><br><span class="line">    <span class="keyword">const</span> nextState = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ‰§è¡Œæ‰€æœ‰çš„reducersï¼Œæ•´åˆæˆä¸ºä¸€ä¸ªæ–°çš„state</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> key = reducerKeys[i]</span><br><span class="line">      <span class="keyword">const</span> reducer = reducers[key]</span><br><span class="line">      <span class="comment">// ä¹‹å‰çš„ key çš„ state</span></span><br><span class="line">      <span class="keyword">const</span> previousStateForKey = state[key]</span><br><span class="line">      <span class="comment">// æ‰§è¡Œ åˆ† reducerï¼Œè·å¾—æ–°çš„state</span></span><br><span class="line">      <span class="keyword">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class="line"></span><br><span class="line">      nextState[key] = nextStateForKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nextState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="replaceReducer"><a href="#replaceReducer" class="headerlink" title="replaceReducer"></a>replaceReducer</h2><blockquote><p>åœ¨å¤§å‹ Web åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸éœ€è¦å°†åº”ç”¨ç¨‹åºä»£ç æ‹†åˆ†ä¸ºå¤šä¸ªå¯ä»¥æŒ‰éœ€åŠ è½½çš„ JS åŒ…ã€‚ è¿™ç§ç§°ä¸ºâ€œä»£ç åˆ†å‰²â€çš„ç­–ç•¥é€šè¿‡å‡å°åˆæ¬¡åŠ è½½æ—¶çš„ JS çš„åŒ…çš„å¤§å°ï¼Œæ¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p></blockquote><p>reducer æ‹†åˆ†åï¼Œå’Œç»„ä»¶æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æˆ‘ä»¬å°±å¸Œæœ›åœ¨åšæŒ‰éœ€åŠ è½½çš„æ—¶å€™ï¼Œreducer ä¹Ÿå¯ä»¥è·Ÿç€ç»„ä»¶åœ¨å¿…è¦çš„æ—¶å€™å†åŠ è½½ï¼Œç„¶åç”¨æ–°çš„ reducer æ›¿æ¢è€çš„ reducerã€‚ä½†å®é™…ä¸Šåªæœ‰ä¸€ä¸ª root reducer å‡½æ•°, å¦‚æœè¦å®ç°çš„è¯å°±å¯ä»¥ç”¨ replaceReducer è¿™ä¸ªå‡½æ•°ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = <span class="function"><span class="keyword">function</span> (<span class="params">reducer, initState</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> replaceReducer = <span class="function"><span class="params">nextReducer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> nextReducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the nextReducer to be a function.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    reducer = nextReducer</span><br><span class="line">    <span class="comment">// åˆ·æ–°ä¸€é state çš„å€¼ï¼Œæ–°æ¥çš„ reducer æŠŠè‡ªå·±çš„é»˜è®¤çŠ¶æ€æ”¾åˆ° state æ ‘ä¸Šå»</span></span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="built_in">Symbol</span>() &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    replaceReducer,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç”Ÿæˆæ–°çš„reducer*/</span></span><br><span class="line"><span class="keyword">const</span> nextReducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">  info: infoReducer,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/*replaceReducer*/</span></span><br><span class="line">store.replaceReducer(nextReducer)</span><br></pre></td></tr></table></figure><h2 id="bindActionCreators"><a href="#bindActionCreators" class="headerlink" title="bindActionCreators"></a>bindActionCreators</h2><p>bindActionCreators ä¸€èˆ¬æ¯”è¾ƒå°‘ç”¨åˆ°ï¼Œåœ¨ react-redux çš„ connect å‡½æ•°å®ç°ä¼šç”¨åˆ°</p><p>ä¼šä½¿ç”¨åˆ° bindActionCreators çš„åœºæ™¯æ˜¯å½“ä½ éœ€è¦æŠŠ action creator å¾€ä¸‹ä¼ åˆ°ä¸€ä¸ªç»„ä»¶ä¸Šï¼Œå´ä¸æƒ³è®©è¿™ä¸ªç»„ä»¶è§‰å¯Ÿåˆ° Redux çš„å­˜åœ¨ï¼Œè€Œä¸”ä¸å¸Œæœ›æŠŠ dispatch æˆ– Redux store ä¼ ç»™å®ƒã€‚</p><p>æˆ‘ä»¬é€šè¿‡æ™®é€šçš„æ–¹å¼æ¥ éšè— dispatch å’Œ actionCreator è¯•è¯•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">  info: infoReducer,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å› action çš„å‡½æ•°å°±å« actionCreator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'INCREMENT'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'FULL_NAME'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  increment: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> store.dispatch(increment.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> store.dispatch(getName.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…¶ä»–åœ°æ–¹åœ¨å®ç°è‡ªå¢çš„æ—¶å€™ï¼Œæ ¹æœ¬ä¸çŸ¥é“ dispatchï¼ŒactionCreatorç­‰ç»†èŠ‚</span></span><br><span class="line">actions.increment() <span class="comment">// è‡ªå¢</span></span><br><span class="line">actions.getName() <span class="comment">// è·å¾—å…¨å</span></span><br></pre></td></tr></table></figure><p>æŠŠ actions ç”Ÿæˆæ—¶å€™çš„å…¬å…±ä»£ç æå–å‡ºæ¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = bindActionCreators(&#123; increment, getName &#125;, store.dispatch)</span><br></pre></td></tr></table></figure><p>bindActionCreators çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿”å›åŒ…è£¹ dispatch çš„å‡½æ•°, å°† actionCreator è½¬åŒ–æˆ dispatch å½¢å¼</span></span><br><span class="line"><span class="comment">// eg. &#123; addNumAction &#125;  =&gt;  (...args) =&gt; dispatch(addNumAction(args))</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dispatch(actionCreator.apply(<span class="keyword">this</span>, args))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreators, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> bindActionCreator(actionCreators, dispatch)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// actionCreators å¿…é¡»æ˜¯ function æˆ–è€… object</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators !== <span class="string">'object'</span> || actionCreators === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(actionCreators)</span><br><span class="line">  <span class="keyword">const</span> boundActionCreators = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="keyword">const</span> actionCreator = actionCreators[key]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator === <span class="string">'function'</span>) &#123;</span><br><span class="line">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> boundActionCreators</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯èƒ½å¤§å®¶çœ‹åˆ°è¿™é‡Œæœ‰ç‚¹æ‡µé€¼ï¼Œè®©æˆ‘ä»¬æ¥å›å¿†ä¸‹ react-redux ä¸­ connect å‡½æ•°çš„ç”¨æ³•ï¼Œ<br>æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ª actionCreators</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// actionCreators.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addNumAction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'ADD_NUM'</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Demo.jsï¼šåœ¨éœ€è¦ç”¨åˆ° store æ•°æ®çš„ç»„ä»¶ï¼Œå¦‚ Demo ç»„ä»¶åº•éƒ¨æˆ‘ä»¬ç”¨ connect å‡½æ•°è¿æ¥ï¼Œå¦‚ä¸‹:</span></span><br><span class="line"><span class="keyword">import</span> &#123; addNumAction &#125; <span class="keyword">from</span> <span class="string">'./actionCreators'</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> (&#123;</span><br><span class="line">  addNum() &#123;</span><br><span class="line">    dispatch(addNumAction())</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Demo)</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡é¡µé¢çš„æŒ‰é’®æ¥å‡ºå‘ action ä¸º ADD_NUM å¯¹åº”äº‹ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="keyword">this</span>.props.addNum&#125;&gt;å¢åŠ <span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†é™¤äº†ä¸Šé¢çš„ç”¨æ³•ï¼ŒmapDispatchToProps ä¹Ÿå¯ä»¥è¿™æ ·ç”¨ï¼Œç›´æ¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½æ²¡æœ‰ dispatch æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, &#123; addNumAction &#125;)(Demo)</span><br></pre></td></tr></table></figure><p>ç„¶ååªéœ€è§¦å‘ addNumAction å°±èƒ½å®ç°å’Œä¸Šé¢ä¸€æ ·çš„æ•ˆæœã€‚</p><p>ä¸ºä»€ä¹ˆå¯ä»¥ä¸ä¼ ï¼Œå½“ä½ ä¼ å…¥å¯¹è±¡çš„æ—¶å€™ï¼Œ connect å‡½æ•°ä¼šåˆ¤æ–­ï¼Œå¤§è‡´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> dispatchToProps</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> mapDispatchToProps === <span class="string">'function'</span>) &#123;</span><br><span class="line">  dispatchToProps = mapDispatchToProps(store.dispatch)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// ä¼ é€’äº†ä¸€ä¸ª actionCreator å¯¹è±¡è¿‡æ¥</span></span><br><span class="line">  dispatchToProps = bindActionCreators(mapDispatchToProps, store.dispatch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä½¿ç”¨äº† bindActionCreators å‡½æ•°ï¼Œå®ƒå°±æ˜¯æŠŠä½ ä¼ å…¥çš„ actionCreator å†åŒ…ä¸€å±‚ dispatch æ–¹æ³•ï¼Œå³</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; addNumAction &#125;  =&gt;  <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(addNumAction(args))</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Redux å®ç°è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼ŒæŠŠåŸç†ææ‡‚äº†ç¡®å®å¯¹ Redux çš„ç†è§£åŠ æ·±äº†å¥½å¤šï¼Œä¹‹åä¼šç»§ç»­å†™ç›¸å…³æ’ä»¶çš„å®ç°ï¼Œå¦‚ react-redux ç­‰ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://github.com/brickspert/blog/issues/22" target="_blank" rel="noopener">å®Œå…¨ç†è§£ reduxï¼ˆä»é›¶å®ç°ä¸€ä¸ª reduxï¼‰</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±å§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>React</tag>
        <tag>Redux</tag>
      </tags>
  </entry>
  <entry>
    <title>æ€»ç»“JSæ•°ç»„æ–¹æ³•</title>
    <url>/2020/05/10/%E6%80%BB%E7%BB%93JS%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä½¿ç”¨æ•°ç»„æ–¹æ³•çš„æƒ…å†µæ˜¯å¾ˆå¤šçš„ã€‚ä½†æ€»æœ‰å‡ ä¸ªæ–¹æ³•ç”¨å¾—ä¸æ˜¯å¾ˆå¤šï¼Œå°±å®¹æ˜“å¿˜è®°å…·ä½“ç”¨æ³•ï¼Œäºæ˜¯ï¼Œä»Šå¤©æ‰“ç®—åšä¸‹æ€»ç»“ç¬”è®°ï¼Œå›é¡¾æ•°ç»„æ–¹æ³•ã€‚</p>
<a id="more"></a>

<h2 id="æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ9-ä¸ªï¼‰"><a href="#æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ9-ä¸ªï¼‰" class="headerlink" title="æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ9 ä¸ªï¼‰"></a>æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ9 ä¸ªï¼‰</h2><h3 id="push-å’Œ-pop"><a href="#push-å’Œ-pop" class="headerlink" title="push()å’Œ pop()"></a>push()å’Œ pop()</h3><p>å…±åŒç‚¹ï¼š<strong>æ•°ç»„å°¾éƒ¨æ“ä½œçš„æ–¹æ³•</strong></p>
<h4 id="push"><a href="#push" class="headerlink" title="push()"></a>push()</h4><ul>
<li>ç”¨æ³•ï¼špush() æ–¹æ³•å¯å‘æ•°ç»„çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦ã€‚</li>
<li>è¿”å›å€¼ï¼šæŠŠæŒ‡å®šçš„å€¼æ·»åŠ åˆ°æ•°ç»„åçš„æ–°é•¿åº¦ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.push(newEle1, newEle2, ..., newEleX)  è¦æ·»åŠ åˆ°æ•°ç»„æœ«å°¾çš„å…ƒç´ </span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">arr.push(<span class="number">4</span>) <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [1, 2, 4]</span></span><br></pre></td></tr></table></figure>

<h4 id="pop"><a href="#pop" class="headerlink" title="pop()"></a>pop()</h4><ul>
<li>ç”¨æ³•ï¼špop() æ–¹æ³•ç”¨äºåˆ é™¤å¹¶è¿”å›æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</li>
<li>è¿”å›å€¼ï¼šarrayObject çš„æœ€åä¸€ä¸ªå…ƒç´ </li>
<li>è¯´æ˜ï¼šå¦‚æœæ•°ç»„å·²ç»ä¸ºç©ºï¼Œåˆ™ pop() ä¸æ”¹å˜æ•°ç»„ï¼Œå¹¶è¿”å› undefined å€¼ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.pop()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">arr.pop() <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure>

<h3 id="shift-å’Œ-unshift"><a href="#shift-å’Œ-unshift" class="headerlink" title="shift()å’Œ unshift()"></a>shift()å’Œ unshift()</h3><p>å…±åŒç‚¹ï¼š<strong>æ•°ç»„é¦–éƒ¨æ“ä½œçš„æ–¹æ³•</strong></p>
<h4 id="shift"><a href="#shift" class="headerlink" title="shift()"></a>shift()</h4><ul>
<li>ç”¨æ³•ï¼šç”¨äºæŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä»å…¶ä¸­åˆ é™¤ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚</li>
<li>è¿”å›å€¼ï¼šæ•°ç»„åŸæ¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚</li>
<li>è¯´æ˜ï¼šå¦‚æœæ•°ç»„æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆ shift() æ–¹æ³•å°†ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œè¿”å› undefined å€¼ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.shift()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">arr.shift() <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [2, 3]</span></span><br></pre></td></tr></table></figure>

<h4 id="unshift"><a href="#unshift" class="headerlink" title="unshift()"></a>unshift()</h4><ul>
<li>ç”¨æ³•ï¼šå¯å‘æ•°ç»„çš„å¼€å¤´æ·»åŠ ä¸€ä¸ªæˆ–æ›´å¤šå…ƒç´ ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦ã€‚</li>
<li>è¿”å›å€¼ï¼šarrayObject çš„æ–°é•¿åº¦ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.unshift(newEle1, newEle2, ..., newEleX)  è¦æ·»åŠ åˆ°æ•°ç»„é¦–éƒ¨çš„å…ƒç´ </span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">arr.unshift(<span class="number">100</span>) <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [100, 1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<h3 id="reverse-å’Œ-sort"><a href="#reverse-å’Œ-sort" class="headerlink" title="reverse()å’Œ sort()"></a>reverse()å’Œ sort()</h3><p>å…±åŒç‚¹ï¼š<strong>é‡æ’åºçš„æ–¹æ³•</strong></p>
<h4 id="reverse"><a href="#reverse" class="headerlink" title="reverse()"></a>reverse()</h4><ul>
<li>ç”¨æ³•ï¼šç”¨äºé¢ å€’æ•°ç»„ä¸­å…ƒç´ çš„é¡ºåºã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.reverse()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">arr.reverse()</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// ['c', 'b', 'a']</span></span><br></pre></td></tr></table></figure>

<h4 id="sort"><a href="#sort" class="headerlink" title="sort()"></a>sort()</h4><ul>
<li>ç”¨æ³•ï¼šç”¨äºå¯¹æ•°ç»„çš„å…ƒç´ è¿›è¡Œæ’åºã€‚</li>
<li>è¯´æ˜ï¼šå¦‚æœè°ƒç”¨è¯¥æ–¹æ³•æ—¶æ²¡æœ‰ä½¿ç”¨å‚æ•°ï¼Œå°†æŒ‰å­—æ¯é¡ºåºå¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œè¯´å¾—æ›´ç²¾ç¡®ç‚¹ï¼Œæ˜¯æŒ‰ç…§å­—ç¬¦ç¼–ç çš„é¡ºåºè¿›è¡Œæ’åºã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆåº”æŠŠæ•°ç»„çš„å…ƒç´ éƒ½è½¬æ¢æˆå­—ç¬¦ä¸²ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œæ¯”è¾ƒã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.sort(sortby) å¯é€‰ã€‚è§„å®šæ’åºé¡ºåºã€‚å¿…é¡»æ˜¯å‡½æ•°ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'monkey'</span>, <span class="string">'jacky'</span>, <span class="string">'tom'</span>, <span class="string">'john'</span>]</span><br><span class="line">arr.sort()</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// ['jacky', 'john', 'monkey', 'tom']</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ¯”è¾ƒå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sortçš„æ¯”è¾ƒå‡½æ•°æœ‰ä¸¤ä¸ªé»˜è®¤å‚æ•°ï¼Œæ¥å—å‚æ•°ç„¶åè¿”å›ä¸€ä¸ªç”¨äºè¯´æ˜è¿™ä¸¤ä¸ªå€¼çš„ç›¸å¯¹é¡ºåºçš„æ•°å­—ã€‚æ¯”è¾ƒå‡½æ•°åº”è¯¥å…·æœ‰ä¸¤ä¸ªå‚æ•° a å’Œ bï¼Œå…¶è¿”å›å€¼å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">è‹¥ a å°äº bï¼Œåœ¨æ’åºåçš„æ•°ç»„ä¸­ a åº”è¯¥å‡ºç°åœ¨ b ä¹‹å‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªå°äº 0 çš„å€¼ã€‚</span><br><span class="line">è‹¥ a ç­‰äº bï¼Œåˆ™è¿”å› 0ã€‚</span><br><span class="line">è‹¥ a å¤§äº bï¼Œåˆ™è¿”å›ä¸€ä¸ªå¤§äº 0 çš„å€¼ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">100</span>, <span class="number">4</span>, <span class="number">8</span>]</span><br><span class="line"><span class="comment">// å‡åº</span></span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [1, 3, 4, 5, 7, 8, 100]</span></span><br><span class="line"><span class="comment">// é™åº</span></span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> b - a</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [100, 8, 7, 5, 4, 3, 1]</span></span><br></pre></td></tr></table></figure>

<h3 id="splice"><a href="#splice" class="headerlink" title="splice()"></a>splice()</h3><ul>
<li>ç”¨æ³•ï¼šå‘/ä»æ•°ç»„ä¸­æ·»åŠ /åˆ é™¤é¡¹ç›®ï¼Œç„¶åè¿”å›è¢«åˆ é™¤çš„é¡¹ç›®ã€‚</li>
<li>è¿”å›å€¼ï¼šåŒ…å«è¢«åˆ é™¤é¡¹ç›®çš„æ–°æ•°ç»„ï¼Œå¦‚æœæœ‰çš„è¯ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.splice(index, howmany, item1, ....., itemX)</span><br><span class="line"><span class="comment">// index:å¿…éœ€ã€‚æ•´æ•°ï¼Œè§„å®šæ·»åŠ /åˆ é™¤é¡¹ç›®çš„ä½ç½®ï¼Œä½¿ç”¨è´Ÿæ•°å¯ä»æ•°ç»„ç»“å°¾å¤„è§„å®šä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">// howmany:å¿…éœ€ã€‚è¦åˆ é™¤çš„é¡¹ç›®æ•°é‡ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™ä¸ä¼šåˆ é™¤é¡¹ç›®ã€‚</span></span><br><span class="line"><span class="comment">// item, ..., itemX:å¯é€‰ã€‚å‘æ•°ç»„æ·»åŠ çš„æ–°é¡¹ç›®ã€‚</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤å…ƒç´ </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">arr.splice(<span class="number">1</span>, <span class="number">1</span>) <span class="comment">// åˆ é™¤æ•°ç»„ä¸‹æ ‡ä¸º 1 çš„å…ƒç´ ï¼Œåˆ é™¤ä¸€ä¸ª</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [1, 3, 4, 5, 6, 7, 8]</span></span><br><span class="line">arr.splice(<span class="number">-3</span>, <span class="number">2</span>) <span class="comment">// ä»å€’æ•°ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹åˆ é™¤ï¼Œåˆ é™¤ä¸¤ä¸ª</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [1, 3, 4, 5, 8]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤å¹¶æ·»åŠ </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">arr.splice(<span class="number">0</span>, <span class="number">2</span>, <span class="number">100</span>) <span class="comment">// åˆ é™¤æ•°ç»„ä¸‹æ ‡ä¸º 0 çš„å…ƒç´ ï¼Œåˆ é™¤ä¸¤ä¸ªï¼›å¹¶åœ¨æ•°ç»„ä¸‹æ ‡ä¸º0çš„ä½ç½®æ·»åŠ 100</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [100, 3, 4, 5, 6, 7, 8]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸åˆ é™¤åªæ·»åŠ </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">arr.splice(<span class="number">0</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>) <span class="comment">// åœ¨æ•°ç»„ä¸‹æ ‡ä¸º0çš„ä½ç½®æ·»åŠ 9 10 11</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [9, 10, 11, 1, 2, 3, 4, 5, 6, 7, 8]</span></span><br></pre></td></tr></table></figure>

<h3 id="ES6ï¼šfill"><a href="#ES6ï¼šfill" class="headerlink" title="ES6ï¼šfill()"></a>ES6ï¼šfill()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨äºå°†ä¸€ä¸ªå›ºå®šå€¼æ›¿æ¢æ•°ç»„çš„å…ƒç´ ã€‚</li>
<li>è¿”å›å€¼ï¼šä¿®æ”¹åçš„æ•°ç»„ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.fill(value, start, end)</span><br><span class="line"><span class="comment">// value:å¿…éœ€ã€‚å¡«å……çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">// start:å¯é€‰ã€‚å¼€å§‹å¡«å……ä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">// end:	å¯é€‰ã€‚åœæ­¢å¡«å……ä½ç½® (é»˜è®¤ä¸º arrayObject.length)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¡«å…… "replace" åˆ°æ•°ç»„çš„ç¬¬ä¸‰å’Œç¬¬å››ä¸ªå…ƒç´ ï¼š</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</span><br><span class="line">arr.fill(<span class="string">'replace'</span>, <span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// ["a", "b", "replace", "replace", "e"]</span></span><br></pre></td></tr></table></figure>

<h3 id="ES6ï¼šcopyWithin"><a href="#ES6ï¼šcopyWithin" class="headerlink" title="ES6ï¼šcopyWithin()"></a>ES6ï¼šcopyWithin()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨äºä»æ•°ç»„çš„æŒ‡å®šä½ç½®æ‹·è´å…ƒç´ åˆ°æ•°ç»„çš„å¦ä¸€ä¸ªæŒ‡å®šä½ç½®ä¸­ã€‚</li>
<li>è¿”å›å€¼ï¼šä¿®æ”¹åçš„æ•°ç»„ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.copyWithin(target, start, end)</span><br><span class="line"><span class="comment">// value:å¿…éœ€ã€‚å¤åˆ¶åˆ°æŒ‡å®šç›®æ ‡ç´¢å¼•ä½ç½®ã€‚ã€‚</span></span><br><span class="line"><span class="comment">// start:å¯é€‰ã€‚å…ƒç´ å¤åˆ¶çš„èµ·å§‹ä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">// end:	å¯é€‰ã€‚åœæ­¢å¤åˆ¶çš„ç´¢å¼•ä½ç½® (é»˜è®¤ä¸º arrayObject.length)ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</span><br><span class="line">arr.copyWithin(<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// ["a", "b", "a", "b", "e"]</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ8-ä¸ªï¼‰"><a href="#ä¸æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ8-ä¸ªï¼‰" class="headerlink" title="ä¸æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ8 ä¸ªï¼‰"></a>ä¸æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼ˆ8 ä¸ªï¼‰</h2><ul>
<li>æ³¨: æ•°ç»„çš„æ¯ä¸€é¡¹æ˜¯ç®€å•æ•°æ®ç±»å‹ï¼Œä¸”æœªç›´æ¥æ“ä½œæ•°ç»„çš„æƒ…å†µä¸‹</li>
</ul>
<h3 id="slice"><a href="#slice" class="headerlink" title="slice()"></a>slice()</h3><ul>
<li>ç”¨æ³•ï¼šä»å·²æœ‰çš„æ•°ç»„ä¸­è¿”å›é€‰å®šçš„å…ƒç´ ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ŒåŒ…å«ä» start åˆ° end ï¼ˆä¸åŒ…æ‹¬è¯¥å…ƒç´ ï¼‰çš„ arrayObject ä¸­çš„å…ƒç´ ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.slice(start, end)</span><br><span class="line"><span class="comment">// start:å¿…éœ€ã€‚è§„å®šä»ä½•å¤„å¼€å§‹é€‰å–ã€‚å¦‚æœæ˜¯è´Ÿæ•°ï¼Œé‚£ä¹ˆå®ƒè§„å®šä»æ•°ç»„å°¾éƒ¨å¼€å§‹ç®—èµ·çš„ä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">// end:å¯é€‰ã€‚è§„å®šä»ä½•å¤„ç»“æŸé€‰å–ã€‚è¯¥å‚æ•°æ˜¯æ•°ç»„ç‰‡æ–­ç»“æŸå¤„çš„æ•°ç»„ä¸‹æ ‡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å‚æ•°ï¼Œé‚£ä¹ˆåˆ‡åˆ†çš„æ•°ç»„åŒ…å«ä» start åˆ°æ•°ç»„ç»“æŸçš„æ‰€æœ‰å…ƒç´ ã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</span><br><span class="line"><span class="built_in">console</span>.log(arr.slice()) <span class="comment">// ["a", "b", "c", "d", "e"]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.slice(<span class="number">2</span>)) <span class="comment">// ["c", "d", "e"]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.slice(<span class="number">0</span>, <span class="number">3</span>)) <span class="comment">// ["a", "b", "c"]</span></span><br></pre></td></tr></table></figure>

<h3 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf()"></a>indexOf()</h3><ul>
<li>ç”¨æ³•ï¼šæ–¹æ³•è¿”å›åœ¨æ•°ç»„ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç»™å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›-1ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.indexOf(item, start)</span><br><span class="line"><span class="comment">// start:å¿…é¡»ã€‚æŸ¥æ‰¾çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">// end:	å¯é€‰çš„æ•´æ•°å‚æ•°ã€‚è§„å®šåœ¨æ•°ç»„ä¸­å¼€å§‹æ£€ç´¢çš„ä½ç½®ã€‚å®ƒçš„åˆæ³•å–å€¼æ˜¯ 0 åˆ° stringObject.length - 1ã€‚å¦‚çœç•¥è¯¥å‚æ•°ï¼Œåˆ™å°†ä»å­—ç¬¦ä¸²çš„é¦–å­—ç¬¦å¼€å§‹æ£€ç´¢ã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'a'</span>]</span><br><span class="line"><span class="built_in">console</span>.log(arr.indexOf(<span class="string">'c'</span>)) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.indexOf(<span class="string">'a'</span>, <span class="number">1</span>)) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>

<h3 id="lastIndexOf"><a href="#lastIndexOf" class="headerlink" title="lastIndexOf()"></a>lastIndexOf()</h3><ul>
<li>ç”¨æ³•ï¼šè¿”å›ä¸€ä¸ªæŒ‡å®šçš„å…ƒç´ åœ¨æ•°ç»„ä¸­æœ€åå‡ºç°çš„ä½ç½®ï¼Œä»è¯¥å­—ç¬¦ä¸²çš„åé¢å‘å‰æŸ¥æ‰¾ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.lastIndexOf(item, start)</span><br><span class="line"><span class="comment">// start:å¿…é¡»ã€‚æŸ¥æ‰¾çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">// end:	å¯é€‰çš„æ•´æ•°å‚æ•°ã€‚è§„å®šåœ¨æ•°ç»„ä¸­å¼€å§‹æ£€ç´¢çš„ä½ç½®ã€‚å®ƒçš„åˆæ³•å–å€¼æ˜¯ 0 åˆ° stringObject.length - 1ã€‚åˆ™å°†ä»å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦å¤„å¼€å§‹æ£€ç´¢ã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'a'</span>]</span><br><span class="line"><span class="built_in">console</span>.log(arr.lastIndexOf(<span class="string">'a'</span>)) <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.lastIndexOf(<span class="string">'b'</span>, <span class="number">2</span>)) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h3 id="join"><a href="#join" class="headerlink" title="join()"></a>join()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨äºæŠŠæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ æ”¾å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å…ƒç´ æ˜¯é€šè¿‡æŒ‡å®šçš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†éš”çš„ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¯¥å­—ç¬¦ä¸²æ˜¯é€šè¿‡æŠŠ arrayObject çš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åæŠŠè¿™äº›å­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œåœ¨ä¸¤ä¸ªå…ƒç´ ä¹‹é—´æ’å…¥ separator å­—ç¬¦ä¸²è€Œç”Ÿæˆçš„ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.join(separator)</span><br><span class="line"><span class="comment">// separator:å¯é€‰ã€‚æŒ‡å®šè¦ä½¿ç”¨çš„åˆ†éš”ç¬¦ã€‚å¦‚æœçœç•¥è¯¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'a'</span>]</span><br><span class="line"><span class="built_in">console</span>.log(arr.join()) <span class="comment">// a,b,c,b,e,a</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.join(<span class="string">'.'</span>)) <span class="comment">// a.b.c.b.e.a</span></span><br></pre></td></tr></table></figure>

<h3 id="concat"><a href="#concat" class="headerlink" title="concat()"></a>concat()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨äºè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚è¯¥æ•°ç»„æ˜¯é€šè¿‡æŠŠæ‰€æœ‰ arrayX å‚æ•°æ·»åŠ åˆ° arrayObject ä¸­ç”Ÿæˆçš„ã€‚å¦‚æœè¦è¿›è¡Œ concat() æ“ä½œçš„å‚æ•°æ˜¯æ•°ç»„ï¼Œé‚£ä¹ˆæ·»åŠ çš„æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.concat(arrayX, arrayX, ......, arrayX)</span><br><span class="line"><span class="comment">// arrayX: å¿…éœ€ã€‚è¯¥å‚æ•°å¯ä»¥æ˜¯å…·ä½“çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„å¯¹è±¡ã€‚å¯ä»¥æ˜¯ä»»æ„å¤šä¸ªã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"><span class="built_in">console</span>.log(arr1.concat(<span class="number">4</span>, <span class="number">5</span>)) <span class="comment">// [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr1.concat(arr2)) <span class="comment">// [1, 2, 3, 6, 7, 8]</span></span><br></pre></td></tr></table></figure>

<h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h3><ul>
<li>ç”¨æ³•ï¼šæŠŠæ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ç»“æœã€‚</li>
<li>è¿”å›å€¼ï¼šarrayObject çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚è¿”å›å€¼ä¸æ²¡æœ‰å‚æ•°çš„ join() æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ç›¸åŒã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.toString()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'a'</span>]</span><br><span class="line"><span class="built_in">console</span>.log(arr.toString()) <span class="comment">// a,b,c,b,e,a</span></span><br></pre></td></tr></table></figure>

<p>ç›¸å¯¹ join() æ–¹æ³•ï¼Œæ›´æ¨èä½¿ç”¨ join() æ–¹æ³•ï¼Œä¸æ¨èä½¿ç”¨è¯¥æ–¹æ³•</p>
<h3 id="toLocaleString-NaN"><a href="#toLocaleString-NaN" class="headerlink" title="toLocaleString()"></a>toLocaleString()</h3><ul>
<li>ç”¨æ³•ï¼šæŠŠæ•°ç»„è½¬æ¢ä¸ºæœ¬åœ°å­—ç¬¦ä¸²ã€‚</li>
<li>è¿”å›å€¼ï¼šarrayObject çš„æœ¬åœ°å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</li>
<li>è¯´æ˜ï¼šé¦–å…ˆè°ƒç”¨æ¯ä¸ªæ•°ç»„å…ƒç´ çš„ toLocaleString() æ–¹æ³•ï¼Œç„¶åä½¿ç”¨åœ°åŒºç‰¹å®šçš„åˆ†éš”ç¬¦æŠŠç”Ÿæˆçš„å­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.toLocaleString()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="number">23</span>, &#123; <span class="attr">name</span>: <span class="string">'jacky'</span> &#125;, <span class="keyword">new</span> <span class="built_in">Date</span>()]</span><br><span class="line"><span class="built_in">console</span>.log(arr.toLocaleString()) <span class="comment">// a,23,[object Object],2020/5/10 ä¸Šåˆ10:58:37</span></span><br></pre></td></tr></table></figure>

<h3 id="includes"><a href="#includes" class="headerlink" title="includes()"></a>includes()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œæ ¹æ®æƒ…å†µï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</li>
<li>è¿”å›å€¼ï¼šarrayObject çš„æœ¬åœ°å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</li>
<li>è¯´æ˜ï¼šé¦–å…ˆè°ƒç”¨æ¯ä¸ªæ•°ç»„å…ƒç´ çš„ toLocaleString() æ–¹æ³•ï¼Œç„¶åä½¿ç”¨åœ°åŒºç‰¹å®šçš„åˆ†éš”ç¬¦æŠŠç”Ÿæˆçš„å­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.includes(searchElement, fromIndex)</span><br><span class="line"><span class="comment">// searchElementï¼šå¿…é¡»ã€‚éœ€è¦æŸ¥æ‰¾çš„å…ƒç´ å€¼ã€‚</span></span><br><span class="line"><span class="comment">// fromIndexï¼šå¯é€‰ã€‚ä»è¯¥ç´¢å¼•å¤„å¼€å§‹æŸ¥æ‰¾ searchElementã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œåˆ™æŒ‰å‡åºä» array.length + fromIndex çš„ç´¢å¼•å¼€å§‹æœç´¢ã€‚é»˜è®¤ä¸º 0ã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(arr.includes(<span class="number">2</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.includes(<span class="number">4</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.includes(<span class="number">3</span>, <span class="number">3</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.includes(<span class="number">3</span>, <span class="number">-1</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="éå†æ–¹æ³•"><a href="#éå†æ–¹æ³•" class="headerlink" title="éå†æ–¹æ³•"></a>éå†æ–¹æ³•</h2><h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach()"></a>forEach()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨äºè°ƒç”¨æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶å°†å…ƒç´ ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, arr</span>), <span class="title">thisValue</span>)</span></span><br><span class="line"><span class="function">// <span class="title">currentValue</span>ï¼šå¿…éœ€ã€‚å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="function">// <span class="title">index</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">arr</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ æ‰€å±çš„æ•°ç»„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">thisValue</span>ï¼šå¯é€‰ã€‚ä¼ é€’ç»™å‡½æ•°çš„å€¼ä¸€èˆ¬ç”¨ "<span class="title">this</span>" å€¼ã€‚å¦‚æœè¿™ä¸ªå‚æ•°ä¸ºç©ºï¼Œ "<span class="title">undefined</span>" ä¼šä¼ é€’ç»™ "<span class="title">this</span>" å€¼</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">arr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item) <span class="comment">// 1 2 4 6 8</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">arr.forEach(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item, index, arr)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1 0 [1, 2, 4, 6, 8]</span></span><br><span class="line"><span class="comment">// 2 1 [1, 2, 4, 6, 8]</span></span><br><span class="line"><span class="comment">// 4 2 [1, 2, 4, 6, 8]</span></span><br><span class="line"><span class="comment">// 6 3 [1, 2, 4, 6, 8]</span></span><br><span class="line"><span class="comment">// 8 4 [1, 2, 4, 6, 8]</span></span><br></pre></td></tr></table></figure>

<h3 id="every"><a href="#every" class="headerlink" title="every()"></a>every()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨äºæ£€æµ‹æ•°ç»„æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½ç¬¦åˆæŒ‡å®šæ¡ä»¶ï¼ˆé€šè¿‡å‡½æ•°æä¾›ï¼‰ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.every(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, arr</span>), <span class="title">thisValue</span>)</span></span><br><span class="line"><span class="function">// <span class="title">currentValue</span>ï¼šå¿…éœ€ã€‚å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="function">// <span class="title">index</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">arr</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ æ‰€å±çš„æ•°ç»„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">thisValue</span>ï¼šå¯é€‰ã€‚å¯¹è±¡ä½œä¸ºè¯¥æ‰§è¡Œå›è°ƒæ—¶ä½¿ç”¨ï¼Œä¼ é€’ç»™å‡½æ•°ï¼Œç”¨ä½œ "<span class="title">this</span>" çš„å€¼ã€‚</span></span><br><span class="line"><span class="function">å¦‚æœçœç•¥äº† <span class="title">thisValue</span> ï¼Œ"<span class="title">this</span>" çš„å€¼ä¸º "<span class="title">undefined</span>"</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>every() æ–¹æ³•ä½¿ç”¨æŒ‡å®šå‡½æ•°æ£€æµ‹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼š</p>
<ul>
<li>å¦‚æœæ•°ç»„ä¸­æ£€æµ‹åˆ°æœ‰ä¸€ä¸ªå…ƒç´ ä¸æ»¡è¶³ï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼è¿”å› false ï¼Œä¸”å‰©ä½™çš„å…ƒç´ ä¸ä¼šå†è¿›è¡Œæ£€æµ‹ã€‚</li>
<li>å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å› trueã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>]</span><br><span class="line"><span class="keyword">let</span> res1 = arr.every(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ£€æµ‹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦å¤§äº2</span></span><br><span class="line">  <span class="keyword">return</span> num &gt; <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> res2 = arr.every(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ£€æµ‹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦å¤§äº10</span></span><br><span class="line">  <span class="keyword">return</span> num &gt; <span class="number">10</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(res1) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(res2) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="some"><a href="#some" class="headerlink" title="some()"></a>some()</h3><ul>
<li>ç”¨æ³•ï¼šç”¨äºæ£€æµ‹æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦æ»¡è¶³æŒ‡å®šæ¡ä»¶ï¼ˆå‡½æ•°æä¾›ï¼‰ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.some(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, arr</span>), <span class="title">thisValue</span>)</span></span><br><span class="line"><span class="function">// <span class="title">currentValue</span>ï¼šå¿…éœ€ã€‚å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="function">// <span class="title">index</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">arr</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ æ‰€å±çš„æ•°ç»„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">thisValue</span>ï¼šå¯é€‰ã€‚å¯¹è±¡ä½œä¸ºè¯¥æ‰§è¡Œå›è°ƒæ—¶ä½¿ç”¨ï¼Œä¼ é€’ç»™å‡½æ•°ï¼Œç”¨ä½œ "<span class="title">this</span>" çš„å€¼ã€‚</span></span><br><span class="line"><span class="function">å¦‚æœçœç•¥äº† <span class="title">thisValue</span> ï¼Œ"<span class="title">this</span>" çš„å€¼ä¸º "<span class="title">undefined</span>"</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>some() æ–¹æ³•ä¼šä¾æ¬¡æ‰§è¡Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼š</p>
<ul>
<li>å¦‚æœæœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¡¨è¾¾å¼è¿”å› true , å‰©ä½™çš„å…ƒç´ ä¸ä¼šå†æ‰§è¡Œæ£€æµ‹ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œåˆ™è¿”å› falseã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>]</span><br><span class="line"><span class="keyword">let</span> res1 = arr.some(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ£€æµ‹æ•°ç»„ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªå…ƒç´ æ˜¯å¦å¤§äº10</span></span><br><span class="line">  <span class="keyword">return</span> num &gt; <span class="number">10</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> res2 = arr.some(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ£€æµ‹æ•°ç»„ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªå…ƒç´ æ˜¯å¦å¤§äº100</span></span><br><span class="line">  <span class="keyword">return</span> num &gt; <span class="number">100</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(res1) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(res2) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter()"></a>filter()</h3><ul>
<li>ç”¨æ³•ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ–°æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯é€šè¿‡æ£€æŸ¥æŒ‡å®šæ•°ç»„ä¸­ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å…ƒç´ ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›æ•°ç»„ï¼ŒåŒ…å«äº†ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å…ƒç´ ã€‚å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ åˆ™è¿”å›ç©ºæ•°ç»„ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.filter(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, arr</span>), <span class="title">thisValue</span>)</span></span><br><span class="line"><span class="function">// <span class="title">currentValue</span>ï¼šå¿…éœ€ã€‚å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="function">// <span class="title">index</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">arr</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ æ‰€å±çš„æ•°ç»„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">thisValue</span>ï¼šå¯é€‰ã€‚å¯¹è±¡ä½œä¸ºè¯¥æ‰§è¡Œå›è°ƒæ—¶ä½¿ç”¨ï¼Œä¼ é€’ç»™å‡½æ•°ï¼Œç”¨ä½œ "<span class="title">this</span>" çš„å€¼ã€‚</span></span><br><span class="line"><span class="function">å¦‚æœçœç•¥äº† <span class="title">thisValue</span> ï¼Œ"<span class="title">this</span>" çš„å€¼ä¸º "<span class="title">undefined</span>"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>]</span><br><span class="line"><span class="keyword">let</span> res1 = arr.filter(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿”å›æ•°ç»„ä¸­æ‰€æœ‰å¤§äº5çš„å…ƒç´ </span></span><br><span class="line">  <span class="keyword">return</span> num &gt; <span class="number">5</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> res2 = arr.filter(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿”å›æ•°ç»„ä¸­æ‰€æœ‰å°äº5çš„å…ƒç´ </span></span><br><span class="line">  <span class="keyword">return</span> num &lt; <span class="number">5</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(res1) <span class="comment">// [6, 8, 10, 12]</span></span><br><span class="line"><span class="built_in">console</span>.log(res2) <span class="comment">// [4]</span></span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map()"></a>map()</h3><ul>
<li>ç”¨æ³•ï¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ ä¸ºåŸå§‹æ•°ç»„å…ƒç´ è°ƒç”¨å‡½æ•°å¤„ç†åçš„å€¼ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.map(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, arr</span>), <span class="title">thisValue</span>)</span></span><br><span class="line"><span class="function">// <span class="title">currentValue</span>ï¼šå¿…éœ€ã€‚å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="function">// <span class="title">index</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">arr</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ æ‰€å±çš„æ•°ç»„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">thisValue</span>ï¼šå¯é€‰ã€‚å¯¹è±¡ä½œä¸ºè¯¥æ‰§è¡Œå›è°ƒæ—¶ä½¿ç”¨ï¼Œä¼ é€’ç»™å‡½æ•°ï¼Œç”¨ä½œ "<span class="title">this</span>" çš„å€¼ã€‚</span></span><br><span class="line"><span class="function">å¦‚æœçœç•¥äº† <span class="title">thisValue</span> ï¼Œ"<span class="title">this</span>" çš„å€¼ä¸º "<span class="title">undefined</span>"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>]</span><br><span class="line"><span class="keyword">let</span> res = arr.map(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ•°ç»„æ¯ä¸ªå…ƒç´ éƒ½ä¹˜10</span></span><br><span class="line">  <span class="keyword">return</span> num * <span class="number">10</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(res) <span class="comment">// [40, 60, 80, 100, 120]</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°ç»„å½’å¹¶æ–¹æ³•"><a href="#æ•°ç»„å½’å¹¶æ–¹æ³•" class="headerlink" title="æ•°ç»„å½’å¹¶æ–¹æ³•"></a>æ•°ç»„å½’å¹¶æ–¹æ³•</h2><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a>reduce()</h3><ul>
<li>ç”¨æ³•ï¼šæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºç´¯åŠ å™¨ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ï¼ˆä»å·¦åˆ°å³ï¼‰å¼€å§‹ç¼©å‡ï¼Œæœ€ç»ˆè®¡ç®—ä¸ºä¸€ä¸ªå€¼ã€‚</li>
<li>reduce() å¯ä»¥ä½œä¸ºä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œç”¨äºå‡½æ•°çš„ composeã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">total, currentValue, currentIndex, arr</span>), <span class="title">initialValue</span>)</span></span><br><span class="line"><span class="function">// <span class="title">total</span>ï¼šå¿…éœ€ã€‚åˆå§‹å€¼, æˆ–è€…è®¡ç®—ç»“æŸåçš„è¿”å›å€¼ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">currentValue</span>ï¼šå¿…éœ€ã€‚å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="function">// <span class="title">currentIndex</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line"><span class="function">// <span class="title">arr</span>ï¼šå¯é€‰ã€‚å¯é€‰ã€‚å½“å‰å…ƒç´ æ‰€å±çš„æ•°ç»„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">initialValue</span>ï¼šå¯é€‰ã€‚ä¼ é€’ç»™å‡½æ•°çš„åˆå§‹å€¼</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>]</span><br><span class="line"><span class="keyword">let</span> res = arr.reduce(<span class="function">(<span class="params">total, num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> total + num</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(res) <span class="comment">// 40</span></span><br></pre></td></tr></table></figure>

<h3 id="reduceRight"><a href="#reduceRight" class="headerlink" title="reduceRight()"></a>reduceRight()</h3><ul>
<li>ç”¨æ³•ï¼šæ–¹æ³•çš„åŠŸèƒ½å’Œ reduce() åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸åŒçš„æ˜¯ reduceRight() ä»æ•°ç»„çš„æœ«å°¾å‘å‰å°†æ•°ç»„ä¸­çš„æ•°ç»„é¡¹åšç´¯åŠ ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObject.reduceRight(<span class="function"><span class="keyword">function</span>(<span class="params">total, currentValue, currentIndex, arr</span>), <span class="title">initialValue</span>)</span></span><br><span class="line"><span class="function">// <span class="title">total</span>ï¼šå¿…éœ€ã€‚åˆå§‹å€¼, æˆ–è€…è®¡ç®—ç»“æŸåçš„è¿”å›å€¼ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">currentValue</span>ï¼šå¿…éœ€ã€‚å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="function">// <span class="title">currentIndex</span>ï¼šå¯é€‰ã€‚å½“å‰å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line"><span class="function">// <span class="title">arr</span>ï¼šå¯é€‰ã€‚å¯é€‰ã€‚å½“å‰å…ƒç´ æ‰€å±çš„æ•°ç»„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function">// <span class="title">initialValue</span>ï¼šå¯é€‰ã€‚ä¼ é€’ç»™å‡½æ•°çš„åˆå§‹å€¼</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">20</span>]</span><br><span class="line"><span class="keyword">let</span> res = arr.reduceRight(<span class="function">(<span class="params">total, num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> total - num</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(res) <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~</li>
</ul>
]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆReactçš„Context-API</title>
    <url>/2020/04/28/%E6%B5%85%E8%B0%88React%E7%9A%84Context-API/</url>
    <content><![CDATA[<p>ä¸Šä¸‹æ–‡(Context) æä¾›äº†åœ¨ç»„ä»¶ä¹‹é—´å…±äº«è¿™äº›å€¼çš„æ–¹æ³•ï¼Œè€Œä¸å¿…åœ¨æ ‘çš„æ¯ä¸ªå±‚çº§æ˜¾å¼ä¼ é€’ä¸€ä¸ª prop ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ä½ æ²¡æœ‰ç»å¯¹æŠŠæ¡ç”¨å¥½å’Œå¿…é¡»çš„åœºæ™¯ä¸‹ï¼Œæ˜¯ä¸æ¨èä½¿ç”¨çš„ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶é—´æ¥çš„ä½¿ç”¨ç€å®ƒï¼Œæ¯”å¦‚è®¸å¤šå®˜æ–¹ä¾èµ–åœ¨ä½¿ç”¨ï¼Œå¦‚ï¼šreact-redux, mobx-reactï¼Œreact-routerã€‚æˆ‘ä»¬éœ€è¦å®ƒåŠŸèƒ½çš„æ—¶å€™ï¼Œæ›´å¤šæ˜¯é ç¬¬ä¸‰æ–¹ä¾èµ–åº“å°±èƒ½å®ç°ï¼Œè€Œä¸æ˜¯è‡ªå·±æ‰‹åŠ¨å†™ contextã€‚ä½†æ˜¯ï¼Œä¾ç„¶éœ€è¦ç†è§£å®ƒï¼Œå¯¹ç”¨å®ƒçš„ä¸€äº›ä¾èµ–åº“æºç ç†è§£å¾ˆæœ‰å¸®åŠ©ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grandpa</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    info: <span class="string">'GrandPaç»„ä»¶çš„ä¿¡æ¯'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Father info=&#123;<span class="keyword">this</span>.state.info&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Father extends Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Son info=&#123;this.props.info&#125; /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Son extends Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return &lt;div&gt;æˆ‘æ˜¯Sonç»„ä»¶ï¼Œæ‹¿åˆ°ä¿¡æ¯ä¸ºï¼š&#123;this.props.info&#125;&lt;/</span>div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Grandpa</span><br></pre></td></tr></table></figure><p>æœ€åé¡µé¢è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯Sonç»„ä»¶ï¼Œæ‹¿åˆ°ä¿¡æ¯ä¸ºï¼šGrandPaç»„ä»¶çš„ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°è¿™æ ·çš„ç¼ºç‚¹æ˜¯ä¸€å±‚ä¸€å±‚ä¼ å€¼ï¼Œå¦‚æœæœ‰æ›´å¤šå±‚çº§å’Œæ›´å¤šæ•°æ®çš„è¯ï¼Œä¼šè®©ä»£ç çœ‹èµ·æ¥å¾ˆä¸æ•´æ´ï¼Œå¦‚æœä¸­é—´å“ªä¸ªç»„ä»¶å¿˜äº†ä¼ å€¼åŸºæœ¬å°±å®Œäº†ï¼›è€Œä¸” Father ç»„ä»¶ä¹Ÿå¹¶æ²¡æœ‰ç”¨åˆ° info å€¼ï¼Œåªæ˜¯å°†å€¼ä¼ ç»™ Son ç»„ä»¶ã€‚</p><p>å¦‚æœä½¿ç”¨ contextï¼Œå°±èƒ½å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªå±‚çº§ä¸åœä¼ å€¼çš„é—®é¢˜ã€‚</p><p>context æœ‰æ—§ç‰ˆå’Œæ–°ç‰ˆä¹‹åˆ†ï¼Œä»¥ React v16.3.0 ç‰ˆæœ¬åˆ’åˆ†ã€‚</p><h2 id="æ—§ç‰ˆ-Context-API"><a href="#æ—§ç‰ˆ-Context-API" class="headerlink" title="æ—§ç‰ˆ Context API"></a>æ—§ç‰ˆ Context API</h2><p>æˆ‘ä»¬å…ˆæ¥è¯´ä¸‹æ—§ç‰ˆ context API</p><p>å°†ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grandpa</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    info: <span class="string">'GrandPaç»„ä»¶çš„ä¿¡æ¯'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">info</span>: <span class="keyword">this</span>.state.info &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Father /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å£°æ˜Contextå¯¹è±¡å±æ€§</span></span><br><span class="line"><span class="regexp">Grandpa.childContextTypes = &#123;</span></span><br><span class="line"><span class="regexp">  info: PropTypes.string,</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Father extends Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Son /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Son extends Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return &lt;div&gt;æˆ‘æ˜¯Sonç»„ä»¶ï¼Œæ‹¿åˆ°ä¿¡æ¯ä¸ºï¼š&#123;this.context.info&#125;&lt;/</span>div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ ¹æ®çº¦å®šå¥½çš„å‚æ•°ç±»å‹å£°æ˜</span></span><br><span class="line">Son.contextTypes = &#123;</span><br><span class="line">  info: PropTypes.string,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Grandpa</span><br></pre></td></tr></table></figure><p>å¯¹ PropTypes ç±»å‹æ£€æŸ¥ï¼Œè¿˜å¯ä»¥å†™æˆä¸‹é¢è¿™ç§å†™æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grandpa</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">    info: PropTypes.string,</span><br><span class="line">  &#125;</span><br><span class="line">  state = &#123;</span><br><span class="line">    info: <span class="string">'GrandPaç»„ä»¶çš„ä¿¡æ¯'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">info</span>: <span class="keyword">this</span>.state.info &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Father /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>åœ¨éœ€è¦ä¼ å‡ºå»çš„ context å€¼å’Œéœ€è¦æ¥æ”¶ context å€¼éƒ½è¦è¿›è¡Œç±»å‹æ£€æŸ¥åˆ¤æ–­ã€‚</p><p>æ­£å¸¸ç”¨è¿™ä¸ª api å¯èƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœä¸­é—´å“ªä¸ªç»„ä»¶ç”¨åˆ°<code>shouldComponentUpdate</code>æ–¹æ³•çš„è¯ï¼Œå°±å¾ˆå¯èƒ½å‡ºç°é—®é¢˜ã€‚</p><p>ä¸‰ä¸ªç»„ä»¶çš„å±‚çº§å…³ç³»å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;GrandPa&gt;</span><br><span class="line">  &lt;Father&gt;</span><br><span class="line">    &lt;Son /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Father&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>GrandPa&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨ GrandPa ç»„ä»¶è®¾ç½®æŒ‰é’®ç‚¹å‡»å¯ä»¥æ›´æ–° info çš„å€¼ï¼Œå³é€šè¿‡<code>this.setState({info: &#39;æ”¹å˜å€¼&#39;})</code>æ–¹æ³•<br>æ›´æ–° Contextï¼š<br>é‚£ä¹ˆ</p><ul><li>GrandPa ç»„ä»¶é€šè¿‡ setState è®¾ç½®æ–°çš„ Context å€¼åŒæ—¶è§¦å‘å­ç»„ä»¶é‡æ–° renderã€‚</li><li>Father ç»„ä»¶é‡æ–° renderã€‚</li><li>Son ç»„ä»¶é‡æ–° renderï¼Œå¹¶æ‹¿åˆ°æ›´æ–°åçš„ Contextã€‚</li></ul><p>å‡å¦‚åœ¨ Father ç»„ä»¶æ·»åŠ å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">shouldComponentUpdate () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº Father å¹¶ä¸ä¾èµ–ä»»ä½•å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬é»˜è®¤è®©å®ƒæ— éœ€é‡æ–° renderã€‚ä½†æ˜¯ï¼Œè¿™ä¼šå¯¼è‡´ Son ç»„ä»¶ä¹Ÿä¸ä¼šé‡æ–° renderï¼Œå³æ— æ³•è·å–åˆ°æœ€æ–°çš„ Context å€¼ã€‚</p><p>è¿™æ ·çš„ä¸ç¡®å®šæ€§å¯¹äºç›®æ ‡ç»„ä»¶æ¥è¯´æ˜¯å®Œå…¨ä¸å¯æ§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç›®æ ‡ç»„ä»¶æ— æ³•ä¿è¯è‡ªå·±æ¯ä¸€æ¬¡éƒ½å¯ä»¥æ¥æ”¶åˆ°æ›´æ–°åçš„ Context å€¼ã€‚è¿™æ˜¯æ—§ç‰ˆ API å­˜åœ¨çš„ä¸€ä¸ªå¤§é—®é¢˜ã€‚</p><p>è€Œæ–°ç‰ˆ API è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ–°ç‰ˆ API æ€ä¹ˆå†™çš„</p><h2 id="æ–°ç‰ˆ-Context-API"><a href="#æ–°ç‰ˆ-Context-API" class="headerlink" title="æ–°ç‰ˆ Context API"></a>æ–°ç‰ˆ Context API</h2><blockquote><p>æ–°ç‰ˆ Context æ–°å¢äº† creactContext() æ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ä¸ª context å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªæ˜¯ Providerï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚</p></blockquote><ol><li>Provider å’Œ Consumer å¿…é¡»æ¥è‡ªåŒä¸€ä¸ª Context å¯¹è±¡ï¼Œå³ä¸€ä¸ªç”± React.createContext()åˆ›å»ºçš„ Context å¯¹è±¡ã€‚</li><li>React.createContext()æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‚æ•°åšé»˜è®¤å€¼ï¼Œå½“ Consumer å¤–å±‚æ²¡æœ‰å¯¹åº”çš„ Provider æ—¶å°±ä¼šä½¿ç”¨è¯¥é»˜è®¤å€¼ã€‚</li><li>Provider ç»„ä»¶ä½¿ç”¨ Object.is æ–¹æ³•åˆ¤æ–­ prop å€¼æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œå½“ prop çš„å€¼æ”¹å˜æ—¶ï¼Œå…¶å†…éƒ¨ç»„ä»¶æ ‘ä¸­å¯¹åº”çš„ Consumer ç»„ä»¶ä¼šæ¥æ”¶åˆ°æ–°å€¼å¹¶é‡æ–°æ¸²æŸ“ã€‚æ­¤è¿‡ç¨‹ä¸å— shouldComponentUpdete æ–¹æ³•çš„å½±å“ã€‚</li><li>Consumer ç»„ä»¶æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸º children prop å¹¶åˆ©ç”¨è¯¥å‡½æ•°çš„è¿”å›å€¼ç”Ÿæˆç»„ä»¶æ ‘çš„æ¨¡å¼è¢«ç§°ä¸º Render Props æ¨¡å¼ã€‚</li></ol><h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ª context å¯¹è±¡</li></ol><blockquote><p>React.createContext æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ª Context å¯¹è±¡ã€‚è¯¥å¯¹è±¡åŒ…å« Provider å’Œ Consumer ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä¸ºä¸¤ä¸ª React ç»„ä»¶ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> InfoContext = React.createContext(<span class="string">''</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨ Provider ç»„ä»¶ç”Ÿæˆä¸€ä¸ª context</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grandpa</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    info: <span class="string">'GrandPaç»„ä»¶çš„ä¿¡æ¯'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;InfoContext.Provider value=&#123;&#123; <span class="attr">info</span>: <span class="keyword">this</span>.state.info &#125;&#125;&gt;</span><br><span class="line">        &lt;Father /&gt;</span><br><span class="line">      &lt;<span class="regexp">/InfoContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨ Consumer ç»„ä»¶è·å– context å¯¹è±¡çš„å€¼</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;InfoContext.Consumer&gt;</span><br><span class="line">        &#123;value =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘æ˜¯Sonç»„ä»¶ï¼Œæ‹¿åˆ°ä¿¡æ¯ä¸ºï¼š&#123;value.info&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;<span class="regexp">/InfoContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>ContextAPI</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ç°ä¸€ä¸ªè¿·ä½ Reduxï¼ˆåŸºç¡€ç‰ˆï¼‰</title>
    <url>/2020/04/22/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BF%B7%E4%BD%A0Redux%EF%BC%88%E5%9F%BA%E7%A1%80%E7%89%88%EF%BC%89/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»å°†ä» Redux åŸç†å‡ºå‘ï¼Œä¸€æ­¥æ­¥è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„ Reduxï¼Œä¸»è¦ç›®çš„æ˜¯äº†è§£ Redux å†…éƒ¨ä¹‹é—´çš„è”ç³»ã€‚çœ‹æœ¬æ–‡ä¹‹å‰å…ˆè¦çŸ¥é“ Redux æ˜¯æ€ä¹ˆç”¨çš„ï¼Œå¯¹ Redux ç”¨æ³•ä¸ä¼šè®²è§£å¤ªå¤šã€‚</p><a id="more"></a><h2 id="Redux-ä»‹ç»"><a href="#Redux-ä»‹ç»" class="headerlink" title="Redux ä»‹ç»"></a>Redux ä»‹ç»</h2><p>é¦–å…ˆè¦çŸ¥é“çš„æ˜¯ï¼ŒRedux å’Œ React æ²¡æœ‰å…³ç³»ï¼ŒRedux å¯ä»¥ç”¨åœ¨ä»»ä½•æ¡†æ¶ä¸­ã€‚<br>Redux æ˜¯ä¸€ä¸ª JavaScript çŠ¶æ€ç®¡ç†å™¨ï¼Œæ˜¯ä¸€ç§æ–°å‹çš„å‰ç«¯â€œæ¶æ„æ¨¡å¼â€ã€‚</p><p>è¿˜æœ‰é€šå¸¸ä¸ redux ä¸€èµ·ç”¨çš„ä¸€ä¸ªåº“â€”â€”react-reduxï¼Œ å®ƒå°±æ˜¯æŠŠ Redux è¿™ç§æ¶æ„æ¨¡å¼å’Œ React.js ç»“åˆèµ·æ¥çš„ä¸€ä¸ªåº“ï¼Œå°±æ˜¯ Redux æ¶æ„åœ¨ React.js ä¸­çš„ä½“ç°ã€‚</p><h2 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h2><ol><li>Web åº”ç”¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œè§†å›¾ä¸çŠ¶æ€æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</li><li>æ‰€æœ‰çš„çŠ¶æ€ï¼Œä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚</li></ol><h2 id="ä½•æ—¶ä½¿ç”¨-Redux"><a href="#ä½•æ—¶ä½¿ç”¨-Redux" class="headerlink" title="ä½•æ—¶ä½¿ç”¨ Redux"></a>ä½•æ—¶ä½¿ç”¨ Redux</h2><ol><li>ç”¨æˆ·çš„ä½¿ç”¨æ–¹å¼å¤æ‚</li><li>ä¸åŒèº«ä»½çš„ç”¨æˆ·æœ‰ä¸åŒçš„ä½¿ç”¨æ–¹å¼ï¼ˆæ¯”å¦‚æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼‰</li><li>å¤šä¸ªç”¨æˆ·ä¹‹é—´å¯ä»¥åä½œ</li><li>ä¸æœåŠ¡å™¨å¤§é‡äº¤äº’ï¼Œæˆ–è€…ä½¿ç”¨äº† WebSocket</li><li>View è¦ä»å¤šä¸ªæ¥æºè·å–æ•°æ®</li></ol><p>ä»ç»„ä»¶çš„è§’åº¦çœ‹ï¼š</p><ol><li>æŸä¸ªç»„ä»¶çš„çŠ¶æ€ï¼Œéœ€è¦å…±äº«</li><li>æŸä¸ªçŠ¶æ€éœ€è¦åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥æ‹¿åˆ°</li><li>ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å…¨å±€çŠ¶æ€</li><li>ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å¦ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€</li></ol><h2 id="Redux-å·¥ä½œæµç¨‹"><a href="#Redux-å·¥ä½œæµç¨‹" class="headerlink" title="Redux å·¥ä½œæµç¨‹"></a>Redux å·¥ä½œæµç¨‹</h2><p><img src="https://user-gold-cdn.xitu.io/2020/4/18/1718ce1ceca204e3?w=898&h=421&f=png&s=148790" alt=""></p><ol><li>Redux å°†æ•´ä¸ªåº”ç”¨çŠ¶æ€(state)å­˜å‚¨åˆ°ä¸€ä¸ªåœ°æ–¹(é€šå¸¸æˆ‘ä»¬ç§°å…¶ä¸º store)</li><li>å½“æˆ‘ä»¬éœ€è¦ä¿®æ”¹çŠ¶æ€æ—¶ï¼Œå¿…é¡»æ´¾å‘(dispatch)ä¸€ä¸ª action( action æ˜¯ä¸€ä¸ªå¸¦æœ‰ type å­—æ®µçš„å¯¹è±¡)</li><li>ä¸“é—¨çš„çŠ¶æ€å¤„ç†å‡½æ•° reducer æ¥æ”¶æ—§çš„ state å’Œ action ï¼Œå¹¶ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ state</li><li>é€šè¿‡ subscribe è®¾ç½®è®¢é˜…ï¼Œæ¯æ¬¡æ´¾å‘åŠ¨ä½œæ—¶ï¼Œé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ã€‚</li></ol><p>ä»è¿™ä¸ªæµç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼ŒRedux çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ª è§‚å¯Ÿè€… æ¨¡å¼ã€‚ä¸€æ—¦ store å‘ç”Ÿäº†å˜åŒ–å°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œè§†å›¾(åœ¨è¿™é‡Œæ˜¯ react ç»„ä»¶)æ¥æ”¶åˆ°é€šçŸ¥ä¹‹åä¼šè¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚</p><h2 id="Redux-æ¡ˆä¾‹"><a href="#Redux-æ¡ˆä¾‹" class="headerlink" title="Redux æ¡ˆä¾‹"></a>Redux æ¡ˆä¾‹</h2><p>ä¸ºäº†ç®€åŒ–è¯´æ˜ï¼Œæˆ‘ç”¨å’Œå®˜ç½‘å·®ä¸å¤šçš„ä¾‹å­æ”¹å†™æ¥ä½œæ¡ˆä¾‹<br><a href="https://redux.js.org/introduction/getting-started" target="_blank" rel="noopener">å®˜ç½‘ redux demo</a></p><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶ redux.jsï¼Œç„¶åç›´æ¥å¼•å…¥ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">  value: <span class="number">10</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// reducerå¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = defaultState, action</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(state, action)</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        value: state.value + <span class="number">1</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        value: state.value - <span class="number">1</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> init = store.getState()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`ä¸€å¼€å§‹æ•°å­—ä¸ºï¼š<span class="subst">$&#123;init.value&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listener</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> current = store.getState()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`å½“å‰æ•°å­—ä¸ºï¼š<span class="subst">$&#123;current.value&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line">store.subscribe(listener) <span class="comment">// ç›‘å¬stateçš„æ”¹å˜</span></span><br><span class="line"></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;)</span><br><span class="line"><span class="comment">// å½“å‰æ•°å­—ä¸ºï¼š11</span></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;)</span><br><span class="line"><span class="comment">// å½“å‰æ•°å­—ä¸ºï¼š12</span></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'DECREMENT'</span> &#125;)</span><br><span class="line"><span class="comment">// å½“å‰æ•°å­—ä¸ºï¼š11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;value: 10&#125; &#123;type: &quot;@@redux&#x2F;INIT1.a.7.g.7.t&quot;&#125;</span><br><span class="line">ä¸€å¼€å§‹æ•°å­—ä¸ºï¼š10</span><br><span class="line">&#123;value: 10&#125; &#123;type: &quot;INCREMENT&quot;&#125;</span><br><span class="line">å½“å‰æ•°å­—ä¸ºï¼š11</span><br><span class="line">&#123;value: 11&#125; &#123;type: &quot;INCREMENT&quot;&#125;</span><br><span class="line">å½“å‰æ•°å­—ä¸ºï¼š12</span><br><span class="line">&#123;value: 12&#125; &#123;type: &quot;DECREMENT&quot;&#125;</span><br><span class="line">å½“å‰æ•°å­—ä¸ºï¼š11</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å¯¹æ•°æ®çš„æ“ä½œå¿…é¡»é€šè¿‡ dispatch å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•° actionï¼Œaction æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œaction å¿…é¡»åŒ…å«ä¸€ä¸ª<code>type</code>å­—æ®µï¼Œå‘Šè¯‰å®ƒè¦ä¿®æ”¹ä»€ä¹ˆï¼Œåªæœ‰å®ƒå…è®¸æ‰èƒ½ä¿®æ”¹ã€‚</p><p>åœ¨æ¯æ¬¡è°ƒç”¨è¿›æ¥ reducer å‡½æ•°æˆ‘ä»¬éƒ½æ‰“å°äº† state å’Œ actionï¼Œæˆ‘ä»¬æ‰‹åŠ¨é€šè¿‡ store.dispatch æ–¹æ³•æ´¾å‘äº†ä¸‰æ¬¡ actionï¼Œä½†ä½ ä¼šå‘ç°è¾“å‡ºäº†å››æ¬¡.è¿™æ˜¯å› ä¸º Redux å†…éƒ¨åˆå§‹åŒ–å°±è‡ªåŠ¨æ‰§è¡Œäº†ä¸€æ¬¡ dispatch æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡æ‰§è¡Œå®ƒçš„ type å¯¹æˆ‘ä»¬æ•°æ®æ¥è¯´æ˜¯æ²¡æœ‰å½±å“çš„ï¼ˆå› ä¸º type å–å€¼<code>@@redux/INIT1.a.7.g.7.t</code>ï¼Œæˆ‘ä»¬è‡ªå·± redux çš„æ•°æ® type ä¸ä¼šå–åæˆè¿™ä¸ªæ ·å­ï¼Œæ‰€ä»¥ä¸ä¼šè·Ÿå®ƒé‡å¤ï¼‰ï¼Œå³é»˜è®¤è¾“å‡º state å€¼</p><h2 id="åŠ¨æ‰‹å®ç°ä¸€ä¸ª-Redux"><a href="#åŠ¨æ‰‹å®ç°ä¸€ä¸ª-Redux" class="headerlink" title="åŠ¨æ‰‹å®ç°ä¸€ä¸ª Redux"></a>åŠ¨æ‰‹å®ç°ä¸€ä¸ª Redux</h2><ol><li>é¦–å…ˆè¦æ‰‹åŠ¨å®ç°ä¸€ä¸ª Redux ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹æœ‰ä¸Šè¿°ä»£ç æ¶‰åŠåˆ° Redux ä»€ä¹ˆæ–¹æ³•ï¼Œé¦–å…ˆå¼•å…¥äº†</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; createStore &#125; from &#39;redux&#39;</span><br><span class="line">&#x2F;&#x2F; ä¼ å…¥reducer</span><br><span class="line">const store &#x3D; createStore(reducer)</span><br></pre></td></tr></table></figure><p>createStore ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ä¸‰ä¸ªæ–¹æ³•ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ—å‡º Redux é›å½¢ã€‚</p><p>æ–°å»º mini-redux.js</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export function createStore (reducer) &#123;</span><br><span class="line"></span><br><span class="line">    const getState &#x3D; () &#x3D;&gt; &#123;&#125;</span><br><span class="line">    const subscribe &#x3D; () &#x3D;&gt; &#123;&#125;</span><br><span class="line">    const dispatch &#x3D; () &#x3D;&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        getState,</span><br><span class="line">        subscribe,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>store.getState()ç”¨äºè·å– state æ•°æ®ï¼Œå…¶å®å°±æ˜¯ç®€å•åœ°æŠŠ state å‚æ•°è¿”å›ã€‚äºæ˜¯</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> currentState = &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> currentState</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getState,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>dispatch æ–¹æ³•ä¼šæ¥æ”¶ä¸€ä¸ª actionï¼Œæ‰§è¡Œä¼šè°ƒç”¨ <code>reducer</code> è¿”å›ä¸€ä¸ªæ–°çŠ¶æ€</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> currentState = &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> currentState</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    currentState = reducer(currentState, action) <span class="comment">// è¦†ç›–åŸæ¥çš„state</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getState,</span><br><span class="line">    dispatch,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>é€šè¿‡ subscribe è®¾ç½®ç›‘å¬å‡½æ•°ï¼ˆè®¾ç½®è®¢é˜…ï¼‰ï¼Œä¸€æ—¦ state å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼ˆé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼‰ã€‚</li></ol><p>æ€ä¹ˆå®ç°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ subscribe å‡½æ•°æŠŠä½ è¦ç›‘å¬çš„äº‹ä»¶æ·»åŠ åˆ°æ•°ç»„, ç„¶åæ‰§è¡Œ dispatch æ–¹æ³•çš„æ—¶å€™æŠŠ listeners æ•°ç»„çš„ç›‘å¬å‡½æ•°ç»™æ‰§è¡Œä¸€éã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> currentState = &#123;&#125;</span><br><span class="line">  <span class="keyword">let</span> currentListeners = [] <span class="comment">// ç›‘å¬å‡½æ•°ï¼Œå¯æ·»åŠ å¤šä¸ª</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> currentState</span><br><span class="line">  <span class="keyword">const</span> subscribe = <span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">    currentListeners.push(listener)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    currentState = reducer(currentState, action) <span class="comment">// è¦†ç›–åŸæ¥çš„state</span></span><br><span class="line">    currentListeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener())</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getState,</span><br><span class="line">    subscribe,</span><br><span class="line">    dispatch,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¿»å¼€ä¸€å¼€å§‹æˆ‘ä»¬é‚£ä¸ª Redux ä¾‹å­ï¼Œå…¶å®å°±æ˜¯æŠŠ<code>store.getState()</code>æ·»åŠ è¿›æ¥ï¼Œdispatch æ´¾å‘ä¸€ä¸ª action åï¼Œreducer æ‰§è¡Œè¿”å›æ–°çš„ stateï¼Œå¹¶æ‰§è¡Œäº†ç›‘å¬å‡½æ•°<code>store.getState()</code>ï¼Œstate çš„å€¼å°±å‘ç”Ÿå˜åŒ–äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listener</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> current = store.getState()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`å½“å‰æ•°å­—ä¸ºï¼š<span class="subst">$&#123;current.value&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line">store.subscribe(listener) <span class="comment">// ç›‘å¬stateçš„æ”¹å˜</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼Œè·Ÿ React ä¾ç„¶æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯çº¯å± Redux ä¾‹å­ã€‚ä½†æƒ³ä¸€æƒ³å½“æˆ‘ä»¬æŠŠ Redux å’Œ React ä¸€èµ·ç”¨çš„æ—¶å€™ï¼Œè¿˜ä¼šå¤šåšè¿™ä¹ˆä¸€æ­¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = store.getState()</span><br><span class="line">    <span class="keyword">this</span>.storeChange = <span class="keyword">this</span>.storeChange.bind(<span class="keyword">this</span>)</span><br><span class="line">    store.subscribe(<span class="keyword">this</span>.storeChange)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">storeChange () &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(store.getState())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ React é‡Œé¢ç›‘å¬çš„æ–¹æ³•ï¼Œè¿˜è¦ç”¨<code>this.setState()</code>, è¿™æ˜¯å› ä¸º React ä¸­ state çš„æ”¹å˜å¿…é¡»ä¾èµ–äº<code>this.setState</code>æ–¹æ³•ã€‚æ‰€ä»¥å¯¹äº React é¡¹ç›®ï¼Œå°±æ˜¯ç»„ä»¶çš„ render æ–¹æ³•æˆ– setState æ–¹æ³•æ”¾å…¥ listenï¼ˆç›‘å¬å‡½æ•°ï¼‰ï¼Œæ‰ä¼šå®ç°è§†å›¾çš„è‡ªåŠ¨æ¸²æŸ“ï¼Œæ”¹å˜é¡µé¢ä¸­çš„ state å€¼ã€‚</p><p>æœ€åä¸€æ­¥ï¼Œæ³¨æ„æˆ‘ä»¬ä¸Šé¢è¯´çš„ï¼Œå½“åˆå§‹åŒ–çš„æ—¶å€™ï¼Œdispatch ä¼šå…ˆè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œç»§ç»­æ”¹ä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> currentState = &#123;&#125;</span><br><span class="line">  <span class="keyword">let</span> currentListeners = [] <span class="comment">// ç›‘å¬å™¨ï¼Œå¯ç›‘å¬å¤šä¸ªäº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> currentState</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> subscribe = <span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">    currentListeners.push(listener)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    currentState = reducer(currentState, action) <span class="comment">// è¦†ç›–åŸæ¥çš„state</span></span><br><span class="line">    currentListeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener())</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°½é‡å†™å¾—å¤æ‚ï¼Œä½¿ä¸ä¼šä¸æˆ‘ä»¬è‡ªå®šä¹‰çš„actionæœ‰é‡å¤å¯èƒ½</span></span><br><span class="line">  dispatch(&#123; <span class="attr">type</span>: <span class="string">'@@mini-redux/~GSDG4%FDG#*&amp;'</span> &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getState,</span><br><span class="line">    subscribe,</span><br><span class="line">    dispatch,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠå¼•å…¥çš„ redux æ›¿æ¢æˆ‘ä»¬å†™çš„æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; createStore &#125; from &#39;.&#x2F;mini-redux&#39;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æ‰§è¡Œçš„æ—¶å€™ï¼Œå‘ç°ç»“æœå¹¶ä¸å¦‚æˆ‘ä»¬æ‰€æ„¿ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#125; &#123;type: &quot;@@mini-redux&#x2F;~GSDG4%FDG#*&amp;&quot;&#125;</span><br><span class="line">ä¸€å¼€å§‹æ•°å­—ä¸ºï¼šundefined</span><br><span class="line">&#123;&#125; &#123;type: &quot;INCREMENT&quot;&#125;</span><br><span class="line">å½“å‰æ•°å­—ä¸ºï¼šNaN</span><br><span class="line">&#123;type: &quot;INCREMENT&quot;&#125;</span><br><span class="line">å½“å‰æ•°å­—ä¸ºï¼šNaN</span><br><span class="line">&#123;value: NaN&#125; &#123;type: &quot;DECREMENT&quot;&#125;</span><br><span class="line">å½“å‰æ•°å­—ä¸ºï¼šNaN</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ€ä¹ˆå›äº‹å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å†™çš„ redux ä¸€å¼€å§‹å°±ç»™ state èµ‹å€¼ä¸º{}ï¼Œåœ¨äº‹å® state åˆå§‹å€¼æ˜¯ç”±å¤–éƒ¨ä¼ å…¥çš„ï¼Œé€šå¸¸æˆ‘ä»¬è‡ªå·±å†™çš„æ—¶å€™ä¼šè®¾ç½®é»˜è®¤å€¼</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">  value: <span class="number">10</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = defaultState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†åœ¨æˆ‘ä»¬ Redux å®ç°ä¸­å´æŠŠå®ƒæ‰‹åŠ¨ç½®ä¸ºç©ºå¯¹è±¡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æš‚æ—¶è§£å†³æ–¹æ³•å°±æ˜¯ä¸ç»™å®ƒèµ‹å€¼ï¼Œè®©å®ƒä¸º undefinedï¼Œè¿™æ · reducer çš„é»˜è®¤å‚æ•°å°±ä¼šç”Ÿæ•ˆã€‚redux åˆå§‹åŒ–ç¬¬ä¸€æ¬¡ dispatch æ—¶ï¼Œå°±ä¼šè®©å®ƒè‡ªåŠ¨èµ‹å€¼ä¸º reducer ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° state é»˜è®¤å€¼ï¼ˆES6 å‡½æ•°é»˜è®¤èµ‹å€¼ï¼‰ï¼Œæ‰€ä»¥ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> currentState</span><br><span class="line">  <span class="keyword">let</span> currentListeners = [] <span class="comment">// ç›‘å¬å™¨ï¼Œå¯ç›‘å¬å¤šä¸ªäº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> currentState</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> subscribe = <span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">    currentListeners.push(listener)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    currentState = reducer(currentState, action) <span class="comment">// è¦†ç›–åŸæ¥çš„state</span></span><br><span class="line">    currentListeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener())</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch(&#123; <span class="attr">type</span>: <span class="string">'@@mini-redux/~GSDG4%FDG#*&amp;'</span> &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getState,</span><br><span class="line">    subscribe,</span><br><span class="line">    dispatch,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª mini-redux.jsï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°è·ŸåŸæ¥çš„ redux å®Œå…¨ä¸€æ ·çš„è¾“å‡ºæ•ˆæœäº†ã€‚</p><h2 id="å®Œå–„-Redux"><a href="#å®Œå–„-Redux" class="headerlink" title="å®Œå–„ Redux"></a>å®Œå–„ Redux</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­è¡¥å……çŸ¥è¯†ç‚¹</p><ol><li>createStore å®é™…æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå³</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">createStore(reducer, [preloadedState], enhancer)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªå‚æ•° <code>[preloadedState] (any)</code>æ˜¯å¯é€‰çš„: initial state</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°<code>enhancer(function)</code>ä¹Ÿæ˜¯å¯é€‰çš„ï¼šç”¨äºæ·»åŠ ä¸­é—´ä»¶çš„</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡ preloadedState æŒ‡å®šçš„ state ä¼˜å…ˆçº§è¦é«˜äºé€šè¿‡ reducer æŒ‡å®šçš„ stateã€‚è¿™ç§æœºåˆ¶çš„å­˜åœ¨å…è®¸æˆ‘ä»¬åœ¨ reducer å¯ä»¥é€šè¿‡æŒ‡æ˜é»˜è®¤å‚æ•°æ¥æŒ‡å®šåˆå§‹æ•°æ®ï¼Œè€Œä¸”è¿˜ä¸ºé€šè¿‡æœåŠ¡ç«¯æˆ–è€…å…¶å®ƒæœºåˆ¶æ³¨å…¥æ•°æ®åˆ° store ä¸­æä¾›äº†å¯èƒ½ã€‚</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°æˆ‘ä»¬ä¸‹ç¯‡ä¼šè¯´ï¼Œå…ˆç»§ç»­å®Œå–„ä¸€ä¸‹ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå¯é€‰å‚æ•°è¿›è¡Œåˆ¤æ–­ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å½“ç¬¬äºŒä¸ªå‚æ•°æ²¡æœ‰ä¼ preloadedStateï¼Œè€Œç›´æ¥ä¼ functionçš„è¯ï¼Œå°±ä¼šç›´æ¥æŠŠè¿™ä¸ªfunctionå½“æˆenhancer</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> preloadedState === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    enhancer = preloadedState</span><br><span class="line">    preloadedState = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ äº†ä½†ä¸æ˜¯functionä¹Ÿä¼šæŠ¥é”™</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// reducerå¿…é¡»ä¸ºå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the reducer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> currentState = preloadedState <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°æ²¡ä¼ é»˜è®¤å°±æ˜¯undefinedèµ‹ç»™currentState</span></span><br><span class="line">  <span class="keyword">let</span> currentListeners = [] <span class="comment">// ç›‘å¬å™¨ï¼Œå¯ç›‘å¬å¤šä¸ªäº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äºç¬¬ä¸‰ä¸ªå‚æ•°åˆ¤æ–­ä¸ºä»€ä¹ˆè¿”å›<br><code>return enhancer(createStore)(reducer, preloadedState)</code>æˆ‘ä»¬ä¸‹ç¯‡ä¼šè¯´ï¼Œè¿™ç¯‡å…ˆå¿½ç•¥ã€‚ 2. æˆ‘ä»¬å®ç°äº† store.subscribe()æ–¹æ³•ï¼Œä½†è¿˜æ˜¯ä¸å®Œæ•´çš„ï¼Œsubscribe æ–¹æ³•å¯ä»¥æ·»åŠ ç›‘å¬å‡½æ•° listener,å®ƒè¿˜æœ‰è¿”å›å€¼ï¼Œè¿”å›ä¸€ä¸ªç§»é™¤ listener çš„å‡½æ•°ï¼›å¦å¤–æˆ‘ä»¬ä¾ç„¶è¦å¯¹ç±»å‹è¿›è¡Œåˆ¤æ–­ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">let</span> currentListeners = [] <span class="comment">// ç›‘å¬å™¨ï¼Œå¯ç›‘å¬å¤šä¸ªäº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> subscribe = <span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected listener to be a function.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    currentListeners.push(listener)</span><br><span class="line">    <span class="comment">// é€šè¿‡filterè¿‡æ»¤ï¼Œæ‰§è¡Œçš„æ—¶å€™å°†ä¹‹å‰æœ¬èº«å·²ç»æ·»åŠ è¿›æ•°ç»„çš„äº‹ä»¶åç§»é™¤æ•°ç»„</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      currentListeners = currentListeners.filter(<span class="function"><span class="params">l</span> =&gt;</span> l !== listener)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡æ‰¾æ•°ç»„ä¸‹æ ‡çš„æ–¹å¼ç§»é™¤ listener</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> subscribe = <span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected listener to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  currentListeners.push(listener)</span><br><span class="line">  <span class="comment">// é€šè¿‡filterè¿‡æ»¤ï¼Œæ‰§è¡Œçš„æ—¶å€™å°†ä¹‹å‰æœ¬èº«å·²ç»æ·»åŠ è¿›æ•°ç»„çš„äº‹ä»¶åç§»é™¤æ•°ç»„</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> index = currentListeners.indexOf(listener)</span><br><span class="line">    currentListeners.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç§»é™¤ listener å®é™…å°±æ˜¯å–æ¶ˆè®¢é˜…ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(store.getState()))</span><br><span class="line"></span><br><span class="line">unsubscribe() <span class="comment">// å–æ¶ˆç›‘å¬</span></span><br></pre></td></tr></table></figure><ol start="3"><li>diaptch æ–¹æ³•æ‰§è¡Œå®Œè¿”å›ä¸º actionï¼Œç„¶åæˆ‘ä»¬åŒæ ·éœ€è¦ä¸ºå®ƒä½œåˆ¤æ–­</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">let</span> isDispatching = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºåˆ¤æ–­actionæ˜¯å¦ä¸ºä¸€ä¸ªæ™®é€šå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (!isPlainObject(action)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Actions must be plain objects. '</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é˜²æ­¢å¤šæ¬¡dispatchè¯·æ±‚åŒæ—¶æ”¹çŠ¶æ€ï¼Œä¸€å®šæ˜¯å‰é¢çš„dispatchç»“æŸä¹‹åï¼Œæ‰dispatchä¸‹ä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Reducers may not dispatch actions.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      isDispatching = <span class="literal">true</span></span><br><span class="line">      currentState = reducer(currentState, action) <span class="comment">// è¦†ç›–åŸæ¥çš„state</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      isDispatching = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentListeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener())</span><br><span class="line">    <span class="keyword">return</span> action</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºåˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡(æ™®é€šå¯¹è±¡å³ç›´æ¥ä»¥å­—é¢é‡å½¢å¼æˆ–è°ƒç”¨ new Object() æ‰€åˆ›å»ºçš„å¯¹è±¡)</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">'object'</span> || obj === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> proto = obj</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">Object</span>.getPrototypeOf(proto) !== <span class="literal">null</span>) &#123;</span><br><span class="line">    proto = <span class="built_in">Object</span>.getPrototypeOf(proto)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.getPrototypeOf(obj) === proto</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>isPlainObject å‡½æ•°ä¸­é€šè¿‡ while ä¸æ–­åœ°åˆ¤æ–­ Object.getPrototypeOf(proto) !== null å¹¶æ‰§è¡Œ, æœ€ç»ˆ proto ä¼šæŒ‡å‘ Object.prototype. è¿™æ—¶å†åˆ¤æ–­ Object.getPrototypeOf(obj) === proto, å¦‚æœä¸º true çš„è¯å°±ä»£è¡¨ obj æ˜¯é€šè¿‡å­—é¢é‡æˆ–è°ƒç”¨ new Object() æ‰€åˆ›å»ºçš„å¯¹è±¡äº†ã€‚</p><p>ä¿æŒ action å¯¹è±¡æ˜¯ç®€å•å¯¹è±¡çš„ä½œç”¨æ˜¯æ–¹ä¾¿ reducer è¿›è¡Œå¤„ç†ï¼Œä¸ç”¨å¤„ç†å…¶ä»–çš„æƒ…å†µï¼ˆæ¯”å¦‚ function/class å®ä¾‹ç­‰ï¼‰</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†æœ€åŸºæœ¬èƒ½ç”¨çš„ Redux ä»£ç ï¼Œä¸‹ç¯‡å†ç»§ç»­å®Œå–„ Redux ä»£ç ï¼Œæœ€åæ”¾å‡ºåŸºç¡€ç‰ˆ Redux æ‰€æœ‰ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å½“ç¬¬äºŒä¸ªå‚æ•°æ²¡æœ‰ä¼ preloadedStateï¼Œè€Œç›´æ¥ä¼ functionçš„è¯ï¼Œå°±ä¼šç›´æ¥æŠŠè¿™ä¸ªfunctionå½“æˆenhancer</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> preloadedState === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    enhancer = preloadedState</span><br><span class="line">    preloadedState = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ äº†ä½†ä¸æ˜¯functionä¹Ÿä¼šæŠ¥é”™</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// reducerå¿…é¡»ä¸ºå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the reducer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> currentState = preloadedState <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°æ²¡ä¼ é»˜è®¤å°±æ˜¯undefinedèµ‹ç»™currentState</span></span><br><span class="line">  <span class="keyword">let</span> currentListeners = [] <span class="comment">// ç›‘å¬å™¨ï¼Œå¯ç›‘å¬å¤šä¸ªäº‹ä»¶</span></span><br><span class="line">  <span class="keyword">let</span> isDispatching = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> currentState</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> subscribe = <span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected listener to be a function.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    currentListeners.push(listener)</span><br><span class="line">    <span class="comment">// é€šè¿‡filterè¿‡æ»¤ï¼Œæ‰§è¡Œçš„æ—¶å€™å°†ä¹‹å‰æœ¬èº«å·²ç»æ·»åŠ è¿›æ•°ç»„çš„äº‹ä»¶åç§»é™¤æ•°ç»„</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      currentListeners = currentListeners.filter(<span class="function"><span class="params">l</span> =&gt;</span> l !== listener)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºåˆ¤æ–­actionæ˜¯å¦ä¸ºä¸€ä¸ªæ™®é€šå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (!isPlainObject(action)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Actions must be plain objects. '</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é˜²æ­¢å¤šæ¬¡dispatchè¯·æ±‚åŒæ—¶æ”¹çŠ¶æ€ï¼Œä¸€å®šæ˜¯å‰é¢çš„dispatchç»“æŸä¹‹åï¼Œæ‰dispatchä¸‹ä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Reducers may not dispatch actions.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      isDispatching = <span class="literal">true</span></span><br><span class="line">      currentState = reducer(currentState, action) <span class="comment">// è¦†ç›–åŸæ¥çš„state</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      isDispatching = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentListeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener())</span><br><span class="line">    <span class="keyword">return</span> action</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch(&#123; <span class="attr">type</span>: <span class="string">'@@mini-redux/~GSDG4%FDG#*&amp;'</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getState,</span><br><span class="line">    subscribe,</span><br><span class="line">    dispatch,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºåˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡(æ™®é€šå¯¹è±¡å³ç›´æ¥ä»¥å­—é¢é‡å½¢å¼æˆ–è°ƒç”¨ new Object() æ‰€åˆ›å»ºçš„å¯¹è±¡)</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">'object'</span> || obj === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> proto = obj</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">Object</span>.getPrototypeOf(proto) !== <span class="literal">null</span>) &#123;</span><br><span class="line">    proto = <span class="built_in">Object</span>.getPrototypeOf(proto)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.getPrototypeOf(obj) === proto</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">Redux å…¥é—¨æ•™ç¨‹ï¼ˆä¸€ï¼‰ï¼šåŸºæœ¬ç”¨æ³•</a></p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±å§~</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ‰‹å†™</tag>
        <tag>React</tag>
        <tag>Redux</tag>
      </tags>
  </entry>
  <entry>
    <title>Reactå‡½æ•°thisç»‘å®šçš„åŸå› åŠå››ç§ç»‘å®šæ–¹å¼å¯¹æ¯”</title>
    <url>/2020/04/16/React%E5%87%BD%E6%95%B0this%E7%BB%91%E5%AE%9A%E7%9A%84%E5%8E%9F%E5%9B%A0%E5%8F%8A%E5%9B%9B%E7%A7%8D%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94/</url>
    <content><![CDATA[<p>react ç»„ä»¶åœ¨ç»‘å®šå‡½æ•°æ—¶ï¼Œé€šå¸¸æœ‰ä¸‰ç§æ–¹æ³•ï¼Œæ­¤æ–‡å°†å¯¹ä¸‰ç§æ–¹æ³•æ€§èƒ½å’Œå†™æ³•å±•å¼€å†™â€¦</p><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆè¦ç»‘å®š-this"><a href="#ä¸ºä»€ä¹ˆè¦ç»‘å®š-this" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç»‘å®š this"></a>ä¸ºä»€ä¹ˆè¦ç»‘å®š this</h2><p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜å°±æ˜¯ï¼Œç»‘å®š this æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ</p><p>js é‡Œé¢çš„ this ç»‘å®šæ˜¯ä»£ç æ‰§è¡Œçš„æ—¶å€™è¿›è¡Œç»‘å®šçš„ï¼Œè€Œä¸æ˜¯ç¼–å†™çš„æ—¶å€™ï¼Œæ‰€ä»¥ this çš„æŒ‡å‘å–å†³äºå‡½æ•°è°ƒç”¨æ—¶çš„å„ç§æ¡ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BindEvent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      name: <span class="string">'jacky'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.name)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;Click&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> BindEvent</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œè¿è¡Œç‚¹å‡»æŒ‰é’®ï¼Œå‘ç°ç¨‹åºæŠ¥é”™ï¼Œå³ this æŒ‡å‘ä¸æ˜¯æ‰€åœ¨ç±»ã€‚ç”±äºç±»çš„æ–¹æ³•é»˜è®¤ä¸ä¼šç»‘å®š thisï¼Œå› æ­¤åœ¨è°ƒç”¨çš„æ—¶å€™å¦‚æœæ²¡æœ‰ç»‘å®šï¼Œthis çš„å€¼å°†ä¼šæ˜¯ undefinedã€‚æ•…æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç»‘å®š this</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Uncaught TypeError: Cannot read property &#39;state&#39; of undefined</span><br></pre></td></tr></table></figure><p>éœ€è¦æˆ‘ä»¬è‡ªå·±ç»‘å®š thisï¼Œå…¶å®è¿™ä¸æ˜¯ react çš„é”…ï¼Œæœ¬è´¨åŸå› æ˜¯ JavaScript çš„ this æœºåˆ¶é—®é¢˜</p><h2 id="this-æœºåˆ¶"><a href="#this-æœºåˆ¶" class="headerlink" title="this æœºåˆ¶"></a>this æœºåˆ¶</h2><p>æ¥çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'obj'</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>, <span class="keyword">this</span>.name)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">obj.getName() <span class="comment">// &#123;name: "obj", getName: Æ’&#125; "obj"</span></span><br></pre></td></tr></table></figure><p>ç»“æœç†æ‰€åº”å½“ï¼Œä½¿ç”¨<code>.</code>æ“ä½œç¬¦è°ƒç”¨å‡½æ•° obj.getName()ï¼Œthis æŒ‡å‘çš„æ˜¯ obj å¯¹è±¡ï¼Œå³ obj å¯¹è±¡æ˜¯å‡½æ•° getName çš„è°ƒç”¨è€…ï¼Œä½†å¦‚æœæ”¹æˆè¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> middleObj = obj.getName</span><br><span class="line">middleObj() <span class="comment">// Window &#123;...&#125; ""</span></span><br></pre></td></tr></table></figure><p>å°† getName å‡½æ•°å¼•ç”¨èµ‹å€¼ç»™ middleObj å˜é‡ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªæ–°çš„å‡½æ•°å¼•ç”¨å»è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œæ‰“å°å‡º this ä¸º Window å¯¹è±¡ï¼Œå…³äº this çš„æŒ‡å‘ï¼Œå¯ç®€å•ç²—æš´ç†è§£ä¸º<strong>this æ°¸è¿œæŒ‡å‘æœ€åè°ƒç”¨å®ƒçš„é‚£ä¸ªå¯¹è±¡</strong>ã€‚</p><p>å¦‚æœæ²¡æœ‰æ˜¾å¼è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ŒJS çš„è§£é‡Šå™¨å°±ä¼šæŠŠå…¨å±€å¯¹è±¡å½“ä½œè°ƒç”¨è€…ï¼Œåœ¨æµè§ˆå™¨åˆ™æ˜¯ Window å¯¹è±¡ä¸ºè°ƒç”¨è€…ã€‚</p><p>å¦‚æœä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œé‚£ä¹ˆæ²¡æœ‰æ˜¾å¼çš„ä½¿ç”¨è°ƒç”¨è€…çš„æƒ…å†µä¸‹ï¼Œthis æŒ‡å‘ undefined ã€‚</p><p>ç†è§£å®Œä¸Šé¢ï¼Œæˆ‘ä»¬ç”¨ç±»æ¥ä½œä¸ºå‚ç…§ï¼š</p><p>ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªç±»ï¼Œç±»é‡Œçš„ display è®¿é—® this.name å±æ€§</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  display() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// è¿è¡Œæ‰“å°ï¼š Foo &#123;name: "jacky"&#125;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo(<span class="string">'jacky'</span>)</span><br><span class="line">foo.display() <span class="comment">// jacky</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> display = foo.display</span><br><span class="line">display()</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// Uncaught TypeError: Cannot read property 'name' of undefined</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å°†ä¸€ä¸ªå‡½æ•°å¼•ç”¨èµ‹å€¼ç»™æŸä¸ªå…¶ä»–å˜é‡ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªæ–°çš„å‡½æ•°å¼•ç”¨å»è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œåœ¨ display() æ–¹æ³• this ä¸º<code>undefined</code>ï¼Œæ•…æ‰¾ä¸åˆ° name å€¼æŠ¥é”™ã€‚</p><p>åœ¨è¿™é‡Œåˆæœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œdisplay è¿™æ ·ç›´æ¥è°ƒç”¨ï¼Œåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹è°ƒç”¨è€…ä¸æ˜¯åº”è¯¥ä¸º Window å¯¹è±¡å—ï¼Ÿåœ¨è¿™é‡Œï¼Œè¦çŸ¥é“ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><p><strong>ES6 çš„ class è¯­æ³•ï¼Œæ‰€æœ‰åœ¨ class ä¸­å£°æ˜çš„æ–¹æ³•éƒ½ä¼šè‡ªåŠ¨åœ°ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼</strong></p><h2 id="React-çš„-JSX"><a href="#React-çš„-JSX" class="headerlink" title="React çš„ JSX"></a>React çš„ JSX</h2><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿™è·Ÿ React é‚£ä¸ªæœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Œæƒ³ææ¸…æ¥šä¸ºä»€ä¹ˆç»‘å®š this è¿™ä¸ªé—®é¢˜å‰ï¼Œå°±æƒ³å…ˆå¼„æ˜ç™½ JSX åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p><blockquote><p>æœ¬è´¨ä¸Šæ¥è®²ï¼ŒJSX åªæ˜¯ä¸º React.createElement(component, props, â€¦children) æ–¹æ³•æä¾›çš„è¯­æ³•ç³–ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;button className=<span class="string">'btn'</span> onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;</span><br><span class="line">  Click Me</span><br><span class="line">&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure><p>ç» babel ç¼–è¯‘ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">React.createElement(<span class="string">'button'</span>, &#123; <span class="attr">className</span>: <span class="string">'btn'</span>, <span class="attr">onClick</span>: <span class="keyword">this</span>.handleClick &#125;, <span class="string">'Click Me'</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠ render æ–¹æ³•é‡Œçš„ JSX æ‰‹åŠ¨å†™æˆç¼–è¯‘åè¿™ç§å½¢å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(<span class="string">'button'</span>, &#123; <span class="attr">className</span>: <span class="string">'btn'</span>, <span class="attr">onClick</span>: <span class="keyword">this</span>.handleClick &#125;, <span class="string">'Click Me'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React.createElement çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰å±æ€§çš„å€¼æ˜¯å– this å¯¹è±¡é‡Œé¢çš„å±æ€§ ï¼Œå½“è¿™ä¸ªå¯¹è±¡æ”¾å…¥ React.createElement æ‰§è¡Œåï¼Œå»å–è¿™ä¸ª this.handleClick å±æ€§çš„æ—¶å€™ï¼Œthis å·²ç»ä¸æ˜¯æˆ‘ä»¬åœ¨ä¹¦å†™çš„æ—¶å€™è®¤ä¸ºçš„ç»‘å®šåœ¨ Example ç»„ä»¶ä¸Šäº†ã€‚this.handleClick è¿™é‡Œçš„ this ä¼šé»˜è®¤ç»‘å®šï¼Œä½†æ˜¯åˆæ˜¯åœ¨ ES6 çš„ class ä¸­ï¼Œæ‰€ä»¥ this ç»‘å®šäº† undefinedã€‚</p><p>åœ¨ JSX è¯­æ³•ä¸­: <code>onClick={ this.handleClick }</code>ä¸­ onClick è¿™ä¸ªå±æ€§å°±æ˜¯ç›¸å½“äºä¸Šé¢çš„â€ä¸­é—´å˜é‡â€ã€‚</p><p>å³æ˜¯å°†<code>this.handleClick</code>å‡½æ•°èµ‹å€¼ç»™ onClick è¿™ä¸ªä¸­é—´å˜é‡ï¼Œåé¢ä¸ä»…è¦è¿›è¡Œ JSX è¯­æ³•è½¬åŒ–,å°† JSX ç»„ä»¶è½¬æ¢æˆ<strong>JS å¯¹è±¡</strong>,è¿˜è¦å†å°† Javascript å¯¹è±¡è½¬æ¢æˆçœŸå® DOMã€‚æŠŠ onClick ä½œä¸ºä¸­é—´å˜é‡,æŒ‡å‘ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™,åé¢çš„ä¸€ç³»åˆ—å¤„ç†ä¸­ï¼Œä½¿ç”¨ onClick è¿™ä¸ªä¸­é—´å˜é‡æ‰€æŒ‡å‘çš„å‡½æ•°ï¼Œé‡Œé¢çš„ this è‡ªç„¶å°±ä¸¢å¤±æ‰äº†ï¼Œä¸æ˜¯å†æŒ‡å‘ç»„ä»¶å®ä¾‹äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå½“åœ¨ç»„ä»¶å®šä¹‰æ–¹æ³•æƒ³è®¿é—® thisï¼Œæ‰éœ€è¦æ‰‹åŠ¨ç»‘å®šã€‚</p><h2 id="ç»‘å®š-this-çš„æ–¹æ³•"><a href="#ç»‘å®š-this-çš„æ–¹æ³•" class="headerlink" title="ç»‘å®š this çš„æ–¹æ³•"></a>ç»‘å®š this çš„æ–¹æ³•</h2><h3 id="render-æ–¹æ³•ä¸­ç»‘å®š-this"><a href="#render-æ–¹æ³•ä¸­ç»‘å®š-this" class="headerlink" title="render æ–¹æ³•ä¸­ç»‘å®š this"></a>render æ–¹æ³•ä¸­ç»‘å®š this</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BindEvent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      name: <span class="string">'jacky'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.name)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>)&#125;&gt;ç‚¹å‡»&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•å³æ˜¯åœ¨äº‹ä»¶å‡½æ•°åä½¿ç”¨<code>.bind(this)</code>å°† this ç»‘å®šåˆ°å½“å‰ç»„ä»¶ä¸­ã€‚å› ä¸º bind å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ‰€ä»¥æ¯æ¬¡çˆ¶ç»„ä»¶åˆ·æ–°æ—¶ï¼Œéƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œå³ä½¿çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶å…¶ä»–çš„ props å€¼ä¸å˜ï¼Œå­ç»„ä»¶æ¯æ¬¡éƒ½ä¼šåˆ·æ–°ï¼Œè¿™å°†ä¼šå½±å“æ€§èƒ½ï¼Œæ•…ä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="render-æ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°"><a href="#render-æ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°" class="headerlink" title="render æ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°"></a>render æ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BindEvent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      name: <span class="string">'jacky'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.name)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.handleClick()&#125;&gt;ç‚¹å‡»&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–é€‰è¦æ˜ç¡®ä¸€ç‚¹ï¼Œ<strong>ç®­å¤´å‡½æ•°ä¸­ï¼Œthis æ°¸è¿œç»‘å®šäº†å®šä¹‰ç®­å¤´å‡½æ•°æ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡</strong></p><p>è¿™ç§æ–¹æ³•å†™æ³•æ¯”è¾ƒç®€æ´ï¼Œ æœ€å¤§å¥½å¤„å°±æ˜¯ä¼ å‚å¾ˆçµæ´»ï¼Œçˆ¶ç»„ä»¶åˆ·æ–°çš„æ—¶å€™ï¼Œå³ä½¿ä¸¤ä¸ªç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“æ˜¯ä¸€æ ·çš„ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç®­å¤´å‡½æ•°ã€‚è¿™ç§æ–¹å¼é‡æ–°åˆ›å»ºå‡½æ•°æ€§èƒ½çš„æŸè€—å°äºç¬¬ 1 ç§ã€‚</p><h3 id="æ„é€ å‡½æ•°ç»‘å®š-this"><a href="#æ„é€ å‡½æ•°ç»‘å®š-this" class="headerlink" title="æ„é€ å‡½æ•°ç»‘å®š this"></a>æ„é€ å‡½æ•°ç»‘å®š this</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BindEvent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      name: <span class="string">'jacky'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.name)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;ç‚¹å‡»&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…åœ¨ render ä¸­ç»‘å®š this å¼•å‘å¯èƒ½çš„æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥åœ¨ constructor ä¸­é¢„å…ˆè¿›è¡Œç»‘å®šã€‚å¥½å¤„æ˜¯ä»…éœ€è¦ç»‘å®šä¸€æ¬¡ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¦é‡æ–°ç»‘å®šï¼Œä¹Ÿæ˜¯å¸¸æ¨èçš„å†™æ³•ï¼Œå°±æ˜¯å†™èµ·æ¥ç¹çä¸€ç‚¹ï¼Œè¦å•ç‹¬ç»‘å®šã€‚</p><h3 id="åœ¨å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š"><a href="#åœ¨å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š" class="headerlink" title="åœ¨å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š"></a>åœ¨å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BindEvent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      name: <span class="string">'jacky'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.name)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;ç‚¹å‡»&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•æ˜¯ ES7 çš„å†™æ³•ï¼ŒES6 å¹¶ä¸æ”¯æŒï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é…ç½®ä½ çš„å¼€å‘ç¯å¢ƒæ”¯æŒ ES7ã€‚</p><p>è¿™ç§æ–¹æ³•é¿å…äº†ç¬¬ 1 ç§å’Œç¬¬ 2 ç§çš„å¯èƒ½æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ï¼Œä¹Ÿæ¯”ç¬¬ 3 ç§æ–¹æ³•ç®€æ´ï¼Œä¹Ÿæ˜¯å¸¸æ¨èçš„å†™æ³•ã€‚</p><p>è‡³äºå“ªä¸€ç§æ˜¯æœ€å¥½çš„å†™æ³•ï¼Œç›®å‰è¿˜çœŸçš„æ— æ³•å®šè®ºï¼Œæœ‰å¾…ä»¥åå¼€å‘ä¸­å¾—å‡ºæœ€ä½³å®è·µâ€¦</p><br><ul><li>psï¼š <a href="https://github.com/Jacky-Summer/personal-blog" target="_blank" rel="noopener">ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“</a>ï¼Œæ¬¢è¿ star</li></ul>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸç”ŸJavaScript DOMæ“ä½œå¸¸è§æ±‡æ€»</title>
    <url>/2020/04/09/%E5%8E%9F%E7%94%9FJavaScript-DOM%E6%93%8D%E4%BD%9C%E5%B8%B8%E8%A7%81%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨çœ‹ JS æ€§èƒ½ä¼˜åŒ–æ–¹é¢ï¼Œè¯´åˆ°äº† createDocumentFragment()æ–¹æ³•ï¼Œå¯¹è¯¥æ–¹æ³•æœ‰å°è±¡ï¼Œä½†ä¸ºäº†è¿›ä¸€æ­¥äº†è§£ï¼Œæˆ‘è¿˜æ˜¯é‡æ–°æŸ¥é˜…ä¸€éï¼Œé¡ºä¾¿æŠŠ DOM æ“ä½œä¹Ÿç»™æ€»ç»“ä¸€ä¸‹ã€‚</p>
<a id="more"></a>

<h2 id="åˆ›å»ºæ–°èŠ‚ç‚¹"><a href="#åˆ›å»ºæ–°èŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºæ–°èŠ‚ç‚¹"></a>åˆ›å»ºæ–°èŠ‚ç‚¹</h2><ul>
<li><strong>createDocumentFragment()æ–¹æ³•</strong></li>
</ul>
<p>è¯¥æ–¹æ³•æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„èŠ‚ç‚¹å¯¹è±¡ï¼Œæˆ–è€…è¯´ï¼Œæ˜¯ç”¨æ¥åˆ›å»ºæ–‡æ¡£ç¢ç‰‡èŠ‚ç‚¹ã€‚å®ƒå¯ä»¥åŒ…å«å„ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œåœ¨åˆ›å»ºä¹‹åˆæ˜¯ç©ºçš„ã€‚</p>
<p>DocumentFragment ä¸æ˜¯çœŸå® DOM æ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçš„å˜åŒ–ä¸ä¼šè§¦å‘ DOM æ ‘çš„é‡æ–°æ¸²æŸ“ï¼Œä¸”ä¸ä¼šå¯¼è‡´æ€§èƒ½ç­‰é—®é¢˜ã€‚</p>
<p>å½“æŠŠä¸€ä¸ª DocumentFragment èŠ‚ç‚¹æ’å…¥æ–‡æ¡£æ ‘æ—¶ï¼Œæ’å…¥çš„ä¸æ˜¯ DocumentFragment è‡ªèº«ï¼Œè€Œæ˜¯å®ƒçš„æ‰€æœ‰å­å­™èŠ‚ç‚¹ï¼Œå³æ’å…¥çš„æ˜¯æ‹¬å·é‡Œçš„èŠ‚ç‚¹ã€‚è¿™ä¸ªç‰¹æ€§ä½¿å¾— DocumentFragment æˆäº†å ä½ç¬¦ï¼Œæš‚æ—¶å­˜æ”¾é‚£äº›ä¸€æ¬¡æ’å…¥æ–‡æ¡£çš„èŠ‚ç‚¹ã€‚</p>
<ul>
<li><strong>createElement()æ–¹æ³•</strong></li>
</ul>
<p>åœ¨ HTML æ–‡æ¡£ä¸­ï¼Œdocument.createElement() æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªç”±æ ‡ç­¾åç§° tagName æŒ‡å®šçš„ HTML å…ƒç´ </p>
<p>æ¥çœ‹ä¸€ä¸ªä¾‹å­, å¯¹äºé¡µé¢å·²å­˜åœ¨çš„<code>&lt;ul id=&quot;ul&quot;&gt;&lt;/ul&gt;</code>å…ƒç´ ï¼Œæˆ‘ä»¬æƒ³å¾€é‡Œé¢æ·»åŠ  li æ ‡ç­¾</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">'ul'</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>)</span><br><span class="line">  li.innerHTML = <span class="string">'index: '</span> + i</span><br><span class="line">  ul.appendChild(li)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æ“ä½œçœ‹èµ·æ¥å¾ˆæ­£å¸¸ï¼Œä½†å®é™…è¦å¾ˆå¤šçš„æ’å…¥æ“ä½œå’Œæ”¹åŠ¨ï¼›è€Œæ¯ä¸€æ¬¡çš„æ’å…¥éƒ½ä¼šå¼•èµ·é‡æ–°æ¸²æŸ“ï¼Œè¯¥æ“ä½œä¼šå¼•å‘å¤šæ¬¡æ¸²æŸ“ï¼Œåœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢ï¼Œæœ‰ä¸€ç‚¹æ˜¯å‡å°‘ DOM æ“ä½œï¼Œå› ä¸º DOM æ“ä½œå¯¼è‡´äº†é¡µé¢çš„é‡ç»˜æˆ–é‡æ’ã€‚</p>
<ul>
<li>createDocumentFragment()æ–¹æ³•å’Œ createElement()æ–¹æ³•åŒºåˆ«</li>
</ul>
<p>å¦‚æœæ˜¯ç”¨ createDocumentFragment()æ–¹æ³•æ“ä½œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">'ul'</span>)</span><br><span class="line"><span class="keyword">var</span> fragment = <span class="built_in">document</span>.createDocumentFragment()</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>)</span><br><span class="line">  li.innerHTML = <span class="string">'index: '</span> + i</span><br><span class="line">  fragment.appendChild(li)</span><br><span class="line">&#125;</span><br><span class="line">ul.appendChild(fragment)</span><br></pre></td></tr></table></figure>

<p>ç›¸æ¯” createElement()æ–¹æ³•ï¼Œè¿™æ¬¡æ˜¯å…ˆå°†è¿™äº›å…ƒç´ æ·»åŠ åˆ° fragment ä¸­ï¼Œå†ç»Ÿä¸€å°† fragment æ·»åŠ åˆ°é¡µé¢ï¼Œä¼šå‡å°‘é¡µé¢æ¸²æŸ“ dom çš„æ¬¡æ•°ï¼Œæ•ˆç‡ä¼šæ˜æ˜¾æå‡ã€‚å› ä¸º fragment æ–‡æ¡£ç‰‡æ®µå­˜åœ¨äºå†…å­˜ä¸­ï¼Œå¹¶ä¸åœ¨ DOM ä¸­ï¼Œæ‰€ä»¥å°†å­å…ƒç´ æ’å…¥åˆ°æ–‡æ¡£ç‰‡æ®µä¸­æ—¶ä¸ä¼šå¼•èµ·é¡µé¢å›æµï¼ˆæ–°åˆ›å»ºçš„ fragment ç‰‡æ®µåœ¨æ–‡æ¡£å†…æ˜¯æ²¡æœ‰å¯¹åº”çš„æ ‡ç­¾çš„ï¼Œè¿™é‡Œæ·»åŠ çš„æ˜¯ç‰‡æ®µçš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼‰</p>
<ul>
<li>createTextNode()æ–¹æ³•</li>
</ul>
<p>è¯¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚</p>
<p>HTML å…ƒç´ é€šå¸¸æ˜¯ç”±å…ƒç´ èŠ‚ç‚¹å’Œæ–‡æœ¬èŠ‚ç‚¹ç»„æˆã€‚åˆ›å»ºä¸€ä¸ªæ ‡é¢˜ (h1), ä½ å¿…é¡»åˆ›å»º â€œh1â€ å…ƒç´ å’Œæ–‡æœ¬èŠ‚ç‚¹:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> h = <span class="built_in">document</span>.createElement(<span class="string">'h1'</span>)</span><br><span class="line"><span class="keyword">var</span> t = <span class="built_in">document</span>.createTextNode(<span class="string">'Hello World'</span>)</span><br><span class="line">h.appendChild(t)</span><br></pre></td></tr></table></figure>

<h2 id="DOM-æ›´æ”¹ï¼šæ·»åŠ ã€ç§»é™¤ã€æ›¿æ¢ã€æ’å…¥"><a href="#DOM-æ›´æ”¹ï¼šæ·»åŠ ã€ç§»é™¤ã€æ›¿æ¢ã€æ’å…¥" class="headerlink" title="DOM æ›´æ”¹ï¼šæ·»åŠ ã€ç§»é™¤ã€æ›¿æ¢ã€æ’å…¥"></a>DOM æ›´æ”¹ï¼šæ·»åŠ ã€ç§»é™¤ã€æ›¿æ¢ã€æ’å…¥</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ ã€åˆ é™¤å­å…ƒç´ </span></span><br><span class="line">ele.appendChild(el)</span><br><span class="line">ele.removeChild(el)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›¿æ¢å­å…ƒç´ </span></span><br><span class="line">ele.replaceChild(el1, el2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥å­å…ƒç´ </span></span><br><span class="line">parentElement.insertBefore(newElement, referenceElement)</span><br></pre></td></tr></table></figure>

<p>å‰é¢ä¸‰ä¸ªç”¨æ³•å°±ä¸€ç›®äº†ç„¶ï¼Œå¯¹äº insertBefore()æ–¹æ³•æ¥ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"ul"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> newEle = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>)</span><br><span class="line"><span class="keyword">var</span> textNode = <span class="built_in">document</span>.createTextNode(<span class="string">'insertNode'</span>)</span><br><span class="line">newEle.appendChild(textNode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">'ul'</span>)</span><br><span class="line">ul.insertBefore(newEle, ul.firstChild)</span><br></pre></td></tr></table></figure>

<p>é¡µé¢è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insertNode</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h2 id="DOM-æŸ¥è¯¢"><a href="#DOM-æŸ¥è¯¢" class="headerlink" title="DOM æŸ¥è¯¢"></a>DOM æŸ¥è¯¢</h2><p>å…ƒç´ æŸ¥è¯¢çš„ API è¿”å›çš„çš„ç»“æœæ˜¯ DOM èŠ‚ç‚¹æˆ–è€… DOM èŠ‚ç‚¹çš„åˆ—è¡¨</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">getElementById()</span><br><span class="line">getElementsByName()</span><br><span class="line">getElementsByTagName()</span><br><span class="line">getElementsByClassName()</span><br><span class="line">querySelector()</span><br><span class="line">querySelectorAll()</span><br></pre></td></tr></table></figure>

<p>querySelector() æ–¹æ³•è¿”å›åŒ¹é…æŒ‡å®š CSS é€‰æ‹©å™¨å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ ï¼Œ è¯¥æ–¹æ³•åªè¿”å›åŒ¹é…æŒ‡å®šé€‰æ‹©å™¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœè¦è¿”å›æ‰€æœ‰åŒ¹é…å…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨ querySelectorAll() æ–¹æ³•æ›¿ä»£ï¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.querySelector(&quot;#test&quot;); &#x2F;&#x2F; è·å–åˆ°idåä¸ºtestçš„é¦–ä¸ªå…ƒç´ </span><br></pre></td></tr></table></figure>

<ul>
<li>querySelector ç³»åˆ—æ–¹æ³•ä¸ getElementBy ç³»åˆ—æ–¹æ³•å¯¹æ¯”</li>
</ul>
<ol>
<li>å¾—åˆ°çš„å…ƒç´ ä¸æ˜¯éœ€è¦å¾ˆéº»çƒ¦çš„å¤šæ¬¡ getElementBy..çš„è¯ï¼Œå°½é‡ä½¿ç”¨ getElementBy ç³»åˆ—æ–¹æ³•,å› ä¸º getElementBy ç³»åˆ—æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€‚</li>
<li>å¾—åˆ°çš„å…ƒç´ éœ€è¦å¾ˆéº»çƒ¦çš„å¤šæ¬¡ getElementByâ€¦ç»„åˆæ‰èƒ½å¾—åˆ°çš„è¯ä½¿ç”¨ querySelectorï¼Œæ–¹ä¾¿ã€‚</li>
<li>querySelector()é€‰æ‹©çš„æ ‡ç­¾æ˜¯é™æ€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨é€‰ä¸­ä¹‹åï¼Œèƒ½å¤Ÿä¸€ç›´ä¿å­˜ï¼Œä¹Ÿå°±æ˜¯è„±ç¦»äº†è¢«é€‰æ‹©çš„æˆä¸ºå‰¯æœ¬ã€‚è€Œ getelementsBy ç³»åˆ—æ–¹æ³•æ˜¯åŠ¨æ€çš„ï¼Œç›¸äº’æ˜ å°„ï¼Œåœ¨è°ƒç”¨æ—¶ï¼Œå˜åŒ–å¯ä»¥åŠæ—¶çš„åæ˜ åœ¨é¡µé¢ä¸Šã€‚</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”¨ querySelector æ“ä½œå…ƒç´ </span></span><br><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.querySelector(<span class="string">'ul'</span>)</span><br><span class="line"><span class="keyword">var</span> list = ul.querySelectorAll(<span class="string">'li'</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»º3ä¸ªæ–°çš„liæ ‡ç­¾ï¼Œæ·»åŠ åˆ°ulåˆ—è¡¨ä¸­</span></span><br><span class="line">  ul.appendChild(<span class="built_in">document</span>.createElement(<span class="string">'li'</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(list.length) <span class="comment">// 3</span></span><br><span class="line"><span class="comment">// è¾“å‡ºçš„æ˜¯æ·»åŠ å‰liçš„æ•°é‡3ï¼Œè€Œéæ­¤æ—¶liçš„æ€»æ•°é‡6</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'ul'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">var</span> list = ul.getElementsByTagName(<span class="string">'li'</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»º3ä¸ªæ–°çš„liæ ‡ç­¾ï¼Œæ·»åŠ åˆ°ulåˆ—è¡¨ä¸­</span></span><br><span class="line">  ul.appendChild(<span class="built_in">document</span>.createElement(<span class="string">'li'</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(list.length) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>

<ul>
<li>è¿˜æœ‰å…ƒç´ çš„ DOM å¯¼èˆªæ–¹æ³•ï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–çˆ¶å…ƒç´ ã€çˆ¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> parent = ele.parentElement</span><br><span class="line"><span class="keyword">var</span> parent = ele.parentNode</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹å¯ä»¥æ˜¯ä»»ä½•ä¸€ç§èŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡nodeTypeæ¥åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">var</span> nodes = ele.children</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢å­å…ƒç´ </span></span><br><span class="line"><span class="keyword">var</span> els = ele.getElementsByTagName(<span class="string">'li'</span>)</span><br><span class="line"><span class="keyword">var</span> els = ele.getElementsByClassName(<span class="string">'test'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰å…ƒç´ çš„ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªå­å…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> el = ele.firstElementChild</span><br><span class="line"><span class="keyword">var</span> el = ele.lastElementChild</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªå…„å¼Ÿå…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> el = ele.nextElementSibling</span><br><span class="line"><span class="keyword">var</span> el = ele.previousElementSibling</span><br></pre></td></tr></table></figure>

<h2 id="å±æ€§æ“ä½œ"><a href="#å±æ€§æ“ä½œ" class="headerlink" title="å±æ€§æ“ä½œ"></a>å±æ€§æ“ä½œ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getAttribute(key)</span><br><span class="line">setAttribute(key,value)</span><br><span class="line">hasAttribute(key)</span><br><span class="line">removeAttribute(key)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>DOM</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨React+Antdå°è£…Axioså®ç°å…¨å±€Loadingæ•ˆæœ</title>
    <url>/2020/03/29/%E7%94%A8React-Antd%E5%B0%81%E8%A3%85Axios%E5%AE%9E%E7%8E%B0%E5%85%A8%E5%B1%80Loading%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<p>ä»Šå¤©åœ¨åš react åå°ç®¡ç†çš„æ—¶å€™è¦å®ç°ä¸€ä¸ªå…¨å±€ Loading æ•ˆæœï¼Œé€šå¸¸ä½¿ç”¨ axios åº“ä¸åç«¯è¿›è¡Œæ•°æ®äº¤äº’ã€‚ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œåœ¨æ¯æ¬¡è¯·æ±‚å‰æ·»åŠ ä¸€ä¸ªåŠ è½½æ•ˆæœï¼Œè®©ç”¨æˆ·çŸ¥é“åœ¨ç­‰å¾…åŠ è½½ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªç»„ä»¶è¯·æ±‚æ‰‹åŠ¨æ·»åŠ åŠ è½½æ•ˆæœè¿”å›åå†å°†å…¶éšè—ï¼Œä½†å¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½è¿™ä¹ˆåšï¼Œå°±è¦åšå¤šæ¬¡é‡å¤è®¾ç½®æ˜¾å¾—å¾ˆéº»çƒ¦ï¼Œä½†å¥½å¤„æ˜¯å¯ä»¥è®¾ç½®å®šåˆ¶å¤šç§è¯·æ±‚æ•ˆæœã€‚ä½†è€ƒè™‘åˆ°è¯¥é¡¹ç›®åœºæ™¯ä¸ºåå°ç®¡ç†ç³»ç»Ÿï¼Œç»™ç®¡ç†å‘˜ä½¿ç”¨ï¼ŒèŠ±æ ·å¯ä»¥ä¸ç”¨æå¤ªå¤šï¼Œç»Ÿä¸€ä¼˜é›…å³å¯ï¼Œæ•…é‡‡å–å…¨å±€è®¾ç½® loading æ•ˆæœã€‚</p><h2 id="å¼€å‘ç‰ˆæœ¬"><a href="#å¼€å‘ç‰ˆæœ¬" class="headerlink" title="å¼€å‘ç‰ˆæœ¬"></a>å¼€å‘ç‰ˆæœ¬</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"react"</span>: <span class="string">"^16.13.1"</span>,</span><br><span class="line"><span class="string">"antd"</span>: <span class="string">"^4.0.4"</span>,</span><br><span class="line"><span class="string">"axios"</span>: <span class="string">"^0.19.2"</span></span><br></pre></td></tr></table></figure><h2 id="ä»£ç è¯´æ˜"><a href="#ä»£ç è¯´æ˜" class="headerlink" title="ä»£ç è¯´æ˜"></a>ä»£ç è¯´æ˜</h2><ol><li>é€šè¿‡ axios æä¾›çš„è¯·æ±‚æ‹¦æˆªå’Œå“åº”æ‹¦æˆªçš„æ¥å£ï¼Œæ§åˆ¶ loading çš„æ˜¾ç¤ºæˆ–è€…éšè—ã€‚åœ¨æ­¤æˆ‘è¿˜è®¾ç½®äº†æ²¡æœ‰ç½‘ç»œå’Œç½‘ç»œè¶…æ—¶çš„æç¤ºä¿¡æ¯</li><li>é‡‡ç”¨ antd çš„ Spin ç»„ä»¶æ¥å®ç° loading æ•ˆæœï¼Œmessage ç»„ä»¶æ¥è¿›è¡Œæ¶ˆæ¯æç¤ºï¼ˆantd.css è¿™é‡Œæ²¡æœ‰å¼•å…¥ï¼Œæ˜¯å› ä¸ºæˆ‘è®¾ç½®äº†æŒ‰éœ€åŠ è½½ï¼‰</li><li>å®šä¹‰å˜é‡ requestCount ä½œä¸ºè®¡æ•°å™¨ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»å¦‚æœæœ‰å¤šä¸ªè¯·æ±‚çš„è¯ï¼Œä¸ä¼šåŒæ—¶æ·»åŠ å¤šä¸ª loadingï¼Œè€Œæ˜¯åªæœ‰ 1 ä¸ªï¼Œå¹¶åœ¨æ‰€æœ‰è¯·æ±‚ç»“æŸåæ‰ä¼šéšè— loadingã€‚</li><li>é»˜è®¤æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨æœ‰ loading æ•ˆæœã€‚å¦‚æœæŸä¸ªè¯·æ±‚ä¸éœ€è¦ loading æ•ˆæœï¼Œå¯ä»¥åœ¨è¯·æ±‚ headers ä¸­è®¾ç½® isLoading ä¸º falseã€‚</li></ol><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ol><li>åœ¨ src ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ axios.js</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; message, Spin &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Axios = axios.create(&#123;</span><br><span class="line">  <span class="comment">// baseURL: process.env.BASE_URL, // è®¾ç½®è¯·æ±‚çš„base url</span></span><br><span class="line">  timeout: <span class="number">20000</span>, <span class="comment">// è®¾ç½®è¶…æ—¶æ—¶é•¿</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®postè¯·æ±‚å¤´</span></span><br><span class="line">Axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰æ­£åœ¨è¯·æ±‚çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">let</span> requestCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºloading</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showLoading</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (requestCount === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dom = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">    dom.setAttribute(<span class="string">'id'</span>, <span class="string">'loading'</span>)</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(dom)</span><br><span class="line">    ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Spin</span> <span class="attr">tip</span>=<span class="string">'åŠ è½½ä¸­...'</span> <span class="attr">size</span>=<span class="string">'large'</span> /&gt;</span></span>, dom)</span><br><span class="line">  &#125;</span><br><span class="line">  requestCount++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšè—loading</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hideLoading</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  requestCount--</span><br><span class="line">  <span class="keyword">if</span> (requestCount === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(<span class="built_in">document</span>.getElementById(<span class="string">'loading'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å‰æ‹¦æˆª</span></span><br><span class="line">Axios.interceptors.request.use(</span><br><span class="line">  config =&gt; &#123;</span><br><span class="line">    <span class="comment">// requestCountä¸º0ï¼Œæ‰åˆ›å»ºloading, é¿å…é‡å¤åˆ›å»º</span></span><br><span class="line">    <span class="keyword">if</span> (config.headers.isLoading !== <span class="literal">false</span>) &#123;</span><br><span class="line">      showLoading()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  err =&gt; &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦è®¾ç½®äº†ä¸æ˜¾ç¤ºLoading</span></span><br><span class="line">    <span class="keyword">if</span> (err.config.headers.isLoading !== <span class="literal">false</span>) &#123;</span><br><span class="line">      hideLoading()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›åæ‹¦æˆª</span></span><br><span class="line">Axios.interceptors.response.use(</span><br><span class="line">  res =&gt; &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦è®¾ç½®äº†ä¸æ˜¾ç¤ºLoading</span></span><br><span class="line">    <span class="keyword">if</span> (res.config.headers.isLoading !== <span class="literal">false</span>) &#123;</span><br><span class="line">      hideLoading()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;,</span><br><span class="line">  err =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.config.headers.isLoading !== <span class="literal">false</span>) &#123;</span><br><span class="line">      hideLoading()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (err.message === <span class="string">'Network Error'</span>) &#123;</span><br><span class="line">      message.warning(<span class="string">'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (err.code === <span class="string">'ECONNABORTED'</span>) &#123;</span><br><span class="line">      message.warning(<span class="string">'è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡è¯•'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠç»„ä»¶å¼•å…¥ï¼Œå¹¶å®šä¹‰æˆåŸå‹å±æ€§æ–¹ä¾¿ä½¿ç”¨</span></span><br><span class="line">Component.prototype.$axios = Axios</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Axios</span><br></pre></td></tr></table></figure><ol start="2"><li>æ·»åŠ  loading æ ·å¼åœ¨å…±ç”¨çš„ css æ–‡ä»¶é‡Œ</li></ol><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#loading</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.75</span>);</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">9999</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>axios è¯·æ±‚</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. å¼•å…¥è‡ªå®šä¹‰axiosæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">// 2. å¼•å…¥å…±ç”¨cssæ–‡ä»¶ï¼ˆloadingæ ·å¼ï¼‰</span></span><br><span class="line"><span class="comment">// 3. åœ¨reactç»„ä»¶ä¸­æ­£å¸¸å†™æ³•è¯·æ±‚urlå³å¯</span></span><br><span class="line">componentDidMount () &#123;</span><br><span class="line">    axios(&#123;</span><br><span class="line">      url: <span class="string">'/manage/statistic/base_count.do'</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(res.data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸åŠ  loading æ•ˆæœï¼Œè¿™æ ·å†™</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  url: <span class="string">'/manage/statistic/base_count.do'</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    isLoading: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.setState(res.data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/3/29/17126d31a0fc0571?w=1854&h=954&f=gif&s=427836" alt=""></p>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>Ant Design</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£ä¹‹JavaScriptä¹‹call, apply, bindæ–¹æ³•</title>
    <url>/2020/03/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E4%B9%8BJavaScript%E4%B9%8Bcall-apply-bind%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>åœ¨JavaScriptä¸­ï¼Œcallã€applyå’Œbindæ˜¯Functionå¯¹è±¡è‡ªå¸¦çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯æ”¹å˜å‡½æ•°æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ï¼Œå†å…·ä½“ä¸€ç‚¹å°±æ˜¯<strong>æ”¹å˜å‡½æ•°è¿è¡Œæ—¶çš„thisæŒ‡å‘</strong>ã€‚</p>
<a id="more"></a>
<ul>
<li><h2 id="Function-prototype-call"><a href="#Function-prototype-call" class="headerlink" title="Function.prototype.call()"></a>Function.prototype.call()</h2></li>
</ul>
<p>call() æ–¹æ³•è°ƒç”¨ä¸€ä¸ªå‡½æ•°, å…¶å…·æœ‰ä¸€ä¸ªæŒ‡å®šçš„ this å€¼å’Œå¤šä¸ªå‚æ•°(å‚æ•°çš„åˆ—è¡¨)ã€‚</p>
<blockquote>
<p>fun.call(thisArg, arg1, arg2, â€¦)</p>
</blockquote>
<p>thisArgçš„å–å€¼æœ‰ä»¥ä¸‹4ç§æƒ…å†µï¼š</p>
<ol>
<li>ä¸ä¼ ï¼Œæˆ–è€…ä¼ null, undefinedï¼Œ å‡½æ•°ä¸­çš„thisæŒ‡å‘windowå¯¹è±¡ï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰</li>
<li>ä¼ é€’å¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°åï¼Œå‡½æ•°ä¸­çš„thisæŒ‡å‘è¿™ä¸ªå‡½æ•°çš„å¼•ç”¨</li>
<li>ä¼ é€’å­—ç¬¦ä¸²ã€æ•°å€¼æˆ–å¸ƒå°”ç±»å‹ç­‰åŸºç¡€ç±»å‹ï¼Œå‡½æ•°ä¸­çš„thisæŒ‡å‘å…¶å¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼Œå¦‚ Stringã€Numberã€Boolean</li>
<li>ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼Œå‡½æ•°ä¸­çš„thisæŒ‡å‘è¿™ä¸ªå¯¹è±¡.</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹ä»£ç éªŒè¯ä¸€ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params"></span>) </span>&#123;   </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);   </span><br><span class="line">&#125;       </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params"></span>) </span>&#123;&#125;       </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">"jacky"</span> &#125;;  </span><br><span class="line"></span><br><span class="line">func1.call();   <span class="comment">// Window</span></span><br><span class="line">func1.call(<span class="literal">null</span>);   <span class="comment">// Window</span></span><br><span class="line">func1.call(<span class="literal">undefined</span>);   <span class="comment">// Window</span></span><br><span class="line">func1.call(<span class="number">1</span>);   <span class="comment">// Number &#123;1&#125;</span></span><br><span class="line">func1.call(<span class="string">''</span>);   <span class="comment">// String &#123;""&#125;</span></span><br><span class="line">func1.call(<span class="literal">true</span>);   <span class="comment">// Boolean &#123;true&#125;</span></span><br><span class="line">func1.call(func2);   <span class="comment">// Æ’ func2() &#123;&#125;</span></span><br><span class="line">func1.call(obj);   <span class="comment">// &#123;name: "jacky"&#125;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†æ¥çœ‹ä¸ªä¾‹å­ï¼Œç†è§£æ€ä¹ˆæ”¹å˜thisçš„æŒ‡å‘ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'animal'</span>;</span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'cat'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> animal = <span class="keyword">new</span> Animal();</span><br><span class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> Cat();</span><br><span class="line"></span><br><span class="line">animal.sayName.call(cat); <span class="comment">// cat</span></span><br><span class="line"><span class="comment">// this æ°¸è¿œæŒ‡å‘æœ€åè°ƒç”¨å®ƒçš„é‚£ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">// è¯¥ä¾‹å­ä¸­sayNameæ–¹æ³•çš„thisæŒ‡å‘Cat</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="Function-prototype-apply"><a href="#Function-prototype-apply" class="headerlink" title="Function.prototype.apply()"></a>Function.prototype.apply()</h2></li>
</ul>
<p>callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯è¦æ”¹å˜ä¸Šä¸‹æ–‡çš„å¯¹è±¡ï¼Œè€Œcallä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹ä»¥å‚æ•°åˆ—è¡¨çš„å½¢å¼å±•ç°ï¼Œapplyåˆ™æ˜¯æŠŠé™¤äº†æ”¹å˜ä¸Šä¸‹æ–‡å¯¹è±¡çš„å‚æ•°æ”¾åœ¨ä¸€ä¸ª<strong>æ•°ç»„</strong>é‡Œé¢ä½œä¸ºå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»–ä»¬ä¿©ä¹‹é—´çš„å·®åˆ«åœ¨äº<strong>å‚æ•°</strong>çš„åŒºåˆ«ã€‚</p>
<p>å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> å’Œå…¶ä»–å‚æ•° <span class="subst">$&#123;args&#125;</span>`</span>); </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = &#123;</span><br><span class="line">    name: <span class="string">'xiaomao'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. ä½¿ç”¨ call</span></span><br><span class="line">Animal.call(cat, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// xiaomao å’Œå…¶ä»–å‚æ•° 1,2,3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä½¿ç”¨ apply</span></span><br><span class="line">Animal.apply(cat, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// xiaomao å’Œå…¶ä»–å‚æ•° 1,2,3</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="callã€applyä½¿ç”¨"><a href="#callã€applyä½¿ç”¨" class="headerlink" title="callã€applyä½¿ç”¨"></a>callã€applyä½¿ç”¨</h2></li>
</ul>
<p>ç”±äºä¸¤ä¸ªæ–¹æ³•å®é™…æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¯¹äºä¸¤è€…å¹³æ—¶ç”¨è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p>
<ol>
<li>å‚æ•°æ•°é‡/é¡ºåºç¡®å®šå°±ç”¨callï¼Œå‚æ•°æ•°é‡/é¡ºåºä¸ç¡®å®šçš„è¯å°±ç”¨applyã€‚</li>
<li>è€ƒè™‘å¯è¯»æ€§ï¼šå‚æ•°æ•°é‡ä¸å¤šå°±ç”¨callï¼Œå‚æ•°æ•°é‡æ¯”è¾ƒå¤šçš„è¯ï¼ŒæŠŠå‚æ•°æ•´åˆæˆæ•°ç»„ï¼Œä½¿ç”¨applyã€‚</li>
<li>å‚æ•°é›†åˆå·²ç»æ˜¯ä¸€ä¸ªæ•°ç»„çš„æƒ…å†µï¼Œç”¨applyã€‚</li>
</ol>
<ul>
<li><h2 id="call-apply-çš„åº”ç”¨"><a href="#call-apply-çš„åº”ç”¨" class="headerlink" title="call, apply çš„åº”ç”¨"></a>call, apply çš„åº”ç”¨</h2></li>
</ul>
<h3 id="æ•°ç»„æ‹¼æ¥"><a href="#æ•°ç»„æ‹¼æ¥" class="headerlink" title="æ•°ç»„æ‹¼æ¥"></a>æ•°ç»„æ‹¼æ¥</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨ applyæ–¹æ³•</span></span><br><span class="line">[].push.apply(arr1, arr2);  <span class="comment">// ç»™arr1æ·»åŠ arr2</span></span><br><span class="line"><span class="built_in">console</span>.log(arr1); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>

<h3 id="è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼"><a href="#è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼" class="headerlink" title="è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼"></a>è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">100</span>, <span class="number">98</span>]; </span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">Math</span>.max.apply(<span class="built_in">Math</span>, numbers) );   <span class="comment">// 100</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">Math</span>.max.call(<span class="built_in">Math</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">100</span>, <span class="number">98</span>) ); <span class="comment">// 100</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">Math</span>.min.call(<span class="built_in">Math</span>, ...numbers) ); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ¤æ–­æ•°æ®ç±»å‹"><a href="#åˆ¤æ–­æ•°æ®ç±»å‹" class="headerlink" title="åˆ¤æ–­æ•°æ®ç±»å‹"></a>åˆ¤æ–­æ•°æ®ç±»å‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">'string'</span>,</span><br><span class="line">    obj = &#123; <span class="attr">name</span>: <span class="string">'jacky'</span> &#125;</span><br><span class="line"><span class="comment">// åˆ¤æ–­ä¼ å…¥å‚æ•°æ˜¯å¦ä¸ºæ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArray</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Array]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(isArray(arr)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isArray(str)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(arr)); <span class="comment">// [object Array]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(str)); <span class="comment">// [object String]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(obj)); <span class="comment">// [object Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="literal">null</span>)); <span class="comment">// [object Null]</span></span><br></pre></td></tr></table></figure>

<h3 id="è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°å®ç°ç»§æ‰¿"><a href="#è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°å®ç°ç»§æ‰¿" class="headerlink" title="è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°å®ç°ç»§æ‰¿"></a>è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°å®ç°ç»§æ‰¿</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">name</span>)</span>&#123;      </span><br><span class="line">    <span class="keyword">this</span>.name = name;      </span><br><span class="line">    <span class="keyword">this</span>.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;      </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);      </span><br><span class="line">    &#125;      </span><br><span class="line">&#125;      </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cat</span>(<span class="params">name</span>)</span>&#123;    </span><br><span class="line">    Animal.call(<span class="keyword">this</span>, name);    </span><br><span class="line">&#125;      </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> Cat(<span class="string">"xiaomao"</span>);     </span><br><span class="line">cat.showName();   <span class="comment">// xiaomao</span></span><br></pre></td></tr></table></figure>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>åªèƒ½ç»§æ‰¿çˆ¶ç±»çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œä¸èƒ½ç»§æ‰¿åŸå‹å±æ€§/æ–¹æ³•</li>
<li>æ¯æ¬¡å­ç±»å®ä¾‹åŒ–éƒ½è¦æ‰§è¡Œçˆ¶ç±»å‡½æ•°ï¼Œé‡æ–°å£°æ˜çˆ¶ç±»thisé‡Œæ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œå› æ­¤çˆ¶ç±»æ–¹æ³•æ— æ³•å¤ç”¨ã€‚</li>
</ol>
<h3 id="ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„"><a href="#ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„" class="headerlink" title="ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„"></a>ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(args);</span><br><span class="line">&#125;</span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰åƒè°ƒç”¨ getElementsByTagName , document.childNodes ä¹‹ç±»çš„ï¼Œå®ƒä»¬è¿”å›NodeListå¯¹è±¡éƒ½å±äºä¼ªæ•°ç»„ã€‚</p>
<h3 id="ä»£ç†console-logæ–¹æ³•"><a href="#ä»£ç†console-logæ–¹æ³•" class="headerlink" title="ä»£ç†console.logæ–¹æ³•"></a>ä»£ç†console.logæ–¹æ³•</h3><p>æ³¨æ„è¿™é‡Œä¼ å…¥å¤šå°‘ä¸ªå‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥ä½¿ç”¨applyæ˜¯æœ€å¥½çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log.apply(<span class="built_in">console</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br><span class="line">log(<span class="number">1</span>);    <span class="comment">// 1</span></span><br><span class="line">log(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);    <span class="comment">// 1 2 3</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="Function-prototype-bind"><a href="#Function-prototype-bind" class="headerlink" title="Function.prototype.bind()"></a>Function.prototype.bind()</h2></li>
</ul>
<p>MDNçš„è§£é‡Šæ˜¯ï¼š</p>
<blockquote>
<p>bind()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œç§°ä¸ºç»‘å®šå‡½æ•°ï¼Œå½“è°ƒç”¨è¿™ä¸ªç»‘å®šå‡½æ•°æ—¶ï¼Œç»‘å®šå‡½æ•°ä¼šä»¥åˆ›å»ºå®ƒæ—¶ä¼ å…¥ bind()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸º thisï¼Œä¼ å…¥ bind() æ–¹æ³•çš„ç¬¬äºŒä¸ªä»¥åŠä»¥åçš„å‚æ•°åŠ ä¸Šç»‘å®šå‡½æ•°è¿è¡Œæ—¶æœ¬èº«çš„å‚æ•°æŒ‰ç…§é¡ºåºä½œä¸ºåŸå‡½æ•°çš„å‚æ•°æ¥è°ƒç”¨åŸå‡½æ•°ã€‚</p>
</blockquote>
<p>è¯´ç›´ç™½ä¸€ç‚¹ï¼Œbindæ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå¯ä»¥åœ¨éœ€è¦è°ƒç”¨çš„æ—¶å€™å†æ‰§è¡Œå‡½æ•°ï¼Œå¹¶éæ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°ï¼›è€Œcallï¼Œapplyæ˜¯åœ¨æ”¹å˜äº†ä¸Šä¸‹æ–‡ä¸­çš„thisæŒ‡å‘åå¹¶ç«‹å³æ‰§è¡Œå‡½æ•°ã€‚</p>
<p>bind æ¥æ”¶çš„å‚æ•°ç±»å‹ä¸ call æ˜¯ä¸€æ ·çš„ï¼Œç»™å®ƒä¼ é€’çš„æ˜¯ä¸€ç»„ç”¨é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;   </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);   </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = &#123; </span><br><span class="line">    x: <span class="number">2</span>   </span><br><span class="line">&#125;   </span><br><span class="line">bar(); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = bar.bind(foo);   </span><br><span class="line">func(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="bindçš„åº”ç”¨"><a href="#bindçš„åº”ç”¨" class="headerlink" title="bindçš„åº”ç”¨"></a>bindçš„åº”ç”¨</h2></li>
</ul>
<h3 id="bindç»‘å®šå›è°ƒå‡½æ•°çš„thisæŒ‡å‘"><a href="#bindç»‘å®šå›è°ƒå‡½æ•°çš„thisæŒ‡å‘" class="headerlink" title="bindç»‘å®šå›è°ƒå‡½æ•°çš„thisæŒ‡å‘"></a>bindç»‘å®šå›è°ƒå‡½æ•°çš„thisæŒ‡å‘</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(callBack) &#123;</span><br><span class="line">        <span class="keyword">this</span>.className = <span class="string">'PageA'</span></span><br><span class="line">        <span class="keyword">this</span>.MessageCallBack = callBack </span><br><span class="line">        <span class="keyword">this</span>.MessageCallBack(<span class="string">'æ‰§è¡Œäº†'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.className = <span class="string">'PageB'</span></span><br><span class="line">        <span class="keyword">this</span>.pageClass = <span class="keyword">new</span> PageA(<span class="keyword">this</span>.handleMessage)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å›è°ƒå‡½æ•°</span></span><br><span class="line">    handleMessage(msg) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'å¤„ç†'</span> + <span class="keyword">this</span>.className + <span class="string">'çš„å›è°ƒ '</span> + msg) <span class="comment">// å¤„ç†PageAçš„å›è°ƒ æ‰§è¡Œäº†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> PageB();</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å‘ç°å›è°ƒå‡½æ•°thisä¸¢å¤±äº†ï¼Ÿé—®é¢˜å‡ºåœ¨è¿™è¡Œä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.pageClass = <span class="keyword">new</span> PageA(<span class="keyword">this</span>.handleMessage)</span><br></pre></td></tr></table></figure>
<p>ä¼ é€’è¿‡å»çš„this.handleMessageæ˜¯ä¸€ä¸ªå‡½æ•°å†…å­˜åœ°å€ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å‡½æ•°æ²¡æœ‰ç»‘å®šå®ƒçš„thisæŒ‡å‘ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šç”¨bindç»‘å®šthisçš„æŒ‡å‘</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.pageClass = <span class="keyword">new</span> PageA(<span class="keyword">this</span>.handleMessage.bind(<span class="keyword">this</span>))</span><br></pre></td></tr></table></figure>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆreactçš„renderå‡½æ•°åœ¨ç»‘å®šå›è°ƒå‡½æ•°çš„æ—¶å€™ï¼Œä¹Ÿè¦ä½¿ç”¨bindç»‘å®šä¸€ä¸‹thisçš„æŒ‡å‘ï¼Œä¹Ÿæ˜¯å› ä¸ºåŒæ ·çš„é—®é¢˜ä»¥åŠåŸç†ã€‚</p>
<ul>
<li><p>å¤šä¸ªbindçš„æƒ…å†µ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    x: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">    x: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj3 = &#123;</span><br><span class="line">    x: <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func1 = bar.bind(obj1).bind(obj2);</span><br><span class="line"><span class="keyword">var</span> func2 = bar.bind(obj1).bind(obj2).bind(obj3);</span><br><span class="line">func1(); <span class="comment">// 2</span></span><br><span class="line">func2(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœéƒ½ä¸ºç¬¬ä¸€ä¸ªç»‘å®šçš„objå¯¹è±¡çš„xå€¼ã€‚åŸå› æ˜¯ï¼Œåœ¨Javascriptä¸­ï¼Œbind()æ–¹æ³•è¿”å›çš„å¤–æ¥çš„ç»‘å®šå‡½æ•°å¯¹è±¡ä»…åœ¨åˆ›å»ºçš„æ—¶å€™è®°å¿†ä¸Šä¸‹æ–‡ï¼ˆå¦‚æœæä¾›äº†å‚æ•°ï¼‰ï¼Œå¤šæ¬¡ bind() æ˜¯æ— æ•ˆçš„ã€‚æ›´æ·±å±‚æ¬¡çš„åŸå› ï¼Œ bind() çš„å®ç°ï¼Œç›¸å½“äºä½¿ç”¨å‡½æ•°åœ¨å†…éƒ¨åŒ…äº†ä¸€ä¸ª call / apply ï¼Œç¬¬äºŒæ¬¡ bind() ç›¸å½“äºå†åŒ…ä½ç¬¬ä¸€æ¬¡ bind() ,æ•…ç¬¬äºŒæ¬¡ä»¥åçš„ bind æ˜¯æ— æ³•ç”Ÿæ•ˆçš„ã€‚</p>
</li>
<li><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2></li>
</ul>
<p>callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯è¦æ”¹å˜ä¸Šä¸‹æ–‡çš„å¯¹è±¡ï¼Œè€Œcallä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹ä»¥å‚æ•°åˆ—è¡¨çš„å½¢å¼å±•ç°; applyåˆ™æ˜¯æŠŠé™¤äº†æ”¹å˜ä¸Šä¸‹æ–‡å¯¹è±¡çš„å‚æ•°æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢ä½œä¸ºå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»–ä»¬ä¿©ä¹‹é—´çš„å·®åˆ«åœ¨äºå‚æ•°çš„åŒºåˆ«ã€‚</p>
<p>callå’Œapplyæ”¹å˜äº†å‡½æ•°çš„thisä¸Šä¸‹æ–‡åä¾¿æ‰§è¡Œè¯¥å‡½æ•°,è€Œbindåˆ™æ˜¯è¿”å›æ”¹å˜äº†ä¸Šä¸‹æ–‡åçš„ä¸€ä¸ªå‡½æ•°,å…¶å†…çš„thisæŒ‡å‘ä¸ºåˆ›å»ºå®ƒæ—¶ä¼ å…¥bindçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¼ å…¥bindçš„ç¬¬äºŒä¸ªåŠä»¥åçš„å‚æ•°ä½œä¸ºåŸå‡½æ•°çš„å‚æ•°æ¥è°ƒç”¨åŸå‡½æ•°ã€‚bindçš„å‚æ•°å¯ä»¥åœ¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™å†æ¬¡æ·»åŠ ã€‚</p>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹ä½œç”¨åŸŸé“¾ä¸é—­åŒ…</title>
    <url>/2020/03/01/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E4%B8%8E%E9%97%AD%E5%8C%85/</url>
    <content><![CDATA[<p>ä½œç”¨åŸŸå’Œé—­åŒ…æ˜¯ Js å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå¯¹æ­¤è¿›è¡Œæ·±å…¥äº†è§£</p>
<a id="more"></a>

<h2 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h2><p>ä½œç”¨åŸŸæ˜¯æŒ‡ç¨‹åºæºä»£ç ä¸­å®šä¹‰å˜é‡çš„åŒºåŸŸã€‚</p>
<p>å®é™…ä¸Šæè¿°çš„å°±æ˜¯æŸ¥æ‰¾å˜é‡çš„èŒƒå›´ï¼Œä½œç”¨åŸŸå¿…é¡»æœ‰çš„ä¸¤ä¸ªåŠŸèƒ½å°±æ˜¯<strong>å­˜å‚¨å˜é‡</strong>ä»¥åŠ<strong>æŸ¥æ‰¾å˜é‡</strong>ï¼Œä½œç”¨åŸŸå°±æ˜¯å‘æŒ¥è¿™ä¸¤ä¸ªä½œç”¨ä»¥åŠæ›´å¤šä½œç”¨çš„è§„åˆ™ã€‚</p>
<p>ä½œç”¨åŸŸè§„å®šäº†å¦‚ä½•æŸ¥æ‰¾å˜é‡ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šå½“å‰æ‰§è¡Œä»£ç å¯¹å˜é‡çš„è®¿é—®æƒé™ã€‚</p>
<h3 id="è¯æ³•ä½œç”¨åŸŸå’ŒåŠ¨æ€ä½œç”¨åŸŸ"><a href="#è¯æ³•ä½œç”¨åŸŸå’ŒåŠ¨æ€ä½œç”¨åŸŸ" class="headerlink" title="è¯æ³•ä½œç”¨åŸŸå’ŒåŠ¨æ€ä½œç”¨åŸŸ"></a>è¯æ³•ä½œç”¨åŸŸå’ŒåŠ¨æ€ä½œç”¨åŸŸ</h3><ul>
<li>è¯æ³•ä½œç”¨åŸŸï¼šï¼ˆé™æ€ä½œç”¨åŸŸï¼‰å‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±å†³å®šäº†ã€‚</li>
<li>åŠ¨æ€ä½œç”¨åŸŸï¼šå‡½æ•°çš„ä½œç”¨åŸŸæ˜¯åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‰å†³å®šçš„ã€‚</li>
</ul>
<p>JavaScript é‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸ</p>
<h3 id="å…¨å±€ä½œç”¨åŸŸ"><a href="#å…¨å±€ä½œç”¨åŸŸ" class="headerlink" title="å…¨å±€ä½œç”¨åŸŸ"></a>å…¨å±€ä½œç”¨åŸŸ</h3><p>åœ¨ä»£ç ä¸­ä»»ä½•åœ°æ–¹éƒ½èƒ½è®¿é—®åˆ°çš„å¯¹è±¡æ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸ</p>
<p>å…¨å±€å˜é‡ï¼š</p>
<blockquote>
<ol>
<li>ç”Ÿå‘½å‘¨æœŸå°†å­˜åœ¨äºæ•´ä¸ªç¨‹åºä¹‹å†…ã€‚</li>
<li>èƒ½è¢«ç¨‹åºä¸­ä»»ä½•å‡½æ•°æˆ–è€…æ–¹æ³•è®¿é—®ã€‚</li>
<li>åœ¨ JavaScript å†…é»˜è®¤æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ã€‚</li>
</ol>
</blockquote>
<p>JavaScript é‡‡ç”¨è¯æ³•ä½œç”¨åŸŸ(lexical scoping)ï¼Œä¹Ÿå°±æ˜¯é™æ€ä½œç”¨åŸŸã€‚</p>
<h4 id="æ˜¾å¼å£°æ˜"><a href="#æ˜¾å¼å£°æ˜" class="headerlink" title="æ˜¾å¼å£°æ˜"></a>æ˜¾å¼å£°æ˜</h4><p>å¸¦æœ‰å…³é”®å­— var çš„å£°æ˜</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> winValue = <span class="number">10</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.winValue) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>

<h4 id="éšå¼å£°æ˜"><a href="#éšå¼å£°æ˜" class="headerlink" title="éšå¼å£°æ˜"></a>éšå¼å£°æ˜</h4><p>ä¸å¸¦æœ‰å£°æ˜å…³é”®å­—çš„å˜é‡ï¼ŒJS ä¼šé»˜è®¤å¸®ä½ å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  result = value + <span class="number">1</span> <span class="comment">// æ²¡æœ‰ç”¨ var å£°æ˜</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.result) <span class="comment">// 2 &lt;=  æŒ‚åœ¨äº† windowå…¨å±€å¯¹è±¡ä¸Š</span></span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°ä½œç”¨åŸŸ"><a href="#å‡½æ•°ä½œç”¨åŸŸ" class="headerlink" title="å‡½æ•°ä½œç”¨åŸŸ"></a>å‡½æ•°ä½œç”¨åŸŸ</h3><p>å‡½æ•°ä½œç”¨åŸŸå†…ï¼Œå¯¹å¤–æ˜¯å°é—­çš„ï¼Œä»å¤–å±‚çš„ä½œç”¨åŸŸæ— æ³•ç›´æ¥è®¿é—®å‡½æ•°å†…éƒ¨çš„ä½œç”¨åŸŸã€‚</p>
<p>åœ¨å‡½æ•°å†…éƒ¨çš„å˜é‡æƒé™ç§°ä¸ºå‡½æ•°ä½œç”¨åŸŸï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œè€Œä¸”è°ƒç”¨ä¸€æ¬¡å°±ä¼šç”Ÿæˆæ–°çš„ä½œç”¨åŸŸ</li>
<li>åªèƒ½åœ¨å‡½æ•°å†…éƒ¨æ‰èƒ½è®¿é—®ï¼Œå¤–éƒ¨æ˜¯æ²¡æœ‰æƒé™è®¿é—®çš„</li>
<li>è¿›å…¥å‡½æ•°å†…éƒ¨æ—¶å¼€å¯ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åé”€æ¯</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> foo = <span class="string">'test'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(foo) <span class="comment">// Uncaught ReferenceError: foo is not defined</span></span><br></pre></td></tr></table></figure>

<h3 id="å—çº§ä½œç”¨åŸŸï¼ˆES6-æ–°å¢ï¼‰"><a href="#å—çº§ä½œç”¨åŸŸï¼ˆES6-æ–°å¢ï¼‰" class="headerlink" title="å—çº§ä½œç”¨åŸŸï¼ˆES6 æ–°å¢ï¼‰"></a>å—çº§ä½œç”¨åŸŸï¼ˆES6 æ–°å¢ï¼‰</h3><p>å‡¡æ˜¯ç”±{}ç¬¦å·åŒ…è£¹èµ·æ¥çš„éƒ½æ˜¯å—ä½œç”¨åŸŸ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i) <span class="comment">// Uncaught ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ for å¾ªç¯æ‰§è¡Œå®Œæ¯•ä¹‹å i å˜é‡å°±è¢«é‡Šæ”¾äº†</p>
<h2 id="ä½œç”¨åŸŸé“¾"><a href="#ä½œç”¨åŸŸé“¾" class="headerlink" title="ä½œç”¨åŸŸé“¾"></a>ä½œç”¨åŸŸé“¾</h2><p>ä½œç”¨åŸŸé“¾ï¼šå½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼Œè§£é‡Šå™¨ä¼šé¦–å…ˆåœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å»çˆ¶ä½œç”¨åŸŸæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å˜é‡æˆ–è€…ä¸åœ¨çˆ¶ä½œç”¨åŸŸä¸­ï¼Œè¿™å°±æ˜¯ä½œç”¨åŸŸé“¾ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">2</span></span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo() <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// Uncaught ReferenceError: b is not defined</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œfoo å‡½æ•°å–åˆ°äº†å®ƒå¤–éƒ¨çš„å˜é‡ a, è€Œæœ€å¤–å±‚çš„ console.log(b) æ“ä½œå¹¶æ²¡èƒ½å–å¾— foo å‡½æ•°é‡Œé¢çš„å˜é‡ bã€‚</p>
<ul>
<li>ä½œç”¨åŸŸé“¾å’ŒåŸå‹ç»§æ‰¿æŸ¥æ‰¾æ—¶çš„åŒºåˆ«ï¼š</li>
</ul>
<p>å¦‚æœå»æŸ¥æ‰¾ä¸€ä¸ªæ™®é€šå¯¹è±¡çš„å±æ€§ï¼Œä½†æ˜¯åœ¨å½“å‰å¯¹è±¡å’Œå…¶åŸå‹ä¸­éƒ½æ‰¾ä¸åˆ°æ—¶ï¼Œä¼šè¿”å› undefinedï¼›ä½†æŸ¥æ‰¾çš„å±æ€§åœ¨ä½œç”¨åŸŸé“¾ä¸­ä¸å­˜åœ¨çš„è¯å°±ä¼šæŠ›å‡º ReferenceErrorã€‚</p>
<h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>é—­åŒ…æ˜¯æŒ‡<strong>æœ‰æƒè®¿é—®å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡çš„å‡½æ•°</strong></p>
<p>åœ¨ javascript ä¸­ï¼Œåªæœ‰å‡½æ•°å†…éƒ¨çš„å­å‡½æ•°æ‰èƒ½è¯»å–å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥é—­åŒ…å¯ä»¥ç†è§£æˆâ€å®šä¹‰åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å‡½æ•°â€ã€‚åœ¨æœ¬è´¨ä¸Šï¼Œé—­åŒ…æ˜¯å°†å‡½æ•°å†…éƒ¨å’Œå‡½æ•°å¤–éƒ¨è¿æ¥èµ·æ¥çš„æ¡¥æ¢ã€‚</p>
<ul>
<li>é—­åŒ…ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼š</li>
</ul>
<ol>
<li>å‡½æ•°</li>
<li>èƒ½è®¿é—®å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆæœ‰é—­åŒ…"><a href="#ä¸ºä»€ä¹ˆæœ‰é—­åŒ…" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰é—­åŒ…?"></a>ä¸ºä»€ä¹ˆæœ‰é—­åŒ…?</h3><blockquote>
<p>ä¹‹æ‰€ä»¥å‡ºç°é—­åŒ…æ˜¯å› ä¸º JS çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒJS æœ¬èº«ä¸ºäº†é¿å…è§£é‡Šå™¨è¿‡é‡æ¶ˆè€—å†…å­˜ï¼Œé€ æˆç³»ç»Ÿå´©æºƒï¼Œè‡ªå¸¦æœ‰ä¸€å¥—åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶èƒ½å¤Ÿæ£€æµ‹åˆ°ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯æ— ç”¨çš„ã€‚æ£€æµ‹åˆ°ä¹‹åï¼Œå°±ä¼šæŠŠå®ƒå ç”¨çš„å†…å­˜é‡Šæ”¾æ‰ã€‚ä½†æ˜¯å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šéœ€è¦ä¸€äº›å˜é‡ä¸é‚£ä¹ˆåŠæ—¶çš„è¢«æ¸…ç†ï¼Œæ‰€ä»¥å°±å‡ºç°äº†é—­åŒ…ï¼Œç”¨æ¥è¾¾æˆè¿™ä¸ªæ•ˆæœã€‚</p>
</blockquote>
<h3 id="é—­åŒ…çš„ç‰¹ç‚¹"><a href="#é—­åŒ…çš„ç‰¹ç‚¹" class="headerlink" title="é—­åŒ…çš„ç‰¹ç‚¹"></a>é—­åŒ…çš„ç‰¹ç‚¹</h3><ul>
<li>é—­åŒ…å¯ä»¥è®¿é—®å½“å‰å‡½æ•°ä»¥å¤–çš„å˜é‡</li>
<li>å³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»è¿”å›ï¼Œé—­åŒ…ä»èƒ½è®¿é—®å¤–éƒ¨å‡½æ•°å®šä¹‰çš„å˜é‡</li>
<li>å‚æ•°å’Œå˜é‡ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶æ”¶å›ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOuter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'jacky'</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(str + name) <span class="comment">// å¯ä»¥è®¿é—®getNameå‡½æ•°å¤–éƒ¨çš„name</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> getName(<span class="string">'åå­—æ˜¯ï¼š'</span>)</span><br><span class="line">&#125;</span><br><span class="line">getOuter() <span class="comment">// åå­—æ˜¯ï¼šjacky</span></span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = bar() <span class="comment">// è¿™ä¸€å¥æ‰§è¡Œå®Œï¼Œå˜é‡xå¹¶æ²¡æœ‰è¢«å›æ”¶ï¼Œå› ä¸ºè¦å†…éƒ¨å‡½æ•°è¿˜éœ€è¦å¼•ç”¨</span></span><br><span class="line"><span class="built_in">console</span>.log(foo()) <span class="comment">// 3  æ‰§è¡Œå†…éƒ¨å‡½æ•°ï¼Œå¼•ç”¨å¤–éƒ¨å˜é‡x</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œåœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° bar å’Œå˜é‡ fooï¼Œå‡½æ•° bar å†…éƒ¨è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ‰€ä»¥æ­¤åˆ»åŒ¿åå‡½æ•°çš„ä½œç”¨åŸŸé“¾åˆå§‹åŒ–ä¸ºåŒ…å«äº†å…¨å±€å˜é‡å¯¹è±¡å’Œ bar ä¸­çš„å˜é‡å¯¹è±¡ã€‚</p>
<p>å½“æ‰§è¡Œ var foo = bar()æ—¶ï¼ŒæŠŠå‡½æ•° bar çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‹å…¥æ ˆï¼Œå½“ bar æ‰§è¡Œå®Œåï¼Œå…¶æ‰§è¡Œä¸Šä¸‹æ–‡åº”è¯¥å¼¹å‡ºæ ˆï¼Œä½†æ˜¯å› ä¸º bar å†…éƒ¨çš„åŒ¿åå‡½æ•°ä½œç”¨åŸŸé“¾è¿˜å¼•ç”¨è¿™ bar å‡½æ•°å†…çš„å˜é‡ xï¼Œæ‰€ä»¥ bar çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¾—ä¸åˆ°é‡Šæ”¾ï¼Œè¿™æ ·å°±å½¢æˆäº†é—­åŒ…ã€‚</p>
<h3 id="é—­åŒ…çš„åº”ç”¨"><a href="#é—­åŒ…çš„åº”ç”¨" class="headerlink" title="é—­åŒ…çš„åº”ç”¨"></a>é—­åŒ…çš„åº”ç”¨</h3><ol>
<li>è®¾è®¡ç§æœ‰çš„æ–¹æ³•å’Œå˜é‡ï¼ˆå°è£…ï¼Œå®šä¹‰æ¨¡å—ï¼‰ã€‚</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> counter = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> privateCounter = <span class="number">0</span> <span class="comment">//ç§æœ‰å˜é‡</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    privateCounter += val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    increment: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      change(<span class="number">1</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    decrement: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      change(<span class="number">-1</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> privateCounter</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åŒ¿åå‡½æ•°æœ€å¤§çš„ç”¨é€”æ˜¯åˆ›å»ºé—­åŒ…ã€‚å‡å°‘å…¨å±€å˜é‡çš„ä½¿ç”¨ã€‚ä»è€Œä½¿ç”¨é—­åŒ…æ¨¡å—åŒ–ä»£ç ï¼Œå‡å°‘å…¨å±€å˜é‡çš„æ±¡æŸ“ã€‚</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> objEvent = objEvent || &#123;&#125;</span><br><span class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> addEvent = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">  &#125;</span><br><span class="line">  objEvent.addEvent = addEvent</span><br><span class="line">  objEvent.removeEvent = removeEvent</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>addEvent å’Œ removeEvent éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å…¨å±€å˜é‡ objEvent ä½¿ç”¨å®ƒ</p>
<h3 id="å¦‚ä½•é”€æ¯é—­åŒ…"><a href="#å¦‚ä½•é”€æ¯é—­åŒ…" class="headerlink" title="å¦‚ä½•é”€æ¯é—­åŒ…"></a>å¦‚ä½•é”€æ¯é—­åŒ…</h3><p>javascript ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œè€Œä¸å†è¢«ç¬¬ 3 è€…æ‰€å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäº’ç›¸å¼•ç”¨çš„å¯¹è±¡ä¹Ÿä¼šè¢«å›æ”¶ã€‚</p>
<p>å³é‡Šæ”¾å¯¹é—­åŒ…çš„å¼•ç”¨ï¼Œä½¿å¼•ç”¨å˜é‡ä¸º nullã€‚</p>
<h3 id="é—­åŒ…çš„ä¼˜ç¼ºç‚¹"><a href="#é—­åŒ…çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="é—­åŒ…çš„ä¼˜ç¼ºç‚¹"></a>é—­åŒ…çš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>é—­åŒ…é‡Œçš„å˜é‡ä¸ä¼šæ±¡æŸ“å…¨å±€ï¼Œå› ä¸ºå˜é‡è¢«å°åœ¨é—­åŒ…é‡Œï¼›</li>
<li>æ‰€æœ‰å˜é‡éƒ½åœ¨é—­åŒ…é‡Œä¿è¯äº†éšç§æ€§å’Œç§æœ‰æ€§ï¼›</li>
<li>å¯ä»¥è®©è¿™äº›å±€éƒ¨å˜é‡ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå®ç°å˜é‡æ•°æ®å…±äº«ã€‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<p>å½¢æˆé—­åŒ…å³è¦æŠŠä¸€ä¸ªå‡½æ•°å½“æˆå€¼ä¼ é€’ï¼Œè€Œä¸”è¯¥å‡½æ•°è¿˜å¼•ç”¨è¿™å¦ä¸€ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸé“¾ä½¿å¾—è¢«å¼•ç”¨çš„å‡½æ•°ä¸èƒ½è¢«å›æ”¶ï¼Œä½¿ç”¨ä¸å½“å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ï¼›</p>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>ä½œç”¨åŸŸé“¾</tag>
        <tag>é—­åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹ new åŸç†åŠæ¨¡æ‹Ÿå®ç°</title>
    <url>/2020/02/22/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B-new-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<p>æ¢è®¨ new åŸç†â€¦â€¦</p><a id="more"></a><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>new è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹</p><p>å…ˆçœ‹çœ‹ new å®ç°äº†å“ªäº›åŠŸèƒ½, å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.getAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å¹´é¾„ä¸º:'</span> + <span class="keyword">this</span>.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="number">18</span>)</span><br><span class="line">person.age <span class="comment">// è®¿é—®æ„é€ å‡½æ•°é‡Œçš„å±æ€§</span></span><br><span class="line"><span class="comment">// 18</span></span><br><span class="line"></span><br><span class="line">person.getAge() <span class="comment">// è®¿é—®åŸå‹é‡Œçš„å±æ€§</span></span><br><span class="line"><span class="comment">// å¹´é¾„ä¸º:18</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢ä»£ç å¯ä»¥çŸ¥é“ï¼Œå®ä¾‹ person å¯ä»¥ï¼š</p><ol><li>è®¿é—®åˆ° Person æ„é€ å‡½æ•°é‡Œçš„å±æ€§</li><li>è®¿é—®åˆ° Person.prototype ä¸­çš„å±æ€§</li></ol><p>è¿™ä¸ªæ˜¯æœ€åŸºæœ¬çš„äº†ï¼Œä¹Ÿæ˜¯åˆšå­¦ä¼š new ä¸€ä¸ªå¯¹è±¡å°±çŸ¥é“è¿™æ˜¯ new çš„ç‰¹ç‚¹</p><h2 id="æ¢è®¨-new-è¿˜åšäº†ä»€ä¹ˆï¼Ÿ"><a href="#æ¢è®¨-new-è¿˜åšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ¢è®¨ new è¿˜åšäº†ä»€ä¹ˆï¼Ÿ"></a>æ¢è®¨ new è¿˜åšäº†ä»€ä¹ˆï¼Ÿ</h2><p>æ¢è®¨å®Œä¸Šé¢ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ new è¿˜åšäº†ä»€ä¹ˆï¼Ÿæ¥çœ‹å‡ ä¸ªä¾‹å­</p><h3 id="æ²¡æœ‰-return-è¯­å¥"><a href="#æ²¡æœ‰-return-è¯­å¥" class="headerlink" title="æ²¡æœ‰ return è¯­å¥"></a>æ²¡æœ‰ return è¯­å¥</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="number">18</span>)</span><br><span class="line"><span class="built_in">console</span>.log(person) <span class="comment">// Person &#123;age: 18&#125;</span></span><br></pre></td></tr></table></figure><p>ä»æ„é€ å‡½æ•°ç›´è§‚çœ‹ï¼Œæœ€åæ˜¯æ²¡æœ‰ return è¯­å¥çš„ï¼Œä½†æˆ‘ä»¬ä»è¿”å›ç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºæ„é€ å‡½æ•°æ—¶é»˜è®¤æƒ…å†µä¼šè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡</p><h3 id="return-å¯¹è±¡æ•°æ®ç±»å‹"><a href="#return-å¯¹è±¡æ•°æ®ç±»å‹" class="headerlink" title="return å¯¹è±¡æ•°æ®ç±»å‹"></a>return å¯¹è±¡æ•°æ®ç±»å‹</h3><p>æˆ‘ä»¬å°è¯•åœ¨æ„é€ å‡½æ•°æœ€åè¿”å›ä¸€ä¸ªå¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">'æ‰‹åŠ¨è¿”å›ä¸€ä¸ªå¯¹è±¡'</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="number">18</span>)</span><br><span class="line"><span class="built_in">console</span>.log(person) <span class="comment">// &#123;name: "æ‰‹åŠ¨è¿”å›ä¸€ä¸ªå¯¹è±¡"&#125;</span></span><br></pre></td></tr></table></figure><p>æ‰“å°å‡ºæ¥çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼šreturn ä¹‹å‰çš„ä»£ç ç‰‡æ®µéƒ½è¢«è¦†ç›–äº†ï¼Œæœ€åè¿”å› return åé¢çš„å¯¹è±¡ã€‚</p><h3 id="return-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#return-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="return åŸºæœ¬æ•°æ®ç±»å‹"></a>return åŸºæœ¬æ•°æ®ç±»å‹</h3><p>å¦‚æœæ„é€ å‡½æ•°æœ€å return çš„ä¸æ˜¯å¯¹è±¡å‘¢ï¼Œè¯•ä¸‹åŸºæœ¬æ•°æ®ç±»å‹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="number">18</span>)</span><br><span class="line"><span class="built_in">console</span>.log(person) <span class="comment">// Person &#123;age: 18&#125;</span></span><br></pre></td></tr></table></figure><p>ä»æ‰“å°å‡ºæ¥çš„ç»“æœå¯çŸ¥ï¼Œå’Œæ²¡æœ‰ return æ•ˆæœä¸€æ ·ã€‚</p><h2 id="new-åŸç†"><a href="#new-åŸç†" class="headerlink" title="new åŸç†"></a>new åŸç†</h2><p>mdn ä¸ŠæŠŠå†…éƒ¨æ“ä½œå¤§æ¦‚åˆ†ä¸º 4 æ­¥ï¼š</p><blockquote><ol><li>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å• JavaScript å¯¹è±¡ï¼ˆå³{ } ï¼‰ï¼›</li><li>é“¾æ¥è¯¥å¯¹è±¡ï¼ˆå³è®¾ç½®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡ ï¼›(å› æ­¤ this å°±æŒ‡å‘äº†è¿™ä¸ªæ–°å¯¹è±¡)</li><li>æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç ï¼ˆä¸ºè¿™ä¸ªæ–°å¯¹è±¡æ·»åŠ å±æ€§ï¼‰ï¼›</li><li>å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å› thisã€‚</li></ol></blockquote><h2 id="æ¨¡æ‹Ÿå®ç°-new"><a href="#æ¨¡æ‹Ÿå®ç°-new" class="headerlink" title="æ¨¡æ‹Ÿå®ç° new"></a>æ¨¡æ‹Ÿå®ç° new</h2><p>new æ˜¯å…³é”®è¯ï¼Œä¸å¯ä»¥ç›´æ¥è¦†ç›–ã€‚è¿™é‡Œä½¿ç”¨ create æ¥æ¨¡æ‹Ÿå®ç° new çš„æ•ˆæœã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;,</span><br><span class="line">  <span class="comment">// è·å¾—æ„é€ å‡½æ•°ï¼Œargumentsä¸­å»é™¤ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">  <span class="keyword">let</span> Con = [].shift.call(<span class="built_in">arguments</span>)</span><br><span class="line">  <span class="comment">// é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§</span></span><br><span class="line">  obj.__proto__ = Con.prototype</span><br><span class="line">  <span class="comment">// ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§</span></span><br><span class="line">  <span class="keyword">let</span> result = Con.apply(obj, <span class="built_in">arguments</span>)</span><br><span class="line">  <span class="comment">// ä¼˜å…ˆè¿”å›æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> result <span class="keyword">instanceof</span> <span class="built_in">Object</span> ? result : obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹çœ‹ä¸Šé¢æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥æ¨¡æ‹Ÿå®ç°çš„ï¼š</p><ol><li>ç”¨ new Object() çš„æ–¹å¼æ–°å»ºäº†ä¸€ä¸ªç©ºå¯¹è±¡ obj</li><li>å–å‡ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³æ˜¯ä¼ å…¥çš„æ„é€ å‡½æ•°ã€‚shift ä¼šä¿®æ”¹åŸæ•°ç»„ï¼Œæ•°ç»„åŸæ¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚</li><li>å°† obj çš„åŸå‹æŒ‡å‘æ„é€ å‡½æ•°ï¼Œè¿™æ · obj å°±å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§</li><li>ä½¿ç”¨ applyï¼Œæ”¹å˜æ„é€ å‡½æ•° this çš„æŒ‡å‘ã€‚å°† this æŒ‡å‘ obj å¯¹è±¡ å°±å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§</li><li>å¤„ç†è¿”å›å€¼ã€‚</li></ol><ul><li>æ„é€ å‡½æ•°è¿”å›å€¼æœ‰ä¸‰ç§æƒ…å†µï¼š</li></ul><ol><li>æ²¡æœ‰ returnï¼Œé»˜è®¤è¿”å›ä¹‹å‰åˆ›å»ºçš„å¯¹è±¡</li><li>è¿”å›ä¸€ä¸ªå¯¹è±¡</li><li>è¿”å›çš„ä¸æ˜¯å¯¹è±¡ï¼Œé»˜è®¤è¿”å›ä¹‹å‰åˆ›å»ºçš„ç©ºå¯¹è±¡</li></ol><p>åœ¨ä¸Šé¢æˆ‘ä»¬ç”¨ instanceof æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è±¡</p><blockquote><p>instanceof è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚</p></blockquote><p>æµ‹è¯•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.getAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å¹´é¾„ä¸º:'</span> + <span class="keyword">this</span>.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = create(Person, <span class="number">18</span>)</span><br><span class="line">person.age <span class="comment">// è®¿é—®æ„é€ å‡½æ•°é‡Œçš„å±æ€§</span></span><br><span class="line"><span class="comment">// 18</span></span><br><span class="line"></span><br><span class="line">person.getAge() <span class="comment">// è®¿é—®åŸå‹é‡Œçš„å±æ€§</span></span><br><span class="line"><span class="comment">// å¹´é¾„ä¸º:18</span></span><br></pre></td></tr></table></figure><p>æ¨¡æ‹Ÿå®ç°æˆåŠŸï¼</p>]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>new</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹åŸå‹ä¸åŸå‹é“¾</title>
    <url>/2020/02/16/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E5%8E%9F%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE/</url>
    <content><![CDATA[<p>å¯¹äº JavaScriptï¼ŒåŸå‹æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªåŸºç¡€çŸ¥è¯†ç‚¹ï¼Œæ¶‰åŠçš„å†…å®¹å¾ˆå¤šï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹</p>
<a id="more"></a>

<h2 id="åŸå‹-prototype"><a href="#åŸå‹-prototype" class="headerlink" title="åŸå‹ prototype"></a>åŸå‹ prototype</h2><p>åŸå‹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŠŠ prototype ç§°ä¸ºåŸå‹å¯¹è±¡ï¼Œprototype å¯ä»¥è®©æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å…±äº«å®ƒåŒ…å«çš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<p>JavaScript è§„å®šï¼Œæ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª prototype å¯¹è±¡å±æ€§ï¼ŒæŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚prototype å¯¹è±¡å±æ€§çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½ä¼šè¢«æ„é€ å‡½æ•°çš„å®ä¾‹ç»§æ‰¿ã€‚</p>
<h2 id="åªæœ‰å‡½æ•°æœ‰-prototype-å±æ€§"><a href="#åªæœ‰å‡½æ•°æœ‰-prototype-å±æ€§" class="headerlink" title="åªæœ‰å‡½æ•°æœ‰ prototype å±æ€§"></a>åªæœ‰å‡½æ•°æœ‰ prototype å±æ€§</h2><p>js åˆ†ä¸ºå‡½æ•°å¯¹è±¡å’Œæ™®é€šå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰<strong>proto</strong>å±æ€§ï¼Œä½†æ˜¯åªæœ‰å‡½æ•°å¯¹è±¡æ‰æœ‰ prototype å±æ€§</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a.prototype) <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(func.prototype) <span class="comment">// &#123; constructor: function()&#123;...&#125; &#125;</span></span><br></pre></td></tr></table></figure>

<p>JS é€šè¿‡ new å…³é”®å­—ï¼Œå³é æ„é€ å‡½æ•°ç”Ÿæˆå¯¹è±¡ï¼Œæ¯æ¬¡ç”Ÿæˆçš„å¯¹è±¡éƒ½ä¸ä¸€æ ·ã€‚å› ä¸ºå¸¸å¸¸éœ€è¦åœ¨ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å…±äº«å±æ€§ï¼Œç”±äº JS åœ¨è®¾è®¡ä¹‹åˆæ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œæ‰€ä»¥ JS ä½¿ç”¨å‡½æ•°çš„ prototype å±æ€§æ¥å¤„ç†è¿™éƒ¨åˆ†éœ€è¦è¢«å…±äº«çš„å±æ€§ã€‚</p>
<h2 id="æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡"><a href="#æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡" class="headerlink" title="æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡"></a>æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Animal.prototype.name = <span class="string">'kiki'</span></span><br><span class="line"><span class="keyword">var</span> animal1 = <span class="keyword">new</span> Animal()</span><br><span class="line"><span class="keyword">var</span> animal2 = <span class="keyword">new</span> Animal()</span><br><span class="line"><span class="built_in">console</span>.log(animal1.name, animal2.name) <span class="comment">// kiki kiki</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå‡½æ•°çš„ prototype å±æ€§æŒ‡å‘äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ­£æ˜¯è°ƒç”¨è¯¥æ„é€ å‡½æ•°è€Œåˆ›å»ºçš„å®ä¾‹çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªä¾‹å­ä¸­çš„ animal1 å’Œ animal2 çš„åŸå‹</p>
<p>æ¯ä¸€ä¸ª JavaScript å¯¹è±¡(null é™¤å¤–)åœ¨åˆ›å»ºçš„æ—¶å€™å°±ä¼šä¸ä¹‹å…³è”å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åŸå‹ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä¼šä»åŸå‹â€ç»§æ‰¿â€å±æ€§ã€‚</p>
<p>æ„é€ å‡½æ•°å’Œå®ä¾‹åŸå‹å…³ç³»å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/2/15/17049498b6d308cb?w=885&h=207&f=png&s=21292" alt=""></p>
<h2 id="proto"><a href="#proto" class="headerlink" title="proto"></a><strong>proto</strong></h2><p>é‚£ä¹ˆå¦‚ä½•è¡¨ç¤ºå®ä¾‹ä¸å®ä¾‹åŸå‹ä¹‹é—´çš„å…³ç³»å‘¢ï¼Œè¿™é‡Œéœ€è¦è®²åˆ°å¦ä¸€ä¸ªå±æ€§<strong>proto</strong></p>
<p>æ¯ä¸€ä¸ª JavaScript å¯¹è±¡(é™¤äº† null)éƒ½å…·æœ‰çš„ä¸€ä¸ªå±æ€§ï¼Œå«<strong>proto</strong>ï¼Œè¿™ä¸ªå±æ€§ä¼šæŒ‡å‘è¯¥å¯¹è±¡çš„åŸå‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Animal()</span><br><span class="line"><span class="built_in">console</span>.log(dog.__proto__ === Animal.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>äºæ˜¯æ›´æ–°å®ä¾‹ä¸å®ä¾‹åŸå‹ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/2/15/17049522bfa417ec?w=866&h=336&f=png&s=32709" alt=""></p>
<h2 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h2><p>æ¯ä¸ªåŸå‹éƒ½æœ‰ä¸€ä¸ª constructor å±æ€§æŒ‡å‘å…³è”çš„æ„é€ å‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Animal === Animal.prototype.constructor) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/2/15/170496796080e487?w=849&h=347&f=png&s=35480" alt=""></p>
<p>åˆ™å¯ä»¥å¾—å‡ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Animal()</span><br><span class="line"><span class="built_in">console</span>.log(dog.__proto__ === Animal.prototype) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// Object.getPrototypeOf() æ–¹æ³•è¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå‹</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(dog) === Animal.prototype) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Animal.prototype.constructor == Animal) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>å†æä¸€ç‚¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Animal()</span><br><span class="line"><span class="built_in">console</span>.log(dog.constructor === Animal) <span class="comment">// true</span></span><br><span class="line"><span class="comment">/* å½“è·å– dog.constructor æ—¶ï¼Œå…¶å® dog ä¸­å¹¶æ²¡æœ‰ constructor å±æ€§,</span></span><br><span class="line"><span class="comment">å½“ä¸èƒ½è¯»å–åˆ°constructor å±æ€§æ—¶ï¼Œ</span></span><br><span class="line"><span class="comment">ä¼šä» dog çš„åŸå‹ä¹Ÿå°±æ˜¯ Animal.prototype ä¸­è¯»å–ï¼Œæ­£å¥½åŸå‹ä¸­æœ‰è¯¥å±æ€§, æ‰€ä»¥ä¸‹åˆ—ä»£ç ä¸ºtrue */</span></span><br><span class="line">dog.constructor === Animal.prototype.constructor</span><br></pre></td></tr></table></figure>

<h2 id="å®ä¾‹å’ŒåŸå‹"><a href="#å®ä¾‹å’ŒåŸå‹" class="headerlink" title="å®ä¾‹å’ŒåŸå‹"></a>å®ä¾‹å’ŒåŸå‹</h2><p>å½“è¯»å–å®ä¾‹çš„å±æ€§æ—¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±ä¼šæŸ¥æ‰¾ä¸å¯¹è±¡å…³è”çš„åŸå‹ä¸­çš„å±æ€§ï¼Œå¦‚æœè¿˜æŸ¥ä¸åˆ°ï¼Œå°±å»æ‰¾åŸå‹çš„åŸå‹ï¼Œä¸€ç›´æ‰¾åˆ°æœ€é¡¶å±‚ä¸ºæ­¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Animal.prototype.name = <span class="string">'kiki'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Animal()</span><br><span class="line"></span><br><span class="line">dog.name = <span class="string">'xiaobai'</span></span><br><span class="line"><span class="built_in">console</span>.log(dog.name) <span class="comment">// xiaobai</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> dog.name</span><br><span class="line"><span class="built_in">console</span>.log(dog.name) <span class="comment">// kiki</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ã€‚é¦–å…ˆæ„é€ å‡½æ•°åŸå‹è®¾ç½®äº† name å€¼ï¼Œæ¥ç€ dog å®ä¾‹æ·»åŠ äº† name å±æ€§ï¼Œè¦†ç›–åŸå‹çš„ name å€¼ï¼Œæ‰“å° dog.name æ—¶ç»“æœè‡ªç„¶æ˜¯ xiaobaiã€‚</p>
<p>å½“åˆ é™¤äº† dog çš„ name å±æ€§æ—¶ï¼Œè¯»å– dog.name æ—¶ï¼Œä»å¯¹è±¡ä¸­æ— æ³•æ‰¾åˆ° name å±æ€§ï¼Œå°±ä¼šä» dog çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯ dog.<strong>proto</strong>ï¼Œå³ Animal.prototype ä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç»“æœä¸º kikiã€‚</p>
<p>å¦‚æœåŸå‹æ²¡æœ‰è®¾ç½® name å€¼ï¼Œæ‰¾ä¸åˆ°å‘¢ï¼ŸåŸå‹çš„åŸå‹åˆæ˜¯è°ï¼Ÿ</p>
<h2 id="åŸå‹çš„åŸå‹"><a href="#åŸå‹çš„åŸå‹" class="headerlink" title="åŸå‹çš„åŸå‹"></a>åŸå‹çš„åŸå‹</h2><p>åŸå‹æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ—¢ç„¶æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æœ€åŸå§‹çš„æ–¹å¼åˆ›å»ºå®ƒï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line">obj.name = <span class="string">'kiki'</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.name) <span class="comment">// kiki</span></span><br></pre></td></tr></table></figure>

<p>å…¶å®åŸå‹å¯¹è±¡å°±æ˜¯é€šè¿‡ Object æ„é€ å‡½æ•°ç”Ÿæˆçš„ï¼Œæ‰€æœ‰å‡½æ•°çš„ é»˜è®¤åŸå‹ éƒ½æ˜¯ Object çš„å®ä¾‹ï¼Œå› æ­¤é»˜è®¤åŸå‹éƒ½ä¼šåŒ…å«ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆï¼ŒæŒ‡å‘ Object.prototypeã€‚</p>
<p>ç”±æ­¤ï¼Œæ›´æ–°å…³ç³»å›¾ï¼š</p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/2/16/1704bf72a35f1a74?w=861&h=505&f=png&s=54960" alt=""></p>
<h2 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h2><ol>
<li>æ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡: dog çš„åŸå‹æ˜¯ Animal.prototypeã€‚</li>
<li>å¯¹è±¡çš„åŸå‹å¯èƒ½ä¹Ÿæ˜¯ç»§æ‰¿å…¶ä»–åŸå‹å¯¹è±¡çš„: Animal.prototype ä¹Ÿæœ‰å®ƒçš„åŸå‹ Object.prototypeã€‚</li>
<li>ä¸€å±‚ä¸€å±‚çš„ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè¿™ç§å…³ç³»å°±æ˜¯åŸå‹é“¾ã€‚</li>
</ol>
<p>é‚£ä¹ˆ<code>Object.prototype</code>çš„åŸå‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span>) <span class="comment">// true</span></span><br><span class="line"><span class="keyword">const</span> proto = <span class="built_in">Object</span>.getPrototypeOf(<span class="built_in">Object</span>.prototype) <span class="comment">// null</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ Object.prototype.<strong>proto</strong> çš„å€¼ä¸º null è·Ÿ Object.prototype æ²¡æœ‰åŸå‹ï¼Œå…¶å®è¡¨è¾¾äº†ä¸€ä¸ªæ„æ€ã€‚null è¡¨ç¤ºæ­¤å¤„ä¸åº”è¯¥æœ‰å€¼ï¼Œä¹Ÿå°±æ˜¯åŸå‹é“¾çš„ç»ˆç‚¹äº†ï¼Œæ‰€ä»¥æŸ¥æ‰¾å±æ€§çš„æ—¶å€™æŸ¥åˆ° Object.prototype å°±å¯ä»¥åœæ­¢æŸ¥æ‰¾äº†ã€‚</p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/2/16/1704bffc23da9aaf?w=800&h=592&f=png&s=54550" alt=""></p>
<p>ä¸Šå›¾ä¸­çš„çº¢è‰²çº¿ç»„æˆçš„é“¾å°±å¯ä»¥ç§°ä¹‹ä¸ºåŸå‹é“¾ã€‚</p>
<p>ç”±ä¸Šè¿°å…³ç³»å›¾æˆ‘ä»¬å¯ä»¥é‡æ–°æè¿°ä¸€ä¸‹åŸå‹é“¾ï¼š</p>
<blockquote>
<p>ä»ä¸€ä¸ªå®ä¾‹å¯¹è±¡å¼€å§‹å¾€ä¸Šæ‰¾ï¼Œè¿™ä¸ªå®ä¾‹å¯¹è±¡çš„<strong>proto</strong>å±æ€§æ‰€æŒ‡å‘çš„åˆ™æ˜¯è¿™ä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼Œå¦‚æœç”¨ dog è¡¨ç¤ºè¿™ä¸ªå®ä¾‹ï¼Œåˆ™åŸå‹å¯¹è±¡è¡¨ç¤ºä¸º<code>dog.__proto__</code>ã€‚åŒæ—¶ï¼Œè¿™ä¸ªåŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”å®ƒä¹Ÿæœ‰ä¸Šä¸€çº§çš„åŸå‹å¯¹è±¡ï¼Œç›¸å¯¹äºä¸Šä¸€çº§åŸå‹å¯¹è±¡è€Œè¨€ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä¹Ÿæ‹¥æœ‰<strong>proto</strong>å±æ€§ï¼Œå®ƒçš„<strong>proto</strong>å±æ€§ä¹ŸæŒ‡å‘å®ƒçš„åŸå‹å¯¹è±¡ï¼Œåé¢ä¹Ÿä»¥æ­¤ç±»æ¨ï¼Œä¸€ç›´åˆ° Object.prototype è¿™ä¸ªåŸå‹ä¸ºæ­¢ï¼Œè¿™å°±æ˜¯æ•´ä¸ªåŸå‹é“¾ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>åŸå‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹Generatorç”Ÿæˆå™¨å…¨è§£æ</title>
    <url>/2020/01/13/ES6%E7%B3%BB%E5%88%97%E4%B9%8BGenerator%E7%94%9F%E6%88%90%E5%99%A8%E5%85%A8%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬å†™å®Œäº† Iterator è¿­ä»£å™¨ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥è®²ä¸‹ Generator ç”Ÿæˆå™¨ï¼Œå¦‚æœä¸äº†è§£ Iterator çš„è¯å»ºè®®å…ˆçœ‹æˆ‘ä¸Šä¸€ç¯‡åšå®¢ï¼Œå› ä¸ºè¿™ç¯‡ä¼šæ¶‰åŠè¿­ä»£å™¨çš„å†…å®¹ã€‚</p>
<a id="more"></a>

<h2 id="ä¸ºä»€ä¹ˆéœ€è¦-Generator"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Generator" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Generator"></a>ä¸ºä»€ä¹ˆéœ€è¦ Generator</h2><p>åœ¨ JavaScript ä¸­ï¼Œå¼‚æ­¥ç¼–ç¨‹åœºæ™¯ä½¿ç”¨éå¸¸å¤šï¼Œç»å¸¸ä¼šå‡ºç°éœ€è¦é€æ­¥å®Œæˆå¤šä¸ªå¼‚æ­¥æ“ä½œçš„æƒ…å†µã€‚ä¹‹å‰ç”¨å›è°ƒå‡½æ•°å®ç°å¼‚æ­¥ç¼–ç¨‹å¦‚æœç¢°åˆ°äº†è¿™ç§é—®é¢˜å°±éœ€è¦åµŒå¥—ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œå¼‚æ­¥æ“ä½œè¶Šå¤šï¼ŒåµŒå¥—å¾—å°±è¶Šæ·±ï¼Œå¯¼è‡´ä»£ç çš„å¯ç»´æŠ¤æ€§è¾ƒå·®ï¼Œä»£ç é˜…è¯»èµ·æ¥ä¹Ÿå¾ˆå›°éš¾ã€‚</p>
<p>Generator å‡½æ•°æ˜¯ ES6 æå‡ºçš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥é¿å…å›è°ƒçš„åµŒå¥—ï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒGenerator çš„ç‰¹æ€§åœ¨æŸäº›åœºæ™¯ä½¿ç”¨ä¹Ÿååˆ†æ–¹ä¾¿ã€‚</p>
<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>è¯­æ³•ä¸Šï¼Œé¦–å…ˆå¯ä»¥æŠŠå®ƒç†è§£æˆï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ª Iterator å¯¹è±¡ç”Ÿæˆå‡½æ•°ã€‚å®ƒè¿”å›çš„éå†å™¨å¯¹è±¡å¯ä»¥ä¾æ¬¡éå† Generator å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚Generator å‡½æ•°æ˜¯ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯è°ƒç”¨çš„æ—¶å€™å‰é¢ä¸èƒ½åŠ  new å‘½ä»¤ã€‚</p>
<p>é€šä¿—æ¥è¯´ï¼ŒGenerator å‡½æ•°å®ƒå¯ä»¥éšæ—¶æš‚åœå‡½æ•°è¿è¡Œï¼Œå¹¶å¯ä»¥åœ¨ä»»æ„æ—¶å€™æ¢å¤å‡½æ•°è¿è¡Œã€‚</p>
<h2 id="ä¸-Iterator-æ¥å£çš„å…³ç³»"><a href="#ä¸-Iterator-æ¥å£çš„å…³ç³»" class="headerlink" title="ä¸ Iterator æ¥å£çš„å…³ç³»"></a>ä¸ Iterator æ¥å£çš„å…³ç³»</h2><p>ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„ Symbol.iterator æ–¹æ³•ï¼Œç­‰äºè¯¥å¯¹è±¡çš„éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°ä¼šè¿”å›è¯¥å¯¹è±¡çš„ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚</p>
<p>ç”±äº Generator å‡½æ•°å°±æ˜¯ Iterator è¿­ä»£å™¨ç”Ÿæˆå‡½æ•°ï¼Œå› æ­¤å¯ä»¥æŠŠ Generator èµ‹å€¼ç»™å¯¹è±¡çš„ Symbol.iterator å±æ€§ï¼Œä»è€Œä½¿å¾—è¯¥å¯¹è±¡å…·æœ‰ Iterator æ¥å£ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myIterable = &#123;&#125;</span><br><span class="line">myIterable[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log([...myIterable]) <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒGenerator å‡½æ•°èµ‹å€¼ç»™ Symbol.iterator å±æ€§ï¼Œä»è€Œä½¿å¾— myIterable å¯¹è±¡å…·æœ‰äº† Iterator æ¥å£ï¼Œå¯ä»¥è¢«â€¦è¿ç®—ç¬¦éå†äº†ã€‚</p>
<p>Generator å‡½æ•°æ‰§è¡Œåï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚è¯¥å¯¹è±¡æœ¬èº«ä¹Ÿå…·æœ‰ Symbol.iterator å±æ€§ï¼Œæ‰§è¡Œåè¿”å›è‡ªèº«ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = gen()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(g[<span class="built_in">Symbol</span>.iterator]() === g) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œgen æ˜¯ä¸€ä¸ª Generator å‡½æ•°ï¼Œè°ƒç”¨å®ƒä¼šç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ gã€‚å®ƒçš„ Symbol.iterator å±æ€§ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œæ‰§è¡Œåè¿”å›å®ƒè‡ªå·±ã€‚</p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ol>
<li>function å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ª<code>*</code>å·ï¼Œè€Œä¸”è¿™ä¸ª<code>*</code>å‰åå…è®¸æœ‰ç©ºç™½å­—ç¬¦ï¼Œå¦‚ï¼š</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå››ç§å†™æ³•éƒ½å¯ä»¥ï¼Œæ ¹æ®ä¸ªäººä¸åŒä¹ æƒ¯ï¼Œä¸€èˆ¬ç¬¬ä¸‰å’Œç¬¬å››ç§ç”¨å¾—æ¯”è¾ƒå¤š</p>
<ol start="2">
<li>å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨ yield è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€</li>
<li>æ™®é€šå‡½æ•°çš„æ‰§è¡Œæ¨¡å¼æ˜¯: <strong>æ‰§è¡Œ-ç»“æŸ</strong>, ç”Ÿæˆå™¨çš„æ‰§è¡Œæ¨¡å¼æ˜¯: <strong>æ‰§è¡Œ-æš‚åœ-ç»“æŸ</strong>ã€‚ç”Ÿæˆå™¨å¯ä»¥åœ¨æ‰§è¡Œå½“ä¸­æš‚åœè‡ªèº«ï¼Œå¯ä»¥ç«‹å³æ¢å¤æ‰§è¡Œä¹Ÿå¯ä»¥è¿‡ä¸€æ®µæ—¶é—´ä¹‹åæ¢å¤æ‰§è¡Œã€‚æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å®ƒä¸åƒæ™®é€šå‡½æ•°é‚£æ ·ä¿è¯è¿è¡Œåˆ°å®Œæ¯•ã€‚</li>
</ol>
<h2 id="yield-å…³é”®å­—"><a href="#yield-å…³é”®å­—" class="headerlink" title="yield å…³é”®å­—"></a>yield å…³é”®å­—</h2><p>ç”Ÿæˆå™¨å‡½æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ–°å…³é”®å­—ï¼š<code>yield</code>ã€‚ç”±äº Generator å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Iterator å¯¹è±¡ï¼Œåªæœ‰è°ƒç”¨ next æ–¹æ³•æ‰ä¼šéå†ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€,è€Œ<code>yield</code>å…³é”®å­—å°±æ˜¯<strong>æš‚åœæ ‡å¿—</strong>ã€‚å› ä¸ºæœ‰å®ƒï¼Œæ‰€ä»¥æ‰èƒ½å®ç°æ‰§è¡Œ-æš‚åœ-ç»“æŸçš„æ‰§è¡Œæ¨¡å¼ã€‚</p>
<p><code>yield</code> åé¢å¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„ JavaScript è¡¨è¾¾å¼ï¼Œ<code>yield</code>è¯­å¥å¯ä»¥å‡ºç°çš„ä½ç½®å¯ä»¥ç­‰ä»·äºä¸€èˆ¬çš„èµ‹å€¼è¡¨è¾¾å¼ï¼ˆæ¯”å¦‚ a=2ï¼‰èƒ½å¤Ÿå‡ºç°çš„ä½ç½®ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">b = <span class="number">2</span> + a = <span class="number">2</span> <span class="comment">// ä¸åˆæ³•</span></span><br><span class="line">b = <span class="number">2</span> + <span class="keyword">yield</span> <span class="number">2</span> <span class="comment">// ä¸åˆæ³•</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">2</span> + (a = <span class="number">2</span>) <span class="comment">// åˆæ³•</span></span><br><span class="line">b = <span class="number">2</span> + (<span class="keyword">yield</span> <span class="number">2</span>) <span class="comment">// åˆæ³•</span></span><br></pre></td></tr></table></figure>

<p><code>yield</code>å…³é”®å­—çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œå‡ ä¹<code>yield</code>ä¹‹åçš„ä»»ä½•è¡¨è¾¾å¼éƒ½ä¼šå…ˆè¿›è¡Œè®¡ç®—ï¼Œç„¶åå†é€šè¿‡<code>yield</code>å‘å¤–ç•Œäº§ç”Ÿå€¼ã€‚è€Œä¸”<code>yield</code>æ˜¯å³ç»“åˆè¿ç®—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yield yield 2 ç­‰ä»·äº (yield (yield 2))</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong>ï¼š</p>
<ol>
<li>å®ƒå¯ä»¥æŒ‡å®šè°ƒç”¨ next æ–¹æ³•æ—¶çš„è¿”å›å€¼ä»¥åŠè°ƒç”¨é¡ºåºã€‚</li>
<li>æ¯å½“æ‰§è¡Œå®Œ yield è¯­å¥ï¼Œå‡½æ•°å°±ä¼šåœæ­¢æ‰§è¡Œï¼Œç›´åˆ°å†æ¬¡è°ƒç”¨ next æ–¹æ³•æ‰ä¼šç»§ç»­æ‰§è¡Œ</li>
<li>yield å…³é”®å­—åªèƒ½åœ¨ç”Ÿæˆå™¨å†…éƒ¨ä½¿ç”¨ï¼Œå…¶ä»–åœ°æ–¹ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯</li>
</ol>
<h2 id="è¿è¡Œç”Ÿæˆå™¨å‡½æ•°"><a href="#è¿è¡Œç”Ÿæˆå™¨å‡½æ•°" class="headerlink" title="è¿è¡Œç”Ÿæˆå™¨å‡½æ•°"></a>è¿è¡Œç”Ÿæˆå™¨å‡½æ•°</h2><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªç®€å•çš„ä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä¸ºä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå¦‚ä½•è¿è¡Œå®ƒå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œç”Ÿæˆå™¨è¿˜æ˜¯ä¸€ä¸ªéå†å™¨/è¿­ä»£å™¨ç”Ÿæˆå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿”å›çš„ Iterator å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†ç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ next()æ–¹æ³•è®©å®ƒè¿è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> generator = gen() <span class="comment">// ç”Ÿæˆå™¨è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„generatorå¯¹è±¡</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¦çŸ¥é“çš„æ˜¯ï¼ŒGenerator å‡½æ•°ï¼Œä¸ç®¡å†…éƒ¨æœ‰æ²¡æœ‰<code>yield</code>è¯­å¥ï¼Œè°ƒç”¨å‡½æ•°æ—¶éƒ½ä¸ä¼šæ‰§è¡Œä»»ä½•è¯­å¥ï¼Œä¹Ÿä¸è¿”å›å‡½æ•°æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„ generator å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª Iterator å¯¹è±¡ã€‚åªæœ‰å½“è°ƒç”¨ next(),å†…éƒ¨è¯­å¥æ‰ä¼šæ‰§è¡Œã€‚</p>
<p>åœ¨è¯¥å‡½æ•°å†…éƒ¨æœ‰ 3 ä¸ª<code>yield</code>è¡¨è¾¾å¼ï¼Œå³è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼š1ã€2ã€3ã€‚è€Œ Generator å‡½æ•°åœ¨æ­¤åˆ†æ®µæ‰§è¡Œï¼Œè°ƒç”¨ next æ–¹æ³•å‡½æ•°å†…éƒ¨é€»è¾‘å¼€å§‹æ‰§è¡Œï¼Œé‡åˆ°<code>yield</code>è¡¨è¾¾å¼åœæ­¢ï¼Œè¿”å› Iterator å¯¹è±¡ï¼Œå†æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œä¼šä»ä¸Šä¸€æ¬¡åœæ­¢æ—¶çš„<code>yield</code>å¤„å¼€å§‹ï¼Œç›´åˆ°æœ€åã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸éš¾ç†è§£<code>yield</code>è¯­å¥åªæ˜¯å‡½æ•°æš‚åœæ‰§è¡Œçš„ä¸€ä¸ªæ ‡è®°ã€‚</p>
<p>å†æ¥çœ‹ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'hello'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'world'</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'ending'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> generator = gen()</span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123; value: 'hello', done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123; value: 'world', done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123; value: 'ending', done: true &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ç”Ÿæˆå™¨å‡½æ•° gen æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼šhelloï¼Œworld å’Œ return è¯­å¥ã€‚</p>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œç”Ÿæˆå™¨å‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œé‡åˆ°ç¬¬ä¸€ä¸ª yield è¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ value å±æ€§å°±æ˜¯å½“å‰ yield è¡¨è¾¾å¼çš„å€¼ helloï¼Œdone å±æ€§çš„å€¼ falseï¼Œè¡¨ç¤ºéå†è¿˜æ²¡æœ‰ç»“æŸã€‚</p>
<p>åŒç†ç¬¬äºŒæ¬¡è°ƒç”¨ä¹Ÿæ˜¯æŒ‰ä¸Šè¿°é€»è¾‘æ¨</p>
<p>ç¬¬ä¸‰æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œé‡åˆ°äº† return è¯­å¥ï¼ˆå¦‚æœæ²¡æœ‰ return è¯­å¥ï¼Œå°±æ‰§è¡Œåˆ°å‡½æ•°ç»“æŸï¼‰ã€‚æ­¤æ—¶ next æ–¹æ³•è¿”å›çš„å¯¹è±¡çš„ value å±æ€§ï¼Œå°±æ˜¯ç´§è·Ÿåœ¨ return è¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œåœ¨è¿™é‡Œ return åçš„å€¼å³æ˜¯â€endingâ€ï¼ˆå¦‚æœæ²¡æœ‰ return è¯­å¥ï¼Œåˆ™ value å±æ€§çš„å€¼ä¸º undefinedï¼‰ï¼Œdone å±æ€§çš„å€¼ trueï¼Œè¡¨ç¤ºéå†å·²ç»ç»“æŸã€‚</p>
<p>ç¬¬å››æ¬¡è°ƒç”¨ï¼Œæ­¤æ—¶ ç”Ÿæˆå™¨å‡½æ•°å·²ç»è¿è¡Œå®Œæ¯•ï¼Œæ•… next æ–¹æ³•è¿”å›å¯¹è±¡çš„ value å±æ€§ä¸º undefinedï¼Œdone å±æ€§ä¸º trueã€‚ä»¥åæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ next æ–¹æ³•ï¼Œè¿”å›çš„éƒ½æ˜¯è¿™ä¸ªå€¼ã€‚</p>
<h2 id="next-ä¼ é€’å‚æ•°"><a href="#next-ä¼ é€’å‚æ•°" class="headerlink" title="next ä¼ é€’å‚æ•°"></a>next ä¼ é€’å‚æ•°</h2><p>ç”±ä¸Šè¿°æˆ‘ä»¬çŸ¥é“æ€»ç»“ next æ–¹æ³•çš„è¿è¡Œé€»è¾‘ï¼š</p>
<ol>
<li>é‡åˆ° <code>yield</code> è¯­å¥æš‚åœæ‰§è¡Œåé¢çš„æ“ä½œï¼Œå¹¶å°†åœ¨ <code>yield</code> åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›å¯¹è±¡çš„ value å±æ€§å€¼</li>
<li>ä¸‹æ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª <code>yield</code> è¯­å¥</li>
<li>å¦‚æœæ²¡æœ‰é‡åˆ°æ–°çš„ <code>yield</code> è¯­å¥ï¼Œå°±ä¸€ç›´è¿è¡Œå‡½æ•°ç»“æŸ åˆ° return è¯­å¥ä¸ºæ­¢ï¼Œå°† return çš„å€¼ä½œä¸ºè¿”å›çš„å¯¹è±¡ value çš„å±æ€§å€¼</li>
<li>å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰ return è¯­å¥ï¼Œåˆ™è¿”å›çš„å¯¹è±¡çš„ value å±æ€§å€¼ä¸º undefined</li>
</ol>
<p>é‚£ next æ–¹æ³•å¯ä»¥å¸¦å‚æ•°å—ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="keyword">yield</span> a + <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> b * <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> generator1 = gen(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(generator1.next()) <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator1.next()) <span class="comment">// &#123;value: NaN, done: true&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generator2 = gen(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(generator2.next(<span class="number">2</span>)) <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator2.next(<span class="number">4</span>)) <span class="comment">// &#123;value: 16, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œç”Ÿæˆå™¨å‡½æ•° gen éƒ½æ¥æ”¶äº†ä¸€ä¸ªå‚æ•° a,éƒ½ä¼ å…¥äº† 1ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œlet b = yield 1 + 1 = yield 2,å³è¿”å›<code>yield</code>çš„ value å€¼ä¸º 2ï¼›åˆ°äº†ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ï¼Œè¯­å¥ return b _ 2ï¼Œè¿”å›çš„å¯¹è±¡ value å€¼å±…ç„¶ä¸º NaNã€‚ç”±æ­¤å¯æ¨æ–­æ­¤æ—¶çš„ b å¹¶ä¸æ˜¯ä¸Šæ¬¡è®¡ç®—çš„ç»“æœ 2ï¼Œè€Œæ˜¯ undefinedï¼Œæ‰€ä»¥ undefined _ 4 = NaN</p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œä¸æ‡‚ç”Ÿæˆå™¨çš„å°ä¼™ä¼´å¯èƒ½æœ‰ç‚¹æ‡µé€¼ï¼Œè¡¨é¢ä¸Šå˜é‡ b å·²ç»ç”¨ yield è¯­å¥èµ‹å€¼äº†ï¼Œä½†å¹¶æ²¡æœ‰èµ‹å€¼æˆåŠŸã€‚</p>
<p>å†ç¬¬äºŒä¸ªä¾‹å­ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œlet b = yield (1 + 1),æ­¤æ—¶çš„ next æ–¹æ³•ä¼ å…¥äº†å‚æ•°ï¼Œå€¼ä¸º 1ï¼Œè¿™ä¸ªå‚æ•°æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç­”ï¼šç¡®å®æ²¡ä»€ä¹ˆç”¨ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ç¤ºèŒƒå®ƒå¯¹ç»“æœæ— å½±å“ã€‚</p>
<blockquote>
<p>ç¬¬ä¸€ä¸ª next æ–¹æ³•åªæ˜¯ç”¨æ¥å¯åŠ¨ç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨çš„éå†å™¨ï¼Œä¼ å‚ä¹Ÿæ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚å³ä½¿ä¼ äº†å€¼ï¼Œå®ƒåªæ˜¯å°†è¿™ä¸ªä¼ å…¥çš„å€¼æŠ›å¼ƒè€Œå·²ã€‚ES6 è¡¨æ˜ï¼Œgenerator å‡½æ•°åœ¨è¿™ç§æƒ…å†µåªæ˜¯å¿½ç•¥äº†è¿™äº›æ²¡æœ‰è¢«ç”¨åˆ°çš„å€¼ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ let b = yield (1 + 1) = yield 2, è¿”å› value å€¼ä»ç„¶ä¸º 2ï¼›ç¬¬äºŒæ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ä¼ å…¥äº†å‚æ•° 4ï¼Œæ­¤æ—¶ 4 è¦†ç›–ä¸Šæ¬¡ yield è¯­å¥çš„è¿”å›å€¼ 2ï¼Œå³ let b = 4;æ•…æ‰§è¡Œ return b _ 4 è¯­å¥æ—¶ï¼Œå³ return 4 _ 4ï¼Œå³è¿”å›äº† 16ã€‚</p>
<ul>
<li>ä¸Šè¿°ç»“æœå¯ä»¥è¯´æ˜ï¼š<ul>
<li><strong>yield è¯­å¥æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…æ€»æ˜¯è¿”å› undefinedï¼›</strong></li>
<li><strong>next æ–¹æ³•å¦‚æœå¸¦ä¸Šä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä½œä¸ºä¸Šä¸€ä¸ª yield è¯­å¥çš„è¿”å›å€¼ã€‚<br>æ³¨æ„ï¼šå› ä¸º next æ–¹æ³•è¡¨ç¤ºä¸Šä¸€ä¸ª yield è¯­å¥çš„è¿”å›å€¼ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ä¸Šä¸€ä¸ª yield è¯­å¥çš„å­˜åœ¨ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶å°±ä¸èƒ½ä¼ å‚æ•°ã€‚ç¬¬ä¸€ä¸ª next åªæ˜¯ç”¨æ¥å¯åŠ¨ Generator å‡½æ•°å†…éƒ¨çš„éå†å™¨ï¼Œä¼ å‚ä¹Ÿæ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚</strong></li>
</ul>
</li>
</ul>
<p>å¯¹äºä¸Šè¿°ä¸¤ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä»£ç å†æ¬¡åŠ æ·±ç†è§£ï¼š</p>
<p>yield åå¯ä»¥ä¸å¸¦ä»»ä½•è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œè¿”å›çš„ value ä¸º undefinedã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> gen = (<span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line">&#125;)()</span><br><span class="line"><span class="built_in">console</span>.log(gen.next()) <span class="comment">// &#123; value: undefined, done: false &#125;</span></span><br></pre></td></tr></table></figure>

<p>å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">2</span> * (<span class="keyword">yield</span> x + <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">let</span> z = <span class="keyword">yield</span> y / <span class="number">4</span></span><br><span class="line">  <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> generator = gen(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 4, done: false&#125; è¿”å›yieldï¼ˆ2+2ï¼‰= 4</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next(<span class="number">7</span>)) <span class="comment">// &#123;value: 3.5, done: false&#125; è®¾ç½®yield(x+2) = 7,é‚£ä¹ˆy= 2*7=14,é‚£ä¹ˆyield(y/4) = 3.5</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next(<span class="number">3</span>)) <span class="comment">// &#123;value: 19, done: false&#125; è®¾ç½®z = yield(y/4) = 3 é‚£ä¹ˆ x+y+z = 2+14+3 = 19</span></span><br></pre></td></tr></table></figure>

<ol>
<li>ç¬¬ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œè¿”å› yieldï¼ˆ2+2ï¼‰= 4ï¼Œè¿”å› value å€¼ä¸º 4</li>
<li>ç¬¬äºŒæ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œnext å‚æ•°å€¼ä¸º 7ï¼Œè¦†ç›–ä¸Šä¸€æ¬¡çš„ yield å€¼ï¼Œæ•… let y = 2 * 7 = 14ï¼Œåˆ™ let z = yield(14 / 4) = 3.5</li>
<li>ç¬¬ä¸‰æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œnext å‚æ•°å€¼ä¸º 3ï¼Œè¦†ç›–ä¸Šä¸€æ¬¡çš„ yield å€¼ï¼Œæ•… z = 3ï¼Œx + y + z = 2 + 14 + 3 = 19</li>
</ol>
<p>è¿™é‡Œåˆæ¬¡çœ‹å¯èƒ½æœ‰ç‚¹ç»•ï¼Œå»ºè®®å¤šçœ‹å¤šè¯•å‡ æ¬¡å°±å®¹æ˜“ç†è§£äº†ã€‚</p>
<h2 id="return-ä¸-yield-åŒºåˆ«"><a href="#return-ä¸-yield-åŒºåˆ«" class="headerlink" title="return ä¸ yield åŒºåˆ«"></a>return ä¸ yield åŒºåˆ«</h2><p>ä»ä»¥ä¸Šçš„ä¾‹å­ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå‡½æ•°ä¸ä»…æ˜¯ç¢°åˆ° yield è¯­å¥æ‰ä¼šåœæ­¢æ‰§è¡Œï¼Œç¢°åˆ° return è¯­å¥ä¹Ÿä¼šåœæ­¢æ‰§è¡Œã€‚æ™®é€šå‡½æ•°é‡åˆ° return ä¹Ÿä¼šåœæ­¢æ‰§è¡Œï¼ŒGenerator å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥å¾ˆå¥½ç†è§£ã€‚é‚£ä¹ˆï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'hello'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'world'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> generator = gen()</span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: "hello", done: true&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå½“ç¢°åˆ° return è¯­å¥æ—¶ï¼Œè¿”å›å¯¹è±¡çš„ value å€¼ä¸ºç´§è·Ÿ return åé¢çš„å€¼ï¼Œdone å±æ€§å€¼å°±ä¸º trueï¼Œä»£è¡¨éå†ç»“æŸï¼Œä¸ç®¡åé¢æ˜¯å¦è¿˜æœ‰ yield æˆ–è€… return è¯­å¥ã€‚è¿™ç§åŒºåˆ«æœ¬è´¨ä¸Šæ˜¯å› ä¸º yield è¯­å¥å…·å¤‡ä½ç½®è®°å¿†åŠŸèƒ½è€Œ return è¯­å¥åˆ™æ²¡æœ‰è¯¥åŠŸèƒ½ã€‚</p>
<h2 id="return-ä¸-next-å‚æ•°åŒºåˆ«"><a href="#return-ä¸-next-å‚æ•°åŒºåˆ«" class="headerlink" title="return ä¸ next å‚æ•°åŒºåˆ«"></a>return ä¸ next å‚æ•°åŒºåˆ«</h2><p>å¯ä»¥æ€»ç»“ä¸ºä¸‰ç‚¹ï¼š</p>
<ol>
<li>return ç»ˆç»“éå†ï¼Œä¹‹åçš„ yield è¯­å¥éƒ½å¤±æ•ˆï¼›next è¿”å›æœ¬æ¬¡ yield è¯­å¥çš„è¿”å›å€¼ã€‚</li>
<li>return æ²¡æœ‰å‚æ•°çš„æ—¶å€™ï¼Œè¿”å›{ value: undefined, done: true }ï¼›next æ²¡æœ‰å‚æ•°çš„æ—¶å€™è¿”å›æœ¬æ¬¡ yield è¯­å¥çš„è¿”å›å€¼ã€‚</li>
<li>return æœ‰å‚æ•°çš„æ—¶å€™ï¼Œè¦†ç›–æœ¬æ¬¡ yield è¯­å¥çš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿”å›{ value: å‚æ•°, done: true }ï¼›next æœ‰å‚æ•°çš„æ—¶å€™ï¼Œè¦†ç›–ä¸Šæ¬¡ yield è¯­å¥çš„è¿”å›å€¼ï¼Œè¿”å›å€¼å¯èƒ½è·Ÿå‚æ•°æœ‰å…³ï¼ˆå‚æ•°å‚ä¸è®¡ç®—çš„è¯ï¼‰ï¼Œä¹Ÿå¯èƒ½è·Ÿå‚æ•°æ— å…³ï¼ˆå‚æ•°ä¸å‚ä¸è®¡ç®—ï¼‰ã€‚</li>
</ol>
<h2 id="return-value-æ–¹æ³•"><a href="#return-value-æ–¹æ³•" class="headerlink" title="return(value)æ–¹æ³•"></a>return(value)æ–¹æ³•</h2><p>åœ¨ç”Ÿæˆå™¨é‡Œä½¿ç”¨ return(value)æ–¹æ³•ï¼Œéšæ—¶ç»ˆæ­¢ç”Ÿæˆå™¨ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> generator = gen()</span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.return(<span class="number">10</span>)) <span class="comment">// &#123;value: 10, done: true&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šè¿°ä»£ç æˆ‘ä»¬çœ‹å‡ºï¼Œä½¿ç”¨ return()æ–¹æ³•æˆ‘ä»¬æå‰ç»ˆæ­¢äº†ç”Ÿæˆå™¨ï¼Œè¿”å› return é‡Œçš„å€¼ï¼Œå†æ¬¡è°ƒç”¨ next()æ–¹æ³•æ—¶ï¼Œdone å±æ€§çš„å€¼ä¸º true,éå†ç»“æŸï¼Œç”±æ­¤å¯è§ return æå‰ç»ˆæ­¢äº†ç”Ÿæˆå™¨ã€‚</p>
<h2 id="throw-exception-æ–¹æ³•"><a href="#throw-exception-æ–¹æ³•" class="headerlink" title="throw(exception)æ–¹æ³•"></a>throw(exception)æ–¹æ³•</h2><p>é™¤äº†ç”¨ return(value)æ–¹æ³•å¯ä»¥ç»ˆæ­¢ç”Ÿæˆç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è°ƒç”¨ throw(exception) è¿›è¡Œæå‰ç»ˆæ­¢ç”Ÿæˆå™¨ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> generator = gen()</span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  generator.throw(<span class="string">'throw error msg'</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å¿…æ‰§è¡Œçš„finallyè¯­å¥å—'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœ;</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;</span><br><span class="line"><span class="keyword">throw</span> error msg</span><br><span class="line">å¿…æ‰§è¡Œçš„<span class="keyword">finally</span>è¯­å¥å—</span><br><span class="line">&#123;<span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œåœ¨ç”Ÿæˆå™¨å¤–éƒ¨è°ƒç”¨ tryâ€¦catchâ€¦finally,throw()å¼‚å¸¸è¢« tryâ€¦catch æ•æ‰å¹¶è¿”å›ï¼Œå¹¶æ‰§è¡Œäº† finally ä»£ç å—ä¸­çš„ä»£ç ã€‚å½“å†æ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œdone å±æ€§è¿”å› true,è¯´æ˜ç”Ÿæˆå™¨å·²è¢«ç»ˆæ­¢ã€‚</p>
<p>æˆ‘ä»¬ä¸ä»…å¯ä»¥åœ¨ next æ‰§è¡Œè¿‡ç¨‹ä¸­æ’å…¥ throw()è¯­å¥ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ç”Ÿæˆå™¨å†…éƒ¨æ’å…¥ tryâ€¦catch è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p>
<blockquote>
<p>throw æ–¹æ³•æŠ›å‡ºçš„é”™è¯¯è¦è¢«å†…éƒ¨æ•è·ï¼Œå‰ææ˜¯å¿…é¡»è‡³å°‘æ‰§è¡Œè¿‡ä¸€æ¬¡ next æ–¹æ³•ã€‚</p>
</blockquote>
<p>ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'first Exception'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'second Exception'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> generator = gen()</span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="built_in">console</span>.log(generator.throw(<span class="string">'exception string'</span>))</span><br><span class="line"><span class="built_in">console</span>.log(generator.throw(<span class="string">'exception string'</span>))</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;</span><br><span class="line">first Exception</span><br><span class="line">&#123;<span class="attr">value</span>: <span class="number">2</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;</span><br><span class="line">second Exception</span><br><span class="line">&#123;<span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä»£ç è¾“å‡ºå¯ä»¥è¾“å‡ºï¼Œå½“æˆ‘ä»¬åœ¨ generator.throw()æ–¹æ³•æ—¶ï¼Œè¢«ç”Ÿæˆå™¨å†…éƒ¨ä¸Šä¸ªæš‚åœç‚¹çš„å¼‚å¸¸å¤„ç†ä»£ç æ‰€æ•è·ï¼Œä¼šé™„å¸¦æ‰§è¡Œä¸‹ä¸€æ¡<code>yield</code>è¡¨è¾¾å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šé™„å¸¦æ‰§è¡Œä¸€æ¬¡ next æ–¹æ³•ã€‚ç”±æ­¤å¯è§åœ¨ç”Ÿæˆå™¨å†…éƒ¨ä½¿ç”¨ tryâ€¦catch å¯ä»¥æ•è·å¼‚å¸¸ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°éå†å™¨çš„çŠ¶æ€ã€‚</p>
<h2 id="yield-è¡¨è¾¾å¼"><a href="#yield-è¡¨è¾¾å¼" class="headerlink" title="yield* è¡¨è¾¾å¼"></a>yield* è¡¨è¾¾å¼</h2><p>å¦‚æœæƒ³è¦åœ¨ Generator å‡½æ•°å†…éƒ¨ï¼Œè°ƒç”¨å¦ä¸€ä¸ª Generator å‡½æ•°ã€‚éœ€è¦åœ¨å‰è€…çš„å‡½æ•°ä½“å†…éƒ¨ï¼Œè‡ªå·±æ‰‹åŠ¨å®Œæˆéå†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'a'</span></span><br><span class="line">  <span class="comment">// for...oféå† gen1()</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> gen1()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'b'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> gen2()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">a</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">b</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰å¤šä¸ª Generator å‡½æ•°åµŒå¥—ï¼Œå†™èµ·æ¥å°±éå¸¸éº»çƒ¦ã€‚<br>ES6 æä¾›äº†<code>yield*</code>è¡¨è¾¾å¼ï¼Œä½œä¸ºè§£å†³åŠæ³•ï¼Œç”¨æ¥åœ¨ä¸€ä¸ª Generator å‡½æ•°é‡Œé¢æ‰§è¡Œå¦ä¸€ä¸ª Generator å‡½æ•°ã€‚</p>
<p>æŠŠä¸Šé¢çš„ gen2 å‡½æ•°æ”¹å†™å¦‚ä¸‹,å¦‚ä¸‹ä¹Ÿèƒ½å¾—åˆ°ç›¸åŒçš„è¾“å‡ºç»“æœ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'a'</span></span><br><span class="line">  <span class="keyword">yield</span>* gen1()</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'b'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>yield*</code>å¯ä»¥å°†å¯è¿­ä»£çš„å¯¹è±¡ iterable æ”¾åœ¨ä¸€ä¸ªç”Ÿæˆå™¨é‡Œï¼Œç”Ÿæˆå™¨å‡½æ•°è¿è¡Œåˆ°<code>yield*</code> ä½ç½®æ—¶ï¼Œå°†æ§åˆ¶æƒå§”æ‰˜ç»™è¿™ä¸ªè¿­ä»£å™¨ï¼Œç›´åˆ°æ‰§è¡Œå®Œæˆä¸ºæ­¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ•°ç»„ä¹Ÿæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œå› æ­¤<code>yield*</code>ä¹Ÿå¯å§”æ‰˜ç»™æ•°ç»„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span>* gen1()</span><br><span class="line">  <span class="keyword">yield</span>* [<span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> generator = gen2()</span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 4, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: 5, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Generator-çš„åº”ç”¨åœºæ™¯"><a href="#Generator-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="Generator çš„åº”ç”¨åœºæ™¯"></a>Generator çš„åº”ç”¨åœºæ™¯</h2><h3 id="å¼‚æ­¥æ“ä½œçš„åŒæ­¥åŒ–è¡¨è¾¾"><a href="#å¼‚æ­¥æ“ä½œçš„åŒæ­¥åŒ–è¡¨è¾¾" class="headerlink" title="å¼‚æ­¥æ“ä½œçš„åŒæ­¥åŒ–è¡¨è¾¾"></a>å¼‚æ­¥æ“ä½œçš„åŒæ­¥åŒ–è¡¨è¾¾</h3><p>Generator å‡½æ•°çš„æš‚åœæ‰§è¡Œçš„æ•ˆæœï¼Œæ„å‘³ç€å¯ä»¥æŠŠå¼‚æ­¥æ“ä½œå†™åœ¨ yield è¡¨è¾¾å¼é‡Œé¢ï¼Œç­‰åˆ°è°ƒç”¨ next æ–¹æ³•æ—¶å†å¾€åæ‰§è¡Œã€‚è¿™å®é™…ä¸Šç­‰åŒäºä¸éœ€è¦å†™å›è°ƒå‡½æ•°äº†ï¼Œå› ä¸ºå¼‚æ­¥æ“ä½œçš„åç»­æ“ä½œå¯ä»¥æ”¾åœ¨ yield è¡¨è¾¾å¼ä¸‹é¢ï¼Œåæ­£è¦ç­‰åˆ°è°ƒç”¨ next æ–¹æ³•æ—¶å†æ‰§è¡Œã€‚æ‰€ä»¥ï¼ŒGenerator å‡½æ•°çš„ä¸€ä¸ªé‡è¦å®é™…æ„ä¹‰å°±æ˜¯ç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œï¼Œæ”¹å†™å›è°ƒå‡½æ•°ï¼Œé¿å…å›è°ƒåµŒå¥—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">loadUI</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  showLoadingScreen()</span><br><span class="line">  <span class="keyword">yield</span> loadUIDataAsynchronously()</span><br><span class="line">  hideLoadingScreen()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> loader = loadUI()</span><br><span class="line"><span class="comment">// åŠ è½½UI</span></span><br><span class="line">loader.next()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸è½½UI</span></span><br><span class="line">loader.next()</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ï¼Œåˆ™ä¼šæ˜¾ç¤º Loading ç•Œé¢ï¼Œå¹¶ä¸”å¼‚æ­¥åŠ è½½æ•°æ®ã€‚ç­‰åˆ°æ•°æ®åŠ è½½å®Œæˆï¼Œå†ä¸€æ¬¡ä½¿ç”¨ next æ–¹æ³•ï¼Œåˆ™ä¼šéšè— Loading ç•Œé¢ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§å†™æ³•çš„å¥½å¤„æ˜¯æ‰€æœ‰ Loading ç•Œé¢çš„é€»è¾‘ï¼Œéƒ½è¢«å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‰éƒ¨å°±ç­éå¸¸æ¸…æ™°ã€‚</p>
<h3 id="å¼‚æ­¥ä»»åŠ¡çš„å°è£…"><a href="#å¼‚æ­¥ä»»åŠ¡çš„å°è£…" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡çš„å°è£…"></a>å¼‚æ­¥ä»»åŠ¡çš„å°è£…</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fetch = <span class="built_in">require</span>(<span class="string">'node-fetch'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = <span class="string">'https://api.github.com/users/github'</span></span><br><span class="line">  <span class="keyword">var</span> result = <span class="keyword">yield</span> fetch(url)</span><br><span class="line">  <span class="built_in">console</span>.log(result.bio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = gen()</span><br><span class="line"><span class="keyword">var</span> result = g.next()</span><br><span class="line"></span><br><span class="line">result.value</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data.json()</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    g.next(data)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>Generator å‡½æ•°å°è£…äº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè¯¥æ“ä½œå…ˆè¯»å–ä¸€ä¸ªè¿œç¨‹æ¥å£ï¼Œç„¶åä» JSON æ ¼å¼çš„æ•°æ®è§£æä¿¡æ¯ã€‚ä¸è¿‡ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ Generator å‡½æ•°å°†å¼‚æ­¥æ“ä½œè¡¨ç¤ºå¾—å¾ˆç®€æ´ï¼Œä½†æ˜¯æµç¨‹ç®¡ç†å´ä¸æ–¹ä¾¿ï¼ˆå³ä½•æ—¶æ‰§è¡Œç¬¬ä¸€é˜¶æ®µã€ä½•æ—¶æ‰§è¡Œç¬¬äºŒé˜¶æ®µï¼‰ã€‚</p>
<h3 id="éƒ¨ç½²-Iterator-æ¥å£"><a href="#éƒ¨ç½²-Iterator-æ¥å£" class="headerlink" title="éƒ¨ç½² Iterator æ¥å£"></a>éƒ¨ç½² Iterator æ¥å£</h3><p>åˆ©ç”¨ Generator å‡½æ•°ï¼Œå¯ä»¥åœ¨ä»»æ„å¯¹è±¡ä¸Šéƒ¨ç½² Iterator æ¥å£ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">iterEntries</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> key = keys[i]</span><br><span class="line">    <span class="keyword">yield</span> [key, obj[key]]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myObj = &#123; <span class="attr">foo</span>: <span class="number">3</span>, <span class="attr">bar</span>: <span class="number">7</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> iterEntries(myObj)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒmyObj æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œé€šè¿‡ iterEntries å‡½æ•°ï¼Œå°±æœ‰äº† Iterator æ¥å£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åœ¨ä»»æ„å¯¹è±¡ä¸Šéƒ¨ç½² next æ–¹æ³•ã€‚</p>
<h3 id="æŠ½å¥–ç¨‹åº"><a href="#æŠ½å¥–ç¨‹åº" class="headerlink" title="æŠ½å¥–ç¨‹åº"></a>æŠ½å¥–ç¨‹åº</h3><p>æ¯”å¦‚å½“å‰ç”¨æˆ·è¿˜å¯ä»¥æŠ½å¥– 5 æ¬¡ï¼Œç”¨æˆ·ç‚¹äº† 5 æ¬¡æŠ½å¥–åå°±ä¸èƒ½ç»§ç»­æŠ½å¥–äº†ï¼Œå¦‚åšä¸€ä¸ªå‰©ä½™æŠ½å¥–æ¬¡æ•°çš„é™åˆ¶ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"start"</span>&gt;</span>æŠ½å¥–<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> draw = <span class="function"><span class="keyword">function</span> (<span class="params">count</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…·ä½“æŠ½å¥–é€»è¾‘</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`å‰©ä½™<span class="subst">$&#123;count&#125;</span>æ¬¡`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> residue = <span class="function"><span class="keyword">function</span>* (<span class="params">count</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// æŠ½å¥–æ¬¡æ•°çš„é™åˆ¶</span></span><br><span class="line">    count--</span><br><span class="line">    <span class="keyword">yield</span> draw(count) <span class="comment">//æ‰§è¡ŒæŠ½å¥–çš„é€»è¾‘</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> start = residue(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'start'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  start.next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬é€šè¿‡ç‚¹å‡» 5 æ¬¡æŠ½å¥–æŒ‰é’®,ä¾æ¬¡è¾“å‡ºå‰©ä½™å‡ æ¬¡ã€‚å½“å‰©ä½™ 0 æ¬¡æ—¶ï¼Œå†ç‚¹å‡»æŒ‰é’®ä¸ä¼šæœ‰ä»»ä½•è¾“å‡º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‰©ä½™4æ¬¡</span><br><span class="line">å‰©ä½™3æ¬¡</span><br><span class="line">å‰©ä½™2æ¬¡</span><br><span class="line">å‰©ä½™1æ¬¡</span><br><span class="line">å‰©ä½™0æ¬¡</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°é€šè¿‡ generator æ¥æ§åˆ¶æŠ½å¥–çš„æ¬¡æ•°é™åˆ¶çš„å¥½å¤„æ˜¯ï¼šæŠ½å¥–æ¬¡æ•°æ— éœ€ä¿å­˜åœ¨å…¨å±€å˜é‡ä¸­ï¼Œè€Œä¸”æŠŠæŠ½å¥–å…·ä½“é€»è¾‘ç»™åˆ†ç¦»å¼€ã€‚</p>
<h2 id="Generator-å‡½æ•°çš„è¯­æ³•ç³–â€”async-å‡½æ•°"><a href="#Generator-å‡½æ•°çš„è¯­æ³•ç³–â€”async-å‡½æ•°" class="headerlink" title="Generator å‡½æ•°çš„è¯­æ³•ç³–â€”async å‡½æ•°"></a>Generator å‡½æ•°çš„è¯­æ³•ç³–â€”async å‡½æ•°</h2><p>ES2017 æ ‡å‡†å¼•å…¥äº† async å‡½æ•°ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿ï¼Œè€Œ async å‡½æ•°æ˜¯å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</p>
<ol>
<li><code>async</code> å¯¹åº”çš„æ˜¯ <code>*</code></li>
<li><code>await</code> å¯¹åº”çš„æ˜¯ <code>yield</code></li>
</ol>
<p><code>async</code>å’Œ<code>await</code>ï¼Œæ¯”èµ·<code>*</code>å·å’Œ<code>yield</code>ï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚async è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawait è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬å‡è£…æ¨¡æ‹Ÿä¸€ä¸ªè¯·æ±‚ ajax æ–¹æ³•è¿”å›ç”¨æˆ·æ•°æ®å¹¶è¾“å‡ºæ˜¾ç¤ºçš„ä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'ç”¨æˆ·æ•°æ®...'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">fetchUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">yield</span> ajax()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`è¾“å‡ºçš„useræ•°æ®:<span class="subst">$&#123;user&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å½“ç„¶çœŸå®é¡¹ç›®ä¸å¯èƒ½è¿™ä¹ˆå†™ï¼Œåœ¨æ­¤åªæ˜¯æ–¹ä¾¿æ‹¿æ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> generator = fetchUser()</span><br><span class="line"><span class="keyword">let</span> obj = generator.next()</span><br><span class="line">generator.next(obj.value)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨ async å‡½æ•°ä»£æ›¿,ä»£ç å°±ä¼šä¼˜é›…å¾ˆå¤š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> ajax()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`è¾“å‡ºçš„useræ•°æ®:<span class="subst">$&#123;user&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line">fetchUser()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹å‡ºå¹¶ä¸éœ€è¦è°ƒç”¨ next()æ–¹æ³•ï¼Œå› ä¸º async å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<br>async å‡½æ•°çš„å®ç°ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Generator æ˜¯ä¸€ä¸ªå¯ä»¥æš‚åœå’Œç»§ç»­æ‰§è¡Œçš„å‡½æ•°ï¼Œä»–å¯ä»¥å®Œå…¨å®ç° Iterator çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ç”±äºå¯ä»¥ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œä»–éå¸¸é€‚åˆå®ç°ç®€å•çš„çŠ¶æ€æœºã€‚å¦å¤–é€šè¿‡ä¸€äº›æµç¨‹æ§åˆ¶ä»£ç çš„é…åˆï¼Œå¯ä»¥æ¯”è¾ƒå®¹æ˜“è¿›è¡Œå¼‚æ­¥æ“ä½œã€‚</p>
<p>Async/Await å°±æ˜¯ generator è¿›è¡Œå¼‚æ­¥æ“ä½œçš„è¯­æ³•ç³–ï¼Œè¯¥è¯­æ³•ç³–ç›¸æ¯”ä¸‹æœ‰æ›´å¥½çš„åº”ç”¨å’Œè¯­ä¹‰åŒ–ï¼Œå®ƒä»¬æ­é… promiseï¼Œå¯ä»¥é€šè¿‡ç¼–å†™å½¢ä¼¼åŒæ­¥çš„ä»£ç æ¥å¤„ç†å¼‚æ­¥æµç¨‹ï¼Œæé«˜ä»£ç çš„ç®€æ´æ€§å’Œå¯è¯»æ€§ã€‚</p>
]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>Generator</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹ä¸€æ–‡å½»åº•å¼„æ‡‚Iterator</title>
    <url>/2020/01/11/ES6%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E5%BC%84%E6%87%82Iterator/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ¥æ·±å…¥å‰–æ ES6 çš„ Iteratorï¼ˆè¿­ä»£å™¨/éå†å™¨ï¼‰ï¼Œåœ¨äº†è§£å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦ Iterator? å®ƒå‡ºç°çš„åŸå› æ˜¯ä»€ä¹ˆ?</p>
<a id="more"></a>

<h2 id="ä»å¾ªç¯è¯´èµ·"><a href="#ä»å¾ªç¯è¯´èµ·" class="headerlink" title="ä»å¾ªç¯è¯´èµ·"></a>ä»å¾ªç¯è¯´èµ·</h2><p>å¹³æ—¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°å¾ªç¯ï¼Œæ‹¿æœ€åŸºæœ¬çš„æ¥è¯´ï¼Œæ¯”å¦‚å¾ªç¯ä¸€ä¸ªæ•°ç»„:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// forå¾ªç¯</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arr[i]) <span class="comment">// 1 2 3 4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ç”¨forEachå¾ªç¯</span></span><br><span class="line">arr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item) <span class="comment">// 1 2 3 4</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ç”¨for inå¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arr[i]) <span class="comment">// 1 2 3 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯å¾ªç¯è¾“å‡ºå­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªå­—ç¬¦</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// forå¾ªç¯</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">'abcde'</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(str[i]) <span class="comment">// a b c d e</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for inå¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> str) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(str[k]) <span class="comment">// a b c d e</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// forEachä¸èƒ½éå†å­—ç¬¦ä¸²ï¼Œå¦‚æœç¡¬è¦ç”¨åˆ™åªèƒ½å…ˆæŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„å†ç”¨æ•°ç»„æ–¹å¼å¾ªç¯</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯å¾ªç¯è¾“å‡ºä¸€ä¸ª map å¯¹è±¡å‘¢, å¦¥å¦¥çš„å°±ä¸€ä¸ª foreach å¾ªç¯ï¼Œæ™®é€šçš„ for å¾ªç¯å’Œ forâ€¦in éƒ½ä¸è¡Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">map.set(<span class="string">'first'</span>, <span class="string">'ç¬¬ä¸€'</span>)</span><br><span class="line">map.set(<span class="string">'second'</span>, <span class="string">'ç¬¬äºŒ'</span>)</span><br><span class="line">map.set(<span class="string">'third'</span>, <span class="string">'ç¬¬ä¸‰'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// forEachå¾ªç¯</span></span><br><span class="line">map.forEach(<span class="function">(<span class="params">val, key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(val, key)</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€ first</span></span><br><span class="line">  <span class="comment">// ç¬¬äºŒ second</span></span><br><span class="line">  <span class="comment">// ç¬¬ä¸‰ third</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šè¿°å„é›†åˆæ•°æ®ï¼Œæˆ‘ä»¬å‘ç°æ²¡æœ‰ä¸€ä¸ªå¾ªç¯æ–¹æ³•æ˜¯å¯ä»¥ä¸€æ¬¡æ€§è§£å†³çš„ã€‚</p>
<p>è™½ç„¶ forEach å¾ªç¯ä¸èƒ½å¾ªç¯å­—ç¬¦ä¸²ï¼Œä½†å­—ç¬¦ä¸²å¯ä»¥è½¬ä¸ºæ•°ç»„å†ä½¿ç”¨ forEach å³å¯è¾“å‡ºï¼Œä½†è¿™æ“ä½œå¹¶ä¸èˆ’æœæ¯æ¬¡ä½¿ç”¨éƒ½è¦è½¬æ¢ã€‚è€Œä¸” forEach å¾ªç¯å­˜åœ¨ç¼ºç‚¹ï¼š<code>ä¸èƒ½ä½¿ç”¨breakï¼Œcontinueè¯­å¥è·³å‡ºå¾ªç¯ï¼Œæˆ–è€…ä½¿ç”¨returnä»å‡½æ•°ä½“è¿”å›</code>ã€‚</p>
<p>è€Œ for å¾ªç¯åœ¨æœ‰äº›æƒ…å†µå†™ä»£ç ä¼šå¢åŠ å¤æ‚åº¦ï¼Œè€Œä¸”ä¸èƒ½å¾ªç¯å¯¹è±¡ã€‚</p>
<p>ç›¸æ¯”ä¸‹ï¼Œforâ€¦in çš„ç¼ºç‚¹æ˜¯ä¸ä»…éå†æ•°å­—é”®åï¼Œè¿˜ä¼šéå†æ‰‹åŠ¨æ·»åŠ çš„è‡ªå®šä¹‰é”®ï¼Œç”šè‡³åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„é”®ã€‚forâ€¦in ä¸»è¦è¿˜æ˜¯ä¸ºéå†å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œå¹¶ä¸å¤ªé€‚ç”¨äºéå†æ•°ç»„ã€‚</p>
<p>å¦‚ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.protoValue = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">arr.test = <span class="string">'test'</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arr[i]) <span class="comment">// 1 2 3 4 test hello</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯è¯´å›æ¥ï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„å¾ªç¯èƒ½ä¸€ç»Ÿä¸Šè¿°å¾ªç¯é—®é¢˜ï¼Ÿ ES6 å°±æœ‰äº†ï¼Œç”¨ forâ€¦of å¾ªç¯</p>
<h2 id="forâ€¦of-å¾ªç¯å‡ºç°"><a href="#forâ€¦of-å¾ªç¯å‡ºç°" class="headerlink" title="forâ€¦of å¾ªç¯å‡ºç°"></a>forâ€¦of å¾ªç¯å‡ºç°</h2><p>å®ƒçš„å‡ºç°è§£å†³äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿé¦–å…ˆæ˜¯å½“ç„¶æ˜¯èƒ½è§£å†³äº†ä¸Šè¿°æˆ‘ä»¬çš„é—®é¢˜</p>
<p>å¯¹ä¸Šè¿°æ•°æ®è¿›è¡Œå¾ªç¯è¾“å‡º</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v) <span class="comment">// 1 2 3 4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> str) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v) <span class="comment">// a b c d e</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v)</span><br><span class="line">  <span class="comment">// (2) ["first", "ç¬¬ä¸€"]</span></span><br><span class="line">  <span class="comment">// (2) ["second", "ç¬¬äºŒ"]</span></span><br><span class="line">  <span class="comment">// (2) ["third", "ç¬¬ä¸‰"]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹çœ‹å®ƒçš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>ç®€æ´ç›´æ¥çš„éå†æ•°ç»„è¯­æ³•</li>
<li>å®ƒé¿å¼€äº† for-in å¾ªç¯çš„æ‰€æœ‰ç¼ºç‚¹</li>
<li>ä¸ forEach å¾ªç¯ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ breakã€continue å’Œ return è¯­å¥</li>
</ol>
<p>é˜®ä¸€å³°è€å¸ˆçš„ã€ŠECMAScript 6 å…¥é—¨ã€‹æåˆ°ï¼š</p>
<blockquote>
<p>ES6 ä¸­å¼•å…¥äº† forâ€¦of å¾ªç¯ï¼Œä½œä¸ºéå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€çš„æ–¹æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>Iterator æ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚</p>
</blockquote>
<p>ä¸€ä¸ªæ•°æ®ç»“æ„åªè¦å…·æœ‰ iterator æ¥å£ï¼Œå°±å¯ä»¥ç”¨ forâ€¦of å¾ªç¯éå†å®ƒçš„æˆå‘˜ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½èƒ½ä½¿ç”¨ forâ€¦of å¾ªç¯ï¼Œåªæœ‰å®ç°äº† Iterator æ¥å£çš„å¯¹è±¡ï¼Œæ‰èƒ½å¤Ÿ forâ€¦of æ¥è¿›è¡Œéå†å–å€¼ã€‚</p>
<p>é‚£ä¹ˆï¼ŒIterator æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç€è¯´</p>
<h2 id="Iterator-è¿­ä»£å™¨"><a href="#Iterator-è¿­ä»£å™¨" class="headerlink" title="Iterator è¿­ä»£å™¨"></a>Iterator è¿­ä»£å™¨</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><blockquote>
<p>å®ƒæ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚</p>
</blockquote>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><ol>
<li>ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›</li>
<li>ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—ï¼›</li>
<li>åˆ›é€ ä¸€ç§æ–°çš„éå†å‘½ä»¤ forâ€¦of å¾ªç¯ï¼ŒIterator æ¥å£ä¸»è¦ä¾› forâ€¦of æ¶ˆè´¹ã€‚</li>
</ol>
<p>ç°åœ¨æ˜ç™½äº†ï¼ŒIterator çš„äº§ç”Ÿä¸»è¦æ˜¯ä¸ºäº†ä½¿ç”¨ forâ€¦of æ–¹æ³•ã€‚ä½†å…·ä½“ Iterator æ¦‚å¿µè¿˜æ˜¯æœ‰äº›æŠ½è±¡ï¼Œå¦‚æœè¦ç›´æ¥å…·ä½“çš„æè¿°çš„è¯ï¼š</p>
<p>Iterator å…¶å®å°±æ˜¯ä¸€ä¸ªå…·æœ‰ next()æ–¹æ³•çš„å¯¹è±¡ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨ next()æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªç»“æœå¯¹è±¡ï¼Œè¿™ä¸ªç»“æœå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§, å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    value: è¡¨ç¤ºå½“å‰çš„å€¼,</span><br><span class="line">    done: è¡¨ç¤ºéå†æ˜¯å¦ç»“æŸ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¤šäº†ä¸€äº›æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ï¼š</p>
<p>Iterator æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼š</p>
<ol>
<li>å®ƒå…·æœ‰ next()æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å°±ä¼šè¿”å›ä¸€ä¸ªç»“æœå¯¹è±¡</li>
<li>ç»“æœå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§å€¼ï¼š<code>value</code>å’Œ<code>done</code>ã€‚</li>
<li><code>value</code>è¡¨ç¤ºå…·ä½“çš„è¿”å›å€¼ï¼›done æ˜¯å¸ƒå°”ç±»å‹ï¼Œè¡¨ç¤ºé›†åˆæ˜¯å¦å®Œæˆéå†ï¼Œæ²¡æœ‰åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</li>
<li>å†…éƒ¨æœ‰ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚æ¯è°ƒç”¨ä¸€æ¬¡ next()æ–¹æ³•ï¼ŒæŒ‡é’ˆéƒ½ä¼šå‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œç›´åˆ°æŒ‡å‘æœ€åä¸€ä¸ªä½ç½®ã€‚</li>
</ol>
<h3 id="æ¨¡æ‹Ÿ-Iterator"><a href="#æ¨¡æ‹Ÿ-Iterator" class="headerlink" title="æ¨¡æ‹Ÿ Iterator"></a>æ¨¡æ‹Ÿ Iterator</h3><p>æ ¹æ®ä¸Šè¿°æè¿°ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªè¿­ä»£å™¨ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIterator</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> done = i &gt;= item.length</span><br><span class="line">      <span class="keyword">var</span> value = !done ? items[i++] : <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: done,</span><br><span class="line">        value: value,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// iterator å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> iterator = createIterator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; done: false, value: 1 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; done: false, value: 2 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; done: false, value: 3 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; done: true, value: undefined &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; done: true, value: undefined &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; done: true, value: undefined &#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹:</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéå†å™¨å¯¹è±¡æœ¬è´¨ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ã€‚</li>
<li>ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ next æ–¹æ³•ï¼Œnext æ–¹æ³•å†…éƒ¨é€šè¿‡é—­åŒ…æ¥ä¿å­˜æŒ‡é’ˆ<code>i</code> çš„å€¼ï¼Œæ¯æ¬¡è°ƒç”¨<code>i</code>éƒ½ä¼š<code>+1</code>ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªã€‚æ•…ç¬¬ä¸€æ¬¡æŒ‡é’ˆæŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œè¾“å‡º 1ã€‚</li>
<li>ç¬¬äºŒæ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ next æ–¹æ³•ï¼ŒæŒ‡é’ˆå°±æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬äºŒä¸ªæˆå‘˜ï¼Œè¾“å‡º 2ã€‚</li>
<li>ç¬¬ä¸‰æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ next æ–¹æ³•ï¼Œæ•°ç»„é•¿åº¦ä¸º 3ï¼Œæ­¤æ—¶æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®ï¼Œè¾“å‡º 3ã€‚</li>
<li>ç¬¬å››æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ next æ–¹æ³•ï¼Œæ­¤æ—¶å·²éå†å®Œæˆäº†ï¼Œè¾“å‡º done ä¸º true è¡¨ç¤ºå®Œæˆï¼Œvalue ä¸º undefinedï¼Œæ­¤åç¬¬ n æ¬¡è°ƒç”¨éƒ½æ˜¯è¯¥ç»“æœã€‚</li>
</ol>
<p>çœ‹åˆ°è¿™é‡Œå¤§å®¶å¤§æ¦‚çŸ¥é“<code>Iterator</code>äº†ï¼Œä½† Iterator æ¥å£ä¸»è¦ä¾› forâ€¦of æ¶ˆè´¹ã€‚æˆ‘ä»¬è¯•ç€ç”¨ forâ€¦of å¾ªç¯ä¸Šé¢åˆ›å»º Iterator å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var iterator &#x3D; makeIterator([1, 2, 3]);</span><br><span class="line"></span><br><span class="line">for (let value of iterator) &#123;</span><br><span class="line">    console.log(value); &#x2F;&#x2F; Uncaught TypeError: iterator is not iterable</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœæŠ¥é”™ï¼Œè¯´æ˜æˆ‘ä»¬ç”Ÿæˆçš„ iterator å¯¹è±¡å¹¶ä¸æ˜¯å¯éå†çš„ï¼Œè¿™æ ·çš„ç»“æ„è¿˜ä¸èƒ½å¤Ÿè¢« forâ€¦of å¾ªç¯</p>
<p>é‚£ä»€ä¹ˆæ ·çš„ç»“æ„æ‰æ˜¯å¯éå†çš„å‘¢ï¼Ÿ</p>
<h2 id="å¯è¿­ä»£å¯¹è±¡-Iterable"><a href="#å¯è¿­ä»£å¯¹è±¡-Iterable" class="headerlink" title="å¯è¿­ä»£å¯¹è±¡ Iterable"></a>å¯è¿­ä»£å¯¹è±¡ Iterable</h2><h3 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h3><p>ES6 è¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ Symbol å¯¹è±¡ï¼Œsymbol å€¼æ˜¯å”¯ä¸€çš„ã€‚</p>
<p>ä¸€ä¸ªæ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº† Symbol.iterator å±æ€§ï¼Œå°±è¢«è§†ä¸ºå…·æœ‰ iterator æ¥å£ï¼›è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚è¿™æ ·çš„æ•°æ®ç»“æ„æ‰èƒ½è¢«ç§°ä¸ºå¯è¿­ä»£å¯¹è±¡(Iterator)ï¼Œè¯¥å¯¹è±¡å¯è¢« forâ€¦of éå†ã€‚</p>
<p>ç…§ç€ä¸Šé¢çš„è§„å®šæ¥åˆ›å»ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">arr[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> done = i &gt;= _this.length</span><br><span class="line">      <span class="keyword">var</span> value = !done ? _this[i++] : <span class="literal">undefined</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: done,</span><br><span class="line">        value: value,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶å¯ä»¥for...oféå†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item) <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“ forâ€¦of éå†çš„å…¶å®æ˜¯å¯¹è±¡çš„ Symbol.iterator å±æ€§ã€‚</p>
<h3 id="åŸç”Ÿå…·å¤‡-Iterator-æ¥å£çš„æ•°æ®ç»“æ„"><a href="#åŸç”Ÿå…·å¤‡-Iterator-æ¥å£çš„æ•°æ®ç»“æ„" class="headerlink" title="åŸç”Ÿå…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„"></a>åŸç”Ÿå…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„</h3><p>åœ¨ ES6 ä¸­ï¼Œæ‰€æœ‰çš„é›†åˆå¯¹è±¡ï¼ŒåŒ…æ‹¬æ•°ç»„ï¼Œç±»æ•°ç»„å¯¹è±¡ï¼ˆarguments å¯¹è±¡ã€DOM NodeList å¯¹è±¡ï¼‰ï¼ŒMap å’Œ Setï¼Œè¿˜æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯å¯è¿­ä»£çš„ï¼Œéƒ½å¯ä»¥è¢« forâ€¦of éå†ï¼Œå› ä¸ºä»–ä»¬éƒ½æœ‰é»˜è®¤çš„è¿­ä»£å™¨ã€‚</p>
<p>ä¸‹é¢å°±æŒ‘å…¶ä¸­å‡ ä¸ªç±»å‹æ¥ä¸¾ä¾‹å­ï¼š</p>
<h4 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iteratorObj = arr[<span class="built_in">Symbol</span>.iterator]()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iteratorObj.next())</span><br><span class="line"><span class="built_in">console</span>.log(iteratorObj.next())</span><br><span class="line"><span class="built_in">console</span>.log(iteratorObj.next())</span><br><span class="line"><span class="built_in">console</span>.log(iteratorObj.next())</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š<br><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/1/8/16f8433c4b0b041a?w=294&h=282&f=png&s=23046" alt=""><br>ç”±ä¸Šè¿°å¯¹è¿­ä»£å™¨çš„æ¦‚å¿µè®¤è¯†ï¼Œè¾“å‡ºç»“æœä¹Ÿå®Œå…¨ç¬¦åˆæˆ‘ä»¬é¢„æœŸã€‚</p>
<h4 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h4><p>æˆ‘ä»¬çŸ¥é“æ™®é€šå¯¹è±¡æ˜¯é»˜è®¤æ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ¥å£çš„ï¼Œæ‰€ä»¥ arguments è¿™ä¸ªå±æ€§æ²¡æœ‰åœ¨åŸå‹ä¸Šï¼Œè€Œæ˜¯åœ¨å¯¹è±¡è‡ªèº«çš„å±æ€§ä¸Šã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="built_in">arguments</span>[<span class="built_in">Symbol</span>.iterator]()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(obj.next())</span><br><span class="line">  <span class="built_in">console</span>.log(obj.next())</span><br><span class="line">  <span class="built_in">console</span>.log(obj.next())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/1/8/16f8446fec7e2102?w=508&h=197&f=png&s=20591" alt=""></p>
<h4 id="NodeList"><a href="#NodeList" class="headerlink" title="NodeList"></a>NodeList</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> nodeList = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'test'</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> node <span class="keyword">of</span> nodeList) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/1/8/16f84531078f206d?w=236&h=61&f=png&s=3489" alt=""></p>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>è¿™æ¬¡ç›´æ¥ä»åŸå‹ä¸Šæ‰¾æ¥è¯æ˜</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Map</span>.prototype.hasOwnProperty(<span class="built_in">Symbol</span>.iterator)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>è‡³äºå…¶ä»–ç±»å‹çš„å¯è¿­ä»£å¯¹è±¡å¤§å®¶å¯ä¸¾ä¸€åä¸‰ã€‚</p>
<h2 id="è°ƒç”¨-Iterator-æ¥å£çš„åœºåˆ"><a href="#è°ƒç”¨-Iterator-æ¥å£çš„åœºåˆ" class="headerlink" title="è°ƒç”¨ Iterator æ¥å£çš„åœºåˆ"></a>è°ƒç”¨ Iterator æ¥å£çš„åœºåˆ</h2><p>æœ‰ä¸€äº›åœºåˆä¼šé»˜è®¤è°ƒç”¨ Iterator æ¥å£ï¼ˆå³ Symbol.iterator æ–¹æ³•ï¼‰</p>
<h3 id="è§£æ„èµ‹å€¼"><a href="#è§£æ„èµ‹å€¼" class="headerlink" title="è§£æ„èµ‹å€¼"></a>è§£æ„èµ‹å€¼</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">set</span> = new Set().add('a').add('b').add('c')</span><br><span class="line"></span><br><span class="line">let [x, y] = <span class="keyword">set</span></span><br><span class="line">console.log(x, y) // a b</span><br></pre></td></tr></table></figure>

<h3 id="æ‰©å±•è¿ç®—ç¬¦"><a href="#æ‰©å±•è¿ç®—ç¬¦" class="headerlink" title="æ‰©å±•è¿ç®—ç¬¦"></a>æ‰©å±•è¿ç®—ç¬¦</h3><p>æ‰©å±•è¿ç®—ç¬¦ï¼ˆâ€¦ï¼‰ä¹Ÿä¼šè°ƒç”¨é»˜è®¤çš„ Iterator æ¥å£ï¼Œå¯ä»¥å°†å½“å‰è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'hello'</span></span><br><span class="line"><span class="built_in">console</span>.log([...str]) <span class="comment">// ["h", "e", "l", "l", "o"]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line"><span class="built_in">console</span>.log([<span class="string">'a'</span>, ...arr, <span class="string">'d'</span>]) <span class="comment">// ["a", "b", "c", "d"]</span></span><br></pre></td></tr></table></figure>

<h3 id="yield"><a href="#yield" class="headerlink" title="yield*"></a>yield*</h3><p>yield*åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå¯éå†çš„ç»“æ„ï¼Œå®ƒä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> generator = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span>* [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = generator()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; value: 3, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; value: 4, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; value: 5, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<p>å…³äº yield ä¹‹åä¼šå†å†™ä¸€ç¯‡ä¸“é¢˜</p>
<h3 id="å…¶ä»–åœºåˆ"><a href="#å…¶ä»–åœºåˆ" class="headerlink" title="å…¶ä»–åœºåˆ"></a>å…¶ä»–åœºåˆ</h3><p>ä¾‹å¦‚ï¼šforâ€¦ofã€Set()ã€Map()ã€Array.from()ç­‰ã€‚æˆ‘ä»¬ä¸»è¦æ˜¯ä¸ºäº†è¯æ˜è°ƒç”¨ä¸Šé¢è¿™äº›å‡½æ•°æ—¶ç€å®æ˜¯ç”¨åˆ°äº† Iterator æ¥å£ã€‚</p>
<p>æˆ‘ä»¬è´´å‡ºä¸Šé¢çš„å®ç°å¯è¿­ä»£å¯¹è±¡çš„ä»£ç ï¼Œè¿›è¡Œæ”¹åŠ¨ã€‚æƒ³ä¸€æƒ³ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰æ‰‹åŠ¨æ·»åŠ  Symbol.iterator å±æ€§ï¼Œä½†å› ä¸º ES6 é»˜è®¤éƒ¨ç½²äº† Symbol.iteratorï¼Œæ•°ç»„è¿˜æ˜¯å¯ä»¥éå†æˆåŠŸï¼Œé‚£å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªå±æ€§ï¼Œé‡æ–°éƒ¨ç½²ä¹Ÿå¯ä»¥ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ‰‹åŠ¨ä¿®æ”¹ç”Ÿæ•ˆï¼Œå½±å“äº†è¾“å‡ºï¼Œè¯æ˜æŸæ–¹æ³•è°ƒç”¨éœ€è¦ç”¨åˆ° Iterator æ¥å£</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">arr[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> done = i &gt;= _this.length</span><br><span class="line">      <span class="keyword">var</span> value = !done ? _this[i++] : <span class="literal">undefined</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: done,</span><br><span class="line">        value: value + <span class="string">' æ‰‹åŠ¨æ·»åŠ çš„å±æ€§'</span>, <span class="comment">// æ·»åŠ è‡ªå®šä¹‰å€¼</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœæ˜¾ç¤ºæ‰‹åŠ¨ä¿®æ”¹ç”Ÿæ•ˆï¼Œè¯æ˜for...ofè°ƒç”¨äº†Iteratoræ¥å£</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)</span><br><span class="line">  <span class="comment">// 1 æ‰‹åŠ¨æ·»åŠ çš„å±æ€§</span></span><br><span class="line">  <span class="comment">// 2 æ‰‹åŠ¨æ·»åŠ çš„å±æ€§</span></span><br><span class="line">  <span class="comment">// 3 æ‰‹åŠ¨æ·»åŠ çš„å±æ€§</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">set</span> = new Set(arr)</span><br><span class="line">console.log(<span class="keyword">set</span>) // Set(3) &#123;<span class="number">1</span> æ‰‹åŠ¨æ·»åŠ çš„å±æ€§<span class="string">", 2 æ‰‹åŠ¨æ·»åŠ çš„å±æ€§"</span>, <span class="number">3</span> æ‰‹åŠ¨æ·»åŠ çš„å±æ€§<span class="string">"&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°å…¶ä»–æ–¹æ³•è¯æ˜ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå°±ä¸ä¸€ä¸€åˆ—å‡ºäº†ã€‚</p>
<h2 id="è®¡ç®—ç”Ÿæˆçš„æ•°æ®ç»“æ„"><a href="#è®¡ç®—ç”Ÿæˆçš„æ•°æ®ç»“æ„" class="headerlink" title="è®¡ç®—ç”Ÿæˆçš„æ•°æ®ç»“æ„"></a>è®¡ç®—ç”Ÿæˆçš„æ•°æ®ç»“æ„</h2><p>æœ‰äº›æ•°æ®ç»“æ„æ˜¯åœ¨ç°æœ‰æ•°æ®ç»“æ„çš„åŸºç¡€ä¸Šï¼Œè®¡ç®—ç”Ÿæˆçš„ã€‚æ¯”å¦‚ï¼ŒES6 çš„æ•°ç»„ã€Setã€Map éƒ½éƒ¨ç½²äº†ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨åéƒ½è¿”å›éå†å™¨å¯¹è±¡ã€‚</p>
<ol>
<li>entries() è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨æ¥éå†[é”®å,é”®å€¼]ç»„æˆçš„æ•°ç»„ã€‚å¯¹äºæ•°ç»„ï¼Œé”®åå°±æ˜¯ç´¢å¼•å€¼ã€‚</li>
<li>keys() è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨æ¥éå†æ‰€æœ‰çš„é”®åã€‚</li>
<li>values() è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨æ¥éå†æ‰€æœ‰çš„é”®å€¼ã€‚</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'first'</span>, <span class="string">'second'</span>, <span class="string">'third'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">of</span> arr.keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> color <span class="keyword">of</span> arr.values()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(color)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// first</span></span><br><span class="line"><span class="comment">// second</span></span><br><span class="line"><span class="comment">// third</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr.entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [ 0, "first" ]</span></span><br><span class="line"><span class="comment">// [ 1, "second" ]</span></span><br><span class="line"><span class="comment">// [ 2, "third" ]</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¿­ä»£"><a href="#åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¿­ä»£" class="headerlink" title="åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¿­ä»£"></a>åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¿­ä»£</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isIterable = <span class="function"><span class="params">obj</span> =&gt;</span> obj != <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> obj[<span class="built_in">Symbol</span>.iterator] === <span class="string">'function'</span></span><br><span class="line"><span class="built_in">console</span>.log(isIterable(<span class="keyword">new</span> <span class="built_in">Set</span>())) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isIterable(<span class="keyword">new</span> <span class="built_in">Map</span>())) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isIterable([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isIterable(<span class="string">'hello world'</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="forâ€¦of-å¾ªç¯ä¸æ”¯æŒéå†æ™®é€šå¯¹è±¡"><a href="#forâ€¦of-å¾ªç¯ä¸æ”¯æŒéå†æ™®é€šå¯¹è±¡" class="headerlink" title="forâ€¦of å¾ªç¯ä¸æ”¯æŒéå†æ™®é€šå¯¹è±¡"></a>forâ€¦of å¾ªç¯ä¸æ”¯æŒéå†æ™®é€šå¯¹è±¡</h3><p>æ¢³ç†äº†åŠå¤©ï¼Œå›åˆ°æœ€åˆï¼ŒIterator çš„äº§ç”Ÿä¸»è¦æ˜¯ä¸ºäº†ä½¿ç”¨ forâ€¦of æ–¹æ³•ã€‚è€Œå¯¹è±¡ä¸åƒæ•°ç»„çš„å€¼æ˜¯æœ‰åºçš„ï¼Œéå†çš„æ—¶å€™æ ¹æœ¬ä¸çŸ¥é“å¦‚ä½•ç¡®å®šä»–ä»¬çš„å…ˆåé¡ºåºï¼Œæ‰€ä»¥è¦æ³¨æ„çš„æ˜¯ forâ€¦of å¾ªç¯ä¸æ”¯æŒéå†å¯¹è±¡ã€‚</p>
<p>å¦‚æœéè¦éå†å¯¹è±¡ï¼ŒåŒç†å¯¹è±¡ä¹Ÿå¿…é¡»åŒ…å«[Symbol.iterator]çš„å±æ€§å¹¶å®ç°è¿­ä»£å™¨æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨åˆ©ç”¨ Object.defineProperty æ–¹æ³•æ·»åŠ è¯¥å±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span>, <span class="attr">b</span>: <span class="number">3</span> &#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i) <span class="comment">// Uncaught TypeError: obj is not iterable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äº Iterator å°±å†™åˆ°è¿™é‡Œäº†ï¼Œä¸‹ä¸€ç¯‡å†™ ES6 çš„ Generator ç”Ÿæˆå™¨ã€‚</p>
]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>Iterator</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹ç®­å¤´å‡½æ•°å…¨è§£æ</title>
    <url>/2020/01/07/ES6%E7%B3%BB%E5%88%97%E4%B9%8B%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0%E5%85%A8%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<p>ES6 ä¸­å…è®¸ä½¿ç”¨ç®­å¤´æ¥å®šä¹‰ç®­å¤´å‡½æ•°ï¼Œæ˜¯ ES6 ä¸­è¾ƒå—æ¬¢è¿ä¹Ÿè¾ƒå¸¸ä½¿ç”¨çš„æ–°å¢ç‰¹æ€§ã€‚æœ¬æ–‡å°†ä»ç®­å¤´å‡½æ•°çš„åŸºæœ¬è¯­æ³•ï¼Œä¸æ™®é€šå‡½æ•°å¯¹æ¯”ï¼Œç®­å¤´å‡½æ•°ä¸é€‚ç”¨åœºæ™¯ä¸‰ä¸ªæ–¹é¢è¿›è¡Œæ¢³ç†ã€‚</p>
<a id="more"></a>

<h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`Hello <span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`Hello <span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå®šä¹‰ç®­å¤´å‡½æ•°è¯­æ³•ä¸Šè¦æ¯”æ™®é€šå‡½æ•°ç®€æ´å¾—å¤šã€‚ç®­å¤´å‡½æ•°çœå»äº†<code>function</code>å…³é”®å­—ï¼Œé‡‡ç”¨ç®­å¤´<code>=&gt;</code>æ¥å®šä¹‰å‡½æ•°ã€‚å‡½æ•°çš„å‚æ•°æ”¾åœ¨<code>=&gt;</code>å‰é¢çš„æ‹¬å·ä¸­ï¼Œå‡½æ•°ä½“è·Ÿåœ¨<code>=&gt;</code>åçš„èŠ±æ‹¬å·ä¸­ï¼Œç®­å¤´å‡½æ•°åœ¨å‚æ•°å’Œç®­å¤´ä¹‹é—´ä¸èƒ½æ¢è¡Œã€‚</p>
<h3 id="ç®­å¤´å‡½æ•°çš„å‚æ•°"><a href="#ç®­å¤´å‡½æ•°çš„å‚æ•°" class="headerlink" title="ç®­å¤´å‡½æ•°çš„å‚æ•°"></a>ç®­å¤´å‡½æ•°çš„å‚æ•°</h3><ol>
<li>å¦‚æœç®­å¤´å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œç›´æ¥å†™ä¸€ä¸ªç©ºæ‹¬å·å³å¯ã€‚</li>
<li>å¦‚æœç®­å¤´å‡½æ•°çš„å‚æ•°åªæœ‰ä¸€ä¸ªï¼Œå¯ä»¥çœç•¥åŒ…è£¹å‚æ•°çš„æ‹¬å·ã€‚</li>
<li>å¦‚æœç®­å¤´å‡½æ•°æœ‰å¤šä¸ªå‚æ•°ï¼Œå°†å‚æ•°ä¾æ¬¡ç”¨é€—å·åˆ†éš”ï¼Œå‚æ•°å¿…é¡»è¢«åŒ…è£¹åœ¨æ‹¬å·ä¸­ã€‚</li>
</ol>
<h3 id="ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“"><a href="#ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“" class="headerlink" title="ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“"></a>ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“</h3><p>å¦‚æœç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“åªæœ‰ä¸€å¥ä»£ç ï¼Œå³è¿”å›æŸä¸ªå˜é‡æˆ–è€…è¿”å›ä¸€ä¸ªç®€å•çš„ JS è¡¨è¾¾å¼ï¼Œå¯ä»¥çœå»å‡½æ•°ä½“çš„å¤§æ‹¬å·{ }ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">val</span> =&gt;</span> val</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum = <span class="function">(<span class="params">num1, num2</span>) =&gt;</span> num1 + num2</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mulFunction = <span class="function">(<span class="params">num1, num2, num3</span>) =&gt;</span> num1 * num2 * num3</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">let</span> mulFunction = <span class="function"><span class="keyword">function</span> (<span class="params">num1, num2, num3</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1 * num2 * num3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç®­å¤´å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡"><a href="#ç®­å¤´å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡" class="headerlink" title="ç®­å¤´å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡"></a>ç®­å¤´å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡</h3><p>å¦‚æœç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“åªæœ‰ä¸€å¥ä»£ç ä¸”è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆå¯¹è±¡å­—é¢é‡ï¼‰æ—¶ï¼Œç›´æ¥å†™ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯ä¸è¡Œçš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="attr">foo</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(func()); <span class="comment">// æ‰§è¡Œåè¿”å›undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯è¿™æ ·è¿˜ä¼šç›´æ¥æŠ¥é”™</span></span><br><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="attr">foo</span>: <span class="number">1</span>, <span class="attr">bar</span>: <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>åŸå› æ˜¯èŠ±æ‹¬å·è¢«è§£é‡Šä¸ºå‡½æ•°ä½“çš„å¤§æ‹¬å·ï¼Œè§£å†³åŠæ³•ï¼š<strong>ç”¨åœ†æ‹¬å·æŠŠå¯¹è±¡å­—é¢é‡åŒ…èµ·æ¥</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">foo</span>: <span class="number">1</span> &#125;)</span><br><span class="line"><span class="built_in">console</span>.log(func()) <span class="comment">// &#123;foo: 1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸è¿‡ä¸Šé¢é‚£æ ·è§£å†³çš„ç¼ºç‚¹æ˜¯å¯è¯»æ€§å˜å·®äº†ï¼Œæ‰€ä»¥æ›´æ¨èç›´æ¥å½“æˆå¤šæ¡è¯­å¥çš„å½¢å¼æ¥å†™ï¼Œå¯è¯»æ€§é«˜</span></span><br><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    foo: <span class="number">1</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç®€åŒ–å›è°ƒå‡½æ•°"><a href="#ç®€åŒ–å›è°ƒå‡½æ•°" class="headerlink" title="ç®€åŒ–å›è°ƒå‡½æ•°"></a>ç®€åŒ–å›è°ƒå‡½æ•°</h3><p>è¿™æ˜¯ç®­å¤´å‡½æ•°æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šå‡½æ•°å†™æ³•</span></span><br><span class="line">;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].map(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = [<span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>].sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°å†™æ³•</span></span><br><span class="line">;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> x * x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = [<span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>].sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b)</span><br></pre></td></tr></table></figure>

<h2 id="è·Ÿæ™®é€šå‡½æ•°çš„åŒºåˆ«"><a href="#è·Ÿæ™®é€šå‡½æ•°çš„åŒºåˆ«" class="headerlink" title="è·Ÿæ™®é€šå‡½æ•°çš„åŒºåˆ«"></a>è·Ÿæ™®é€šå‡½æ•°çš„åŒºåˆ«</h2><h3 id="æ²¡æœ‰-this-ç»‘å®š"><a href="#æ²¡æœ‰-this-ç»‘å®š" class="headerlink" title="æ²¡æœ‰ this ç»‘å®š"></a>æ²¡æœ‰ this ç»‘å®š</h3><p>ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ thisï¼Œå®ƒä¼šæ•è·è‡ªå·±åœ¨<em>å®šä¹‰æ—¶</em>ï¼‰æ‰€å¤„çš„å¤–å±‚æ‰§è¡Œç¯å¢ƒçš„ thisï¼Œå¹¶ç»§æ‰¿è¿™ä¸ª this å€¼ã€‚æ‰€ä»¥ï¼Œç®­å¤´å‡½æ•°ä¸­ this çš„æŒ‡å‘åœ¨å®ƒè¢«å®šä¹‰çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ï¼Œä¹‹åæ°¸è¿œä¸ä¼šæ”¹å˜ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  a: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">obj.a() <span class="comment">// æ‰“å°ç»“æœï¼šobjå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  a: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">obj.a() <span class="comment">// æ‰“å°ç»“æœï¼š Windowå¯¹è±¡</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œç®­å¤´å‡½æ•°ä¸å¤–å±‚çš„ this ä¿æŒä¸€è‡´ï¼Œæœ€å¤–å±‚çš„ this å°±æ˜¯ Window å¯¹è±¡ã€‚</p>
<h3 id="æ²¡æœ‰-arguments"><a href="#æ²¡æœ‰-arguments" class="headerlink" title="æ²¡æœ‰ arguments"></a>æ²¡æœ‰ arguments</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> func2 = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">func1(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// Arguments(2)Â [1, 2, callee: Æ’, Symbol(Symbol.iterator): Æ’]</span></span><br><span class="line">func2(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// Uncaught ReferenceError: arguments is not defined</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœéè¦æ‰“å°å‡½æ•°å‚æ•°ï¼Œå¯ä»¥åœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ rest å‚æ•°ä»£æ›¿ arguments å¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> func2 = <span class="function">(<span class="params">...rest</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(rest) <span class="comment">// (2)Â [1, 2]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸èƒ½é€šè¿‡-new-å…³é”®å­—è°ƒç”¨"><a href="#ä¸èƒ½é€šè¿‡-new-å…³é”®å­—è°ƒç”¨" class="headerlink" title="ä¸èƒ½é€šè¿‡ new å…³é”®å­—è°ƒç”¨"></a>ä¸èƒ½é€šè¿‡ new å…³é”®å­—è°ƒç”¨</h3><p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œthis æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡å®ä¾‹</p>
<p>è€Œç®­å¤´å‡½æ•°æ²¡æœ‰ [[Construct]]æ–¹æ³•ï¼Œç®­å¤´å‡½æ•°ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°ï¼Œå¦‚æœè¿™æ ·åšä¼šæŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Uncaught TypeError: Person is not a constructor</span></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">'jacky'</span>)</span><br></pre></td></tr></table></figure>

<p>ç®­å¤´å‡½æ•°åœ¨åˆ›å»ºæ—¶ this å¯¹è±¡å°±ç»‘å®šäº†ï¼Œæ•…ä¸ä¼šæŒ‡å‘å¯¹è±¡å®ä¾‹ã€‚</p>
<h3 id="æ²¡æœ‰-new-target"><a href="#æ²¡æœ‰-new-target" class="headerlink" title="æ²¡æœ‰ new.target"></a>æ²¡æœ‰ new.target</h3><p>new.target æ˜¯ ES6 æ–°å¼•å…¥çš„å±æ€§ï¼Œæ™®é€šå‡½æ•°å¦‚æœé€šè¿‡ new è°ƒç”¨ï¼Œnew.target ä¼šè¿”å›è¯¥å‡½æ•°çš„å¼•ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cat</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">new</span>.target)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> Cat() <span class="comment">// Æ’ Cat() &#123; console.log(new.target); &#125;</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å±æ€§ä¸»è¦ï¼šç”¨äºç¡®å®šæ„é€ å‡½æ•°æ˜¯å¦ä¸º new è°ƒç”¨çš„ã€‚</p>
<p>ç®­å¤´å‡½æ•°çš„ this æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šå‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">new</span>.target)</span><br><span class="line">&#125;</span><br><span class="line">a() <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">new</span>.target) <span class="comment">// æŠ¥é”™ï¼šUncaught SyntaxError: new.target expression is not allowed here</span></span><br><span class="line">&#125;</span><br><span class="line">b()</span><br></pre></td></tr></table></figure>

<h3 id="æ²¡æœ‰åŸå‹"><a href="#æ²¡æœ‰åŸå‹" class="headerlink" title="æ²¡æœ‰åŸå‹"></a>æ²¡æœ‰åŸå‹</h3><p>ç”±äºä¸èƒ½é€šè¿‡ new å…³é”®å­—è°ƒç”¨ï¼Œä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°ä¸å­˜åœ¨ prototype è¿™ä¸ªå±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(func.prototype) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="æ²¡æœ‰-super"><a href="#æ²¡æœ‰-super" class="headerlink" title="æ²¡æœ‰ super"></a>æ²¡æœ‰ super</h3><p>ç®­å¤´å‡½æ•°æ²¡æœ‰åŸå‹ï¼Œæ•…ä¹Ÿä¸èƒ½é€šè¿‡ super æ¥è®¿é—®åŸå‹çš„å±æ€§ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°ä¹Ÿæ˜¯æ²¡æœ‰ super çš„ã€‚åŒ thisã€argumentsã€new.target ä¸€æ ·ï¼Œè¿™äº›å€¼ç”±å¤–å›´æœ€è¿‘ä¸€å±‚éç®­å¤´å‡½æ•°å†³å®šã€‚</p>
<h3 id="call-apply-bind-æ–¹æ³•æ— æ³•æ”¹å˜ç®­å¤´å‡½æ•°ä¸­-this-çš„æŒ‡å‘"><a href="#call-apply-bind-æ–¹æ³•æ— æ³•æ”¹å˜ç®­å¤´å‡½æ•°ä¸­-this-çš„æŒ‡å‘" class="headerlink" title="call/apply/bind æ–¹æ³•æ— æ³•æ”¹å˜ç®­å¤´å‡½æ•°ä¸­ this çš„æŒ‡å‘"></a>call/apply/bind æ–¹æ³•æ— æ³•æ”¹å˜ç®­å¤´å‡½æ•°ä¸­ this çš„æŒ‡å‘</h3><p>call()ã€apply()ã€bind()æ–¹æ³•çš„å…±åŒç‰¹ç‚¹æ˜¯å¯ä»¥æ”¹å˜ this çš„æŒ‡å‘ï¼Œç”¨æ¥åŠ¨æ€ä¿®æ”¹å‡½æ•°æ‰§è¡Œæ—¶ this çš„æŒ‡å‘ã€‚ä½†ç”±äºç®­å¤´å‡½æ•°çš„ this å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šäº†ä¸”ä¸ä¼šæ”¹å˜ã€‚æ‰€ä»¥è¿™ä¸‰ä¸ªæ–¹æ³•æ°¸è¿œä¹Ÿæ”¹å˜ä¸äº†ç®­å¤´å‡½æ•° this çš„æŒ‡å‘ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'global name'</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°å®šä¹‰åœ¨å…¨å±€ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func() <span class="comment">// global name</span></span><br><span class="line"><span class="comment">// thisçš„æŒ‡å‘ä¸ä¼šæ”¹å˜ï¼Œæ°¸è¿œæŒ‡å‘Windowå¯¹è±¡,æ”¾åˆ°åˆ°windowä¸‹çš„å…¨å±€å˜é‡</span></span><br><span class="line">func.call(obj) <span class="comment">// global name</span></span><br><span class="line">func.apply(obj) <span class="comment">// global name</span></span><br><span class="line">func.bind(obj)() <span class="comment">// global name</span></span><br></pre></td></tr></table></figure>

<h3 id="ç®­å¤´å‡½æ•°çš„è§£æé¡ºåºç›¸å¯¹é å‰"><a href="#ç®­å¤´å‡½æ•°çš„è§£æé¡ºåºç›¸å¯¹é å‰" class="headerlink" title="ç®­å¤´å‡½æ•°çš„è§£æé¡ºåºç›¸å¯¹é å‰"></a>ç®­å¤´å‡½æ•°çš„è§£æé¡ºåºç›¸å¯¹é å‰</h3><p>è™½ç„¶ç®­å¤´å‡½æ•°ä¸­çš„ç®­å¤´ä¸æ˜¯è¿ç®—ç¬¦ï¼Œä½†ç®­å¤´å‡½æ•°å…·æœ‰ä¸å¸¸è§„å‡½æ•°ä¸åŒçš„ç‰¹æ®Šè¿ç®—ç¬¦ä¼˜å…ˆçº§è§£æè§„åˆ™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> callback;</span><br><span class="line"></span><br><span class="line">callback = callback || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;; <span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line">callback = callback || <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line"><span class="comment">// SyntaxError:éæ³•ç®­å¤´å‡½æ•°å±æ€§</span></span><br><span class="line"></span><br><span class="line">callback = callback || <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;&#125;);    <span class="comment">// ok</span></span><br></pre></td></tr></table></figure>

<h3 id="ç®­å¤´å‡½æ•°ä¸æ”¯æŒé‡åå‚æ•°"><a href="#ç®­å¤´å‡½æ•°ä¸æ”¯æŒé‡åå‚æ•°" class="headerlink" title="ç®­å¤´å‡½æ•°ä¸æ”¯æŒé‡åå‚æ•°"></a>ç®­å¤´å‡½æ•°ä¸æ”¯æŒé‡åå‚æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, a</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, <span class="built_in">arguments</span>) <span class="comment">// 2 Arguments(2)Â [1, 2, callee: Æ’, Symbol(Symbol.iterator): Æ’]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> boo = <span class="function">(<span class="params">a, a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç›´æ¥æŠ¥é”™ï¼šUncaught SyntaxError: Duplicate parameter name not allowed in this context</span></span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">boo(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="1-ä½¿ç”¨-yield-å…³é”®å­—"><a href="#1-ä½¿ç”¨-yield-å…³é”®å­—" class="headerlink" title="1 ä½¿ç”¨ yield å…³é”®å­—"></a>1 ä½¿ç”¨ yield å…³é”®å­—</h3><p>yield å…³é”®å­—é€šå¸¸ä¸èƒ½åœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ï¼ˆé™¤éæ˜¯åµŒå¥—åœ¨å…è®¸ä½¿ç”¨çš„å‡½æ•°å†…ï¼‰ã€‚å› æ­¤ï¼Œç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œç”Ÿæˆå™¨ï¼ˆ Generator ï¼‰ã€‚</p>
<h2 id="ç®­å¤´å‡½æ•°ä¸é€‚ç”¨çš„åœºæ™¯"><a href="#ç®­å¤´å‡½æ•°ä¸é€‚ç”¨çš„åœºæ™¯" class="headerlink" title="ç®­å¤´å‡½æ•°ä¸é€‚ç”¨çš„åœºæ™¯"></a>ç®­å¤´å‡½æ•°ä¸é€‚ç”¨çš„åœºæ™¯</h2><p><strong>1.ä¸åº”è¢«ç”¨åœ¨å®šä¹‰å¯¹è±¡çš„æ–¹æ³•ä¸Š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  x: <span class="number">10</span>,</span><br><span class="line">  b: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.x, <span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  c: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.x, <span class="keyword">this</span>),</span><br><span class="line">&#125;</span><br><span class="line">obj.b() <span class="comment">// 10  &#123;x: 10, b: Æ’, c: Æ’&#125;</span></span><br><span class="line"></span><br><span class="line">obj.c() <span class="comment">// undefined Window</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºå®ƒå†…éƒ¨ this çš„æŒ‡å‘åŸå› ï¼Œå½“ä½¿ç”¨ obj.c()çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ› c æ–¹æ³•é‡Œé¢çš„ this æŒ‡å‘ objï¼Œä½†æ˜¯å®ƒå´æŒ‡å‘äº† obj æ‰€åœ¨ä¸Šä¸‹æ–‡ä¸­çš„ thisï¼ˆå³ windowï¼‰ï¼Œè¿èƒŒäº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°ä¸é€‚åˆä½œä¸ºå¯¹è±¡çš„æ–¹æ³•ã€‚</p>
<p><strong>2.å…·æœ‰åŠ¨æ€ä¸Šä¸‹æ–‡çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¸åº”ä½¿ç”¨ç®­å¤´å‡½æ•°</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">&#125;);</span><br><span class="line">ä¸ºbtnçš„ç›‘å¬å‡½æ•°æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œå¯¼è‡´é‡Œé¢çš„<span class="keyword">this</span>å°±æ˜¯å…¨å±€å¯¹è±¡,è€Œä¸ç¬¦åˆæˆ‘ä»¬æƒ³æ“ä½œæŒ‰é’®æœ¬èº«çš„éœ€æ±‚ã€‚å¦‚æœæ”¹æˆæ™®é€šå‡½æ•°ï¼Œ<span class="keyword">this</span>å°±ä¼šåŠ¨æ€æŒ‡å‘è¢«ç‚¹å‡»çš„æŒ‰é’®å¯¹è±¡</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å‰é¢ä¸¤ç‚¹ï¼Œå‰©ä¸‹çš„è·Ÿä¸Šé¢è®²çš„ä¸æ™®é€šå‡½æ•°çš„åŒºåˆ«é‡å¤äº†ï¼Œæ•…åªä½œæ€»ç»“ä¸è´´ä»£ç äº†:</p>
<ol>
<li>ä¸åº”è¢«ç”¨åœ¨å®šä¹‰å¯¹è±¡çš„æ–¹æ³•ä¸Š</li>
<li>å…·æœ‰åŠ¨æ€ä¸Šä¸‹æ–‡çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¸åº”ä½¿ç”¨ç®­å¤´å‡½æ•°</li>
<li>ä¸èƒ½åº”ç”¨åœ¨æ„é€ å‡½æ•°ä¸­</li>
<li>é¿å…åœ¨ prototype ä¸Šä½¿ç”¨</li>
<li>é¿å…åœ¨éœ€è¦ arguments ä¸Šä½¿ç”¨</li>
</ol>
]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>ç®­å¤´å‡½æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹æ¨¡æ¿å­—ç¬¦ä¸²</title>
    <url>/2020/01/05/ES6%E7%B3%BB%E5%88%97%E4%B9%8B%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    <content><![CDATA[<p>æ¨¡æ¿å­—ç¬¦ä¸²æ˜¯ES6ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§ä½¿å¾—å¤„ç†ç›¸å…³ä¸šåŠ¡å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
<a id="more"></a>
<h2 id="åŸºç¡€ç”¨æ³•"><a href="#åŸºç¡€ç”¨æ³•" class="headerlink" title="åŸºç¡€ç”¨æ³•"></a>åŸºç¡€ç”¨æ³•</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">`hello world`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// hello world</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œä¸æ˜¯åŒå¼•å·ï¼Œè€Œæ˜¯åæ’‡å·`</p>
<p>åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­ï¼Œè¿˜å¯ä»¥æ‹¼æ¥htmlå…ƒç´ ï¼ŒåŒæ—¶ç©ºæ ¼ã€ç¼©è¿›ã€æ¢è¡Œéƒ½ä¼šè¢«ä¿ç•™ï¼Œå¹¶ä¸”å¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ²¡æœ‰å£°æ˜ï¼Œå°†æŠ¥é”™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;ul&gt;</span></span><br><span class="line"><span class="string">            &lt;li&gt;11&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li&gt;22&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/1/5/16f75f81fdc039fd?w=283&h=118&f=png&s=3077" alt=""></p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>&lt;div&gt;</code>æ ‡ç­¾å‰é¢ä¼šæœ‰ä¸€ä¸ªæ¢è¡Œã€‚å¦‚æœä½ ä¸æƒ³è¦è¿™ä¸ªæ¢è¡Œï¼Œå¯ä»¥ä½¿ç”¨trimæ–¹æ³•æ¶ˆé™¤å®ƒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;ul&gt;</span></span><br><span class="line"><span class="string">            &lt;li&gt;11&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li&gt;22&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>.trim();</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2020/1/5/16f75fa6f941fbc2?w=285&h=115&f=png&s=3098" alt=""></p>
<p>åœ¨æ¨¡ç‰ˆå­—ç¬¦ä¸²å†…ä½¿ç”¨åå¼•å·`æ—¶ï¼Œéœ€è¦åœ¨å®ƒå‰é¢åŠ è½¬ä¹‰ç¬¦\</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">`hello \\n`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br></pre></td></tr></table></figure>

<h2 id="åµŒå…¥å˜é‡"><a href="#åµŒå…¥å˜é‡" class="headerlink" title="åµŒå…¥å˜é‡"></a>åµŒå…¥å˜é‡</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'jacky'</span>;</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">'æˆ‘å«'</span> + name + <span class="string">'ï¼Œå¤§å®¶å¥½'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str); <span class="comment">// æˆ‘å«jackyï¼Œå¤§å®¶å¥½</span></span><br></pre></td></tr></table></figure>
<p>å½“æœ‰å˜é‡å‚ä¸æ‹¼æ¥æ—¶ï¼ŒES5ä¸‹å¿…é¡»ç”¨+å·è¿™æ ·çš„å½¢å¼è¿›è¡Œæ‹¼æ¥ï¼Œè¿™æ ·å¾ˆéº»çƒ¦è€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ã€‚<br>ES6æ–°å¢äº†å­—ç¬¦ä¸²æ¨¡ç‰ˆï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™æ—¶å†å¼•ç”¨strå˜é‡å°±éœ€è¦ç”¨${name}è¿™ç§å½¢å¼äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'jacky'</span>;</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">'æˆ‘å«$&#123;name&#125;ï¼Œå¤§å®¶å¥½'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str); <span class="comment">// æˆ‘å«jackyï¼Œå¤§å®¶å¥½</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¤§æ‹¬å·å†…éƒ¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†ä¼šåŸæ ·è¾“å‡ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> world = <span class="string">'666'</span>;</span><br><span class="line"><span class="keyword">let</span> a = <span class="string">`hello <span class="subst">$&#123;<span class="string">'world'</span>&#125;</span>`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// hello world</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯¹è¿ç®—çš„æ”¯æŒ"><a href="#å¯¹è¿ç®—çš„æ”¯æŒ" class="headerlink" title="å¯¹è¿ç®—çš„æ”¯æŒ"></a>å¯¹è¿ç®—çš„æ”¯æŒ</h2><p>åœ¨${}é‡Œé¢ï¼Œå¯ä»¥å†™ä»»æ„çš„JSè¡¨è¾¾å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨å®ƒè¿›è¡Œè¿ç®—</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> c = <span class="string">`<span class="subst">$&#123;a+b&#125;</span>`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;obj.x + obj.y&#125;</span>`</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h2 id="æ¨¡æ¿å­—ç¬¦ä¸²è°ƒç”¨å‡½æ•°"><a href="#æ¨¡æ¿å­—ç¬¦ä¸²è°ƒç”¨å‡½æ•°" class="headerlink" title="æ¨¡æ¿å­—ç¬¦ä¸²è°ƒç”¨å‡½æ•°"></a>æ¨¡æ¿å­—ç¬¦ä¸²è°ƒç”¨å‡½æ•°</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`foo <span class="subst">$&#123;fn()&#125;</span> bar`</span>); <span class="comment">// foo Hello World bar</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹å˜é‡çš„è§£æ„èµ‹å€¼</title>
    <url>/2020/01/04/ES6%E7%B3%BB%E5%88%97%E4%B9%8B%E5%8F%98%E9%87%8F%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC/</url>
    <content><![CDATA[<p>è§£æ„èµ‹å€¼åœ¨å¼€å‘ä¸­å¾ˆå¸¸ç”¨ï¼Œåœ¨æ­¤æ€»ç»“å®ƒçš„ç”¨æ³•â€¦</p>
<a id="more"></a>

<h2 id="ä»€ä¹ˆæ˜¯è§£æ„ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è§£æ„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è§£æ„ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è§£æ„ï¼Ÿ</h2><p>ES6 å…è®¸æŒ‰ç…§ä¸€å®šæ¨¡å¼ï¼Œä»æ•°ç»„å’Œå¯¹è±¡ä¸­æå–å€¼ï¼Œå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œè¿™è¢«ç§°ä¸ºè§£æ„ã€‚å®ƒåœ¨è¯­æ³•ä¸Šæ¯” ES5 æ‰€æä¾›çš„æ›´åŠ ç®€æ´ã€ç´§å‡‘ã€æ¸…æ™°ã€‚å®ƒä¸ä»…èƒ½å‡å°‘ä½ çš„ä»£ç é‡ï¼Œè¿˜èƒ½ä»æ ¹æœ¬ä¸Šæ”¹å˜ä½ çš„ç¼–ç æ–¹å¼ã€‚</p>
<h2 id="æ•°ç»„è§£æ„"><a href="#æ•°ç»„è§£æ„" class="headerlink" title="æ•°ç»„è§£æ„"></a>æ•°ç»„è§£æ„</h2><p>ä»¥å‰ï¼Œä¸ºå˜é‡èµ‹å€¼ï¼Œæˆ‘ä»¬åªèƒ½ç›´æ¥æŒ‡å®šå€¼ï¼Œæ¯”å¦‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¯ä»¥ç”¨æ•°ç»„è§£æ„çš„æ–¹å¼æ¥è¿›è¡Œèµ‹å€¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, b, c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c) <span class="comment">// 1, 2, 3</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æ•°ç»„è§£æ„æœ€åŸºæœ¬ç±»å‹çš„ç”¨æ³•ï¼Œè¿˜å¯ä»¥è§£æ„å¯¹è±¡æ•°ç»„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹è±¡æ•°ç»„è§£æ„</span></span><br><span class="line"><span class="keyword">let</span> [a, b, c] = [&#123; <span class="attr">name</span>: <span class="string">'jacky'</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'monkey'</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'houge'</span> &#125;]</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c) <span class="comment">// &#123;name: 'jacky'&#125;, &#123;name: 'monkey'&#125;, &#123;name: 'houge'&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°ç»„æ¨¡å¼å’Œèµ‹å€¼æ¨¡å¼ç»Ÿä¸€"><a href="#æ•°ç»„æ¨¡å¼å’Œèµ‹å€¼æ¨¡å¼ç»Ÿä¸€" class="headerlink" title="æ•°ç»„æ¨¡å¼å’Œèµ‹å€¼æ¨¡å¼ç»Ÿä¸€"></a>æ•°ç»„æ¨¡å¼å’Œèµ‹å€¼æ¨¡å¼ç»Ÿä¸€</h2><p>è¿™æ¡å¯ä»¥ç†è§£ä¸ºç­‰å·å·¦è¾¹å’Œç­‰å·å³è¾¹çš„å½¢å¼è¦ç»Ÿä¸€ï¼Œå¦‚æœä¸ç»Ÿä¸€è§£æ„å°†å¤±è´¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, [b, c], d] = [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c, d) <span class="comment">// 1 2 3 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æå–é™¤ç¬¬äºŒã€ä¸‰ä¸ªå¤–çš„æ‰€æœ‰æ•°å€¼</span></span><br><span class="line"><span class="keyword">let</span> [a, , , d] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, d) <span class="comment">// 1 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, ...b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">// 1 [2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, , , ...d] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, d) <span class="comment">// 1 [4, 5]</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè§£æ„ä¸æˆåŠŸï¼Œå˜é‡çš„å€¼å°±ç­‰äº<code>undefined</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, b, c] = [<span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c) <span class="comment">// 2 3 undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [c] = []</span><br><span class="line"><span class="built_in">console</span>.log(c) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°æ˜¯å®Œå…¨è§£æ„çš„æƒ…å†µï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä¸å®Œå…¨è§£æ„ï¼Œå³ç­‰å·å·¦è¾¹çš„æ¨¡å¼ï¼ŒåªåŒ¹é…ä¸€éƒ¨åˆ†çš„ç­‰å·å³è¾¹çš„æ•°ç»„ï¼Œè§£æ„ä¾ç„¶å¯ä»¥æˆåŠŸã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [x, y] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(x, y) <span class="comment">// 1 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, [b], d] = [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, b, d) <span class="comment">// 1 2 4</span></span><br></pre></td></tr></table></figure>

<h2 id="è§£æ„çš„é»˜è®¤å€¼"><a href="#è§£æ„çš„é»˜è®¤å€¼" class="headerlink" title="è§£æ„çš„é»˜è®¤å€¼"></a>è§£æ„çš„é»˜è®¤å€¼</h2><p>è§£æ„èµ‹å€¼å…è®¸æŒ‡å®šé»˜è®¤å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, b = <span class="number">2</span>] = [<span class="number">1</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">// 1 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a = <span class="number">1</span>, b = <span class="number">2</span>, c, d = <span class="number">13</span>] = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c, d) <span class="comment">// 10 11 12 13</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯¹è±¡çš„è§£æ„èµ‹å€¼"><a href="#å¯¹è±¡çš„è§£æ„èµ‹å€¼" class="headerlink" title="å¯¹è±¡çš„è§£æ„èµ‹å€¼"></a>å¯¹è±¡çš„è§£æ„èµ‹å€¼</h2><p>å¯¹è±¡çš„è§£æ„ä¸æ•°ç»„æœ‰ä¸€ä¸ªé‡è¦çš„ä¸åŒã€‚æ•°ç»„çš„å…ƒç´ æ˜¯æŒ‰æ¬¡åºæ’åˆ—çš„ï¼Œå˜é‡çš„å–å€¼ç”±å®ƒçš„ä½ç½®å†³å®šï¼›è€Œå¯¹è±¡çš„å±æ€§æ²¡æœ‰æ¬¡åºï¼Œå˜é‡å¿…é¡»ä¸å±æ€§åŒåï¼Œæ‰èƒ½å–åˆ°æ­£ç¡®çš„å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹è±¡è§£æ„èµ‹å€¼çš„å†…éƒ¨æœºåˆ¶ï¼Œæ˜¯å…ˆæ‰¾åˆ°åŒåå±æ€§ï¼Œç„¶åå†èµ‹ç»™å¯¹åº”çš„å˜é‡ã€‚çœŸæ­£è¢«èµ‹å€¼çš„æ˜¯åè€…ï¼Œè€Œéå‰è€…ã€‚</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">a</span>: <span class="string">'aaa'</span>, <span class="attr">b</span>: <span class="string">'bbb'</span> &#125;</span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">a</span>: x, <span class="attr">b</span>: y &#125; = obj</span><br><span class="line"><span class="built_in">console</span>.log(x, y) <span class="comment">// aaa bbb</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; a, b &#125; = &#123; <span class="attr">a</span>: <span class="string">'aaa'</span>, <span class="attr">b</span>: <span class="string">'bbb'</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">// aaa bbb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸æŒ‰ç…§é¡ºåº</span></span><br><span class="line"><span class="keyword">let</span> &#123; b, a &#125; = &#123; <span class="attr">a</span>: <span class="string">'test1'</span>, <span class="attr">b</span>: <span class="string">'test2'</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">// test1 test2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åµŒå¥—è§£æ„</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  obj: &#123; name &#125;,</span><br><span class="line">&#125; = &#123; <span class="attr">obj</span>: &#123; <span class="attr">name</span>: <span class="string">'jacky'</span>, <span class="attr">age</span>: <span class="string">'22'</span> &#125; &#125;</span><br><span class="line"><span class="built_in">console</span>.log(name) <span class="comment">// jacky</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¨å¾®å¤æ‚çš„åµŒå¥—</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  p: [<span class="string">'Hello'</span>, &#123; <span class="attr">y</span>: <span class="string">'World'</span> &#125;],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  p: [x, &#123; y &#125;],</span><br><span class="line">&#125; = obj</span><br><span class="line"><span class="built_in">console</span>.log(x, y) <span class="comment">// Hello World</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå˜é‡åä¸å±æ€§åä¸ä¸€è‡´ï¼Œå¿…é¡»å†™æˆä¸‹é¢è¿™æ ·ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> &#123; <span class="attr">foo</span>: rename &#125; = &#123; <span class="attr">foo</span>: <span class="string">'aaa'</span>, <span class="attr">bar</span>: <span class="string">'bbb'</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(rename) <span class="comment">// aaa</span></span><br><span class="line"><span class="built_in">console</span>.log(foo) <span class="comment">// Uncaught ReferenceError: foo is not defined</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨è§£æ„ä¹‹å‰å°±å®šä¹‰äº†å˜é‡ï¼Œè¿™æ—¶å€™å†è§£æ„ä¼šå‡ºç°é—®é¢˜ã€‚ä¸‹é¢æ˜¯é”™è¯¯çš„ä»£ç ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ï¼ˆå› ä¸º js å¼•æ“ä¼šå°†{a}ç†è§£æˆä¸€ä¸ªä»£ç å—ï¼Œä»è€Œå‘ç”Ÿè¯­æ³•é”™è¯¯ã€‚åªæœ‰ä¸å°†å¤§æ‹¬å·å†™åœ¨è¡Œé¦–ï¼Œé¿å… js å°†å…¶è§£é‡Šæˆä»£ç å—ï¼Œæ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">a</span>: <span class="string">"aaa"</span> &#125;;</span><br><span class="line">&#123;a&#125; = obj; <span class="comment">// Uncaught SyntaxError: Unexpected token '='</span></span><br></pre></td></tr></table></figure>

<p>è¦è§£å†³æŠ¥é”™ï¼Œä½¿ç¨‹åºæ­£å¸¸ï¼Œè¿™æ—¶å€™åªè¦åœ¨è§£æ„çš„è¯­å¥å¤–è¾¹åŠ ä¸€ä¸ªåœ†æ‹¬å·å°±å¯ä»¥äº†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a</span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">a</span>: <span class="string">'aaa'</span> &#125;</span><br><span class="line">;(&#123; a &#125; = obj)</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// aaa</span></span><br></pre></td></tr></table></figure>

<h2 id="å‡½æ•°å‚æ•°"><a href="#å‡½æ•°å‚æ•°" class="headerlink" title="å‡½æ•°å‚æ•°"></a>å‡½æ•°å‚æ•°</h2><p>å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">[x, y]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add([<span class="number">1</span>, <span class="number">2</span>]) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å‚æ•°çš„è§£æ„ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">x, y = <span class="number">7</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn(<span class="number">3</span>)) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>

<h2 id="å­—ç¬¦ä¸²è§£æ„"><a href="#å­—ç¬¦ä¸²è§£æ„" class="headerlink" title="å­—ç¬¦ä¸²è§£æ„"></a>å­—ç¬¦ä¸²è§£æ„</h2><p>å­—ç¬¦ä¸²è¢«è½¬æ¢æˆäº†ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [a, b, c, d, e, f] = <span class="string">'hello'</span></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">//h</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">//e</span></span><br><span class="line"><span class="built_in">console</span>.log(c) <span class="comment">//l</span></span><br><span class="line"><span class="built_in">console</span>.log(d) <span class="comment">//l</span></span><br><span class="line"><span class="built_in">console</span>.log(e) <span class="comment">//o</span></span><br><span class="line"><span class="built_in">console</span>.log(f) <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼"><a href="#æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼" class="headerlink" title="æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼"></a>æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼</h2><p>è§£æ„èµ‹å€¼æ—¶ï¼Œå¦‚æœç­‰å·å³è¾¹æ˜¯æ•°å€¼å’Œå¸ƒå°”å€¼ï¼Œåˆ™ä¼šå…ˆè½¬ä¸ºå¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; <span class="attr">toString</span>: s &#125; = <span class="number">0</span></span><br><span class="line"><span class="built_in">console</span>.log(s === <span class="built_in">Number</span>.prototype.toString) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">toString</span>: s &#125; = <span class="literal">true</span></span><br><span class="line"><span class="built_in">console</span>.log(s === <span class="built_in">Boolean</span>.prototype.toString) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>è§£æ„èµ‹å€¼çš„è§„åˆ™æ˜¯ï¼Œåªè¦ç­‰å·å³è¾¹çš„å€¼ä¸æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±å…ˆå°†å…¶è½¬ä¸ºå¯¹è±¡ã€‚ç”±äº<code>undefined</code>å’Œ<code>null</code>æ— æ³•è½¬ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬è¿›è¡Œè§£æ„èµ‹å€¼ï¼Œéƒ½ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; <span class="attr">prop</span>: x &#125; = <span class="literal">undefined</span> <span class="comment">// TypeError</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">prop</span>: y &#125; = <span class="literal">null</span> <span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure>

<h2 id="è§£æ„èµ‹å€¼çš„åº”ç”¨"><a href="#è§£æ„èµ‹å€¼çš„åº”ç”¨" class="headerlink" title="è§£æ„èµ‹å€¼çš„åº”ç”¨"></a>è§£æ„èµ‹å€¼çš„åº”ç”¨</h2><h3 id="äº¤æ¢å˜é‡çš„å€¼"><a href="#äº¤æ¢å˜é‡çš„å€¼" class="headerlink" title="äº¤æ¢å˜é‡çš„å€¼"></a>äº¤æ¢å˜é‡çš„å€¼</h3><p>é€šå¸¸äº¤æ¢ä¸¤ä¸ªå˜é‡çš„æ–¹æ³•éœ€è¦ä¸€ä¸ªé¢å¤–çš„ä¸´æ—¶å˜é‡,å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> temp</span><br><span class="line"></span><br><span class="line">temp = a</span><br><span class="line">a = b</span><br><span class="line">b = temp</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">// 2 1</span></span><br></pre></td></tr></table></figure>

<p>ç”¨ ES6 è§£æ„èµ‹å€¼çš„è¯ï¼Œä¼šå˜å¾—å¾ˆç®€æ´</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span></span><br><span class="line">;[a, b] = [b, a]</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">// 2 1</span></span><br></pre></td></tr></table></figure>

<h3 id="ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼"><a href="#ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼" class="headerlink" title="ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼"></a>ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼</h3><p>å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœè¦è¿”å›å¤šä¸ªå€¼ï¼Œåªèƒ½å°†å®ƒä»¬æ”¾åœ¨æ•°ç»„æˆ–å¯¹è±¡é‡Œè¿”å›ã€‚æœ‰äº†è§£æ„èµ‹å€¼ï¼Œå–å‡ºè¿™äº›å€¼å°±éå¸¸æ–¹ä¾¿ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> [a, b, c] = example()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    foo: <span class="number">1</span>,</span><br><span class="line">    bar: <span class="number">2</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123; foo, bar &#125; = example()</span><br></pre></td></tr></table></figure>

<h3 id="è®¿é—®æ•°ç»„ä¸­å…ƒç´ "><a href="#è®¿é—®æ•°ç»„ä¸­å…ƒç´ " class="headerlink" title="è®¿é—®æ•°ç»„ä¸­å…ƒç´ "></a>è®¿é—®æ•°ç»„ä¸­å…ƒç´ </h3><p>æœ‰ç§åœºæ™¯ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªæ•°ç»„ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰ã€‚å¹¶ä¸”å¸Œæœ›è®¿é—®æ•°ç»„çš„ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªæˆ–ç¬¬ n ä¸ªé¡¹ï¼Œä½†å¦‚æœè¯¥é¡¹ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨æŒ‡å®šé»˜è®¤å€¼ã€‚<br>é€šå¸¸ä¼šä½¿ç”¨æ•°ç»„çš„<code>length</code>å±æ€§æ¥åˆ¤æ–­</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> firstItem = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">if</span> (list.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  firstItem = list[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(firstItem) <span class="comment">// hello</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨ ES6 è§£æ„èµ‹å€¼æ¥å®ç°ä¸Šè¿°é€»è¾‘</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> list = []</span><br><span class="line"><span class="keyword">const</span> [firstItem = <span class="string">'hello'</span>] = list</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(firstItem) <span class="comment">// 'hello'</span></span><br></pre></td></tr></table></figure>

<h3 id="æå–-JSON-æ•°æ®"><a href="#æå–-JSON-æ•°æ®" class="headerlink" title="æå– JSON æ•°æ®"></a>æå– JSON æ•°æ®</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> jsonData = &#123;</span><br><span class="line">  id: <span class="number">42</span>,</span><br><span class="line">  status: <span class="string">'OK'</span>,</span><br><span class="line">  data: [<span class="number">867</span>, <span class="number">5309</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; id, status, <span class="attr">data</span>: number &#125; = jsonData</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(id, status, number)</span><br><span class="line"><span class="comment">// 42, "OK", [867, 5309]</span></span><br></pre></td></tr></table></figure>

<h3 id="éå†-Map-ç»“æ„"><a href="#éå†-Map-ç»“æ„" class="headerlink" title="éå† Map ç»“æ„"></a>éå† Map ç»“æ„</h3><p>ä»»ä½•éƒ¨ç½²äº† Iterator æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ç”¨<code>for...of</code>å¾ªç¯éå†ã€‚Map ç»“æ„åŸç”Ÿæ”¯æŒ Iterator æ¥å£ï¼Œé…åˆå˜é‡çš„è§£æ„èµ‹å€¼ï¼Œè·å–é”®åå’Œé”®å€¼å°±éå¸¸æ–¹ä¾¿ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">map.set(<span class="string">'first'</span>, <span class="string">'hello'</span>)</span><br><span class="line">map.set(<span class="string">'second'</span>, <span class="string">'world'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key + <span class="string">' is '</span> + value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// first is hello</span></span><br><span class="line"><span class="comment">// second is world</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœåªæƒ³è·å–é”®åï¼Œæˆ–è€…åªæƒ³è·å–é”®å€¼ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–é”®å</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–é”®å€¼</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ–‡ç« éƒ¨åˆ†å†…å®¹å‚è€ƒï¼šé˜®ä¸€å³°è€å¸ˆçš„ã€ŠECMAScript 6 å…¥é—¨ã€‹ä¸€ä¹¦</li>
</ul>
]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>è§£æ„èµ‹å€¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ç³»åˆ—ä¹‹letå’Œconstä¸varçš„åŒºåˆ«</title>
    <url>/2019/12/28/ES6%E7%B3%BB%E5%88%97%E4%B9%8Blet%E5%92%8Cconst%E4%B8%8Evar%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>ES6è§„èŒƒæ–°å¢äº†letã€constä¸¤ç§å˜é‡å£°æ˜æ–¹å¼ï¼Œé¡¹ç›®ä¸­ä¹Ÿç»å¸¸è¦ç”¨åˆ°ï¼Œä»Šå¤©å€Ÿç€æ¸©ä¹ ES6è¯­æ³•ï¼Œæ¥æ€»ç»“let ã€constã€varçš„åŒºåˆ«ã€‚</p>
<a id="more"></a>

<h2 id="å˜é‡æå‡"><a href="#å˜é‡æå‡" class="headerlink" title="å˜é‡æå‡"></a>å˜é‡æå‡</h2><p>æ¥çœ‹ä¸‹é¢ä¸‰æ®µä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// Uncaught ReferenceError: b is not defined</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// Uncaught ReferenceError: c is not defined</span></span><br><span class="line"><span class="keyword">const</span> c = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>ç”¨varå£°æ˜çš„å˜é‡ï¼Œä¼šåœ¨å…¶ä½œç”¨åŸŸä¸­å‘ç”Ÿå˜é‡æå‡ï¼Œjsé»˜è®¤ç»™å˜é‡ä¸€ä¸ªundefinedå€¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ES6ä¸­ä½¿ç”¨let/constå£°æ˜çš„å˜é‡ï¼Œä¸å­˜åœ¨å˜é‡æå‡è¿‡ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½¿ç”¨let/constå£°æ˜çš„å˜é‡ï¼Œå£°æ˜å‰è®¿é—®å®ƒï¼Œéƒ½ä¼šæŠ¥é”™ã€‚</p>
<h2 id="æš‚æ—¶æ€§æ­»åŒº"><a href="#æš‚æ—¶æ€§æ­»åŒº" class="headerlink" title="æš‚æ—¶æ€§æ­»åŒº"></a>æš‚æ—¶æ€§æ­»åŒº</h2><blockquote>
<p>ä»£ç å—å†…ï¼Œä½¿ç”¨letå‘½ä»¤å£°æ˜å˜é‡ä¹‹å‰ï¼Œè¯¥å˜é‡éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚è¿™åœ¨è¯­æ³•ä¸Šï¼Œç§°ä¸ºâ€œæš‚æ—¶æ€§æ­»åŒºâ€ï¼ˆtemporal dead zoneï¼Œç®€ç§° TDZï¼‰ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">'global'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    a = <span class="string">'block'</span>;    <span class="comment">// Uncaught ReferenceError: a is not defined</span></span><br><span class="line">    <span class="keyword">let</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œifä»£ç å—é‡Œï¼Œåœ¨letå£°æ˜å˜é‡aä¹‹å‰ï¼Œéƒ½æ˜¯açš„â€æš‚æ—¶æ€§æ­»åŒºâ€,åœ¨è¯¥èŒƒå›´å†…è®¿é—®aéƒ½ä¼šæŠ¥é”™ã€‚<br>ç”±æ­¤å¯è§ï¼Œå—çº§ä½œç”¨åŸŸå†…å­˜åœ¨letå£°æ˜çš„è¯ï¼Œå®ƒæ‰€å£°æ˜çš„å˜é‡å°±ç»‘å®šåœ¨è¿™ä¸ªå—çº§ä½œç”¨åŸŸï¼Œä¸å†å—å¤–éƒ¨å½±å“ã€‚</p>
<h2 id="é‡å¤å£°æ˜"><a href="#é‡å¤å£°æ˜" class="headerlink" title="é‡å¤å£°æ˜"></a>é‡å¤å£°æ˜</h2><p>let å’Œ const å‘½ä»¤å£°æ˜çš„å˜é‡ä¸å…è®¸é‡å¤å£°æ˜ï¼›è€Œä½¿ç”¨varå£°æ˜å˜é‡ï¼Œå¯ä»¥å¤šæ¬¡é‡å¤å£°æ˜ä¸€ä¸ªåŒåå˜é‡ï¼Œä½†æœ€ç»ˆå˜é‡çš„å€¼ä¸ºæœ€åä¸€æ¬¡å£°æ˜èµ‹å€¼çš„ç»“æœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'abc'</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'last value'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);  <span class="comment">// last value</span></span><br></pre></td></tr></table></figure>

<p>letä¸conståœ¨ç›¸åŒä½œç”¨åŸŸå£°æ˜é‡å¤çš„å˜é‡ä¼šæŠ¥é”™</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">20</span>; <span class="comment">// Uncaught SyntaxError: Identifier 'a' has already been declared</span></span><br></pre></td></tr></table></figure>
<p>varå’ŒletåŒæ—¶å£°æ˜åŒä¸€ä¸ªå˜é‡ï¼Œä¹Ÿæ˜¯æŠ¥åŒæ ·çš„é”™è¯¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">20</span>; <span class="comment">// Uncaught SyntaxError: Identifier 'b' has already been declared</span></span><br></pre></td></tr></table></figure>
<p>æˆ–å…ˆvarï¼Œå†let</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> c = <span class="number">20</span>; <span class="comment">// Uncaught SyntaxError: Identifier 'c' has already been declared</span></span><br></pre></td></tr></table></figure>

<h2 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h2><p>è¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€ä¸ªæœ€ç»å…¸çš„é—®é¢˜ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123; </span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(i); <span class="comment">// 5 5 5 5 5 </span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªé—®é¢˜çš„è§£å†³å¯ä»¥ä½¿ç”¨é—­åŒ…ç­‰ï¼ŒES6çš„letä¸ºè¿™ä¸ªé—®é¢˜æä¾›äº†æ–°çš„è§£å†³æ–¹æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123; </span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(i); <span class="comment">// 0 1 2 3 4</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨letå£°æ˜çš„å˜é‡ä»…åœ¨å—çº§ä½œç”¨åŸŸå†…æœ‰æ•ˆã€‚ iåœ¨å¾ªç¯ä½“å†…çš„å±€éƒ¨ä½œç”¨åŸŸï¼Œä¸å—å¤–ç•Œå½±å“ã€‚</p>
<p>åœ¨ES6ä¹‹å‰ï¼Œéƒ½æ˜¯ç”¨varæ¥å£°æ˜å˜é‡ï¼Œè€Œä¸”JSåªæœ‰å‡½æ•°ä½œç”¨åŸŸå’Œå…¨å±€ä½œç”¨åŸŸï¼Œæ²¡æœ‰å—çº§ä½œç”¨åŸŸï¼Œæ‰€ä»¥èŠ±æ‹¬å·{}é™å®šä¸äº†varå£°æ˜å˜é‡çš„è®¿é—®èŒƒå›´ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">console</span>.log(a);  <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">9</span>;     <span class="comment">// es6çš„let: bå˜é‡åªåœ¨èŠ±æ‹¬å·å†…æœ‰æ•ˆ</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">console</span>.log(b);  <span class="comment">// Uncaught ReferenceError: b is not defined</span></span><br></pre></td></tr></table></figure>

<h2 id="letã€constå£°æ˜çš„å…¨å±€å˜é‡ä¸ä¼šä½œä¸ºwindowå¯¹è±¡çš„ä¸€ä¸ªå±æ€§"><a href="#letã€constå£°æ˜çš„å…¨å±€å˜é‡ä¸ä¼šä½œä¸ºwindowå¯¹è±¡çš„ä¸€ä¸ªå±æ€§" class="headerlink" title="letã€constå£°æ˜çš„å…¨å±€å˜é‡ä¸ä¼šä½œä¸ºwindowå¯¹è±¡çš„ä¸€ä¸ªå±æ€§"></a>letã€constå£°æ˜çš„å…¨å±€å˜é‡ä¸ä¼šä½œä¸ºwindowå¯¹è±¡çš„ä¸€ä¸ªå±æ€§</h2><p>ä½¿ç”¨varå£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¼šè¢«JSè‡ªåŠ¨æ·»åŠ åœ¨å…¨å±€å¯¹è±¡windowä¸Šï¼Œä½†letå’Œconstä¸ä¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.b); <span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="number">30</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.c); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>



<h2 id="constå£°æ˜å¸¸é‡"><a href="#constå£°æ˜å¸¸é‡" class="headerlink" title="constå£°æ˜å¸¸é‡"></a>constå£°æ˜å¸¸é‡</h2><p>ç”±äºconstç”¨æ¥å£°æ˜å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå°±å¿…é¡»ç«‹å³åˆå§‹åŒ–ï¼Œè€Œä¸”å£°æ˜ä¹‹åå€¼ä¸èƒ½æ”¹å˜ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">10</span>;</span><br><span class="line">a = <span class="number">20</span>; <span class="comment">// Uncaught TypeError: Assignment to constant variable.</span></span><br></pre></td></tr></table></figure>

<p>å¸¸é‡çš„å€¼ä¸å˜ï¼Œå®é™…ä¸Šæ˜¯æŒ‡å¸¸é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€ä¸­æ‰€ä¿å­˜çš„æ•°æ®ä¸å¯æ›´æ”¹ã€‚</p>
<p>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆæ•°å€¼ï¼Œå­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œä»–ä»¬æœ¬èº«å…·ä½“çš„å€¼å°±ä¿å­˜åœ¨å¸¸é‡æ‰€æŒ‡å‘å¯¹åº”çš„æ ˆå†…å­˜åœ°å€ä¸­ï¼Œæ‰€ä»¥ä¿®æ”¹å€¼å°±ç­‰äºä¿®æ”¹æ ˆå†…å­˜åœ°å€ï¼Œè¿™æ˜¾ç„¶ä¸å…è®¸ä¼šæŠ¥é”™ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªå¸¸é‡çš„å€¼æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹å€¼ï¼Œé‚£ä¹ˆå¸¸é‡æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ï¼ˆå †å†…å­˜ï¼‰ä¸­å®é™…ä¿å­˜çš„æ˜¯æŒ‡å‘è¯¥å¼•ç”¨ç±»å‹å€¼çš„ä¸€ä¸ªæŒ‡é’ˆï¼ˆä¹Ÿå°±æ˜¯å¼•ç”¨ç±»å‹å€¼åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼‰ã€‚æ‰€ä»¥conståªèƒ½ä¿è¯è¯¥å¼•ç”¨ç±»å‹åœ°å€ä¸å˜ï¼Œä½†è¯¥åœ°å€ä¸­çš„å…·ä½“æ•°æ®æ˜¯å¯ä»¥å˜åŒ–çš„ã€‚</p>
<p>å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">obj.a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">// &#123;a: 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“objæŒ‡å‘äº†å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå³objä¸­ä¿å­˜çš„åœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼Œå³ä¼šæŠ¥é”™</span></span><br><span class="line">obj = &#123;&#125;;  <span class="comment">// Uncaught TypeError: Assignment to constant variable.</span></span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•æ­£ç¡®ä½¿ç”¨"><a href="#å¦‚ä½•æ­£ç¡®ä½¿ç”¨" class="headerlink" title="å¦‚ä½•æ­£ç¡®ä½¿ç”¨"></a>å¦‚ä½•æ­£ç¡®ä½¿ç”¨</h2><p>åœ¨å¼€å‘çš„æ—¶å€™ï¼Œå£°æ˜å˜é‡æˆ‘ä»¬åº”è¯¥å°‘ä½¿ç”¨varï¼Œé¿å…äº§ç”Ÿä¸å¿…è¦çš„å…¨å±€å˜é‡ã€‚å½“éœ€è¦æ”¹å˜å˜é‡çš„å€¼æ—¶å£°æ˜ç”¨letï¼Œå¯¹äºéœ€è¦å†™ä¿æŠ¤çš„å˜é‡æˆ–å®šä¹‰å¸¸é‡ä½¿ç”¨constã€‚</p>
]]></content>
      <categories>
        <category>ES6ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>swiperçˆ¶çº§å…ƒç´ å¤„äºéšè—çŠ¶æ€æ»šåŠ¨æ•ˆæœå¤±æ•ˆé—®é¢˜</title>
    <url>/2019/12/25/swiper%E7%88%B6%E7%BA%A7%E5%85%83%E7%B4%A0%E5%A4%84%E4%BA%8E%E9%9A%90%E8%97%8F%E7%8A%B6%E6%80%81%E6%BB%9A%E5%8A%A8%E6%95%88%E6%9E%9C%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨ vue-awesome-swiper çš„æ—¶å€™ï¼Œå®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½, ç‚¹å‡»é¡µé¢çš„ banner å›¾ï¼ˆBanner.vueï¼‰ï¼Œè¿›å…¥ä¸€ä¸ªå›¾ç‰‡ç”»å»Šï¼ˆGallary.vueï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹æ›´å¤šç›¸å…³çš„ç…§ç‰‡ï¼Œä½†å‘ç°è½®æ’­å›¾æ»šåŠ¨æ•ˆæœå¤±æ•ˆ,æœ¬æ–‡å°†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><a id="more"></a><p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3aa7f03be6109?w=432&h=764&f=gif&s=1825248" alt=""></p><p>åŸå› æ˜¯ï¼šä¸€å¼€å§‹ Gallay.vue çš„æ‰€æœ‰ç”¨ swiper æ§åˆ¶çš„å›¾ç‰‡å¤„äºéšè—çŠ¶æ€ï¼Œç›´åˆ°ç‚¹å‡»æ‰è¿›å…¥å›¾ç‰‡ç”»å»Šæ˜¾ç¤ºå›¾ç‰‡ã€‚swiper å…¶çˆ¶çº§å…ƒç´ å¤„äºéšè—çŠ¶æ€(display:none), ä¼šå¯¼è‡´ swiper åˆå§‹åŒ–å¤±è´¥, é¡µé¢ä¸­çš„æ»šåŠ¨æ•ˆæœå°±ä¼šæœ‰é—®é¢˜ã€‚</p><p>Gallary.vue çš„ç»“æ„</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> @<span class="attr">click</span>=<span class="string">"handleGallaryClick"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">:options</span>=<span class="string">"swiperOption"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swiper-slide</span> <span class="attr">v-for</span>=<span class="string">"(item, index) of imgs"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"swiper-img"</span> <span class="attr">:src</span>=<span class="string">"item"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">swiper-slide</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-pagination"</span> <span class="attr">slot</span>=<span class="string">"pagination"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ Gallary ç»„ä»¶éƒ½æ˜¯é€šè¿‡çˆ¶ç»„ä»¶ Banner çš„ v-show å€¼è®¾ç½®å¤„äºéšè—çŠ¶æ€</p><p>è§£å†³åŠæ³•ï¼š<br>é€šè¿‡ swiper çš„é…ç½®é¡¹ï¼š</p><blockquote><p>observer<br>å¯åŠ¨åŠ¨æ€æ£€æŸ¥å™¨(OB/è§‚ä¼—/è§‚çœ‹è€…)ï¼Œå½“æ”¹å˜ swiper çš„æ ·å¼ï¼ˆä¾‹å¦‚éšè—/æ˜¾ç¤ºï¼‰æˆ–è€…ä¿®æ”¹ swiper çš„å­å…ƒç´ æ—¶</p></blockquote><blockquote><p>observeParents<br>å°† observe åº”ç”¨äº Swiper çš„çˆ¶å…ƒç´ ã€‚å½“ Swiper çš„çˆ¶å…ƒç´ å˜åŒ–æ—¶ï¼Œä¾‹å¦‚ window.resizeï¼ŒSwiper æ›´æ–°ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        swiperOption: &#123;</span><br><span class="line">            pagination : &#123;</span><br><span class="line">                el: &#39;.swiper-pagination&#39;,</span><br><span class="line">                type: &#39;fraction&#39;</span><br><span class="line">            &#125;,</span><br><span class="line">            observeParents: true, &#x2F;&#x2F;ä¿®æ”¹swiperçš„çˆ¶å…ƒç´ æ—¶ï¼Œè‡ªåŠ¨åˆå§‹åŒ–swiper</span><br><span class="line">            observer: true   &#x2F;&#x2F;ä¿®æ”¹swiperè‡ªå·±æˆ–å­å…ƒç´ æ—¶ï¼Œè‡ªåŠ¨åˆå§‹åŒ–swiper</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3ab29259088a7?w=431&h=759&f=gif&s=974520" alt=""></p>]]></content>
      <categories>
        <category>Vue ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>swiper</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå®šä¹‰checkboxæ ·å¼</title>
    <url>/2019/12/14/%E8%87%AA%E5%AE%9A%E4%B9%89checkbox%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<p>ç”±äºåŸç”Ÿçš„checkboxæ ·å¼æ¯”è¾ƒéš¾çœ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸éœ€è¦æ”¹å†™å®ƒçš„æ ·å¼ï¼Œç¾åŒ–å¤é€‰æ¡†ï¼Œæ‰€ä»¥ä»Šå¤©æ€»ç»“ä¸‹è‡ªå®šä¹‰checkboxæ ·å¼çš„æ–¹æ³•</p>
<a id="more"></a>
<p>htmlæ–‡ä»¶</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox-inline"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">class</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"hobby"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"hobby"</span>&gt;</span>ç¾½æ¯›çƒ<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"checkmark"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox-inline"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">class</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"hobby"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"hobby"</span>&gt;</span>è·‘æ­¥<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"checkmark"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.checkbox-inline</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkmark</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hobby</span>&#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox-inline</span> <span class="selector-tag">input</span><span class="selector-pseudo">:checked</span> ~ <span class="selector-class">.checkmark</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#492c94</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox-inline</span> <span class="selector-tag">input</span><span class="selector-pseudo">:checked</span> ~ <span class="selector-class">.checkmark</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox-inline</span> <span class="selector-class">.checkmark</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border</span>: solid white;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">2px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">    <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå›¾ï¼ˆæœªé€‰ä¸­ä¸é€‰ä¸­å¯¹æ¯”ï¼‰ï¼š</p>
<p><img src="/images/custom-checkbox.png" alt="image.png"></p>
<p>é‡‡å–çš„åšæ³•æ˜¯</p>
<ol>
<li>å…ˆå°†åŸç”Ÿçš„checkboxæ ·å¼éšè—ï¼Œè®¾ç½®å®½é«˜ä¸º0ï¼Œä½¿å…¶éšè—ä¸å ä½ã€‚</li>
<li>åœ¨labelæ ‡ç­¾é‡Œé¢æ·»åŠ é¢å¤–çš„spanæ ‡ç­¾ï¼Œç”¨æ¥åšè‡ªå®šä¹‰æ ·å¼</li>
<li>æ·»åŠ ä¼ªå…ƒç´ ï¼Œåˆ©ç”¨css3çš„transformå±æ€§åšçŸ©å½¢æ—‹è½¬ï¼Œåšå‡ºæ‰“å‹¾çš„æ ·å¼ï¼Œå¹¶å°†å…¶éšè—ã€‚</li>
<li>å½“checkboxè¢«é€‰ä¸­æ—¶ï¼Œåˆ©ç”¨css3çš„é€‰æ‹©å™¨:checkedï¼ŒåŒ¹é…æ¯ä¸ªå·²è¢«é€‰ä¸­çš„ checkbox å…ƒç´ ï¼›å†ä½¿ç”¨å…„å¼Ÿé€‰æ‹©ç¬¦~ï¼ŒåŒ¹é…åˆ°åŒå±‚çº§checkmarkç±»ï¼Œå°±å¯ä»¥æ˜¾ç¤ºå’Œè§¦å‘è‡ªå®šä¹‰checkboxé€‰ä¸­çŠ¶æ€çš„æ ·å¼äº†</li>
</ol>
<p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œä¼ªå…ƒç´ å±äºä¸»å…ƒç´ çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ç‚¹å‡»ä¼ªå…ƒç´ è§¦å‘çš„æ˜¯ä¸»å…ƒç´ çš„clickäº‹ä»¶ã€‚</p>
]]></content>
      <categories>
        <category>CSSç³»åˆ—</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>vue-awesome-swiperä¿®æ”¹è½®æ’­å›¾paginationçš„é¢œè‰²</title>
    <url>/2019/12/12/vue-awesome-swiper%E4%BF%AE%E6%94%B9%E8%BD%AE%E6%92%AD%E5%9B%BEpagination%E7%9A%84%E9%A2%9C%E8%89%B2/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨ vue-awsome-swiper è½®æ’­å›¾çš„æ—¶å€™ï¼Œpagination å¤„äºå½“å‰é€‰ä¸­çŠ¶æ€é»˜è®¤æ˜¯è“è‰²ï¼Œä½†é€šè¿‡ä¿®æ”¹è¿™ä¸ªç±»å¹¶æ— æ³•æ”¹å˜å…¶èƒŒæ™¯é¢œè‰²â€¦</p><a id="more"></a><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">:options</span>=<span class="string">"swiperOption"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swiper-slide</span> <span class="attr">v-for</span>=<span class="string">"(item, index) of swiperList"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"swiper-img"</span> <span class="attr">:src</span>=<span class="string">"item.imgUrl"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">swiper-slide</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-pagination"</span> <span class="attr">slot</span>=<span class="string">"pagination"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/12/22/16f2bbbf5fbc739b?w=433&h=140&f=png&s=141401" alt=""></p><p>åŸå› æ˜¯ä¸º style è®¾ç½®äº† scoped ä»¥åï¼Œswiper åˆ†é¡µæ ·å¼å°±å¤±æ•ˆäº†ã€‚åˆ†é¡µæ˜¯åœ¨ mounted é‡Œåˆ›å»ºçš„ï¼Œæ­¤æ—¶åˆ›å»ºçš„ DOMï¼Œvue ä¸ä¼šå¸® swiper çš„ pagination åŠ ä¸Š scoped è‡ªå®šä¹‰å±æ€§ã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &gt;&gt;&gt; <span class="selector-class">.swiper-pagination-bullet-active</span></span><br><span class="line">    <span class="selector-tag">background</span>: <span class="selector-id">#ff0</span></span><br></pre></td></tr></table></figure><pre><code>.wrapper &gt;&gt;&gt; .swiper-pagination-bullet-active
è¡¨ç¤ºçš„æ˜¯åœ¨wrapperä¸‹æ‰€æœ‰å‡ºç°.swiper-pagination-bullet-active</code></pre><p>æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://user-gold-cdn.xitu.io/2019/12/22/16f2bc67d4dbfa0f?w=426&h=136&f=png&s=151132" alt=""></p>]]></content>
      <categories>
        <category>Vue ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>swiper</tag>
      </tags>
  </entry>
  <entry>
    <title>Vueå®ç°æ˜Ÿçº§è¯„ä»·æ•ˆæœ</title>
    <url>/2019/12/09/Vue%E5%AE%9E%E7%8E%B0%E6%98%9F%E7%BA%A7%E8%AF%84%E4%BB%B7%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<p>åœ¨åšåº—å®¶è¯„ä»·çš„æ—¶å€™ï¼Œå¸¸å¸¸ä¼šæœ‰æ˜Ÿçº§è¯„ä»·çš„æ•ˆæœï¼Œä»Šå¤©æ¥è¯•è¯•çœ‹æ€ä¹ˆå®ç°å®ƒâ€¦</p><a id="more"></a><p>æˆ‘ä»¬æŠŠæ˜Ÿçº§è¯„ä»·å•ç‹¬åšæˆä¸€ä¸ª Star ç»„ä»¶ï¼ŒæŠ½ç¦»å‡ºæ¥ï¼Œå…¶ä¸­çˆ¶ç»„ä»¶ä¸­å¼•å…¥(ä¼ å…¥çš„æ˜¯è¯„åˆ†çš„å€¼)</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"score"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Star</span> <span class="attr">:score</span>=<span class="string">"poiInfo.wm_poi_score"</span>&gt;</span><span class="tag">&lt;/<span class="name">Star</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆå§‹ Star.vue</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;star&quot;&gt;</span><br><span class="line">      &lt;span class&#x3D;&quot;star-item&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;span&gt;&#123;&#123; score &#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;Star&#39;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    score: Number,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬æŠŠè¦åšæ˜Ÿçº§å›¾ç‰‡ç”¨ç±»åä¸º star-item çš„ span æ ‡ç­¾å¾ªç¯å‡ºæ¥ï¼Œæ˜Ÿçº§å›¾ç‰‡æœ‰ä¸‰å¼ ï¼Œå…¨æ˜Ÿï¼ŒåŠæ˜Ÿï¼Œç©ºæ˜Ÿ<br><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/12/29/16f51be56d1a5ea8?w=20&h=19&f=png&s=1215" alt=""><br><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/12/29/16f51bdf50383e0f?w=20&h=19&f=png&s=1349" alt=""><br><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/12/29/16f51be27b49b42d?w=20&h=19&f=png&s=1220" alt=""></p><p>ä¸‹é¢åªç½—åˆ—å…³é”®çš„ css éƒ¨åˆ†, é€šè¿‡å¢åŠ ç±»åŒºåˆ†å›¾ç‰‡</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.star-item</span><span class="selector-class">.on</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(./img/star24_on@<span class="number">2</span>x.png);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.star-item</span><span class="selector-class">.half</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(./img/star24_half@<span class="number">2</span>x.png);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.star-item</span><span class="selector-class">.off</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(./img/star24_off@<span class="number">2</span>x.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¿®æ”¹ Star.vue çš„ä»£ç </p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"star"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item"</span> <span class="attr">v-for</span>=<span class="string">"(itemClass, index) in itemClasses"</span> <span class="attr">:key</span>=<span class="string">"index"</span> <span class="attr">:class</span>=<span class="string">"itemClass"</span>&gt;</span> <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>itemClasses å€¼æ˜¯é€šè¿‡è®¡ç®—å±æ€§è·å–çš„ï¼Œæ€è·¯ï¼š</p><ol><li>é€šè¿‡ computed è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º 5 çš„æ•°ç»„ï¼ˆæ˜¾ç¤º 5 é¢—æ˜Ÿï¼‰</li><li>æ•°ç»„çš„å€¼æ˜¯ä¸Šè¿° css å–çš„ä¸åŒæ˜Ÿå¯¹åº”çš„ç±»åï¼Œå†é€šè¿‡ç»‘å®šæ¯ä¸€ä¸ªå¾ªç¯æ·»åŠ çš„ classï¼Œä»è€Œéå†æ˜Ÿçº§ã€‚</li></ol><p>æ¯”å¦‚ä¸¾ä¾‹è¯„åˆ†ï¼š</p><ul><li>4.7 åˆ†å¯¹åº”çš„æ•°ç»„ä¸º[â€˜onâ€™, â€˜onâ€™, â€˜onâ€™, â€˜onâ€™, â€˜halfâ€™]</li><li>3.4 åˆ†å¯¹åº”çš„æ•°ç»„ä¸º[â€˜onâ€™, â€˜onâ€™, â€˜onâ€™, â€˜halfâ€™, â€˜halfâ€™]</li></ul><p>JS éƒ¨åˆ†çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ˜Ÿæ˜Ÿé•¿åº¦</span></span><br><span class="line"><span class="keyword">const</span> LENGTH = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜Ÿæ˜Ÿçš„çŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> CLS_ON = <span class="string">'on'</span></span><br><span class="line"><span class="keyword">const</span> CLS_HALF = <span class="string">'half'</span></span><br><span class="line"><span class="keyword">const</span> CLS_OFF = <span class="string">'off'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'Star'</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    score: <span class="built_in">Number</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    itemClasses() &#123;</span><br><span class="line">      <span class="keyword">let</span> result = []</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> score = <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.score * <span class="number">2</span>) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// åŠæ˜Ÿ (é€šè¿‡è·Ÿ1å–ä½™åˆ¤æ–­æ˜¯å¦ä¸ºå°æ•°)</span></span><br><span class="line">      <span class="keyword">let</span> hasDecimal = score % <span class="number">1</span> !== <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å…¨æ˜Ÿ ï¼ˆå‘ä¸‹å–æ•´ï¼Œè·å–å…¨æ˜Ÿéƒ¨åˆ†ï¼‰</span></span><br><span class="line">      <span class="keyword">let</span> integer = <span class="built_in">Math</span>.floor(score)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†å…¨æ˜Ÿ</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; integer; i++) &#123;</span><br><span class="line">        result.push(CLS_ON)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¤„ç†åŠæ˜Ÿ</span></span><br><span class="line">      <span class="keyword">if</span> (hasDecimal) &#123;</span><br><span class="line">        result.push(CLS_HALF)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¡¥é½</span></span><br><span class="line">      <span class="keyword">while</span> (result.length &lt; LENGTH) &#123;</span><br><span class="line">        <span class="comment">// åˆ°è¿™é‡Œè¿˜ä¸å¤Ÿäº”é¢—æ˜Ÿï¼Œåˆ™å‡‘ç©ºæ˜Ÿ</span></span><br><span class="line">        result.push(CLS_OFF)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>itemClasses æœ€ç»ˆæ˜¯è¿”å›äº†ä¸€ä¸ªé•¿åº¦ä¸º 5 çš„æ•°ç»„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let score &#x3D; Math.floor(this.score * 2) &#x2F; 2</span><br></pre></td></tr></table></figure><p>åŠæ˜Ÿçš„åˆ’åˆ†ï¼šåªæœ‰å½“å°æ•°ç¬¬ä¸€ä½å¤§äºæˆ–ç­‰äº 5 æ‰å¯ä»¥ç®—ä¸ºåŠæ˜Ÿï¼Œå¦åˆ™æ˜¯ç©ºæ˜Ÿã€‚è¯¥è®¡ç®—æ˜¯ä¸ºäº†å°æ•°éƒ¨åˆ†&gt;=0.5 çš„è®¡ç®—ç»“æœå¸¦æœ‰å°æ•°ï¼Œä»è€Œå†åé¢è·Ÿ 1 å–ä½™åˆ¤æ–­æ˜¯å¦ä¸ºåŠæ˜Ÿã€‚ä¸€å¼€å§‹æœ‰ç‚¹è’™ï¼Œå¤šè¯•å‡ ä¸ªæ•°æƒ³æƒ³å°±æ‡‚äº†ã€‚</p><blockquote><p>æ¯”å¦‚ 4.3 åˆ†æ²¡æœ‰åŠæ˜Ÿï¼Œ4.5 æœ‰åŠæ˜Ÿå‡ºç°</p></blockquote><p>ç»“æœï¼š<br>æ¯”å¦‚ä¼ å…¥çš„å€¼ä¸º 4.7ï¼Œåˆ™æ˜¾ç¤º</p><p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/12/29/16f51d7db002aa38?w=161&h=28&f=png&s=5690" alt=""></p>]]></content>
      <categories>
        <category>Vue ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡µé¢å†…å®¹æ˜¯å¦è¶…å‡ºå¯è§†é«˜åº¦ï¼Œfooterå§‹ç»ˆä¿æŒåº•éƒ¨æ˜¾ç¤º</title>
    <url>/2019/12/07/CSS%E7%B3%BB%E5%88%97%E4%B9%8B%E9%A1%B5%E9%9D%A2%E5%86%85%E5%AE%B9%E6%98%AF%E5%90%A6%E8%B6%85%E5%87%BA%E5%8F%AF%E8%A7%86%E9%AB%98%E5%BA%A6%EF%BC%8Cfooter%E5%A7%8B%E7%BB%88%E4%BF%9D%E6%8C%81%E5%BA%95%E9%83%A8%E6%98%BE%E7%A4%BA/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸ªé¡¹ç›®ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„æŠ€å·§ï¼ŒfooteråŒºï¼ˆæ¯”å¦‚ç‰ˆæƒä¿¡æ¯ï¼‰è¦å§‹ç»ˆå±…äºé¡µé¢åº•éƒ¨ã€‚å¦‚æœç”¨fixedå®šä½æ˜¾ç„¶ä¸å¯å–ï¼Œå› ä¸ºè¦ä¿è¯é¡µé¢é«˜åº¦å¤§äºå±å¹•é«˜åº¦æ—¶ï¼ŒfooteråŒºè¦è·Ÿéšç€é¡µé¢æ»šåŠ¨ä¿æŒåœ¨åº•éƒ¨</p>
<a id="more"></a>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/12/7/16ee0e36c5c55fea?w=1737&h=899&f=png&s=23364" alt=""></p>
<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/12/7/16ee0e3a25e302bd?w=1577&h=903&f=png&s=27932" alt=""></p>
<ul>
<li>tipï¼šä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ä»…é€‚ç”¨äºfooteråŒºé«˜åº¦å›ºå®šçš„æƒ…å†µ</li>
</ul>
<h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>é¡µé¢ç»“æ„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;main-container&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;box&quot;&gt;è¿™æ˜¯ä¸»è¦å†…å®¹&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;footer&gt;è¿™æ˜¯åº•éƒ¨&lt;&#x2F;footer&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…³é”®çš„css<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.main-container</span>&#123;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">footer</span>&#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>å¦‚ä¸Šä»£ç ï¼Œä¸»è¦å†…å®¹åŒºå’ŒfooteråŒºå¿…é¡»ä¸ºå¹¶åˆ—å…³ç³»ã€‚è®¾ç½®main-containerä¸ºborder-boxï¼Œå³å…ƒç´ çš„å†…è¾¹è·å’Œè¾¹æ¡†éƒ½åœ¨å·²è®¾å®šçš„é«˜åº¦å†…ç»˜åˆ¶ï¼Œæˆ‘ä»¬è®¾ç½®äº†min-heightä¸º100%ï¼Œå³æœ€å°é«˜åº¦æ˜¯é“ºæ»¡æ•´å±å¹•ã€‚padding-bottomåœ¨border-boxç›’å­ä¸­ï¼Œç•™å‡ºé«˜åº¦40pxçš„ç©ºç™½å—ã€‚footerçš„margin-topä¸º-40pxï¼ˆå¦‚æœfooteræœ‰è®¾ç½®é«˜åº¦ï¼Œpadding-bottomçš„å€¼åº”ä»¥footeré«˜åº¦ä¸ºå‡†ï¼‰ï¼Œå³å‘ä¸Šæ‹‰åˆ°ç©ºç™½å—å†…ï¼Œmain-containeræœ€å°é«˜åº¦ä¸ºæ•´ä¸ªå±å¹•ï¼Œæ•…é¡µé¢å†…å®¹ä¸è¶³ä¹Ÿå¯ä»¥æ˜¾ç¤ºåœ¨åº•éƒ¨ã€‚</p>
<h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>é¡µé¢ç»“æ„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;main-container&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;box&quot;&gt;è¿™æ˜¯ä¸»è¦å†…å®¹&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;footer&gt;è¿™æ˜¯åº•éƒ¨&lt;&#x2F;footer&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>å…³é”®çš„css</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">html,body&#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">.wrapper&#123;</span><br><span class="line">    min-height: 100%;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.main-container&#123;</span><br><span class="line">    padding-bottom: 40px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">footer&#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    height: 40px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šä»£ç æ—¶ç”¨ç»å¯¹å®šä½ï¼Œç›¸å¯¹äºwrapperå±…äºåº•éƒ¨ï¼Œè·Ÿç¬¬ä¸€ä¸ªæ–¹æ³•æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</p>
]]></content>
      <categories>
        <category>CSSç³»åˆ—</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå˜é‡å¯¹è±¡</title>
    <url>/2019/11/28/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E5%92%8C%E5%8F%98%E9%87%8F%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<p>ç»§ç»­æ¥ç€ä¸Šç¯‡æ–‡ç« ï¼Œä»Šå¤©å†ç»†è¯´æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡â€¦</p>
<a id="more"></a>

<p>ä¸Šç¯‡æˆ‘ä»¬è¯´åˆ°å‡½æ•°ä¸Šä¸‹æ–‡çš„ç»“æ„å¯è¡¨ç¤ºä¸º</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ExecutionContextObj = &#123;</span><br><span class="line">  VO: <span class="built_in">window</span>, <span class="comment">// å˜é‡å¯¹è±¡</span></span><br><span class="line">  ScopeChain: &#123;&#125;, <span class="comment">// ä½œç”¨åŸŸé“¾</span></span><br><span class="line">  <span class="keyword">this</span>: <span class="built_in">window</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å³æ¯ä¸ªå‡½æ•°ä¸Šä¸‹æ–‡ï¼Œéƒ½è¦æœ‰è¿™ä¸‰ä¸ªé‡è¦å±æ€§ï¼š</p>
<ul>
<li>å˜é‡å¯¹è±¡(Variable object, VO)</li>
<li>ä½œç”¨åŸŸé“¾(Scope chain)</li>
<li>this</li>
</ul>
<h2 id="å˜é‡å¯¹è±¡"><a href="#å˜é‡å¯¹è±¡" class="headerlink" title="å˜é‡å¯¹è±¡"></a>å˜é‡å¯¹è±¡</h2><h3 id="ä»€ä¹ˆæ˜¯å˜é‡å¯¹è±¡"><a href="#ä»€ä¹ˆæ˜¯å˜é‡å¯¹è±¡" class="headerlink" title="ä»€ä¹ˆæ˜¯å˜é‡å¯¹è±¡"></a>ä»€ä¹ˆæ˜¯å˜é‡å¯¹è±¡</h3><p>å˜é‡å¯¹è±¡æ˜¯ä¸æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç›¸å…³çš„æ•°æ®ä½œç”¨åŸŸï¼Œå­˜å‚¨äº†åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°å£°æ˜ã€‚å› ä¸ºä¸åŒæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ç•¥æœ‰ä¸åŒï¼Œæ‰€ä»¥å˜é‡å¯¹è±¡ä¸€èˆ¬åˆ†ä¸ºå…¨å±€ä¸Šä¸‹æ–‡ä¸‹çš„å˜é‡å¯¹è±¡å’Œå‡½æ•°ä¸Šä¸‹æ–‡ä¸‹çš„å˜é‡å¯¹è±¡ã€‚</p>
<h3 id="å˜é‡å¯¹è±¡-VO-çš„åˆ›å»ºè¿‡ç¨‹"><a href="#å˜é‡å¯¹è±¡-VO-çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="å˜é‡å¯¹è±¡(VO)çš„åˆ›å»ºè¿‡ç¨‹"></a>å˜é‡å¯¹è±¡(VO)çš„åˆ›å»ºè¿‡ç¨‹</h3><p>å˜é‡å¯¹è±¡çš„åˆ›å»ºï¼Œå±äºæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„åˆ›å»ºé˜¶æ®µï¼Œä¾æ¬¡ç»è¿‡ä»¥ä¸‹ä¸‰ä¸ªè¿‡ç¨‹ï¼š</p>
<p>åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡æœ‰ä¸¤ä¸ªé˜¶æ®µï¼šä¸€ä¸ªæ˜¯åˆ›å»ºé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œé˜¶æ®µã€‚å˜é‡å¯¹è±¡çš„åˆ›å»ºï¼Œå±äºæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„åˆ›å»ºé˜¶æ®µï¼Œä¼šä¾æ¬¡ç»è¿‡ä¸‰ä¸ªè¿‡ç¨‹ï¼š</p>
<h4 id="1-ä¸ºå‡½æ•°çš„å½¢å‚èµ‹å€¼ï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰"><a href="#1-ä¸ºå‡½æ•°çš„å½¢å‚èµ‹å€¼ï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰" class="headerlink" title="1.ä¸ºå‡½æ•°çš„å½¢å‚èµ‹å€¼ï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰"></a>1.ä¸ºå‡½æ•°çš„å½¢å‚èµ‹å€¼ï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰</h4><p>åœ¨è¿›å…¥å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œä¼šé¦–å…ˆæ£€æŸ¥å®å‚ä¸ªæ•°ï¼Œæ¥ç€å¯¹å®å‚å¯¹è±¡å’Œå½¢å‚è¿›è¡Œèµ‹å€¼ã€‚å¦‚æœæ²¡æœ‰å®å‚ï¼Œå±æ€§å€¼è®¾ä¸º undefinedï¼›å½“ä¼ å…¥çš„å®å‚æ•°é‡å°äºå½¢å‚æ•°é‡ï¼Œåˆ™ä¼šå°†æ²¡æœ‰è¢«èµ‹å€¼çš„å½¢å‚èµ‹å€¼ä¸º undefinedã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b, c) <span class="comment">// 1 2 undefined</span></span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å˜é‡å¯¹è±¡çš„ç»“æ„ä¸º:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">VO = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">  c: <span class="literal">undefined</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-å‡½æ•°å£°æ˜"><a href="#2-å‡½æ•°å£°æ˜" class="headerlink" title="2.å‡½æ•°å£°æ˜"></a>2.å‡½æ•°å£°æ˜</h4><p>é‡åˆ°åŒåçš„å‡½æ•°æ—¶ï¼Œåé¢å‡½æ•°ä¼šè¦†ç›–å‰é¢çš„å‡½æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å…ˆå£°æ˜çš„'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'åå£°æ˜çš„'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn) <span class="comment">//Æ’ fn() &#123; console.log('åå£°æ˜çš„'); &#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-å˜é‡å£°æ˜"><a href="#3-å˜é‡å£°æ˜" class="headerlink" title="3.å˜é‡å£°æ˜"></a>3.å˜é‡å£°æ˜</h4><p>æ£€æŸ¥å½“å‰ç¯å¢ƒä¸­é€šè¿‡å˜é‡å£°æ˜(var)å¹¶èµ‹å€¼ä¸º undefinedï¼ˆå˜é‡æå‡äº§ç”Ÿçš„åŸå› ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(fn) <span class="comment">// Æ’ fn() &#123; console.log('åå£°æ˜çš„');&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// undefined</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å…ˆå£°æ˜çš„'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'åå£°æ˜çš„'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>

<p>ç”±ä¸Šé¢æˆ‘ä»¬çœ‹å‡ºï¼Œå½“å˜é‡åç§°ä¸å‡½æ•°åç§°åŒåæ—¶ï¼Œä¼šå¿½ç•¥æ­¤å˜é‡å£°æ˜ï¼Œå³åŒåæ—¶ï¼Œå‡½æ•°å£°æ˜ä¼˜å…ˆ</p>
<p>js è™½ç„¶å•çº¿ç¨‹çš„è¯­è¨€ï¼Œæ‰§è¡Œé¡ºåºä¸ºé¡ºåºæ‰§è¡Œï¼Œä½† JS å¼•æ“å¹¶ä¸æ˜¯ä¸€è¡Œä¸€è¡Œåœ°åˆ†æå’Œæ‰§è¡Œç¨‹åºï¼Œè€Œæ˜¯ä¸€æ®µä¸€æ®µåœ°åˆ†ææ‰§è¡Œã€‚</p>
<p>è®©æˆ‘ä»¬ä» JS å¼•æ“çš„è§’åº¦ç†ä¸€ç†ä¸Šè¿°ä¸‰ä¸ªè¿‡ç¨‹ï¼š<strong>å‡½æ•°æå‡å’Œå˜é‡æå‡ï¼Œæ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡åšçš„å‡†å¤‡å·¥ä½œï¼›å½“æ‰§è¡Œå‡½æ•°æ—¶ï¼Œåˆä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œåšçš„æ˜¯è¿™ä¸ªå‡½æ•°å†…éƒ¨çš„å‡†å¤‡å·¥ä½œï¼›è¿™å°±æ˜¯ JS å¼•æ“åˆ†æä»£ç çš„â€é¢„ç¼–è¯‘é˜¶æ®µâ€ï¼Œåšå®Œè¯¥å·¥ä½œæ‰è¿›å…¥æ‰§è¡Œé˜¶æ®µã€‚</strong></p>
<h3 id="å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡"><a href="#å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡" class="headerlink" title="å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡"></a>å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡</h3><p>åœ¨å®¢æˆ·ç«¯ JavaScript ä¸­ï¼Œå…¨å±€å¯¹è±¡å°±æ˜¯ Window å¯¹è±¡;</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span> <span class="comment">// åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä½¿ç”¨varå®šä¹‰å˜é‡aï¼Œä½œä¸ºå…¨å±€å˜é‡çš„å®¿ä¸»</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// windowå¯¹è±¡</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.a) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºå…¨å±€ä¸Šä¸‹æ–‡ä¸­æ¥è¯´ï¼Œå˜é‡å¯¹è±¡å°±æ˜¯å…¨å±€å¯¹è±¡ï¼Œ</p>
<h3 id="å˜é‡å¯¹è±¡å˜ä¸ºæ´»åŠ¨å¯¹è±¡"><a href="#å˜é‡å¯¹è±¡å˜ä¸ºæ´»åŠ¨å¯¹è±¡" class="headerlink" title="å˜é‡å¯¹è±¡å˜ä¸ºæ´»åŠ¨å¯¹è±¡"></a>å˜é‡å¯¹è±¡å˜ä¸ºæ´»åŠ¨å¯¹è±¡</h3><p>æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç¬¬äºŒä¸ªé˜¶æ®µä¸ºæ‰§è¡Œé˜¶æ®µï¼Œæ­¤æ—¶ä¼šè¿›è¡Œå˜é‡èµ‹å€¼ï¼Œæ‰§è¡Œå…¶ä»–ä»£ç ç­‰å·¥ä½œï¼Œæ­¤æ—¶ï¼Œå˜é‡å¯¹è±¡å˜ä¸ºæ´»åŠ¨å¯¹è±¡(Active object, AO)ã€‚</p>
<blockquote>
<p>æ´»åŠ¨å¯¹è±¡å’Œå˜é‡å¯¹è±¡å…¶å®æ˜¯åŒä¸ªä¸œè¥¿ï¼Œåªæ˜¯è§„èŒƒæ¦‚å¿µä¸Šçš„å·®å¼‚ã€‚åªæœ‰åˆ°å½“è¿›å…¥ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡æ‰ä¼šè¢«æ¿€æ´»ï¼Œæ‰€ä»¥æ‰å«æ´»åŠ¨å¯¹è±¡ã€‚è€Œåªæœ‰è¢«æ¿€æ´»çš„å˜é‡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ´»åŠ¨å¯¹è±¡ä¸Šçš„å„ç§å±æ€§æ‰èƒ½è¢«è®¿é—®ã€‚</p>
</blockquote>
<p>æ‰€ä»¥æ˜ç¡®ï¼Œæ´»åŠ¨å¯¹è±¡æ˜¯åœ¨è¿›å…¥å‡½æ•°ä¸Šä¸‹æ–‡æ—¶åˆ»è¢«åˆ›å»ºçš„ï¼Œå®ƒé€šè¿‡å‡½æ•°çš„ arguments å±æ€§åˆå§‹åŒ–ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(fn) <span class="comment">// Æ’ fn() &#123; console.log('åå£°æ˜çš„');&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// undefined</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å…ˆå£°æ˜çš„'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'åå£°æ˜çš„'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">10</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="number">20</span></span><br><span class="line"><span class="built_in">console</span>.log(fn) <span class="comment">//20</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ï¼ŒçœŸæ­£å¼€å§‹æ‰§è¡Œæ˜¯ä»ç¬¬ä¸€è¡Œ console.log(fn)ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå˜é‡å¯¹è±¡ VO æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line">EC= &#123;</span><br><span class="line">  VOï¼š&#123;&#125;, <span class="comment">// åˆ›å»ºå˜é‡å¯¹è±¡</span></span><br><span class="line">  scopeChain: [&#123;VO&#125;], <span class="comment">// ä½œç”¨åŸŸé“¾</span></span><br><span class="line">  <span class="keyword">this</span>: <span class="built_in">window</span> <span class="comment">// thisç»‘å®š</span></span><br><span class="line">&#125;</span><br><span class="line">VO = &#123;</span><br><span class="line">  <span class="comment">// argument: &#123;&#125;, // å½“å‰ä¸ºå…¨å±€ä¸Šä¸‹æ–‡ï¼Œä¸å­˜åœ¨arguments</span></span><br><span class="line">  fn: reference to <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;&#125;, <span class="comment">// å‡½æ•°fnçš„å¼•ç”¨åœ°å€</span></span><br><span class="line">  b: undefiend  <span class="comment">// å˜é‡æå‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å˜é‡å¯¹è±¡åˆ›å»ºçš„ä¸‰ä¸ªè¿‡ç¨‹ï¼Œ</p>
<ol>
<li>é¦–å…ˆæ˜¯ arguments å¯¹è±¡çš„åˆ›å»ºï¼ˆå…¨å±€ä¸Šä¸‹æ–‡æ²¡æœ‰åˆ™å¿½ç•¥ï¼‰</li>
<li>å…¶æ¬¡ï¼Œæ˜¯æ£€æŸ¥å‡½æ•°çš„å£°æ˜ã€‚æ­¤æ—¶ï¼Œå‡½æ•° fn å£°æ˜äº†ä¸¤æ¬¡ï¼Œåˆ™åä¸€æ¬¡çš„å£°æ˜ä¼šè¦†ç›–ä¸Šä¸€æ¬¡çš„å£°æ˜ã€‚</li>
<li>æœ€åï¼Œæ˜¯æ£€æŸ¥å˜é‡çš„å£°æ˜ï¼Œå…ˆå£°æ˜äº†å˜é‡ bï¼Œå°†å®ƒèµ‹å€¼ä¸º undefinedï¼›æ¥ç€é‡åˆ° fn çš„å˜é‡å£°æ˜ï¼Œç”±äº fn å·²ç»è¢«å£°æ˜ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæ•…å¿½ç•¥è¯¥å˜é‡å£°æ˜ã€‚</li>
</ol>
<p>åˆ°æ­¤ï¼Œå˜é‡å¯¹è±¡çš„åˆ›å»ºé˜¶æ®µå®Œæˆï¼Œæ¥ä¸‹æ¥è¿›è¡Œæ‰§è¡Œé˜¶æ®µï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.æ‰§è¡Œconsole.log(fn);æ­¤æ—¶fnä¸ºå£°æ˜çš„ç¬¬äºŒä¸ªå‡½æ•°ï¼Œæ•…è¾“å‡ºç»“æœï¼š&quot;åå£°æ˜çš„&quot;ã€‚</span><br><span class="line">2.æ‰§è¡Œconsole.log(b)ï¼Œæ­¤æ—¶bå·²è¢«èµ‹å€¼ä¸ºundefinedï¼Œæ•…è¾“å‡ºç»“æœï¼š&quot;undefined&quot;ã€‚</span><br><span class="line">3.æ‰§è¡Œèµ‹å€¼æ“ä½œï¼š b &#x3D; 10;</span><br><span class="line">4.æ‰§è¡Œconsole.log(b) ï¼Œæ•…è¾“å‡ºbä¸º10ã€‚</span><br><span class="line">5.æ‰§è¡Œèµ‹å€¼æ“ä½œï¼š fn &#x3D; 20;</span><br><span class="line">6.æ‰§è¡Œconsole.log(fn) ï¼Œæ•…è¾“å‡ºfnä¸º20ã€‚</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œåˆ°æœ€åä¸€æ­¥æ—¶ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰§è¡Œé˜¶æ®µ</span></span><br><span class="line">EC = &#123;</span><br><span class="line">  VO = &#123;&#125;;</span><br><span class="line">  scopeChain: &#123;&#125;;</span><br><span class="line">  <span class="keyword">this</span>: <span class="built_in">window</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">// VO ---- AO</span></span><br><span class="line">AO = &#123;</span><br><span class="line">  argument: &#123;&#125;;</span><br><span class="line">  fn: <span class="number">20</span>;</span><br><span class="line">  b: <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šï¼Œå°±æ˜¯å˜é‡å¯¹è±¡åœ¨ä»£ç æ‰§è¡Œå‰åŠæ‰§è¡Œåçš„å˜åŒ–ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li><p>å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡åˆå§‹åŒ–æ˜¯å…¨å±€å¯¹è±¡</p>
</li>
<li><p>å‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡åˆå§‹åŒ–åªåŒ…æ‹¬ arguments å¯¹è±¡</p>
</li>
<li><p>åœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ä¼šç»™å˜é‡å¯¹è±¡æ·»åŠ å½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜ç­‰åˆå§‹çš„å±æ€§å€¼</p>
</li>
<li><p>åœ¨ä»£ç æ‰§è¡Œé˜¶æ®µï¼Œä¼šå†æ¬¡ä¿®æ”¹å˜é‡å¯¹è±¡çš„å±æ€§å€¼</p>
</li>
</ol>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ‰§è¡Œä¸Šä¸‹æ–‡</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œæ ˆ</title>
    <url>/2019/11/27/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E5%92%8C%E6%89%A7%E8%A1%8C%E6%A0%88/</url>
    <content><![CDATA[<p>éƒ½è¯´æƒ³æˆä¸ºå‡ºè‰²çš„ JavaScript å¼€å‘è€…ï¼Œå°±è¦æ·±å…¥å­¦ä¹  JavaScript ç¨‹åºå†…éƒ¨çš„æ‰§è¡Œæœºåˆ¶ï¼Œæœ€è¿‘å­¦äº†ä¸€é JS çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œæ ˆï¼Œä»¥æ­¤ä½œæ€»ç»“ã€‚</p>
<a id="more"></a>

<p>é¦–å…ˆå…ˆæ¥äº†è§£å‡ ä¸ªä¸“ä¸šæ¦‚å¿µ</p>
<ul>
<li><p>ECï¼šå‡½æ•°æ‰§è¡Œç¯å¢ƒï¼ˆæˆ–æ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ï¼ŒExecution Context</p>
</li>
<li><p>ECSï¼šæ‰§è¡Œç¯å¢ƒæ ˆï¼ŒExecution Context Stack</p>
</li>
<li><p>VOï¼šå˜é‡å¯¹è±¡ï¼ŒVariable Object</p>
</li>
<li><p>AOï¼šæ´»åŠ¨å¯¹è±¡ï¼ŒActive Object</p>
</li>
<li><p>scope chainï¼šä½œç”¨åŸŸé“¾</p>
</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡"></a>ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡</h2><p>æ¯æ¬¡å½“æ§åˆ¶å™¨è½¬åˆ° ECMAScript å¯æ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œå®ƒéƒ½æ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œå³æ˜¯æŒ‡å½“å‰æ‰§è¡Œç¯å¢ƒä¸­çš„å˜é‡ã€å‡½æ•°å£°æ˜ï¼Œå‚æ•°ï¼Œä½œç”¨åŸŸé“¾ï¼Œthis ç­‰ä¿¡æ¯ã€‚</p>
<h3 id="ç»„æˆä»£ç ç¤ºä¾‹"><a href="#ç»„æˆä»£ç ç¤ºä¾‹" class="headerlink" title="ç»„æˆä»£ç ç¤ºä¾‹"></a>ç»„æˆä»£ç ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ExecutionContextObj = &#123;</span><br><span class="line">  VO: <span class="built_in">window</span>, <span class="comment">// å˜é‡å¯¹è±¡</span></span><br><span class="line">  ScopeChain: &#123;&#125;, <span class="comment">// ä½œç”¨åŸŸé“¾</span></span><br><span class="line">  <span class="keyword">this</span>: <span class="built_in">window</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹"></a>æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹</h2><p>JavaScript ä¸­æœ‰ä¸‰ç§æ‰§è¡Œä¸Šä¸‹æ–‡ç±»å‹ã€‚</p>
<ol>
<li><p><strong>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</strong>â€”â€” è¿™æ˜¯é»˜è®¤ä¸Šä¸‹æ–‡ï¼Œæµè§ˆå™¨ä¸­çš„å…¨å±€å¯¹è±¡å°±æ˜¯ window å¯¹è±¡ï¼Œä»»ä½•ä¸åœ¨å‡½æ•°å†…éƒ¨çš„ä»£ç éƒ½åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œthis æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚</p>
</li>
<li><p><strong>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong> â€”â€” å½“<strong>å‡½æ•°è¢«è°ƒç”¨æ—¶åˆ›å»º</strong>,ä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æœ‰ä»»æ„ä¸ªã€‚</p>
</li>
<li><p><strong>Eval å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong> â€”â€”<br>æ‰§è¡Œ eval å‡½æ•°å†…éƒ¨çš„ä»£ç ä¹Ÿæœ‰å±äºå®ƒçš„ä¸Šä¸‹æ–‡ï¼Œç”±äºå¼€å‘ä¸­æ˜¯å°½é‡é¿å…æˆ–ä¸ç”¨ eval å‡½æ•°ï¼Œæ•…æ­¤ä¸ä½œè®¨è®ºã€‚</p>
</li>
</ol>
<h2 id="æ‰§è¡Œæ ˆ"><a href="#æ‰§è¡Œæ ˆ" class="headerlink" title="æ‰§è¡Œæ ˆ"></a>æ‰§è¡Œæ ˆ</h2><p>æ‰§è¡Œæ ˆï¼Œä¹Ÿå«è°ƒç”¨æ ˆï¼Œè¢«ç”¨æ¥å­˜å‚¨ä»£ç è¿è¡Œæ—¶åˆ›å»ºçš„æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<blockquote>
<p>æ ˆï¼šä¸€ç§æ•°æ®ç»“æ„ï¼Œéµå¾ªåè¿›å…ˆå‡ºçš„åŸåˆ™</p>
</blockquote>
<p>å½“ JavaScript å¼•æ“ç¬¬ä¸€æ¬¡é‡åˆ°è„šæœ¬æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶ä¸”å‹å…¥å½“å‰æ‰§è¡Œæ ˆã€‚æ¯å½“å¼•æ“é‡åˆ°ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå®ƒä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶å‹å…¥æ ˆçš„é¡¶éƒ¨ã€‚</p>
<p>å¼•æ“ä¼šæ‰§è¡Œé‚£äº›æ‰§è¡Œä¸Šä¸‹æ–‡ä½äºæ ˆé¡¶çš„å‡½æ•°ã€‚å½“è¯¥å‡½æ•°æ‰§è¡Œç»“æŸæ—¶ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ä»æ ˆä¸­å¼¹å‡ºï¼Œæ§åˆ¶æµç¨‹åˆ°è¾¾å½“å‰æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'fn1è¢«è°ƒç”¨äº† -- åˆ›å»ºäº†fn1çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‹å…¥æ ˆ'</span>)</span><br><span class="line">  fn2()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'fn2æ‰§è¡Œå®Œæˆï¼Œfn2çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»æ ˆä¸­å¼¹å‡º'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'fn2è¢«è°ƒç”¨äº† -- åˆ›å»ºäº†fn2çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‹å…¥æ ˆ'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn1()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'fn1æ‰§è¡Œå®Œæˆï¼Œfn2çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»æ ˆä¸­å¼¹å‡º'</span>)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fn1è¢«è°ƒç”¨äº† -- åˆ›å»ºäº†fn1çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‹å…¥æ ˆ</span><br><span class="line">fn2è¢«è°ƒç”¨äº† -- åˆ›å»ºäº†fn2çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‹å…¥æ ˆ</span><br><span class="line">fn2æ‰§è¡Œå®Œæˆï¼Œfn2çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»æ ˆä¸­å¼¹å‡º</span><br><span class="line">fn1æ‰§è¡Œå®Œæˆï¼Œfn2çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»æ ˆä¸­å¼¹å‡º</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼š<br><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/11/27/16ead7c041a4b415?w=1276&h=316&f=png&s=30716" alt=""></p>
<p>å½“ä¸Šè¿°ä»£ç åœ¨æµè§ˆå™¨åŠ è½½æ—¶ï¼ŒJavaScript å¼•æ“åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶æŠŠå®ƒå‹å…¥æ ˆä¸­ï¼Œå½“å‡½æ•° fn1()è¢«è°ƒç”¨æ—¶ï¼ŒJavaScript ä¸ºè¯¥å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶æŠŠå®ƒå‹å…¥å½“å‰æ‰§è¡Œæ ˆçš„é¡¶éƒ¨ã€‚</p>
<p>å½“ fn1()å‡½æ•°å†…éƒ¨è°ƒç”¨ fn2()å‡½æ•°æ—¶ï¼ŒJavaScript å¼•æ“åŒæ ·åˆ›å»ºäº† fn2()çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶å‹å…¥æ ˆçš„é¡¶éƒ¨ã€‚ç„¶åæ‰§è¡Œäº† fn2()å‡½æ•°åï¼Œfn2()å‡½æ•°ä¼šä»å½“å‰æ ˆï¼ˆåè¿›å…ˆå‡ºç»“æ„ï¼‰å¼¹å‡ºï¼Œå¹¶ä¸”æŒ‰ç¨‹åºæ‰§è¡Œé¡ºåºç»§ç»­æ‰§è¡Œ fn1()å‡½æ•°ï¼Œå³æ­¤åˆ»å¤„äº fn1 çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<p>å½“ fn1()å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ ˆå¼¹å‡ºï¼Œæ§åˆ¶æµç¨‹åˆ°è¾¾å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ä¸€æ—¦æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæ¯•ï¼ŒJavaScript å¼•æ“ä»å½“å‰æ ˆä¸­ç§»é™¤å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<h2 id="æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º"></a>æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º</h2><p>å·²ç»çŸ¥é“ JavaScript æ€æ ·ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡äº†ï¼Œç°åœ¨æ¥äº†è§£ JavaScript å¼•æ“æ˜¯æ€ä¹ˆåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡çš„ã€‚</p>
<p>åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡æœ‰ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>åˆ›å»ºé˜¶æ®µ</li>
<li>æ‰§è¡Œé˜¶æ®µã€‚</li>
</ol>
<p>åœ¨ JavaScript ä»£ç æ‰§è¡Œå‰ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡å°†ç»å†åˆ›å»ºé˜¶æ®µã€‚åœ¨åˆ›å»ºé˜¶æ®µä¼šå‘ç”Ÿä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>this ç»‘å®š</li>
<li>åˆ›å»º(LexicalEnvironment)è¯æ³•ç¯å¢ƒç»„ä»¶</li>
<li>åˆ›å»º(VariableEnvironment)å˜é‡ç¯å¢ƒç»„ä»¶</li>
</ol>
<p>æ‰§è¡Œä¸Šä¸‹æ–‡åœ¨æ¦‚å¿µå¯è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ExecutionContext &#x3D; &#123;</span><br><span class="line">  ThisBinding &#x3D; &lt;this value&gt;,</span><br><span class="line">  LexicalEnvironment &#x3D; &#123; ... &#125;,</span><br><span class="line">  VariableEnvironment &#x3D; &#123; ... &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-åˆ›å»ºé˜¶æ®µ"><a href="#1-åˆ›å»ºé˜¶æ®µ" class="headerlink" title="1. åˆ›å»ºé˜¶æ®µ"></a>1. åˆ›å»ºé˜¶æ®µ</h3><h4 id="this-ç»‘å®š"><a href="#this-ç»‘å®š" class="headerlink" title="this ç»‘å®š"></a>this ç»‘å®š</h4><p>åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œthis çš„å€¼æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚(åœ¨æµè§ˆå™¨ä¸­ï¼Œthis å¼•ç”¨ window å¯¹è±¡)</p>
<p>åœ¨å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œthis çš„æŒ‡å‘å–å†³äºå‡½æ•°æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„,åœ¨æœ¬ç¯‡æš‚ä¸å¯¹ this æŒ‡å‘åšè¯¦ç»†è®¨è®ºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  fn: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> win = obj.fn</span><br><span class="line"></span><br><span class="line">obj.fn() <span class="comment">//thisæŒ‡å‘obj</span></span><br><span class="line">win() <span class="comment">// thisæŒ‡å‘window</span></span><br></pre></td></tr></table></figure>

<h4 id="è¯æ³•ç¯å¢ƒï¼ˆLexical-Environmentï¼‰"><a href="#è¯æ³•ç¯å¢ƒï¼ˆLexical-Environmentï¼‰" class="headerlink" title="è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰"></a>è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰</h4><p>ES6 å®˜æ–¹æ–‡æ¡£æŠŠè¯æ³•ç¯å¢ƒå®šä¹‰ä¸ºï¼š</p>
<blockquote>
<p>è¯æ³•ç¯å¢ƒæ˜¯ç”¨æ¥å®šä¹‰ åŸºäºè¯æ³•åµŒå¥—ç»“æ„çš„ ECMAScript ä»£ç å†…çš„æ ‡è¯†ç¬¦ä¸å˜é‡å€¼å’Œå‡½æ•°å€¼ä¹‹é—´çš„å…³è”å…³ç³» çš„ä¸€ç§è§„èŒƒç±»å‹ã€‚ä¸€ä¸ªè¯æ³•ç¯å¢ƒç”±ç¯å¢ƒè®°å½•ï¼ˆEnvironment Recordï¼‰å’Œä¸€ä¸ªå¯èƒ½ä¸º null çš„å¯¹å¤–éƒ¨è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ï¼ˆouterï¼‰ç»„æˆã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¯æ³•ç¯å¢ƒéƒ½ä¸ç‰¹å®šçš„ ECMAScript ä»£ç è¯­æ³•ç»“æ„ç›¸å…³è”ï¼Œä¾‹å¦‚å‡½æ•°ã€ä»£ç å—ã€TryCatch ä¸­çš„ Catch ä»å¥ï¼Œå¹¶ä¸”æ¯æ¬¡æ‰§è¡Œè¿™ç±»ä»£ç æ—¶éƒ½ä¼šåˆ›å»ºæ–°çš„è¯æ³•ç¯å¢ƒã€‚</p>
</blockquote>
<p>å¯ä»¥ç†è§£ä¸ºè¯æ³•ç¯å¢ƒæ˜¯ä¸€ç§åŒ…å«æ ‡è¯†ç¬¦(å˜é‡/å‡½æ•°çš„åç§°)å’Œå˜é‡(å‡½æ•°/åŸå§‹å€¼/æ•°ç»„å¯¹è±¡ç­‰)æ˜ å°„çš„æ•°æ®ç»“æ„</p>
<h5 id="è¯æ³•ç¯å¢ƒæœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†"><a href="#è¯æ³•ç¯å¢ƒæœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†" class="headerlink" title="è¯æ³•ç¯å¢ƒæœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†"></a>è¯æ³•ç¯å¢ƒæœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†</h5><ol>
<li><p>å£°æ˜å¼ç¯å¢ƒè®°å½•å™¨ï¼šå­˜å‚¨å˜é‡å’Œå‡½æ•°å£°æ˜çš„å®é™…ä½ç½®</p>
</li>
<li><p>å¯¹è±¡ç¯å¢ƒè®°å½•å™¨ï¼šå¯ä»¥è®¿é—®å…¶å¤–éƒ¨è¯æ³•ç¯å¢ƒ(ä½œç”¨åŸŸ)</p>
</li>
</ol>
<h5 id="è¯æ³•ç¯å¢ƒæœ‰ä¸¤ç§ç±»å‹"><a href="#è¯æ³•ç¯å¢ƒæœ‰ä¸¤ç§ç±»å‹" class="headerlink" title="è¯æ³•ç¯å¢ƒæœ‰ä¸¤ç§ç±»å‹"></a>è¯æ³•ç¯å¢ƒæœ‰ä¸¤ç§ç±»å‹</h5><ol>
<li><p>å…¨å±€ç¯å¢ƒï¼šæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤–éƒ¨ç¯å¢ƒçš„è¯æ³•ç¯å¢ƒï¼Œå…¶å¤–éƒ¨ç¯å¢ƒå¼•ç”¨ä¸º nullã€‚æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆwindow å¯¹è±¡ï¼‰åŠå…¶å…³è”çš„æ–¹æ³•å’Œå±æ€§ï¼ˆä¾‹å¦‚æ•°ç»„æ–¹æ³•ï¼‰ä»¥åŠä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„å…¨å±€å˜é‡ï¼Œthis çš„å€¼æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚</p>
</li>
<li><p>å‡½æ•°ç¯å¢ƒï¼šç”¨æˆ·åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡è¢«å­˜å‚¨åœ¨ç¯å¢ƒè®°å½•ä¸­ï¼ŒåŒ…å«äº† arguments å¯¹è±¡ã€‚å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨å¯ä»¥æ˜¯å…¨å±€ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å†…éƒ¨å‡½æ•°çš„å¤–éƒ¨å‡½æ•°ç¯å¢ƒã€‚</p>
</li>
</ol>
<h4 id="å˜é‡ç¯å¢ƒ-VariableEnvironment"><a href="#å˜é‡ç¯å¢ƒ-VariableEnvironment" class="headerlink" title="å˜é‡ç¯å¢ƒ (VariableEnvironment)"></a>å˜é‡ç¯å¢ƒ (VariableEnvironment)</h4><p>å˜é‡ç¯å¢ƒä¹Ÿæ˜¯ä¸€ä¸ªè¯æ³•ç¯å¢ƒï¼Œå› æ­¤å®ƒå…·æœ‰ä¸Šé¢å®šä¹‰çš„è¯æ³•ç¯å¢ƒçš„æ‰€æœ‰å±æ€§ã€‚</p>
<p>åœ¨ ES6 ä¸­ï¼Œè¯æ³•ç¯å¢ƒç»„ä»¶å’Œå˜é‡ç¯å¢ƒç»„ä»¶ä¹‹é—´çš„ä¸€ä¸ªåŒºåˆ«æ˜¯å‰è€…ç”¨äºå­˜å‚¨å‡½æ•°å£°æ˜å’Œå˜é‡ let å’Œ const ç»‘å®šï¼Œè€Œåè€…ä»…ç”¨äºå­˜å‚¨å˜é‡ var ç»‘å®šã€‚</p>
<h3 id="2-æ‰§è¡Œé˜¶æ®µ"><a href="#2-æ‰§è¡Œé˜¶æ®µ" class="headerlink" title="2.æ‰§è¡Œé˜¶æ®µ"></a>2.æ‰§è¡Œé˜¶æ®µ</h3><p>åœ¨æ­¤é˜¶æ®µï¼Œå®Œæˆå¯¹æ‰€æœ‰è¿™äº›å˜é‡çš„åˆ†é…ï¼Œæœ€åæ‰§è¡Œä»£ç ã€‚ï¼ˆåœ¨æ‰§è¡Œé˜¶æ®µï¼Œå¦‚æœ JavaScript å¼•æ“ä¸èƒ½åœ¨æºç ä¸­å£°æ˜çš„å®é™…ä½ç½®æ‰¾åˆ° let å˜é‡çš„å€¼ï¼Œå®ƒä¼šè¢«èµ‹å€¼ä¸º undefinedï¼‰</p>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ‰§è¡Œä¸Šä¸‹æ–‡</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹å®ç°ç»§æ‰¿çš„7ç§æ–¹å¼</title>
    <url>/2019/11/23/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF%E7%9A%847%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p>æœ‰å¿…è¦ææ¸…æ¥š JS å®ç°ç»§æ‰¿çš„æ–¹å¼â€¦</p>
<a id="more"></a>

<h2 id="åŸå‹é“¾ç»§æ‰¿"><a href="#åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿"></a>åŸå‹é“¾ç»§æ‰¿</h2><p>æ ¸å¿ƒï¼š<strong>å°†çˆ¶ç±»çš„å®ä¾‹ä½œä¸ºå­ç±»çš„åŸå‹</strong></p>
<p>é¦–å…ˆï¼Œè¦çŸ¥é“æ„é€ å‡½æ•°ã€åŸå‹å’Œå®ä¾‹ä¹‹é—´çš„å…³ç³»ï¼šæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆï¼Œè€Œå®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªåŸå‹å¯¹è±¡çš„æŒ‡é’ˆã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'çˆ¶ç±»çš„åå­—'</span></span><br><span class="line">&#125;</span><br><span class="line">Father.prototype.getFatherName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'çˆ¶ç±»çš„æ–¹æ³•'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'å­ç±»çš„åå­—'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ­¤æ—¶æœ‰Sonçš„åŸå‹å¯¹è±¡æœ‰æ–¹æ³•æˆ–å±æ€§ï¼Œä¸‹é¢Son.prototype = new Father()ï¼Œç”±äºåŸå‹é‡å®šå‘ï¼ŒåŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§ä¼šä¸¢å¤±</span></span><br><span class="line">Son.prototype.getAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å­ç±»çš„å¹´é¾„'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father() <span class="comment">// æ ¸å¿ƒ:åˆ›å»ºçˆ¶ç±»çš„å®ä¾‹ï¼Œå¹¶å°†è¯¥å®ä¾‹èµ‹å€¼ç»™å­ç±»çš„prototype</span></span><br><span class="line"></span><br><span class="line">Son.prototype.getSonName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å­ç±»çš„æ–¹æ³•'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son()</span><br><span class="line">son.getFatherName() <span class="comment">// çˆ¶ç±»çš„æ–¹æ³•</span></span><br><span class="line">Son.prototype.__proto__.getFatherName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç¼ºç‚¹ï¼šå¦‚æœæœ‰å¤šä¸ªå®ä¾‹å¯¹å…¶çˆ¶ç±»åŸå‹ï¼Œåˆ™ä¼šäº’ç›¸å½±å“</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å­ç±»æ”¹å˜çˆ¶ç±»çš„æ–¹æ³•'</span>)</span><br><span class="line">&#125;</span><br><span class="line">son.getFatherName() <span class="comment">// å­ç±»æ”¹å˜çˆ¶ç±»çš„æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li><p>çˆ¶ç±»ä½¿ç”¨ this å£°æ˜çš„å±æ€§(ç§æœ‰å±æ€§å’Œå…¬æœ‰å±æ€§)è¢«æ‰€æœ‰å®ä¾‹å…±äº«,åœ¨å¤šä¸ªå®ä¾‹ä¹‹é—´å¯¹å¼•ç”¨ç±»å‹æ•°æ®æ“ä½œä¼šäº’ç›¸å½±å“ã€‚</p>
</li>
<li><p>åˆ›å»ºå­ç±»å®ä¾‹æ—¶ï¼Œæ— æ³•å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚ã€‚</p>
</li>
</ol>
<h2 id="å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿-call"><a href="#å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿-call" class="headerlink" title="å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿(call)"></a>å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿(call)</h2><p>æ ¸å¿ƒï¼š<strong>ä½¿ç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å¢å¼ºå­ç±»å®ä¾‹</strong>ï¼Œå³å¤åˆ¶çˆ¶ç±»çš„å®ä¾‹å±æ€§ç»™å­ç±»</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line">Father.prototype.getFatherName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'çˆ¶ç±»çš„æ–¹æ³•'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  Father.call(<span class="keyword">this</span>, name, age) <span class="comment">// ç»§æ‰¿è‡ªFather</span></span><br><span class="line">  <span class="keyword">this</span>.job = job</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son(<span class="string">'jacky'</span>, <span class="number">22</span>, <span class="string">'å‰ç«¯å¼€å‘'</span>)</span><br><span class="line"><span class="comment">//son.getFatherName(); // Uncaught TypeError: son.getFatherName is not a function</span></span><br></pre></td></tr></table></figure>

<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å¯ä»¥å‘çˆ¶ç±»ä¼ é€’å‚æ•°,è€Œä¸”è§£å†³äº†åŸå‹é“¾ç»§æ‰¿ä¸­ï¼šçˆ¶ç±»å±æ€§ä½¿ç”¨ this å£°æ˜çš„å±æ€§ä¼šåœ¨æ‰€æœ‰å®ä¾‹å…±äº«çš„é—®é¢˜ã€‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>åªèƒ½ç»§æ‰¿çˆ¶ç±»é€šè¿‡ this å£°æ˜çš„å±æ€§/æ–¹æ³•ï¼Œä¸èƒ½ç»§æ‰¿çˆ¶ç±» prototype ä¸Šçš„å±æ€§/æ–¹æ³•ã€‚</li>
<li>æ¯æ¬¡å­ç±»å®ä¾‹åŒ–éƒ½è¦æ‰§è¡Œçˆ¶ç±»å‡½æ•°ï¼Œé‡æ–°å£°æ˜çˆ¶ç±» this é‡Œæ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œå› æ­¤çˆ¶ç±»æ–¹æ³•æ— æ³•å¤ç”¨ã€‚</li>
</ol>
<h2 id="ç»„åˆç»§æ‰¿"><a href="#ç»„åˆç»§æ‰¿" class="headerlink" title="ç»„åˆç»§æ‰¿"></a>ç»„åˆç»§æ‰¿</h2><p>æ ¸å¿ƒï¼š<strong>ç»„åˆä¸Šè¿°ä¸¤ç§æ–¹æ³•ï¼Œç”¨åŸå‹é“¾å®ç°å¯¹åŸå‹å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ï¼Œç”¨å€Ÿç”¨æ„é€ å‡½æ•°æŠ€æœ¯æ¥å®ç°å®ä¾‹å±æ€§çš„ç»§æ‰¿</strong>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">  <span class="keyword">this</span>.sex = <span class="string">'man'</span></span><br><span class="line">&#125;</span><br><span class="line">Father.prototype.getFatherName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'çˆ¶ç±»çš„æ–¹æ³•'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  Father.call(<span class="keyword">this</span>, name, age) <span class="comment">// ç¬¬äºŒæ¬¡è°ƒç”¨:åˆ›å»ºå­ç±»å‹å®ä¾‹çš„æ—¶å€™</span></span><br><span class="line">  <span class="keyword">this</span>.job = job</span><br><span class="line">&#125;</span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father() <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨:è®¾ç½®å­ç±»å‹å®ä¾‹çš„åŸå‹çš„æ—¶å€™</span></span><br><span class="line">Son.prototype.constructor = Son <span class="comment">// prototypeæ„é€ å™¨æŒ‡å›è‡ªå·±</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son(<span class="string">'jacky'</span>, <span class="number">22</span>, <span class="string">'å‰ç«¯å¼€å‘'</span>)</span><br><span class="line">son.getFatherName()</span><br><span class="line"><span class="built_in">console</span>.log(son)</span><br></pre></td></tr></table></figure>

<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/11/20/16e89812367319c7?w=517&h=227&f=png&s=19707" alt=""></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å¯ä»¥ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„å±æ€§ï¼Œå¯ä»¥ä¼ å‚ï¼Œå¯å¤ç”¨ã€‚</li>
<li>æ¯ä¸ªæ–°å­ç±»å¯¹è±¡å®ä¾‹å¼•å…¥çš„æ„é€ å‡½æ•°å±æ€§æ˜¯ç§æœ‰çš„ã€‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>ä¸¤æ¬¡è°ƒç”¨çˆ¶ç±»å‡½æ•°(new fatherFn()å’Œ fatherFn.call(this))ï¼Œé€ æˆä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚</li>
<li>åœ¨ä½¿ç”¨å­ç±»åˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶ï¼Œå…¶åŸå‹ä¸­ä¼šå­˜åœ¨ä¸¤ä»½ç›¸åŒå±æ€§/æ–¹æ³•çš„é—®é¢˜ã€‚</li>
</ol>
<p>æ‹“å±•ï¼š</p>
<h3 id="constructor-çš„ä½œç”¨"><a href="#constructor-çš„ä½œç”¨" class="headerlink" title="constructor çš„ä½œç”¨"></a>constructor çš„ä½œç”¨</h3><p><strong>è¿”å›åˆ›å»ºå®ä¾‹å¯¹è±¡çš„ Object æ„é€ å‡½æ•°çš„å¼•ç”¨</strong>ã€‚</p>
<blockquote>
<p>å½“æˆ‘ä»¬åªæœ‰å®ä¾‹å¯¹è±¡æ²¡æœ‰æ„é€ å‡½æ•°çš„å¼•ç”¨æ—¶ï¼š<br>æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯¹å®ä¾‹å¯¹è±¡ç»è¿‡å¤šè½®å¯¼å…¥å¯¼å‡ºï¼Œæˆ‘ä»¬ä¸çŸ¥é“å®ä¾‹æ˜¯ä»å“ªä¸ªå‡½æ•°ä¸­æ„é€ å‡ºæ¥æˆ–è€…è¿½è¸ªå®ä¾‹çš„æ„é€ å‡½æ•°ï¼Œè¾ƒä¸ºè‰°éš¾ã€‚(å®ƒä¸»è¦é˜²æ­¢ä¸€ç§æƒ…å†µä¸‹å‡ºé”™ï¼Œå°±æ˜¯ä½ æ˜¾å¼åœ°å»ä½¿ç”¨æ„é€ å‡½æ•°ã€‚æ¯”å¦‚ï¼Œæˆ‘å¹¶ä¸çŸ¥é“ instance æ˜¯ç”±å“ªä¸ªå‡½æ•°å®ä¾‹åŒ–å‡ºæ¥çš„ï¼Œä½†æ˜¯æˆ‘æƒ³ clone ä¸€ä¸ªï¼Œè¿™æ—¶å°±å¯ä»¥è¿™æ ·â€”â€”&gt;instance.constructor)<br>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡å®ä¾‹å¯¹è±¡çš„ constructor å±æ€§æ¥å¾—åˆ°æ„é€ å‡½æ•°çš„å¼•ç”¨</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> instance = <span class="keyword">new</span> sonFn() <span class="comment">// å®ä¾‹åŒ–å­ç±»</span></span><br><span class="line"><span class="keyword">export</span> instance;</span><br><span class="line"><span class="comment">// å¤šè½®å¯¼å…¥+å¯¼å‡ºï¼Œå¯¼è‡´sonFnè¿½è¸ªéå¸¸éº»çƒ¦ï¼Œæˆ–è€…ä¸æƒ³åœ¨æ–‡ä»¶ä¸­å†å¼•å…¥sonFn</span></span><br><span class="line"><span class="keyword">let</span>  fn = instance.constructor</span><br></pre></td></tr></table></figure>

<p>å› æ­¤æ¯æ¬¡<strong>é‡å†™</strong>å‡½æ•°çš„ prototype éƒ½åº”è¯¥ä¿®æ­£ä¸€ä¸‹ constructor çš„æŒ‡å‘ï¼Œä»¥ä¿æŒè¯»å– constructor æŒ‡å‘çš„ä¸€è‡´æ€§</p>
<h2 id="åŸå‹å¼ç»§æ‰¿ï¼ˆObject-create-ï¼‰"><a href="#åŸå‹å¼ç»§æ‰¿ï¼ˆObject-create-ï¼‰" class="headerlink" title="åŸå‹å¼ç»§æ‰¿ï¼ˆObject.create()ï¼‰"></a>åŸå‹å¼ç»§æ‰¿ï¼ˆObject.create()ï¼‰</h2><p>æ ¸å¿ƒï¼šåˆ©ç”¨ä¸€ä¸ªç©ºå¯¹è±¡ä½œä¸ºä¸­ä»‹ï¼Œå°†æŸä¸ªå¯¹è±¡ç›´æ¥èµ‹å€¼ç»™ç©ºå¯¹è±¡æ„é€ å‡½æ•°çš„åŸå‹ï¼Œç„¶åè¿”å›è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°å°±å˜æˆäº†ä¸ªå¯ä»¥éšæ„å¢æ·»å±æ€§çš„å®ä¾‹æˆ–å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Object.create() çš„å®ç°åŸç† */</span></span><br><span class="line"><span class="comment">// cloneObject()å¯¹ä¼ å…¥å…¶ä¸­çš„å¯¹è±¡æ‰§è¡Œäº†ä¸€æ¬¡æµ…æ‹·è´ï¼Œå°†æ„é€ å‡½æ•°Fçš„åŸå‹ç›´æ¥æŒ‡å‘ä¼ å…¥çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  F.prototype = obj <span class="comment">// å°†ä¼ è¿›æ¥objå¯¹è±¡ä½œä¸ºç©ºå‡½æ•°çš„prototype</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F() <span class="comment">// æ­¤å¯¹è±¡çš„åŸå‹ä¸ºè¢«ç»§æ‰¿çš„å¯¹è±¡, é€šè¿‡åŸå‹é“¾æŸ¥æ‰¾å¯ä»¥æ‹¿åˆ°è¢«ç»§æ‰¿å¯¹è±¡çš„å±æ€§</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> father = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">  courses: [<span class="string">'å‰ç«¯'</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// var son1 = Object.create(father); // æ•ˆæœä¸€æ ·</span></span><br><span class="line"><span class="keyword">var</span> son1 = cloneObject(father)</span><br><span class="line">son1.courses.push(<span class="string">'åç«¯'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> son2 = cloneObject(father)</span><br><span class="line">son2.courses.push(<span class="string">'å…¨æ ˆ'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(father.courses) <span class="comment">//  ["å‰ç«¯", "åç«¯", "å…¨æ ˆ"]</span></span><br></pre></td></tr></table></figure>

<p>ä¼˜ç‚¹ï¼š</p>
<p>ä»å·²æœ‰å¯¹è±¡è¡ç”Ÿæ–°å¯¹è±¡ï¼Œä¸éœ€è¦åˆ›å»ºè‡ªå®šä¹‰ç±»å‹</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>ä¸åŸå‹é“¾ç»§æ‰¿ä¸€æ ·ã€‚å¤šä¸ªå®ä¾‹å…±äº«è¢«ç»§æ‰¿å¯¹è±¡çš„å±æ€§ï¼Œå­˜åœ¨ç¯¡æ”¹çš„å¯èƒ½ï¼›ä¹Ÿæ— æ³•ä¼ å‚ã€‚</p>
<h2 id="å¯„ç”Ÿå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿå¼ç»§æ‰¿"></a>å¯„ç”Ÿå¼ç»§æ‰¿</h2><p>æ ¸å¿ƒï¼š<strong>åœ¨åŸå‹å¼ç»§æ‰¿çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªä»…ç”¨äºå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨å†…éƒ¨ä»¥æŸç§å½¢å¼æ¥åšå¢å¼ºå¯¹è±¡(å¢åŠ äº†ä¸€äº›æ–°çš„æ–¹æ³•å’Œå±æ€§)ï¼Œæœ€åè¿”å›å¯¹è±¡ã€‚</strong></p>
<p>ä½¿ç”¨åœºæ™¯ï¼šä¸“é—¨ä¸ºå¯¹è±¡æ¥åšæŸç§å›ºå®šæ–¹å¼çš„å¢å¼ºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAnother</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clone = <span class="built_in">Object</span>.create(obj)</span><br><span class="line">  clone.skill = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºè¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'run'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> clone</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> animal = &#123;</span><br><span class="line">  eat: <span class="string">'food'</span>,</span><br><span class="line">  drink: <span class="string">'water'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dog = createAnother(animal)</span><br><span class="line">dog.skill()</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç‚¹ï¼šæ²¡æœ‰åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ï¼Œå› ä¸ºåªæ˜¯å¥—äº†ä¸ªå£³å­å¢åŠ ç‰¹å®šå±æ€§/æ–¹æ³•è¿”å›å¯¹è±¡ï¼Œä»¥è¾¾åˆ°å¢å¼ºå¯¹è±¡çš„ç›®çš„</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>åŒåŸå‹å¼ç»§æ‰¿ï¼šåŸå‹é“¾ç»§æ‰¿å¤šä¸ªå®ä¾‹çš„å¼•ç”¨ç±»å‹å±æ€§æŒ‡å‘ç›¸åŒï¼Œå­˜åœ¨ç¯¡æ”¹çš„å¯èƒ½ï¼Œä¹Ÿæ— æ³•ä¼ é€’å‚æ•°</p>
<h2 id="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"></a>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</h2><p>æ ¸å¿ƒï¼šç»“åˆå€Ÿç”¨æ„é€ å‡½æ•°ä¼ é€’å‚æ•°å’Œå¯„ç”Ÿæ¨¡å¼å®ç°ç»§æ‰¿</p>
<ol>
<li>é€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°(call)æ¥ç»§æ‰¿çˆ¶ç±» this å£°æ˜çš„å±æ€§/æ–¹æ³•</li>
<li>é€šè¿‡åŸå‹é“¾æ¥ç»§æ‰¿æ–¹æ³•</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line">Father.prototype.getFatherName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'çˆ¶ç±»çš„æ–¹æ³•'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  Father.call(<span class="keyword">this</span>, name, age) <span class="comment">// å€Ÿç”¨æ„é€ ç»§æ‰¿: ç»§æ‰¿çˆ¶ç±»é€šè¿‡thiså£°æ˜å±æ€§å’Œæ–¹æ³•è‡³å­ç±»å®ä¾‹çš„å±æ€§ä¸Š</span></span><br><span class="line">  <span class="keyword">this</span>.job = job</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯„ç”Ÿå¼ç»§æ‰¿ï¼šå°è£…äº†son.prototypeå¯¹è±¡åŸå‹å¼ç»§æ‰¿father.prototypeçš„è¿‡ç¨‹ï¼Œå¹¶ä¸”å¢å¼ºäº†ä¼ å…¥çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">son, father</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clone = <span class="built_in">Object</span>.create(father.prototype) <span class="comment">// åŸå‹å¼ç»§æ‰¿ï¼šæµ…æ‹·è´father.prototypeå¯¹è±¡</span></span><br><span class="line">  clone.constructor = son <span class="comment">// å¢å¼ºå¯¹è±¡ï¼Œå¼¥è¡¥å› é‡å†™åŸå‹è€Œå¤±å»çš„é»˜è®¤çš„constructor å±æ€§</span></span><br><span class="line">  son.prototype = clone <span class="comment">// æŒ‡å®šå¯¹è±¡ï¼Œå°†æ–°åˆ›å»ºçš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»çš„åŸå‹</span></span><br><span class="line">&#125;</span><br><span class="line">inheritPrototype(Son, Father) <span class="comment">// å°†çˆ¶ç±»åŸå‹æŒ‡å‘å­ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å¢å­ç±»åŸå‹å±æ€§</span></span><br><span class="line">Son.prototype.getSonName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'å­ç±»çš„æ–¹æ³•'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son(<span class="string">'jacky'</span>, <span class="number">22</span>, <span class="string">'å‰ç«¯å¼€å‘'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(son)</span><br></pre></td></tr></table></figure>

<p><img src="https://images.weserv.nl/?url=https://user-gold-cdn.xitu.io/2019/11/23/16e97782ff645ca0?w=361&h=182&f=png&s=24333" alt=""></p>
<ul>
<li>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ç›¸å¯¹äºç»„åˆç»§æ‰¿æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</li>
</ul>
<ol>
<li>åªè°ƒç”¨ä¸€æ¬¡çˆ¶ç±» Father æ„é€ å‡½æ•°ã€‚ä¸å¿…ä¸ºäº†æŒ‡å®šå­ç±»çš„åŸå‹è€Œè°ƒç”¨æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯é—´æ¥çš„è®© Son.prototype è®¿é—®åˆ° Father.prototypeã€‚</li>
<li>é¿å…åœ¨å­ç±» prototype ä¸Šåˆ›å»ºä¸å¿…è¦å¤šä½™çš„å±æ€§ã€‚<br>ä½¿ç”¨åŸå‹å¼ç»§æ‰¿çˆ¶ç±»çš„ prototypeï¼Œä¿æŒäº†åŸå‹é“¾ä¸Šä¸‹æ–‡ä¸å˜, instanceof å’Œ isPrototypeOf()ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ã€‚ 3.å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ˜¯æœ€æˆç†Ÿçš„ç»§æ‰¿æ–¹æ³•, ä¹Ÿæ˜¯ç°åœ¨æœ€å¸¸ç”¨çš„ç»§æ‰¿æ–¹æ³•ï¼Œä¼—å¤š JS åº“é‡‡ç”¨çš„ç»§æ‰¿æ–¹æ¡ˆä¹Ÿæ˜¯å®ƒã€‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<p>ç¡¬è¦è¯´çš„è¯ï¼Œå°±æ˜¯ç»™å­ç±»åŸå‹æ·»åŠ å±æ€§å’Œæ–¹æ³•çš„æ—¶å€™ï¼Œä¸€å®šè¦æ”¾åœ¨ inheritPrototype()æ–¹æ³•ä¹‹å</p>
<h2 id="ES6-extends-ç»§æ‰¿ï¼ˆæœ€ä¼˜æ–¹å¼ï¼‰"><a href="#ES6-extends-ç»§æ‰¿ï¼ˆæœ€ä¼˜æ–¹å¼ï¼‰" class="headerlink" title="ES6 extends ç»§æ‰¿ï¼ˆæœ€ä¼˜æ–¹å¼ï¼‰"></a>ES6 extends ç»§æ‰¿ï¼ˆæœ€ä¼˜æ–¹å¼ï¼‰</h2><p>æ ¸å¿ƒï¼š ç±»ä¹‹é—´é€šè¿‡ extends å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œæ¸…æ™°æ–¹ä¾¿ã€‚ class ä»…ä»…æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³ä»ç„¶æ˜¯å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line">  skill() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'çˆ¶ç±»çš„æŠ€èƒ½'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Father</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age, job) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name, age) <span class="comment">// è°ƒç”¨çˆ¶ç±»çš„constructor,åªæœ‰è°ƒç”¨superä¹‹åï¼Œæ‰å¯ä»¥ä½¿ç”¨thiså…³é”®å­—</span></span><br><span class="line">    <span class="keyword">this</span>.job = job</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getInfo() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name, <span class="keyword">this</span>.age, <span class="keyword">this</span>.job)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> Son(<span class="string">'jacky'</span>, <span class="number">22</span>, <span class="string">'å‰ç«¯å¼€å‘'</span>)</span><br><span class="line">son.skill() <span class="comment">// çˆ¶ç±»çš„æŠ€èƒ½</span></span><br><span class="line">son.getInfo() <span class="comment">// jacky 22 å‰ç«¯å¼€å‘</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰ constructor æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«é»˜è®¤æ·»åŠ ï¼Œä»£ç å¦‚ä¸‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ˜¾å¼å®šä¹‰ï¼Œä»»ä½•ä¸€ä¸ªå­ç±»éƒ½æœ‰ constructor æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>å­ç±»å¿…é¡»åœ¨ constructor æ–¹æ³•ä¸­è°ƒç”¨ super æ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹æ—¶ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºå­ç±»è‡ªå·±çš„ this å¯¹è±¡ï¼Œå¿…é¡»å…ˆé€šè¿‡çˆ¶ç±»çš„æ„é€ å‡½æ•°å®Œæˆå¡‘é€ ï¼Œå¾—åˆ°ä¸çˆ¶ç±»åŒæ ·çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œç„¶åå†å¯¹å…¶è¿›è¡ŒåŠ å·¥ï¼ŒåŠ ä¸Šå­ç±»è‡ªå·±çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ã€‚å¦‚æœä¸è°ƒç”¨ super æ–¹æ³•ï¼Œå­ç±»å°±å¾—ä¸åˆ° this å¯¹è±¡ã€‚</p>
</blockquote>
<h2 id="ES5-ç»§æ‰¿ä¸-ES6-ç»§æ‰¿çš„åŒºåˆ«"><a href="#ES5-ç»§æ‰¿ä¸-ES6-ç»§æ‰¿çš„åŒºåˆ«" class="headerlink" title="ES5 ç»§æ‰¿ä¸ ES6 ç»§æ‰¿çš„åŒºåˆ«"></a>ES5 ç»§æ‰¿ä¸ ES6 ç»§æ‰¿çš„åŒºåˆ«</h2><ol>
<li>ES5 çš„ç»§æ‰¿å®è´¨ä¸Šæ˜¯å…ˆåˆ›å»ºå­ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå†å°†çˆ¶ç±»çš„æ–¹æ³•æ·»åŠ åˆ° this ä¸Š( Father.call(this) )ã€‚</li>
<li>ES6 çš„ç»§æ‰¿æ˜¯å…ˆåˆ›å»ºçˆ¶ç±»çš„å®ä¾‹å¯¹è±¡ thisï¼Œå†ç”¨å­ç±»çš„æ„é€ å‡½æ•°ä¿®æ”¹ thisã€‚</li>
<li>å› ä¸ºå­ç±»æ²¡æœ‰è‡ªå·±çš„ this å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»å…ˆè°ƒç”¨çˆ¶ç±»çš„ super()æ–¹æ³•ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>ç»§æ‰¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ç°swiperè‡ªå®šä¹‰åˆ†é¡µå™¨</title>
    <url>/2019/11/16/%E5%AE%9E%E7%8E%B0swiper%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E5%99%A8/</url>
    <content><![CDATA[<p><strong>é—®é¢˜:ä¸æƒ³ä½¿ç”¨swiper(ç”¨çš„æ˜¯4.5.1ç‰ˆæœ¬)çš„è‡ªå¸¦çš„åœ†é’®å¼çš„åˆ†é¡µå™¨ï¼Œéœ€è¦è‡ªå®šä¹‰æ ·å¼åŒæ—¶åˆ†é¡µå™¨éœ€è¦æ‘†åœ¨å›¾ç‰‡å¤–é¢</strong></p>
<a id="more"></a>

<p>è§£å†³åŠæ³•:åˆ©ç”¨swiperæä¾›çš„renderCustom()æ–¹æ³•</p>
<p>htmlæ–‡ä»¶</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-wrapper"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./img/IMG_20191109_141728.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./img/IMG_20191109_154050.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--åˆ†é¡µå™¨è¦æ”¾å›¾ç‰‡å¤–æ˜¾ç¤ºçš„è¯ï¼Œéœ€è¦ç§»å‡ºæ¥--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;div class="swiper-pagination"&gt;&lt;/div&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-pagination"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>jsæ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mySwiper = <span class="keyword">new</span> Swiper (<span class="string">'.swiper-container'</span>, &#123;</span><br><span class="line">        autoplay: &#123;</span><br><span class="line">            delay: <span class="number">3000</span>,</span><br><span class="line">            disableOnInteraction: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        pagination: &#123;</span><br><span class="line">            el: <span class="string">'.swiper-pagination'</span>,</span><br><span class="line">            type: <span class="string">'custom'</span>,</span><br><span class="line">            renderCustom: <span class="function"><span class="keyword">function</span> (<span class="params">swiper, current, total</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> customPaginationHtml = <span class="string">""</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; total; i++) &#123;</span><br><span class="line">                    <span class="comment">// åˆ¤æ–­å“ªä¸ªåˆ†é¡µå™¨æ­¤åˆ»åº”è¯¥è¢«æ¿€æ´»</span></span><br><span class="line">                    <span class="keyword">if</span>(i == (current - <span class="number">1</span>)) &#123;</span><br><span class="line">                        customPaginationHtml += <span class="string">'&lt;span class="swiper-pagination-customs swiper-pagination-customs-active"&gt;&lt;/span&gt;'</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        customPaginationHtml += <span class="string">'&lt;span class="swiper-pagination-customs"&gt;&lt;/span&gt;'</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> customPaginationHtml;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>cssæ–‡ä»¶</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.swiper-box</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.swiper-container</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">74vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">34vw</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">4vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.swiper-container</span> <span class="selector-class">.swiper-slide</span> <span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.swiper-pagination</span>&#123;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">74vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.swiper-pagination-bullet</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">4vw</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* åŒ…è£¹è‡ªå®šä¹‰åˆ†é¡µå™¨çš„divçš„ä½ç½®çš„æ ·å¼ */</span></span><br><span class="line"><span class="selector-class">.swiper-pagination-custom</span> &#123;</span><br><span class="line">    <span class="attribute">bottom</span>: -<span class="number">5vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.swiper-pagination-customs</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(../img/point-grey.png); <span class="comment">/* æœªè½®æ’­åˆ°çš„å›¾ç‰‡åˆ†é¡µæ ·å¼ */</span></span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="attribute">background-size</span>: contain;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1.4vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.4vw</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">2vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*è‡ªå®šä¹‰åˆ†é¡µå™¨æ¿€æ´»æ—¶çš„æ ·å¼è¡¨ç°*/</span></span><br><span class="line"><span class="selector-class">.swiper-pagination-customs-active</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(../img/point-green.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼š<img src="/images/swiper-pagination.png" alt=" "></p>
]]></content>
      <categories>
        <category>å¼€å‘æ‚è®°</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ç§»åŠ¨ç«¯åŸç”ŸJSä¹‹å¼€å¯å’Œç¦æ­¢é¡µé¢æ»šåŠ¨</title>
    <url>/2019/11/10/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%8E%9F%E7%94%9FJS%E4%B9%8B%E5%BC%80%E5%90%AF%E5%92%8C%E7%A6%81%E6%AD%A2%E9%A1%B5%E9%9D%A2%E6%BB%9A%E5%8A%A8/</url>
    <content><![CDATA[<p>åœ¨åšç§»åŠ¨ç«¯é¡µé¢é€šå¸¸æœ‰æ“ä½œéœ€è¦ç¦æ­¢é¡µé¢çš„æ»šåŠ¨ï¼Œæ¥çœ‹çœ‹åŸç”Ÿjsæ€ä¹ˆæ“ä½œ</p>
<a id="more"></a>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">    ev.preventDefault();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¦æ­¢é¡µé¢æ»šåŠ¨</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchmove'</span>, handler, &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>passiveï¼šfalseã€‚ è®¾ç½®è¯¥å±æ€§çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†åœ¨é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºå¯¼è‡´çš„å¡é¡¿ã€‚ç­‰å¾…ç›‘å¬å™¨çš„æ‰§è¡Œæ˜¯è€—æ—¶çš„ï¼Œæœ‰äº›ç”šè‡³è€—æ—¶å¾ˆæ˜æ˜¾ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é¡µé¢å¡é¡¿ã€‚å³ä¾¿ç›‘å¬å™¨æ˜¯ä¸ªç©ºå‡½æ•°ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸€å®šçš„å¡é¡¿ï¼Œæ¯•ç«Ÿç©ºå‡½æ•°çš„æ‰§è¡Œä¹Ÿä¼šè€—æ—¶ã€‚åŠ ä¸Š{ passive: false }èƒ½é˜²æ­¢é¡µé¢å¡é¡¿ã€‚<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯é¡µé¢æ»šåŠ¨</span></span><br><span class="line"><span class="built_in">document</span>.body.removeEventListener(<span class="string">'touchmove'</span>, handler, &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure></li>
<li>æ³¨æ„ç‚¹ï¼Œä¸èƒ½è¿™æ ·å†™<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯é¡µé¢æ»šåŠ¨</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchmove'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">    ev.preventDefault();</span><br><span class="line">&#125;, &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ å’Œç§»é™¤çš„å‡½æ•°å¯¹è±¡åº”è¯¥æ˜¯åŒä¸€ä¸ª,å¦åˆ™ç§»é™¤ä¸èµ·ä½œç”¨,å³listenerä¸èƒ½ç›´æ¥ç”¨åŒ¿åå‡½æ•°</li>
</ul>
]]></content>
      <categories>
        <category>å¼€å‘æ‚è®°</category>
      </categories>
      <tags>
        <tag>ç§»åŠ¨ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title>sessionStorageã€localStorageç”¨æ³•æ€»ç»“</title>
    <url>/2019/11/03/sessionStorage%E3%80%81localStorage%E7%94%A8%E6%B3%95%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>åœ¨å·¥ä½œä¸­ä½¿ç”¨ sessionStorage å­˜å‚¨æ•°æ®æ—¶ï¼Œå‘ç° sessionStorage æ— æ³•ç›´æ¥å­˜å‚¨æ•°ç»„å’Œå¯¹è±¡ï¼Œå¦‚å­˜å…¥å¯¹è±¡åˆ™æ˜¾ç¤ºä¸ºâ€[object Object]â€ï¼Œå¯¹æ­¤ä½œä¸‹è®°å½•ï¼Œé‡æ–°æ¸©ä¹  sessionStorage å’Œ localStorage</p>
<a id="more"></a>

<p>html5 ä¸­çš„ web Storage åŒ…æ‹¬äº†ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼šsessionStorage å’Œ localStorage</p>
<h2 id="å…±åŒç‚¹"><a href="#å…±åŒç‚¹" class="headerlink" title="å…±åŒç‚¹"></a>å…±åŒç‚¹</h2><p>å­˜å‚¨å¤§å°ä¸º 5MBï¼Œéƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¸ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’é€šä¿¡ï¼Œæœ‰ç›¸åŒçš„ Web API</p>
<h2 id="sessionStorageã€localStorage-åŒºåˆ«"><a href="#sessionStorageã€localStorage-åŒºåˆ«" class="headerlink" title="sessionStorageã€localStorage åŒºåˆ«"></a>sessionStorageã€localStorage åŒºåˆ«</h2><p>localStorage å­˜å‚¨æŒä¹…æ•°æ®ï¼Œæµè§ˆå™¨å…³é—­åæ•°æ®ä¸ä¸¢å¤±é™¤éä¸»åŠ¨åˆ é™¤æ•°æ®ï¼›</p>
<p>sessionStorage æ•°æ®åœ¨å½“å‰æµè§ˆå™¨çª—å£å…³é—­åè‡ªåŠ¨åˆ é™¤ã€‚</p>
<p>å› æ­¤<strong>sessionStorage å’Œ localStorage çš„ä¸»è¦åŒºåˆ«åœ¨äºä»–ä»¬å­˜å‚¨æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼ŒsessionStorage å­˜å‚¨çš„æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ä¸ªä¼šè¯ï¼Œè€Œ localStorage å­˜å‚¨çš„æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ°¸ä¹…ï¼Œé™¤éä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œå¦åˆ™æ°¸è¿œä¸ä¼šè¿‡æœŸ</p>
<h2 id="Web-Storage-API"><a href="#Web-Storage-API" class="headerlink" title="Web Storage API"></a>Web Storage API</h2><p>localStorage å’Œ sessionStorage æœ‰ç€ç»Ÿä¸€çš„ API æ¥å£ï¼Œä¸‹é¢ä»¥ sessionStorage ä¸ºä¾‹ä»‹ç»ä¸€ä¸‹ API æ¥å£ä½¿ç”¨æ–¹æ³•</p>
<h3 id="æ·»åŠ é”®å€¼å¯¹"><a href="#æ·»åŠ é”®å€¼å¯¹" class="headerlink" title="æ·»åŠ é”®å€¼å¯¹"></a>æ·»åŠ é”®å€¼å¯¹</h3><p><strong>setItem(key,value)ï¼šä¸ºæŒ‡å®š key å€¼è®¾ç½®ä¸€ä¸ªå¯¹åº”çš„ value å€¼</strong></p>
<p>é™¤äº†ä½¿ç”¨ setItem æ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ sessionStorage.key = value æˆ–è€… sessionStorage[â€˜keyâ€™] = value è¿™ä¸¤ç§å½¢å¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŠŠnameå€¼å­˜å‚¨åˆ°nameçš„é”®ä¸Š</span></span><br><span class="line">sessionStorage.setItem(<span class="string">'name'</span>, <span class="string">'jacky'</span>) <span class="comment">// æ³•1</span></span><br><span class="line"><span class="comment">// sessionStorage.name = 'jacky'; // æ³•2</span></span><br><span class="line"><span class="comment">// sessionStorage['name'] = 'jacky'; // æ³•3</span></span><br></pre></td></tr></table></figure>

<p><strong>æ·»åŠ æ•°ç»„å’Œå¯¹è±¡</strong></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ key å’Œ value å€¼å¿…é¡»æ˜¯<strong>å­—ç¬¦ä¸²å½¢å¼</strong>çš„ï¼Œå¦‚æœä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè°ƒç”¨å®ƒä»¬ç›¸åº”çš„ toString()æ–¹æ³•æ¥è½¬æ¢æˆå­—ç¬¦ä¸²å†å­˜å‚¨ã€‚</p>
<p>æ‰€ä»¥è¦å­˜å‚¨æ•°ç»„æˆ–å¯¹è±¡æ—¶ï¼Œåº”å…ˆè½¬æ¢æˆå­—ç¬¦ä¸²æ ¼å¼ï¼ˆå¦‚ JSON æ ¼å¼ï¼‰å†è¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨<strong>JSON.stringify(obj)æ–¹æ³•</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'jacky'</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">&#125;</span><br><span class="line">sessionStorage[<span class="string">'person'</span>] = <span class="built_in">JSON</span>.stringify(obj)</span><br><span class="line"><span class="comment">//sessionStorage['person'] = obj; ä¸èƒ½è¿™æ ·å­˜å‚¨ï¼Œè¿™æ ·å­˜è¿›å»ç»“æœæ˜¯"[object Object]"</span></span><br></pre></td></tr></table></figure>

<p>å­˜è¿›å»ä¹‹ååˆ™ä¸ºå­—ç¬¦ä¸²æ ¼å¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"&#123;"</span>name<span class="string">":"</span>jacky<span class="string">","</span>age<span class="string">":22&#125;"</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ‹¿å‡ºæ¥ä½¿ç”¨çš„æ—¶å€™åˆ™ä½¿ç”¨<strong>JSON.parse()æ–¹æ³•</strong>å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="built_in">JSON</span>.parse(sessionStorage[<span class="string">'person'</span>])</span><br></pre></td></tr></table></figure>

<p>åŒç†ï¼Œæ•°ç»„ä¹Ÿæ˜¯è¿™ä¸ªç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œå­˜å‚¨ã€‚</p>
<h3 id="getItemï¼ˆkeyï¼‰ï¼šæ ¹æ®æŒ‡å®šçš„-key-å€¼è·å–å¯¹åº”çš„-value-å€¼"><a href="#getItemï¼ˆkeyï¼‰ï¼šæ ¹æ®æŒ‡å®šçš„-key-å€¼è·å–å¯¹åº”çš„-value-å€¼" class="headerlink" title="getItemï¼ˆkeyï¼‰ï¼šæ ¹æ®æŒ‡å®šçš„ key å€¼è·å–å¯¹åº”çš„ value å€¼"></a>getItemï¼ˆkeyï¼‰ï¼šæ ¹æ®æŒ‡å®šçš„ key å€¼è·å–å¯¹åº”çš„ value å€¼</h3><p>å’Œ setItem ä¸€æ ·ï¼ŒgetItem ä¹Ÿæœ‰ä¸¤ç§ç­‰æ•ˆå½¢å¼,value = sessionStorage.key å’Œ value = sessionStorage[â€˜keyâ€™]ã€‚è·å–åˆ°çš„ value å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœéœ€è¦å…¶ä»–ç±»å‹ï¼Œéœ€è¦è‡ªå·±åšç±»å‹è½¬æ¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–å­˜å‚¨åˆ° name çš„é”®ä¸Šçš„å€¼</span></span><br><span class="line"><span class="keyword">var</span> name = sessionStorage.getItem(<span class="string">'name'</span>)</span><br><span class="line"><span class="comment">// var name = sessionStorage.name;</span></span><br><span class="line"><span class="comment">// var name = sessionStorage['name'];</span></span><br></pre></td></tr></table></figure>

<h3 id="removeItemï¼ˆkeyï¼‰ï¼šåˆ é™¤æŒ‡å®šçš„-key-å€¼å¯¹åº”çš„-value-å€¼"><a href="#removeItemï¼ˆkeyï¼‰ï¼šåˆ é™¤æŒ‡å®šçš„-key-å€¼å¯¹åº”çš„-value-å€¼" class="headerlink" title="removeItemï¼ˆkeyï¼‰ï¼šåˆ é™¤æŒ‡å®šçš„ key å€¼å¯¹åº”çš„ value å€¼"></a>removeItemï¼ˆkeyï¼‰ï¼šåˆ é™¤æŒ‡å®šçš„ key å€¼å¯¹åº”çš„ value å€¼</h3><p>æ³¨æ„ localStorage æ²¡æœ‰æ•°æ®è¿‡æœŸçš„æ¦‚å¿µï¼Œæ‰€æœ‰æ•°æ®å¦‚æœå¤±æ•ˆäº†ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨åˆ é™¤ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = sessionStorage.getItem(<span class="string">'name'</span>) <span class="comment">// "jacky"</span></span><br><span class="line">sessionStorage.removeItem(<span class="string">'name'</span>)</span><br><span class="line">name = sessionStorage.getItem(<span class="string">'name'</span>) <span class="comment">// null</span></span><br></pre></td></tr></table></figure>

<h3 id="clear-ï¼šåˆ é™¤æ‰€æœ‰å­˜å‚¨çš„å†…å®¹"><a href="#clear-ï¼šåˆ é™¤æ‰€æœ‰å­˜å‚¨çš„å†…å®¹" class="headerlink" title="clear()ï¼šåˆ é™¤æ‰€æœ‰å­˜å‚¨çš„å†…å®¹"></a>clear()ï¼šåˆ é™¤æ‰€æœ‰å­˜å‚¨çš„å†…å®¹</h3><p>å®ƒå’Œ removeItem ä¸åŒçš„åœ°æ–¹æ˜¯ removeItem åˆ é™¤çš„æ˜¯æŸä¸€é¡¹ï¼Œè€Œ clear æ˜¯åˆ é™¤æ‰€æœ‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¸…é™¤ localStorage</span></span><br><span class="line">sessionStorage.clear()</span><br><span class="line"><span class="keyword">var</span> len = sessionStorage.length <span class="comment">// 0</span></span><br><span class="line"><span class="comment">//lengthå±æ€§ç”¨äºè·å– sessionStorage ä¸­é”®å€¼å¯¹çš„æ•°é‡ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="key-index-ï¼šåœ¨æŒ‡å®šçš„æ•°å­—ä½ç½®è·å–è¯¥ä½ç½®çš„åå­—"><a href="#key-index-ï¼šåœ¨æŒ‡å®šçš„æ•°å­—ä½ç½®è·å–è¯¥ä½ç½®çš„åå­—" class="headerlink" title="key(index)ï¼šåœ¨æŒ‡å®šçš„æ•°å­—ä½ç½®è·å–è¯¥ä½ç½®çš„åå­—"></a>key(index)ï¼šåœ¨æŒ‡å®šçš„æ•°å­—ä½ç½®è·å–è¯¥ä½ç½®çš„åå­—</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯èµ‹å€¼æ—©çš„é”®å€¼å¯¹åº”çš„ç´¢å¼•å€¼å¤§ï¼Œèµ‹å€¼å®Œçš„é”®å€¼å¯¹åº”çš„ç´¢å¼•å°,key æ–¹æ³•å¯ç”¨äºéå† sessionStorage å­˜å‚¨çš„é”®å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">sessionStorage.setItem(<span class="string">'name'</span>, <span class="string">'jacky'</span>)</span><br><span class="line"><span class="keyword">var</span> key = sessionStorage.key(<span class="number">0</span>) <span class="comment">// 'name'</span></span><br><span class="line">sessionStorage.setItem(<span class="string">'age'</span>, <span class="number">10</span>)</span><br><span class="line">key = sessionStorage.key(<span class="number">0</span>) <span class="comment">// 'age'</span></span><br><span class="line">key = sessionStorage.key(<span class="number">1</span>) <span class="comment">// 'name'</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸¤è€…åº”ç”¨åœºæ™¯"><a href="#ä¸¤è€…åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸¤è€…åº”ç”¨åœºæ™¯"></a>ä¸¤è€…åº”ç”¨åœºæ™¯</h2><h3 id="sessionStorage-åº”ç”¨åœºæ™¯"><a href="#sessionStorage-åº”ç”¨åœºæ™¯" class="headerlink" title="sessionStorage åº”ç”¨åœºæ™¯"></a>sessionStorage åº”ç”¨åœºæ™¯</h3><p>è¿›è¡Œé¡µé¢ä¼ å€¼</p>
<h3 id="localStorage-åº”ç”¨åœºæ™¯"><a href="#localStorage-åº”ç”¨åœºæ™¯" class="headerlink" title="localStorage åº”ç”¨åœºæ™¯"></a>localStorage åº”ç”¨åœºæ™¯</h3><ol>
<li>é€‚åˆé•¿æœŸä¿å­˜åœ¨æœ¬åœ°çš„æ•°æ®</li>
<li>å¯ä»¥ç”¨äºå­˜å‚¨è¯¥æµè§ˆå™¨å¯¹è¯¥é¡µé¢çš„è®¿é—®æ¬¡æ•°</li>
</ol>
]]></content>
      <categories>
        <category>æ—¥å¸¸æ€»ç»“</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>storage</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼æ–¹æ³•ï¼ˆthis,applyï¼‰</title>
    <url>/2019/10/26/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E8%8E%B7%E5%8F%96%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC%E6%96%B9%E6%B3%95%EF%BC%88this-apply%EF%BC%89/</url>
    <content><![CDATA[<p>1.æ’åºæ³• 2.å‡è®¾æ³• 3.åŸºäº Math.max ä¸ apply 4.ES6 å±•å¼€è¿ç®—ç¬¦</p>
<a id="more"></a>

<h2 id="æ’åºæ³•"><a href="#æ’åºæ³•" class="headerlink" title="æ’åºæ³•"></a>æ’åºæ³•</h2><p>æ€è·¯ï¼šç»™æ•°ç»„å…ˆæ’åº(ç”±å¤§åˆ°å°æ’åº),ç¬¬ä¸€é¡¹å°±æ˜¯æœ€å¤§å€¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">20</span>, <span class="number">40</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> max1 = arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> b - a</span><br><span class="line">&#125;)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">console</span>.log(max1)</span><br></pre></td></tr></table></figure>

<h2 id="å‡è®¾æ³•"><a href="#å‡è®¾æ³•" class="headerlink" title="å‡è®¾æ³•"></a>å‡è®¾æ³•</h2><p>æ€è·¯ï¼šå‡è®¾ç¬¬ä¸€ä¸ªå€¼æ˜¯æœ€å¤§å€¼,ä¾æ¬¡éå†æ•°ç»„ä¸­åé¢çš„æ¯ä¸€é¡¹,å’Œå‡è®¾çš„å€¼è¿›è¡Œæ¯”è¾ƒ,å¦‚æœæ¯”å‡è®¾çš„å€¼è¦å¤§,æŠŠå½“å‰é¡¹èµ‹å€¼ç»™ MAXâ€¦</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">20</span>, <span class="number">40</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> max2 = arr[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= arr.length; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> item = arr[i]</span><br><span class="line">  item &gt; max2 ? (max2 = item) : <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(max2)</span><br></pre></td></tr></table></figure>

<h2 id="åŸºäº-Math-max-ä¸-apply"><a href="#åŸºäº-Math-max-ä¸-apply" class="headerlink" title="åŸºäº Math.max ä¸ apply"></a>åŸºäº Math.max ä¸ apply</h2><p>æ€è·¯ï¼šåŸºäºåŸºäº Math.max å®Œæˆå’Œ apply ç‰¹æ€§</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">20</span>, <span class="number">40</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, arr))</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ˜¯è¦é‡ç‚¹ç†è§£çš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œcall,apply,bind å¸¸å¸¸ä¼šè¢«æ”¾ä¸€èµ·æ¯”è¾ƒ<br>é¦–å…ˆï¼Œcallï¼Œapplyï¼Œbind è¿™ä¸‰ä¸ªæ–¹æ³•å…¶å®éƒ½æ˜¯ç»§æ‰¿è‡ª Function.prototype ä¸­çš„ï¼Œå±äºå®ä¾‹æ–¹æ³•ã€‚<br>ä¸‰ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼Œéƒ½æ˜¯<strong>æ”¹å˜ this çš„æŒ‡å‘</strong>ï¼Œåªæ˜¯ç”¨æ³•ç¨å¾®æœ‰äº›åŒºåˆ«</p>
<h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p>ä»€ä¹ˆæ˜¯ this</p>
<p><strong>this æ—¢ä¸æŒ‡å‘å‡½æ•°è‡ªèº«ï¼Œä¹Ÿä¸æŒ‡å‡½æ•°çš„è¯æ³•ä½œç”¨åŸŸ</strong>ã€‚å®ƒåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™æ˜¯ç¡®å®šä¸äº†çš„,åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰å‘ç”Ÿçš„ç»‘å®šï¼Œä¹Ÿå°±æ˜¯è¯´<code>thiså…·ä½“æŒ‡å‘ä»€ä¹ˆï¼Œå–å†³äºä½ æ˜¯æ€ä¹ˆè°ƒç”¨çš„å‡½æ•°</code>ã€‚</p>
<p>æ€ä¹ˆåˆ¤æ–­ this</p>
<blockquote>
<p>1.ç»™å½“å‰å…ƒç´ çš„æŸä¸ªäº‹ä»¶ç»‘å®šæ–¹æ³•, å½“äº‹ä»¶è§¦å‘æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œæ–¹æ³•ä¸­çš„ THIS æ˜¯å½“å‰æ“ä½œçš„å…ƒç´ å¯¹è±¡ 2.æ™®é€šå‡½æ•°æ‰§è¡Œï¼Œå‡½æ•°ä¸­çš„ THIS å–å†³äºæ‰§è¡Œçš„ä¸»ä½“ï¼Œè°æ‰§è¡Œçš„ï¼ŒTHIS å°±æ˜¯è°ï¼ˆæ‰§è¡Œä¸»ä½“ï¼šæ–¹æ³•æ‰§è¡Œï¼Œçœ‹æ–¹æ³•åå‰é¢æ˜¯å¦æœ‰â€œç‚¹â€ï¼Œæœ‰çš„è¯ï¼Œç‚¹å‰é¢æ˜¯è° this å°±æ˜¯è°ï¼Œæ²¡æœ‰ this æ˜¯ windowï¼‰<br>ä¸‹é¢çœ‹ä¸ªä¾‹å­ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  myFunction() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === obj)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">myFunction() <span class="comment">// true</span></span><br><span class="line">obj.myFunction() <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>å¯¹ this æœ‰äº†å¤§è‡´äº†è§£åï¼Œå†æ¥çœ‹ call æ–¹æ³•</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.name = <span class="string">'windowName'</span></span><br><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'objName'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">  name: <span class="string">'obj1Name'</span>,</span><br><span class="line">&#125;</span><br><span class="line">fn() <span class="comment">//windowName</span></span><br><span class="line">fn.call(obj) <span class="comment">// objNameï¼šè™½ç„¶æ˜¯fnè°ƒç”¨ï¼Œä½†callæ”¹å˜äº†thisæŒ‡å‘ï¼Œthisçš„æŒ‡å‘æ˜¯obj,æ•…obj.nameçš„å€¼ä¸ºobjName</span></span><br><span class="line">fn.call(obj1) <span class="comment">// obj1Name</span></span><br></pre></td></tr></table></figure>

<p>call æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œå†…éƒ¨å¤„ç†äº†ä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆæŠŠè¦æ“ä½œå‡½æ•°ä¸­çš„ this å…³é”®å­—å˜ä¸º call æ–¹æ³•ç¬¬ä¸€ä¸ªä¼ é€’çš„å®å‚å€¼,æŠŠ call æ–¹æ³•ç¬¬äºŒä¸ªåŠç¬¬äºŒä¸ªä»¥åçš„å®å‚è·å–åˆ°ï¼ŒæŠŠè¦æ“ä½œçš„å‡½æ•°æ‰§è¡Œï¼Œå¹¶ä¸”æŠŠç¬¬äºŒä¸ªä»¥åçš„ä¼ é€’è¿›æ¥çš„å®å‚ä¼ ç»™å‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a + b)</span><br><span class="line">&#125;</span><br><span class="line">fn.call(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p>CALL ä¸­çš„ç»†èŠ‚</p>
<blockquote>
<p>1.éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¦‚æœå‚æ•°ä¸ä¼ ï¼Œæˆ–è€…ç¬¬ä¸€ä¸ªä¼ é€’çš„æ˜¯ null/undefinedï¼Œthis éƒ½æŒ‡å‘ window 2.åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ï¼Œthis å°±æŒ‡å‘è°ï¼ˆåŒ…æ‹¬ null/undefinedï¼‰ï¼Œä¸ä¼  this æ˜¯ undefined<br>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœç”¨ applyï¼Œåˆ™æ˜¯</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a + b)</span><br><span class="line">&#125;</span><br><span class="line">fn.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>]) <span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p>applyï¼šå’Œ call åŸºæœ¬ä¸Šä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€åŒºåˆ«åœ¨äº<strong>ä¼ å‚æ–¹å¼</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fn.call(obj, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">fn.apply(obj, [<span class="number">10</span>, <span class="number">20</span>]) <span class="comment">//APPLYæŠŠéœ€è¦ä¼ é€’ç»™FNçš„å‚æ•°æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ï¼ˆæˆ–è€…ç±»æ•°ç»„ï¼‰ä¸­ä¼ é€’è¿›å»ï¼Œè™½ç„¶å†™çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯ä¹Ÿç›¸å½“äºç»™FNä¸€ä¸ªä¸ªçš„ä¼ é€’</span></span><br></pre></td></tr></table></figure>

<p>bindï¼šè¯­æ³•å’Œ call ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºç«‹å³æ‰§è¡Œè¿˜æ˜¯ç­‰å¾…æ‰§è¡Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fn.call(obj,<span class="number">10</span>,<span class="number">20</span>) æ”¹å˜FNä¸­çš„THIS,å¹¶ä¸”æŠŠFNç«‹å³æ‰§è¡Œ</span><br><span class="line">fn.bind(obj,<span class="number">10</span>,<span class="number">20</span>) æ”¹å˜FNä¸­çš„THIS,æ­¤æ—¶çš„FNå¹¶æ²¡æœ‰æ‰§è¡Œï¼ˆä¸å…¼å®¹IE6~<span class="number">8</span>ï¼‰</span><br></pre></td></tr></table></figure>

<p>bind è°ƒç”¨ä¹‹åæ˜¯è¿”å›åŸå‡½æ•°ï¼Œéœ€è¦å†è°ƒç”¨ä¸€æ¬¡æ‰è¡Œ</p>
<hr>
<p>å›åˆ°åŸé¢˜ï¼Œæ±‚æ•°ç»„æœ€å¤§å€¼<br>Math.max(arr)è¿™æ ·è‚¯å®šæ˜¯æŠ¥é”™çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max(ary)) <span class="comment">// =&gt; NaN</span></span><br><span class="line"><span class="comment">// =&gt; Math.maxæ˜¯è·å–ä¸€å †æ•°ä¸­çš„æœ€å¤§å€¼,éœ€è¦æˆ‘ä»¬æŠŠæ¯”è¾ƒçš„æ•°,ä¸€ä¸ªä¸ªçš„ä¼ é€’ç»™è¿™ä¸ªæ–¹æ³• //=&gt;Math.max(12,13,14...) =&gt;Math.max([12,13,14...])è¿™æ ·åªæ˜¯ä¼ é€’ä¸€ä¸ªå€¼</span></span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, arr)</span><br><span class="line"><span class="comment">// =&gt; åˆ©ç”¨äº†applyçš„ä¸€ä¸ªç‰¹å¾ï¼šè™½ç„¶æ”¾çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯æ‰§è¡Œæ–¹æ³•çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æŠŠæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ä¸€ä¸ªä¸ªçš„ä¼ é€’ç»™å‡½æ•°</span></span><br></pre></td></tr></table></figure>

<h2 id="ES6-å±•å¼€è¿ç®—ç¬¦"><a href="#ES6-å±•å¼€è¿ç®—ç¬¦" class="headerlink" title="ES6 å±•å¼€è¿ç®—ç¬¦"></a>ES6 å±•å¼€è¿ç®—ç¬¦</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max(...arr))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹ç”±ä¸€é“é¢˜æ¥æ€è€ƒé—­åŒ…</title>
    <url>/2019/10/24/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E7%94%B1%E4%B8%80%E9%81%93%E9%A2%98%E6%9D%A5%E6%80%9D%E8%80%83%E9%97%AD%E5%8C%85/</url>
    <content><![CDATA[<p>ä»ä¸€é“å¾ˆç»å…¸çš„é—­åŒ…é—®é¢˜è¯´èµ·â€¦</p>
<a id="more"></a>

<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><blockquote>
<p>é—­åŒ…å°±æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡çš„å‡½æ•°</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;ç‚¹å‡»liæ ‡ç­¾å¼¹å‡ºå¯¹åº”æ•°å­—&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;<span class="number">0</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;1&lt;/</span>li&gt;</span><br><span class="line">    &lt;li&gt;<span class="number">2</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;3&lt;/</span>li&gt;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var list = document.getElementsByTagName('li');</span></span><br><span class="line"><span class="regexp">    for(var i = 0;i &lt; list.length;i++)&#123;</span></span><br><span class="line"><span class="regexp">     list[i].onclick = function()&#123;</span></span><br><span class="line"><span class="regexp">         alert(i);</span></span><br><span class="line"><span class="regexp">     &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šé¢˜ï¼Œæœ€ä¸ºå¸¸è§çš„ä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œè§£é‡Šç”±è¿™é“é¢˜å¼•å‡ºçš„ js çŸ¥è¯†ç‚¹ï¼Œå¦‚ä¸Šæˆ‘ä»¬çŸ¥é“åœ¨æµè§ˆå™¨è¿è¡Œæ— è®ºç‚¹å‡»å“ªä¸ª li æ ‡ç­¾éƒ½æ˜¯å¼¹å‡º 3,é¦–å…ˆæ¥ç†è§£ä¸ºä»€ä¹ˆä¼šå¼¹å‡º 3ã€‚</p>
<p>ç¨‹åºé€šè¿‡ for å¾ªç¯ç»™æ¯ä¸ª li æ ‡ç­¾ç»‘å®šäº†äº‹ä»¶ï¼Œç„¶åé€šè¿‡ç‚¹å‡» li æ ‡ç­¾è§¦å‘æ–¹æ³•ï¼Œå³æ‰§è¡Œ alert(i)ã€‚js ä¸­æœ‰ä¸ªä½œç”¨åŸŸé“¾æŸ¥æ‰¾æœºåˆ¶ï¼Œé¦–å…ˆä¼šåœ¨ onclick è¿”å›çš„å‡½æ•°ä½œç”¨åŸŸæŸ¥æ‰¾ i å˜é‡çš„å€¼ï¼Œæ‰¾ä¸åˆ°åˆ™å¾€ä¸Šä¸€å±‚æ‰¾ iï¼Œä¸Šä¸€å±‚å³æ˜¯ window å…¨å±€ä½œç”¨åŸŸï¼Œå³æ‰¾åˆ°å…¨å±€å˜é‡ iï¼Œå³ for å¾ªç¯å®šä¹‰çš„ iã€‚</p>
<p>æ³¨æ„ for å¾ªç¯çš„ i å¹¶ä¸æ˜¯ç§æœ‰å˜é‡ï¼Œè€Œæ˜¯å…¨å±€å˜é‡ã€‚</p>
<blockquote>
<p>js ä¸­æ‰€æœ‰çš„äº‹ä»¶ç»‘å®šéƒ½æ˜¯å¼‚æ­¥ç¼–ç¨‹ï¼ˆå½“å‰è¿™ä»¶äº‹ä»¶æ²¡æœ‰å½»åº•å®Œæˆï¼Œä¸å†ç­‰å¾…ï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»»åŠ¡ï¼‰</p>
</blockquote>
<p>å½“ç»‘å®š onclick äº‹ä»¶åï¼Œä¸éœ€è¦ç­‰å¾…æ‰§è¡Œï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå¾ªç¯ä»»åŠ¡ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ç‚¹å‡»æ‰§è¡Œæ–¹æ³•çš„æ—¶å€™ï¼Œå¾ªç¯æ—©å·²ç»“æŸ,å³æ˜¯æœ€å i=3ã€‚æ•…ç¨‹åºæ‰§è¡Œåå…¨å±€å˜é‡ i è¢«å¾ªç¯æ‰§è¡Œåèµ‹å€¼ä¸ºæœ€ç»ˆçš„ 3ï¼Œæ‰€ä»¥å½“ç‚¹å‡»çš„æ—¶å€™ï¼Œå¤–å±‚å¾ªç¯å·²ç»ç»“æŸï¼Œé¡µé¢åŠ è½½å®Œæˆé¢„ç¤ºç€ js ä»£ç éƒ½å·²ç»æ‰§è¡Œå®Œæˆï¼Œå³æ‰§è¡Œ alert(i)æ—¶ï¼Œç”±äº i ä¸æ˜¯ç§æœ‰å˜é‡ï¼Œä¾¿ä¼šæ‰¾åˆ°ä¸Šä¸€çº§ window ä½œç”¨åŸŸå…¨å±€çš„ iï¼Œæ‰€ä»¥æ— è®ºç‚¹å‡»å“ªä¸ª li æ ‡ç­¾éƒ½æ˜¯å¼¹å‡º 3</p>
<h2 id="ä¸ºä»€ä¹ˆè¦ç”¨é—­åŒ…"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨é—­åŒ…" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨é—­åŒ…"></a>ä¸ºä»€ä¹ˆè¦ç”¨é—­åŒ…</h2><p>é‚£ä¹ˆï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„ç¼˜ç”±ï¼Œåœ¨äº i æ¯æ¬¡åœ¨é¡µé¢åŠ è½½å®Œå°±èµ‹å€¼ä¸º 3ï¼Œalert(i)çš„æ—¶å€™æ€»æ˜¯æ‰¾åˆ°å…¨å±€å˜é‡ iã€‚åœ¨ ES5 ä¼ ç»Ÿè¯­æ³•ä¸­ï¼Œèƒ½å½¢æˆä½œç”¨åŸŸçš„åªæœ‰å…¨å±€å’Œå‡½æ•°ï¼Œç°åœ¨æ¯æ¬¡ i æ‰¾çš„éƒ½æ˜¯å…¨å±€ï¼Œé‚£ä¹ˆè¦ä¿ä½ i çš„å€¼åªèƒ½åœ¨å…¨å±€å’Œ onclick è¿”å›å‡½æ•°çš„ä½œç”¨åŸŸä¸­é—´å†åŠ ä¸€ä¸ªå°çš„ç§æœ‰ä½œç”¨åŸŸï¼Œå³æ˜¯å¤§çš„ä½œç”¨åŸŸå¤–å†åŠ ä¸€ä¸ªå°çš„ä½œç”¨åŸŸï¼Œè¿™æ · i å¾€ä¸Šä¸€å±‚ä½œç”¨åŸŸæŸ¥æ‰¾æ—¶ï¼Œå°±ä¼šè·å–å°ä½œç”¨åŸŸçš„ i çš„å€¼ï¼Œè€Œä¸ä¼šå»è·å–å…¨å±€å˜é‡çš„ i å€¼ã€‚</p>
<p>è¿™ä¸ªæ€è·¯è§£å†³é—®é¢˜å°±éœ€è¦å¼•å…¥é—­åŒ…ï¼Œåœ¨è¿™ä¸ªç†è§£ä¸Šé—­åŒ…æ˜¯æŒ‡å‡½æ•°å˜é‡å¯ä»¥ä¿å­˜åœ¨å‡½æ•°ä½œç”¨åŸŸå†…ï¼Œå› æ­¤çœ‹èµ·æ¥æ˜¯å‡½æ•°å°†å˜é‡â€œåŒ…è£¹â€äº†èµ·æ¥ã€‚äºæ˜¯ï¼Œä»£ç æ”¹æˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">  list[i].onclick = (<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//å½¢å‚n</span></span><br><span class="line">    <span class="comment">//=&gt;è®©è‡ªæ‰§è¡Œå‡½æ•°æ‰§è¡Œ,æŠŠæ‰§è¡Œçš„è¿”å›å€¼(return)èµ‹å€¼ç»™onclick</span></span><br><span class="line">    <span class="comment">//ï¼ˆæ­¤å¤„onclickç»‘å®šçš„æ˜¯è¿”å›çš„å°å‡½æ•°ï¼Œç‚¹å‡»çš„æ—¶å€™æ‰§è¡Œçš„æ˜¯å°å‡½æ•°ï¼‰,</span></span><br><span class="line">    <span class="comment">// è‡ªæ‰§è¡Œå‡½æ•°åœ¨ç»™äº‹ä»¶èµ‹å€¼çš„æ—¶å€™å°±å·²ç»æ‰§è¡Œäº†</span></span><br><span class="line">    <span class="comment">// è‡ªæ‰§è¡Œå‡½æ•°å½¢æˆä¸€ä¸ªç§æœ‰ä½œç”¨åŸŸ</span></span><br><span class="line">    <span class="keyword">var</span> i = n</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      alert(i)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(i) <span class="comment">//ä¼ å…¥å®å‚i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ªç¯ä¸‰æ¬¡ï¼Œå½¢æˆä¸‰ä¸ªä¸é”€æ¯çš„ç§æœ‰ä½œç”¨åŸŸï¼ˆè‡ªæ‰§è¡Œå‡½æ•°æ‰§è¡Œï¼‰ï¼Œè€Œæ¯ä¸€ä¸ªä¸é”€æ¯çš„æ ˆå†…å­˜ä¸­éƒ½å­˜å‚¨äº†ä¸€ä¸ªç§æœ‰å˜é‡ iï¼Œè€Œè¿™ä¸ªå€¼åˆ†åˆ«æ˜¯æ¯ä¸€æ¬¡æ‰§è¡Œä¼ é€’è¿›æ¥çš„å…¨å±€ i çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯ï¼šç¬¬ä¸€ä¸ªä¸é”€æ¯çš„ä½œç”¨åŸŸå­˜å‚¨çš„æ˜¯ 0ï¼Œç¬¬äºŒä¸ªæ˜¯ 1ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ 2ï¼Œç¬¬å››ä¸ªæ˜¯ 3ï¼‰ï¼›å½“ç‚¹å‡»çš„æ—¶å€™ï¼Œæ‰§è¡Œè¿”å›çš„å°å‡½æ•°ï¼Œé‡åˆ°å˜é‡ iï¼Œå‘å®ƒè‡ªå·±çš„ä¸Šçº§ä½œç”¨åŸŸæŸ¥æ‰¾ã€‚è¿™æ ·å°±è¾¾åˆ°äº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœï¼Œè¿™ç§é—­åŒ…å®ç°ï¼Œä¹Ÿå¯ä»¥æœ‰å¦ä¸€ç§å†™æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*åŸç†åŒæ³•äºŒéƒ½æ˜¯å½¢æˆä¸‰ä¸ªä¸é”€æ¯çš„ç§æœ‰ä½œç”¨åŸŸ,åˆ†åˆ«å­˜å‚¨éœ€è¦çš„ç´¢å¼•å€¼*/</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">  ;(<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    list[n].onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      alert(n)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºåˆå§‹çš„ä»£ç ï¼Œå¦‚æœè¯´ä¸ºä»€ä¹ˆä¸èƒ½å®ç°ï¼Œé‚£åŸå› å°±å¯å½’çº³ä¸ºï¼š</p>
<blockquote>
</blockquote>
<ol>
<li>æ‰§è¡Œæ–¹æ³•,å½¢æˆä¸€ä¸ªç§æœ‰çš„æ ˆå†…å­˜,é‡åˆ°å˜é‡ i,i ä¸æ˜¯ç§æœ‰å˜é‡,å‘ä¸Šä¸€çº§ä½œç”¨åŸŸæŸ¥æ‰¾ï¼ˆä¸Šçº§ä½œç”¨åŸŸ windowï¼‰</li>
<li>æ‰€æœ‰çš„äº‹ä»¶ç»‘å®šéƒ½æ˜¯å¼‚æ­¥ç¼–ç¨‹,ç»‘å®šäº‹ä»¶å,ä¸éœ€è¦ç­‰å¾…æ‰§è¡Œ,ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå¾ªç¯ä»»åŠ¡,æ‰€ä»¥å½“æˆ‘ä»¬ç‚¹å‡»æ‰§è¡Œæ–¹æ³•çš„æ—¶å€™,å¾ªç¯æ—©å·²ç»“æŸï¼ˆè®©å…¨å±€çš„ i ç­‰äºå¾ªç¯æœ€åçš„ç»“æœ 3ï¼‰</li>
</ol>
<h2 id="ES6-è¯­æ³•çš„è§£å†³æ–¹å¼"><a href="#ES6-è¯­æ³•çš„è§£å†³æ–¹å¼" class="headerlink" title="ES6 è¯­æ³•çš„è§£å†³æ–¹å¼"></a>ES6 è¯­æ³•çš„è§£å†³æ–¹å¼</h2><p>åœ¨ ES6 ä¸­ï¼Œè§£å†³è¿™ç§é—®é¢˜åªéœ€è¦ä¸€ä¸ª let å˜é‡ï¼ŒES6 ä¸­æ‰æœ‰å—çº§ä½œç”¨åŸŸï¼ˆç±»ä¼¼äºç§æœ‰ä½œç”¨åŸŸï¼‰çš„æ¦‚å¿µ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">  list[i].onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é—­åŒ…å¯¹å†…å­˜çš„å½±å“"><a href="#é—­åŒ…å¯¹å†…å­˜çš„å½±å“" class="headerlink" title="é—­åŒ…å¯¹å†…å­˜çš„å½±å“"></a>é—­åŒ…å¯¹å†…å­˜çš„å½±å“</h2><p>ä»ä¸Šé¢å¯çŸ¥ï¼Œæ¯æ¬¡ for éƒ½ä¼šå½¢æˆä¸€ä¸ªç§æœ‰ä½œç”¨åŸŸï¼Œæ¯ä¸ªéƒ½é‡Œé¢ä¿å­˜çš„å˜é‡ i çš„å€¼ï¼Œç¨‹åºè¿è¡Œåè¿™äº›ä½œç”¨åŸŸå¹¶ä¸ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥ç”±äºé—­åŒ…ä¼šæºå¸¦åŒ…å«å®ƒçš„å‡½æ•°çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥ä¼šæ¯”å…¶ä»–å‡½æ•°å ç”¨æ›´å¤šå†…å®¹ï¼Œè¿‡åº¦ä½¿ç”¨é—­åŒ…ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šã€‚</p>
<p>åœ¨çœŸå®é¡¹ç›®ä¸­ä¸ºäº†ä¿è¯ JS çš„æ€§èƒ½ï¼ˆå †æ ˆå†…å­˜çš„æ€§èƒ½ä¼˜åŒ–ï¼‰ï¼Œåº”è¯¥å°½å¯èƒ½çš„å‡å°‘é—­åŒ…çš„ä½¿ç”¨ï¼ˆä¸é”€æ¯çš„å †æ ˆå†…å­˜æ˜¯è€—æ€§èƒ½çš„ï¼‰</p>
<h2 id="å †å†…å­˜å’Œæ ˆå†…å­˜çš„é‡Šæ”¾"><a href="#å †å†…å­˜å’Œæ ˆå†…å­˜çš„é‡Šæ”¾" class="headerlink" title="å †å†…å­˜å’Œæ ˆå†…å­˜çš„é‡Šæ”¾"></a>å †å†…å­˜å’Œæ ˆå†…å­˜çš„é‡Šæ”¾</h2><p>è¿™é‡Œåˆè¦æåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œjs ä¸­å­˜å‚¨æ–¹å¼çš„åˆ†ç±»ï¼š</p>
<blockquote>
<p>JS ä¸­çš„å†…å­˜åˆ†ä¸ºå †å†…å­˜å’Œæ ˆå†…å­˜<br>å †å†…å­˜ï¼šå­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹å€¼ï¼ˆå¯¹è±¡ï¼šé”®å€¼å¯¹ å‡½æ•°ï¼šä»£ç å­—ç¬¦ä¸²ï¼‰<br>æ ˆå†…å­˜ï¼šæä¾› JS ä»£ç æ‰§è¡Œçš„ç¯å¢ƒå’Œå­˜å‚¨åŸºæœ¬ç±»å‹å€¼</p>
</blockquote>
<p>ç²—æš´ç†è§£ var å®šä¹‰çš„å˜é‡å­˜åœ¨æ ˆå†…å­˜ä¸­ï¼Œå¦‚ for å¾ªç¯ä¸­çš„ i æ˜¯å­˜åœ¨æ ˆå†…å­˜ä¸­çš„ï¼›è€Œå‡½æ•°ï¼Œå®ƒæ˜¯å­˜åœ¨å †å†…å­˜ä¸­</p>
<p><strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œæ‰€å½¢æˆçš„ç§æœ‰ä½œç”¨åŸŸï¼ˆæ ˆå†…å­˜ï¼‰éƒ½ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ï¼ˆåœ¨æ ˆå†…å­˜ä¸­å­˜å‚¨çš„å€¼ä¹Ÿéƒ½ä¼šé‡Šæ”¾æ‰ï¼‰</strong>ï¼Œé‚£ä¸ºä»€ä¹ˆé—­åŒ…çš„æ ˆå†…å­˜ä¸ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾æ‰ï¼Œåœ¨ js ä¸­ä¹Ÿæœ‰ç‰¹æ®Šä¸è¢«é”€æ¯çš„æƒ…å†µï¼š</p>
<blockquote>
<p>1.å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œå½“å‰å½¢æˆçš„æ ˆå†…å­˜ä¸­ï¼ŒæŸäº›å†…å®¹è¢«æ ˆå†…å­˜ä»¥å¤–çš„å˜é‡å ç”¨äº†ï¼Œæ­¤æ—¶æ ˆå†…å­˜ä¸èƒ½é‡Šæ”¾ï¼ˆä¸€æ—¦é‡Šæ”¾å¤–é¢æ‰¾ä¸åˆ°åŸæœ‰çš„å†…å®¹äº†ï¼‰ 2.å…¨å±€æ ˆå†…å­˜åªæœ‰åœ¨é¡µé¢å…³é—­çš„æ—¶å€™æ‰ä¼šè¢«é‡Šæ”¾æ‰</p>
</blockquote>
<p>é—­åŒ…åˆ™æ˜¯å±äºç¬¬ä¸€ç§æƒ…å†µï¼Œonclick å‡½æ•°å½¢æˆçš„æ ˆå†…å­˜ï¼Œè¢«å°å‡½æ•°ã€alert(i)ï¼Œi æ‰¾åˆ° onclick ä½œç”¨åŸŸè·å– i å€¼ã€‘å ç”¨äº† onclick å‡½æ•°çš„æ ˆå†…å­˜ï¼ˆå˜é‡ i æ˜¯å­˜åœ¨æ ˆå†…å­˜ä¸­ï¼‰ï¼Œæ•…æ ˆå†…å­˜ä¸èƒ½è¢«é‡Šæ”¾ï¼Œæ‰€ä»¥æ‰ä¼šè¯´é—­åŒ…è¿‡åº¦ä½¿ç”¨å®¹æ˜“å¯¼è‡´å†…å­˜è¢«å ç”¨è¿‡å¤šï¼Œå› ä¸ºä¸ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚</p>
<p><strong>å †å†…å­˜çš„é‡Šæ”¾</strong></p>
<blockquote>
<p>å †å†…å­˜è®©æ‰€æœ‰å¼•ç”¨å †å†…å­˜ç©ºé—´åœ°å€çš„å˜é‡èµ‹å€¼ä¸º null å³å¯ï¼ˆæ²¡æœ‰å˜é‡å ç”¨è¿™ä¸ªå †å†…å­˜äº†ï¼Œæµè§ˆå™¨ä¼šåœ¨ç©ºé—²çš„æ—¶å€™æŠŠå®ƒé‡Šæ”¾æ‰ï¼‰</p>
</blockquote>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>é—­åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£JavaScriptä¹‹å˜é‡æå‡</title>
    <url>/2019/10/23/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E4%B9%8B%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87/</url>
    <content><![CDATA[<p>åŸç†ï¼šJS å¼•æ“çš„å·¥ä½œæ–¹å¼æ˜¯å…ˆè§£æä»£ç ï¼Œè·å–æ‰€æœ‰è¢«å£°æ˜çš„å˜é‡ï¼›ç„¶ååœ¨è¿è¡Œã€‚JS ä»£ç è‡ªä¸Šè€Œä¸‹æ‰§è¡Œä¹‹å‰ï¼Œæµè§ˆå™¨é¦–å…ˆä¼šæŠŠæ‰€æœ‰å¸¦â€VARâ€/â€œFUNCTIONâ€å…³é”®è¯çš„è¿›è¡Œæå‰â€å£°æ˜â€æˆ–è€…â€å®šä¹‰â€ï¼Œè¿™ç§é¢„å…ˆå¤„ç†æœºåˆ¶ç§°ä¹‹ä¸º â€œå˜é‡æå‡â€ã€‚</p>
<a id="more"></a>

<h2 id="å˜é‡æå‡"><a href="#å˜é‡æå‡" class="headerlink" title="å˜é‡æå‡"></a>å˜é‡æå‡</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">//undefined undefined</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">12</span>,</span><br><span class="line">  b = <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b) <span class="comment">//=&gt;undefined 12</span></span><br><span class="line">  <span class="keyword">var</span> a = (b = <span class="number">13</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(a, b) <span class="comment">//=&gt;13 13</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn()</span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">//=&gt;12 13</span></span><br></pre></td></tr></table></figure>

<ul>
<li>undefined undefinedï¼šé¦–å…ˆè¾“å‡ºè¿™ä¸ªç»“æœæ˜¯å› ä¸ºå˜é‡æå‡ï¼Œå³å‰ä¸‰è¡Œå˜æˆ</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a</span><br><span class="line"><span class="keyword">var</span> b</span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">//undefined undefined</span></span><br><span class="line">a = <span class="number">12</span></span><br><span class="line">b = <span class="number">12</span></span><br></pre></td></tr></table></figure>

<ul>
<li>undefined 12ï¼šæ¥ä¸‹æ¥æ‰§è¡Œå‡½æ•° fnï¼ˆfn ä¸€å¼€å§‹ä¹Ÿè¢«æ‰§è¡Œäº†å˜é‡æå‡,åªä¸è¿‡å‡½æ•°ä¸­å­˜å‚¨çš„éƒ½æ˜¯å­—ç¬¦ä¸²è€Œå·²ï¼‰ï¼Œå¯¹ fn å†…éƒ¨è¿›è¡Œåˆ†æï¼Œå³å†…éƒ¨ä»£ç å˜æˆï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a</span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">//undefined 12</span></span><br><span class="line">a = <span class="number">13</span></span><br><span class="line">b = <span class="number">13</span> <span class="comment">//ä¸åŠ varçš„æœ¬è´¨æ˜¯WINçš„å±æ€§ï¼Œå³ç›¸å½“äºwindow.b = 13;</span></span><br><span class="line"><span class="built_in">console</span>.log(a, b) <span class="comment">//13 13</span></span><br></pre></td></tr></table></figure>

<p>ä¸€å¼€å§‹ b åœ¨ fn å†…éƒ¨æ‰¾ä¸åˆ°ï¼Œä¾¿ä¼šå¼€å§‹å¾€ä¸Šä¸€å±‚æ‰¾ï¼Œæ‰¾åˆ°äº†å…¨å±€çš„ bï¼Œäºæ˜¯ b è¾“å‡º 12ã€‚</p>
<p>å½“ç»è¿‡ var a = b = 13; åï¼Œb è¢«èµ‹å€¼ä¸º 13ï¼Œäºæ˜¯è¾“å‡ºå…ˆä»å‡½æ•°å†…éƒ¨æ‰¾ bï¼Œæ‰¾åˆ°äº† b=13ï¼Œç¬¬äºŒæ¬¡è¾“å‡º b ä¸º 13ã€‚ï¼ˆï¼åŒæ—¶ï¼Œæœ€å…ˆå®šä¹‰çš„å…¨å±€å˜é‡ b = 12 ä¹Ÿè¢«èµ‹å€¼ä¸º 13ï¼Œæ•…æœ€åçš„ b ä¹Ÿç­‰äº 13ï¼‰</p>
<blockquote>
<p>ç§æœ‰ä½œç”¨åŸŸä¸­å¸¦ var å’Œä¸å¸¦ var çš„åŒºåˆ«ï¼š</p>
<ol>
<li>å¸¦ var çš„åœ¨ç§æœ‰ä½œç”¨äºå˜é‡æå‡é˜¶æ®µï¼Œéƒ½å£°æ˜ä¸ºç§æœ‰å˜é‡ï¼Œå’Œå¤–ç•Œæ²¡æœ‰ä»»ä½•çš„å…³ç³»</li>
<li>ä¸å¸¦ var ä¸æ˜¯ç§æœ‰å˜é‡ï¼Œä¼šå‘å®ƒçš„ä¸Šçº§ä½œç”¨äºæŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ° window ä¸ºæ­¢ï¼ˆè¿™ç§æŸ¥æ‰¾æœºåˆ¶å«åšï¼šâ€œä½œç”¨åŸŸé“¾â€ï¼‰ï¼Œä¹Ÿå°±æ˜¯åœ¨ç§æœ‰ä½œç”¨åŸŸä¸­æ“ä½œçš„è¿™ä¸ªéç§æœ‰å˜é‡ï¼Œæ˜¯ä¸€ç›´æ“ä½œåˆ«äººçš„</li>
</ol>
</blockquote>
<h2 id="åªå¯¹ç­‰å·å·¦è¾¹è¿›è¡Œå˜é‡æå‡"><a href="#åªå¯¹ç­‰å·å·¦è¾¹è¿›è¡Œå˜é‡æå‡" class="headerlink" title="åªå¯¹ç­‰å·å·¦è¾¹è¿›è¡Œå˜é‡æå‡"></a>åªå¯¹ç­‰å·å·¦è¾¹è¿›è¡Œå˜é‡æå‡</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">sum()</span><br><span class="line">fn() <span class="comment">// Uncaught TypeError: fn is not a function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//=&gt;åŒ¿åå‡½æ•°ä¹‹å‡½æ•°è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'fn'</span>)</span><br><span class="line">&#125; <span class="comment">//=&gt;ä»£ç æ‰§è¡Œåˆ°æ­¤å¤„ä¼šæŠŠå‡½æ•°å€¼èµ‹å€¼ç»™fn</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//=&gt;æ™®é€šçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sum'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ¡ä»¶åˆ¤æ–­ä¸‹çš„å˜é‡æå‡"><a href="#æ¡ä»¶åˆ¤æ–­ä¸‹çš„å˜é‡æå‡" class="headerlink" title="æ¡ä»¶åˆ¤æ–­ä¸‹çš„å˜é‡æå‡"></a>æ¡ä»¶åˆ¤æ–­ä¸‹çš„å˜é‡æå‡</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åœ¨å½“å‰ä½œç”¨åŸŸä¸‹ï¼Œä¸ç®¡æ¡ä»¶æ˜¯å¦æˆç«‹éƒ½è¦è¿›è¡Œå˜é‡æå‡</span></span><br><span class="line"><span class="comment"> *   =&gt;å¸¦VARçš„è¿˜æ˜¯åªå£°æ˜</span></span><br><span class="line"><span class="comment"> *   =&gt;å¸¦FUNCTIONçš„åœ¨è€ç‰ˆæœ¬æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶ä¸‹ï¼Œå£°æ˜å’Œå®šä¹‰éƒ½å¤„ç†ï¼Œä½†æ˜¯ä¸ºäº†è¿åˆES6ä¸­çš„å—çº§ä½œç”¨</span></span><br><span class="line"><span class="comment"> *     åŸŸï¼Œæ–°ç‰ˆæµè§ˆå™¨å¯¹äºå‡½æ•°ï¼ˆåœ¨æ¡ä»¶åˆ¤æ–­ä¸­çš„å‡½æ•°ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> *     ä¸ç®¡æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œéƒ½åªæ˜¯å…ˆå£°æ˜ï¼Œæ²¡æœ‰å®šä¹‰ï¼Œç±»ä¼¼äºvar</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">1</span> === <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="é‡åé—®é¢˜çš„å¤„ç†"><a href="#é‡åé—®é¢˜çš„å¤„ç†" class="headerlink" title="é‡åé—®é¢˜çš„å¤„ç†"></a>é‡åé—®é¢˜çš„å¤„ç†</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fn() <span class="comment">//=&gt;4</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn() <span class="comment">//=&gt;4</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn() <span class="comment">//=&gt;4</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="number">100</span> <span class="comment">//=&gt;å¸¦VARçš„åœ¨æå‡é˜¶æ®µåªæŠŠå£°æ˜å¤„ç†äº†,èµ‹å€¼æ“ä½œæ²¡æœ‰å¤„ç†,æ‰€ä»¥åœ¨ä»£ç æ‰§è¡Œçš„æ—¶å€™éœ€è¦å®Œæˆèµ‹å€¼ FN=100</span></span><br><span class="line">fn() <span class="comment">//=&gt;100() Uncaught TypeError: fn is not a function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn()</span><br></pre></td></tr></table></figure>

<p>å¸¦ VAR å’Œ FUNCTION å…³é”®å­—å£°æ˜ç›¸åŒçš„åå­—ï¼Œè¿™ç§ä¹Ÿç®—æ˜¯é‡åäº†ï¼ˆå…¶å®æ˜¯ä¸€ä¸ª FNï¼Œåªæ˜¯å­˜å‚¨å€¼çš„ç±»å‹ä¸ä¸€æ ·ï¼‰<br>å…³äºé‡åçš„å¤„ç†ï¼šå¦‚æœåå­—é‡å¤äº†ï¼Œä¸ä¼šé‡æ–°çš„å£°æ˜ï¼Œä½†æ˜¯ä¼šé‡æ–°çš„å®šä¹‰ï¼ˆé‡æ–°èµ‹å€¼ï¼‰[ä¸ç®¡æ˜¯å˜é‡æå‡è¿˜æ˜¯ä»£ç æ‰§è¡Œé˜¶æ®µçš†æ˜¯å¦‚æ­¤]</p>
]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>å˜é‡æå‡</tag>
      </tags>
  </entry>
  <entry>
    <title>jqueryè®¾è®¡çš„å·§å¦™</title>
    <url>/2019/09/07/jquery%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%B7%A7%E5%A6%99/</url>
    <content><![CDATA[<p>æœ€è¿‘å¼€å§‹é˜…è¯»jqueryçš„æºç ï¼Œé¦–å…ˆå…ˆæç‚¼å‡ºjqueryçš„æ ¸å¿ƒç»“æ„ã€‚</p>
<a id="more"></a>
<h2 id="è‡ªæ‰§è¡Œå‡½æ•°"><a href="#è‡ªæ‰§è¡Œå‡½æ•°" class="headerlink" title="è‡ªæ‰§è¡Œå‡½æ•°"></a>è‡ªæ‰§è¡Œå‡½æ•°</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window,undefined</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆä¼ å…¥window"><a href="#ä¸ºä»€ä¹ˆä¼ å…¥window" class="headerlink" title="ä¸ºä»€ä¹ˆä¼ å…¥window?"></a>ä¸ºä»€ä¹ˆä¼ å…¥window?</h3><p><strong>1.ä»£ç å‹ç¼©</strong></p>
<p>é¦–å…ˆä»ä»£ç å‹ç¼©æ··æ·†çš„è§’åº¦è€ƒè™‘ï¼Œç”¨çº¿ä¸Šå·¥å…·æ¥å‹ç¼©æ··æ·†ä¸‹é¢è¿™æ®µç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name=<span class="string">"hello"</span>;</span><br><span class="line">  <span class="built_in">window</span>.description=<span class="string">"hi "</span>+name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‹å®Œæ··å®Œåç˜¦äº†ä¸€ç‚¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> a=<span class="string">"hello"</span>;<span class="built_in">window</span>.description=<span class="string">"hi "</span>+a&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨aä»£æ›¿äº†nameï¼Œä½†æ˜¯windowæ—¢ä¸æ˜¯å£°æ˜çš„å±€éƒ¨å˜é‡ä¹Ÿä¸æ˜¯å‚æ•°ï¼Œæ˜¯ä¸ä¼šè¢«å‹ç¼©æ··æ·†çš„ã€‚<br>æ‰€ä»¥å°†windowä½œä¸ºå‚æ•°ä¼ å…¥å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å°†windowä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¯ä»¥åœ¨å‹ç¼©ä»£ç æ—¶è¿›è¡Œä¼˜åŒ–ï¼Œå³å‚æ•°åå¯ä»¥å‹ç¼©å˜çŸ­ã€‚ä¹Ÿå¯ä»¥åœ¨å‡½æ•°å†…å¦èµ·ä¸ªç®€çŸ­çš„å˜é‡åä»£æ›¿ã€‚  </p>
<p><strong>2.ä½œç”¨åŸŸ</strong></p>
<p>è®¿é—®å½“å‰ä½œç”¨åŸŸä¸‹çš„å˜é‡æ¯”è®¿é—®å…¨å±€å˜é‡è¦å¿«<br>å¦‚æœä¸ä¼ å…¥ï¼Œæ¯ä¸ªè¯­å¥éƒ½è¦å»æ‰¾ä¸€æ¬¡windowã€‚å¦‚æœå°†windowä½œä¸ºå‚æ•°ä¼ é€’è¿‡å»ï¼Œä¸è¦æ¯ä¸ªè¯­å¥éƒ½å»æ‰¾windowï¼Œæé«˜äº†æ•ˆç‡ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦ä¼ å…¥undefinedï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä¼ å…¥undefinedï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¼ å…¥undefinedï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä¼ å…¥undefinedï¼Ÿ</h3><p>undefinedå¹¶ä¸æ˜¯ä½œä¸ºJavaScriptçš„ä¿ç•™å…³é”®å­—ï¼›undefinedåœ¨IE8åŠä»¥ä¸‹ä¸­æ˜¯å¯ä»¥å¯¹å…¶é‡æ–°èµ‹å€¼çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var undefined&#x3D;&quot;new value&quot;;</span><br><span class="line">alert(undefined);&#x2F;&#x2F;alert â€œnew value&quot;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡ŒåŒ¿åå‡½æ•°çš„æ—¶å€™ï¼Œåªä¼ é€’ä¸€ä¸ªå‚æ•°windowï¼Œè€Œä¸ä¼ é€’undefinedï¼Œé‚£ä¹ˆå‡½æ•°ä½“ä¸­çš„undefinedå±€éƒ¨å˜é‡çš„å€¼ï¼Œåˆšå¥½å°±æ˜¯undefined</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span> = <span class="number">8</span>;  </span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> window </span>) </span>&#123;   </span><br><span class="line">    alert(<span class="built_in">window</span>.undefined); <span class="comment">// 8  </span></span><br><span class="line">    alert(<span class="literal">undefined</span>); <span class="comment">// 8  </span></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>
<p>åŠ äº†undefinedå</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span> = <span class="number">8</span>;  </span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> window, undefined </span>) </span>&#123;   </span><br><span class="line">    alert(<span class="built_in">window</span>.undefined);  <span class="comment">// 8  </span></span><br><span class="line">    alert(<span class="literal">undefined</span>); <span class="comment">// æ­¤å¤„undefinedå‚æ•°ä¸ºå±€éƒ¨çš„åç§°ä¸ºundefinedå˜é‡ï¼Œå€¼ä¸ºundefined  </span></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>
<p>åœ¨ è‡ªè°ƒç”¨åŒ¿åå‡½æ•° çš„ä½œç”¨åŸŸå†…ï¼Œç¡®ä¿undefinedæ˜¯çœŸçš„æœªå®šä¹‰ã€‚å› ä¸ºundefinedèƒ½å¤Ÿè¢«é‡å†™ï¼Œèµ‹äºˆæ–°çš„å€¼.</p>
<h2 id="new-jQuery-fn-init-selector-context"><a href="#new-jQuery-fn-init-selector-context" class="headerlink" title="new jQuery.fn.init( selector, context );"></a>new jQuery.fn.init( selector, context );</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context );</span><br><span class="line">    <span class="comment">//=&gt;åˆ›å»ºäº†initè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œä¹Ÿç›¸å½“äºåˆ›å»ºäº†jQueryè¿™ä¸ªç±»çš„å®ä¾‹ï¼ˆå› ä¸ºåœ¨åé¢çš„æ—¶å€™ï¼Œè®©init.prototype=jQuery.prototypeï¼‰&#125;;</span></span><br><span class="line">jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦ç†è§£è¿™æ®µä»£ç ï¼Œé¦–å…ˆè¦ç†è§£jqueryçš„ä¸¤ç§è°ƒç”¨</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'body'</span>).css(<span class="string">'background'</span>,<span class="string">'red'</span>);</span><br><span class="line">$.parseJSON(<span class="string">'&#123;&#125;'</span>);</span><br></pre></td></tr></table></figure>
<p>$(â€˜bodyâ€™)åº”è¯¥æ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œcssæ˜¯æ¯ä¸ªå®ä¾‹å…±äº«çš„æ–¹æ³•ï¼Œæ˜¯åŸå‹ä¸Šçš„æ–¹æ³•ã€‚<br>è€Œ$åˆ™æ˜¯ä¸€ä¸ªç±»ï¼ŒparseJSONåˆ™æ˜¯ç±»çš„é™æ€æ–¹æ³•ã€‚  </p>
<h3 id="å¦‚ä½•ä¸ç”¨newå…³é”®å­—å¾—åˆ°jQueryå¯¹è±¡ï¼Ÿ"><a href="#å¦‚ä½•ä¸ç”¨newå…³é”®å­—å¾—åˆ°jQueryå¯¹è±¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¸ç”¨newå…³é”®å­—å¾—åˆ°jQueryå¯¹è±¡ï¼Ÿ"></a>å¦‚ä½•ä¸ç”¨newå…³é”®å­—å¾—åˆ°jQueryå¯¹è±¡ï¼Ÿ</h3><p>ä¸€èˆ¬è·å–å®ä¾‹å¯¹è±¡è°ƒå–å®ä¾‹æ–¹æ³•çš„ä¾‹å­ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨newåˆ™ä¼šæŠ¥é”™</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> demo=<span class="keyword">new</span> Demo(<span class="string">"jacky"</span>);</span><br><span class="line">demo.change();</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è·å–jQueryå¯¹è±¡ï¼ˆä»¥ä¸‹ç®€ç§°JQå¯¹è±¡ï¼‰ç”¨newå’Œä¸ç”¨newéƒ½å¯ä»¥ï¼Œè¿”å›çš„æ˜¯ä¸€æ ·çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log($(<span class="string">'*'</span>).length);<span class="comment">//14</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> $(<span class="string">'*'</span>).length);<span class="comment">//14</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°éœ€è¦<strong>åœ¨æ„é€ å‡½æ•°å†…éƒ¨è¿”å›å¯¹è±¡</strong>ã€‚</p>
<p>æ„é€ å‡½æ•°æœ‰returnå€¼æ€ä¹ˆåŠï¼Ÿ<br><strong>æ„é€ å‡½æ•°é‡Œæ²¡æœ‰æ˜¾å¼è°ƒç”¨returnæ—¶ï¼Œé»˜è®¤æ˜¯è¿”å›thiså¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ–°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡ã€‚</strong></p>
<p>å½“æ„é€ å‡½æ•°é‡Œè°ƒç”¨returnæ—¶ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p>
<blockquote>
<p>1.returnçš„æ˜¯äº”ç§ç®€å•æ•°æ®ç±»å‹ï¼šStringï¼ŒNumberï¼ŒBooleanï¼ŒNullï¼ŒUndefinedã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œå¿½è§†returnå€¼ï¼Œä¾ç„¶è¿”å›thiså¯¹è±¡ã€‚<br>2.returnçš„æ˜¯Object è¿™ç§æƒ…å†µä¸‹ï¼Œä¸å†è¿”å›thiså¯¹è±¡ï¼Œè€Œæ˜¯è¿”å›returnè¯­å¥çš„è¿”å›å€¼ã€‚</p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨jQueryæ„é€ å‡½æ•°å†…éƒ¨å»è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ç”¨newçš„æ–¹å¼å»åˆ›å»ºJQå¯¹è±¡äº†ï¼Œå…¶å®è¿™æ—¶å€™ï¼Œæ„é€ å‡½æ•°å°±ç›¸å½“äºä¸€ä¸ªå·¥å‚å‡½æ•°äº†ã€‚</p>
<p>è¯¥è¿”å›ä»€ä¹ˆæ ·çš„å¯¹è±¡ï¼Ÿå¯¹äºè¿™ä¸ªå¯¹è±¡æœ‰ä½•è¦æ±‚ï¼Ÿ<br>è¿™ä¸ªå¯¹è±¡å¿…é¡»å¯ä»¥è°ƒç”¨jQuery.prototypeä¸Šçš„æ–¹æ³•</p>
<p>æˆ‘ä»¬ä½¿ç”¨æˆ–è‡ªå·±å†™jQueryæ’ä»¶çš„æ—¶å€™ä¼šç»å¸¸é‡åˆ°$.fnè¿™ä¸ªå¯¹è±¡ï¼Œå¾ˆå¤šæ’ä»¶éƒ½æ˜¯é€šè¿‡æ‰©å±•è¿™ä¸ªå¯¹è±¡æ¥å®ç°çš„ã€‚<br>$.fnå…¶å®å¯¹åº”ç€jQuery.prototypeï¼Œ$å’Œfnåˆ†åˆ«æ˜¯jQueryå’Œprototypeçš„ç®€å†™æ–¹å¼ï¼Œåªè¦æˆ‘ä»¬æŠŠæ–¹æ³•æ‰©å±•åˆ°è¿™ä¸ªåŸå‹å¯¹è±¡èº«ä¸Šï¼Œé€šè¿‡$()è·å–çš„JQå¯¹è±¡éƒ½æ˜¯å¯ä»¥è®¿é—®åˆ°æ–¹æ³•çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.greeting=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">'hi'</span>)&#125;;</span><br><span class="line">$(<span class="string">'body'</span>).greeting();<span class="comment">// alert 'hi'</span></span><br></pre></td></tr></table></figure>
<p>jqueryæºç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context, rootjQuery );</span><br><span class="line">&#125;,</span><br><span class="line">jQuery.fn = jQuery.prototype = &#123; <span class="comment">// fnå³å¯¹åº”prototype</span></span><br><span class="line">    <span class="keyword">constructor</span>: jQuery,</span><br><span class="line">    init: function( selector, context, rootjQuery ) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jQuery.fn.init.prototype = jQuery.fn;<br>çœ‹åˆ°ä¸Šé¢è¿™æ®µæºç ï¼ŒåŸå› å°±å¾ˆæ˜æ˜¾äº†ï¼Œâ€jQuery.fn.init.prototype = jQuery.fnâ€è¿™å¥å¾ˆé‡è¦ï¼Œå®ƒå°†initçš„åŸå‹æŒ‡å‘jQueryçš„åŸå‹ï¼Œæ‰€ä»¥JQå¯¹è±¡æ‰å¯ä»¥è®¿é—®â€˜cssâ€™ã€â€™showâ€™ã€â€™hideâ€™è¿™äº›å†™åœ¨jQuery.fnä¸Šçš„æ–¹æ³•ã€‚å…¶å®æˆ‘ä»¬æ‰€è¯´çš„JQå¯¹è±¡æ ¹æœ¬å°±æ˜¯initå‡½æ•°çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œinitåˆ™æ˜¯jQueryåŸå‹ä¸Šçš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæœ¬èº«æ˜¯æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•çš„ï¼Œå…¨é ä»jQueryåŸå‹ä¸Šæ‹¿ã€‚</p>
<p>ä¸ºä½•è¦ä»initè¿™ç»•è¿™ä¹ˆä¸€å¤§åœˆæ¥è®¿é—®jQueryçš„åŸå‹ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªjQueryå®ä¾‹ç›´æ¥é€šè¿‡è¿™ä¸ªå®ä¾‹æ¥è®¿é—®è‡ªèº«åŸå‹ï¼Ÿæ¯”å¦‚è¯´ä»£ç å¯ä»¥å†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> jQuery();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é—®é¢˜å¾ˆæ˜æ˜¾ï¼Œæ­»åœ¨å¾ªç¯é‡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jQuery.fn.init();<span class="comment">// ä¸åŒç‚¹åœ¨äºå»æ‰äº†newå…³é”®å­—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åšç‚¹åŠ¨ä½œæ¥è¯æ˜åŠ ä¸Šnewæ˜¯æœ‰ç”¨çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jQuery.fn.init();</span><br><span class="line">&#125;,</span><br><span class="line">jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name=<span class="string">'sheila'</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    anotherName:<span class="string">'sunwukong'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jq=jQuery();</span><br><span class="line"><span class="built_in">console</span>.log(jq.anotherName);<span class="comment">// "sunwukong"</span></span><br><span class="line"><span class="built_in">console</span>.log(jq.name);<span class="comment">// "sheila"</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ®µä»£ç æ˜¯ä¸ºäº†è¯´æ˜thisçš„ä½œç”¨åŸŸé—®é¢˜ï¼Œå…¶ä¸ä»…èƒ½è®¿é—®initå‡½æ•°å†…éƒ¨ï¼Œè¿˜èƒ½å‘ä¸Šä¸€å±‚åˆ°fnå¯¹è±¡ï¼Œä½œç”¨åŸŸä¸ç‹¬ç«‹.å¦‚æœæ˜¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init();</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(jq.anotherName);<span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(jq.name);<span class="comment">//  "sheila"</span></span><br></pre></td></tr></table></figure>
<p>åŠ ä¸åŠ newè¿˜ç‰µæ¶‰åˆ°ä¸€ä¸ªæ›´é‡è¦çš„é—®é¢˜ï¼šè¿”å›çš„å¯¹è±¡ç©¶ç«Ÿæ˜¯è°ã€‚</p>
<p>ä¸åŠ newçš„æƒ…å†µä¸‹ï¼Œâ€™jQuery.fn.init()â€™ç›¸å½“äºè°ƒç”¨æ–¹æ³•ï¼ŒthisæŒ‡å‘çš„ä»¥åŠæœ€åè¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªjQuery.fnå¯¹è±¡ï¼Œ$(â€˜bodyâ€™)å’Œ$(â€˜pâ€™)å°±æ²¡æœ‰åŒºåˆ†äº†ã€‚</p>
<p>æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚è€ŒåŠ äº†newï¼Œå°±æ˜¯æ¯æ¬¡ç”¨æ„é€ å‡½æ•°å®ä¾‹åŒ–äº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå½¼æ­¤éƒ½æ˜¯ä¸åŒçš„</p>
]]></content>
      <categories>
        <category>å¼€å‘æ‚è®°</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>this.props.history.push()æŠ¥é”™è§£å†³</title>
    <url>/2019/04/05/this-props-history-push%E6%96%B9%E6%B3%95%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨ React çš„è·¯ç”±è·³è½¬æ—¶ï¼Œå‡ºç°äº†è¿™ä¸ªé”™è¯¯â€cannot read property â€˜pushâ€™ of undefinedâ€ï¼Œæ‰¾æ¥æ‰¾å»ï¼Œå‘ç°æ˜¯å­ç»„ä»¶è¿™æ ·è°ƒç”¨æ—¶æ‰ä¼šæŠ¥é”™,å®ƒä¸æ˜¯è·¯ç”±ç»„ä»¶ã€‚ä»¥ä¸‹æ˜¯è§£å†³æ–¹æ¡ˆï¼š</p><a id="more"></a><p>åœ¨æˆ‘çš„æ¯ä¸ªé¡µé¢ä¸­ï¼ŒHeader ç»„ä»¶éƒ½ä¼šå¼•å…¥ï¼Œä½¿å…¶æˆä¸ºå­ç»„ä»¶</p><h3 id="é€šè¿‡çˆ¶ç»„ä»¶ä¼ å€¼ç»™å­ç»„ä»¶"><a href="#é€šè¿‡çˆ¶ç»„ä»¶ä¼ å€¼ç»™å­ç»„ä»¶" class="headerlink" title="é€šè¿‡çˆ¶ç»„ä»¶ä¼ å€¼ç»™å­ç»„ä»¶"></a>é€šè¿‡çˆ¶ç»„ä»¶ä¼ å€¼ç»™å­ç»„ä»¶</h3><p>åœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œä¼ é€’ä¸€ä¸ª history ç»™å­ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Header history=&#123;<span class="keyword">this</span>.props.history&#125; /&gt;</span><br></pre></td></tr></table></figure><p>å­ç»„ä»¶æ–¹æ³•è¿˜æ˜¯ä¸€æ ·å†™</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.props.history.push(<span class="string">'/login'</span>)</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœ Header ç»„ä»¶è¢«åµŒå¥—å°è£…æ›´æ·±çš„è¯æ˜¯ä¸è¡Œçš„ï¼Œè¿™æ—¶åªèƒ½é€‰æ‹©ç¬¬äºŒç§æ–¹æ³•ã€‚</p><h3 id="ä½¿ç”¨-withRouter"><a href="#ä½¿ç”¨-withRouter" class="headerlink" title="ä½¿ç”¨ withRouter"></a>ä½¿ç”¨ withRouter</h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹å¿…é¡»ç»è¿‡è·¯ç”±åŒ¹é…æ¸²æŸ“çš„ç»„ä»¶æ‰å­˜åœ¨ this.props,æ‰æ‹¥æœ‰è·¯ç”±å‚æ•°ï¼Œæ‰§è¡Œ this.props.history.push(â€˜/loginâ€™)è·³è½¬åˆ°å¯¹åº”è·¯ç”±çš„é¡µé¢ï¼Œç„¶è€Œä¸æ˜¯æ‰€æœ‰ç»„ä»¶éƒ½ç›´æ¥ä¸è·¯ç”±ç›¸è¿ï¼ˆé€šè¿‡è·¯ç”±è·³è½¬åˆ°æ­¤ç»„ä»¶ï¼‰çš„ï¼Œå½“è¿™äº›ç»„ä»¶éœ€è¦è·¯ç”±å‚æ•°æ—¶ï¼Œä½¿ç”¨ withRouter å°±å¯ä»¥ç»™æ­¤ç»„ä»¶ä¼ å…¥è·¯ç”±å‚æ•°ï¼Œå°† react-router çš„ historyã€locationã€match ä¸‰ä¸ªå¯¹è±¡ä¼ å…¥ props å¯¹è±¡ä¸Šï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ this.propsã€‚</p></blockquote><p>å¯è§å½“ä¸€ä¸ªéè·¯ç”±ç»„ä»¶ä¹Ÿæƒ³è®¿é—®åˆ°å½“å‰è·¯ç”±çš„ match,location,history å¯¹è±¡ï¼Œé‚£ä¹ˆ withRouter å°†æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ï¼Œå¯ä»¥ç†è§£ä¸ºå°†ä¸€ä¸ªç»„ä»¶åŒ…è£¹æˆè·¯ç”±ç»„ä»¶ã€‚</p><p>ç”¨æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(Header) <span class="comment">// exportæ—¶è¦ä½¿ç”¨withRouter</span></span><br></pre></td></tr></table></figure><p>åœ¨ Header ç»„ä»¶å¼•å…¥å¹¶ä½¿ç”¨ï¼Œå°±å¯ä»¥ä½¿ç”¨ this.props.history.push æ–¹æ³•è¿›è¡Œæ­£å¸¸è·³è½¬äº†~~</p>]]></content>
      <categories>
        <category>Reactç³»åˆ—</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDBæ€§èƒ½ä¹‹é€æ¡æ’å…¥ä¸æ‰¹é‡æ’å…¥</title>
    <url>/2018/05/12/MongoDB%E6%80%A7%E8%83%BD%E4%B9%8B%E9%80%90%E6%9D%A1%E6%8F%92%E5%85%A5%E4%B8%8E%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5/</url>
    <content><![CDATA[<p>åœ¨ mongoDB ä¸­ï¼Œå½“æˆ‘ä»¬è¦æ’å…¥å¾ˆå¤šæ•°æ®æ—¶ï¼Œå¯ä»¥é€‰æ‹©ç”¨å¾ªç¯ä¾æ¬¡é€æ¡æ’å…¥ï¼Œæˆ–è€…å¯ä»¥å…ˆæŠŠæ‰€æœ‰æ•°æ®è£…åœ¨ä¸€ä¸ªæ•°ç»„å†æ•´ä¸ªæ•°ç»„æ’å…¥é›†åˆï¼Œä½†æ˜¯ï¼Œæœ€å¥½ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼â€¦</p>
<a id="more"></a>

<p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼ˆå·²æ–°å»ºæ•°æ®åº“ log å’Œé›†åˆ testï¼‰ï¼Œåœ¨ js å†™å…¥å¦‚ä¸‹ä»£ç </p>
<h2 id="é€æ¡æ’å…¥"><a href="#é€æ¡æ’å…¥" class="headerlink" title="é€æ¡æ’å…¥"></a>é€æ¡æ’å…¥</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="comment">//è·å¾—å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="keyword">var</span> db = connect(<span class="string">'log'</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  db.test.insert(&#123; <span class="attr">num</span>: <span class="number">1</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> runTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - startTime <span class="comment">//è·å¾—è¿è¡Œæ—¶é—´</span></span><br><span class="line">print(<span class="string">'runTime is '</span> + runTime + <span class="string">'ms'</span>) <span class="comment">//runTime is 745ms</span></span><br></pre></td></tr></table></figure>

<h2 id="æ‰¹é‡æ’å…¥"><a href="#æ‰¹é‡æ’å…¥" class="headerlink" title="æ‰¹é‡æ’å…¥"></a>æ‰¹é‡æ’å…¥</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="comment">//è·å¾—å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="keyword">var</span> db = connect(<span class="string">'log'</span>)</span><br><span class="line"><span class="keyword">var</span> tempArr = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  tempArr.push(&#123; <span class="attr">num</span>: <span class="number">1</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line">db.test.insert(tempArr)</span><br><span class="line"><span class="keyword">var</span> runTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - startTime</span><br><span class="line">print(<span class="string">'runTime is '</span> + runTime + <span class="string">'ms'</span>) <span class="comment">// runTime is 48ms</span></span><br></pre></td></tr></table></figure>

<p>ç”±è¿è¡Œæ—¶é—´æ¥çœ‹ï¼Œæ‰¹é‡æ’å…¥æ¯”é€æ¡æ’å…¥æ‰€ç”¨çš„æ—¶é—´å°‘äº†å¾ˆå¤šï¼Œåœ¨å°å‹é¡¹ç›®ä¸­å¯èƒ½æ„Ÿå—ä¸åˆ°çš„å·®è·ï¼Œåœ¨å¤§é¡¹ç›®å°±æ˜¯æ€§èƒ½çš„é—®é¢˜äº†ï¼Œæ•…åº”ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ¥æ‰¹é‡æ’å…¥æ•°æ®ã€‚</p>
]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
</search>
